import Xc from"jszip";import*as ed from"pdfjs-dist";import Ym from"katex";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();function Qm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Eu={exports:{}},Ql={},Lu={exports:{}},ot={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ba=Symbol.for("react.element"),qm=Symbol.for("react.portal"),Xm=Symbol.for("react.fragment"),ef=Symbol.for("react.strict_mode"),tf=Symbol.for("react.profiler"),sf=Symbol.for("react.provider"),nf=Symbol.for("react.context"),rf=Symbol.for("react.forward_ref"),af=Symbol.for("react.suspense"),lf=Symbol.for("react.memo"),of=Symbol.for("react.lazy"),td=Symbol.iterator;function cf(e){return e===null||typeof e!="object"?null:(e=td&&e[td]||e["@@iterator"],typeof e=="function"?e:null)}var Tu={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Au=Object.assign,Pu={};function Kr(e,s,n){this.props=e,this.context=s,this.refs=Pu,this.updater=n||Tu}Kr.prototype.isReactComponent={};Kr.prototype.setState=function(e,s){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,s,"setState")};Kr.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Ru(){}Ru.prototype=Kr.prototype;function nc(e,s,n){this.props=e,this.context=s,this.refs=Pu,this.updater=n||Tu}var rc=nc.prototype=new Ru;rc.constructor=nc;Au(rc,Kr.prototype);rc.isPureReactComponent=!0;var sd=Array.isArray,Du=Object.prototype.hasOwnProperty,ac={current:null},Ou={key:!0,ref:!0,__self:!0,__source:!0};function zu(e,s,n){var r,a={},l=null,o=null;if(s!=null)for(r in s.ref!==void 0&&(o=s.ref),s.key!==void 0&&(l=""+s.key),s)Du.call(s,r)&&!Ou.hasOwnProperty(r)&&(a[r]=s[r]);var i=arguments.length-2;if(i===1)a.children=n;else if(1<i){for(var c=Array(i),d=0;d<i;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in i=e.defaultProps,i)a[r]===void 0&&(a[r]=i[r]);return{$$typeof:Ba,type:e,key:l,ref:o,props:a,_owner:ac.current}}function df(e,s){return{$$typeof:Ba,type:e.type,key:s,ref:e.ref,props:e.props,_owner:e._owner}}function lc(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ba}function uf(e){var s={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return s[n]})}var nd=/\/+/g;function bo(e,s){return typeof e=="object"&&e!==null&&e.key!=null?uf(""+e.key):s.toString(36)}function fl(e,s,n,r,a){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(l){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Ba:case qm:o=!0}}if(o)return o=e,a=a(o),e=r===""?"."+bo(o,0):r,sd(a)?(n="",e!=null&&(n=e.replace(nd,"$&/")+"/"),fl(a,s,n,"",function(d){return d})):a!=null&&(lc(a)&&(a=df(a,n+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(nd,"$&/")+"/")+e)),s.push(a)),1;if(o=0,r=r===""?".":r+":",sd(e))for(var i=0;i<e.length;i++){l=e[i];var c=r+bo(l,i);o+=fl(l,s,n,c,a)}else if(c=cf(e),typeof c=="function")for(e=c.call(e),i=0;!(l=e.next()).done;)l=l.value,c=r+bo(l,i++),o+=fl(l,s,n,c,a);else if(l==="object")throw s=String(e),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return o}function Za(e,s,n){if(e==null)return e;var r=[],a=0;return fl(e,r,"","",function(l){return s.call(n,l,a++)}),r}function mf(e){if(e._status===-1){var s=e._result;s=s(),s.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=s)}if(e._status===1)return e._result.default;throw e._result}var os={current:null},hl={transition:null},ff={ReactCurrentDispatcher:os,ReactCurrentBatchConfig:hl,ReactCurrentOwner:ac};function Bu(){throw Error("act(...) is not supported in production builds of React.")}ot.Children={map:Za,forEach:function(e,s,n){Za(e,function(){s.apply(this,arguments)},n)},count:function(e){var s=0;return Za(e,function(){s++}),s},toArray:function(e){return Za(e,function(s){return s})||[]},only:function(e){if(!lc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ot.Component=Kr;ot.Fragment=Xm;ot.Profiler=tf;ot.PureComponent=nc;ot.StrictMode=ef;ot.Suspense=af;ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ff;ot.act=Bu;ot.cloneElement=function(e,s,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Au({},e.props),a=e.key,l=e.ref,o=e._owner;if(s!=null){if(s.ref!==void 0&&(l=s.ref,o=ac.current),s.key!==void 0&&(a=""+s.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in s)Du.call(s,c)&&!Ou.hasOwnProperty(c)&&(r[c]=s[c]===void 0&&i!==void 0?i[c]:s[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){i=Array(c);for(var d=0;d<c;d++)i[d]=arguments[d+2];r.children=i}return{$$typeof:Ba,type:e.type,key:a,ref:l,props:r,_owner:o}};ot.createContext=function(e){return e={$$typeof:nf,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:sf,_context:e},e.Consumer=e};ot.createElement=zu;ot.createFactory=function(e){var s=zu.bind(null,e);return s.type=e,s};ot.createRef=function(){return{current:null}};ot.forwardRef=function(e){return{$$typeof:rf,render:e}};ot.isValidElement=lc;ot.lazy=function(e){return{$$typeof:of,_payload:{_status:-1,_result:e},_init:mf}};ot.memo=function(e,s){return{$$typeof:lf,type:e,compare:s===void 0?null:s}};ot.startTransition=function(e){var s=hl.transition;hl.transition={};try{e()}finally{hl.transition=s}};ot.unstable_act=Bu;ot.useCallback=function(e,s){return os.current.useCallback(e,s)};ot.useContext=function(e){return os.current.useContext(e)};ot.useDebugValue=function(){};ot.useDeferredValue=function(e){return os.current.useDeferredValue(e)};ot.useEffect=function(e,s){return os.current.useEffect(e,s)};ot.useId=function(){return os.current.useId()};ot.useImperativeHandle=function(e,s,n){return os.current.useImperativeHandle(e,s,n)};ot.useInsertionEffect=function(e,s){return os.current.useInsertionEffect(e,s)};ot.useLayoutEffect=function(e,s){return os.current.useLayoutEffect(e,s)};ot.useMemo=function(e,s){return os.current.useMemo(e,s)};ot.useReducer=function(e,s,n){return os.current.useReducer(e,s,n)};ot.useRef=function(e){return os.current.useRef(e)};ot.useState=function(e){return os.current.useState(e)};ot.useSyncExternalStore=function(e,s,n){return os.current.useSyncExternalStore(e,s,n)};ot.useTransition=function(){return os.current.useTransition()};ot.version="18.3.1";Lu.exports=ot;var u=Lu.exports;const $n=Qm(u);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hf=u,pf=Symbol.for("react.element"),xf=Symbol.for("react.fragment"),gf=Object.prototype.hasOwnProperty,bf=hf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,vf={key:!0,ref:!0,__self:!0,__source:!0};function Wu(e,s,n){var r,a={},l=null,o=null;n!==void 0&&(l=""+n),s.key!==void 0&&(l=""+s.key),s.ref!==void 0&&(o=s.ref);for(r in s)gf.call(s,r)&&!vf.hasOwnProperty(r)&&(a[r]=s[r]);if(e&&e.defaultProps)for(r in s=e.defaultProps,s)a[r]===void 0&&(a[r]=s[r]);return{$$typeof:pf,type:e,key:l,ref:o,props:a,_owner:bf.current}}Ql.Fragment=xf;Ql.jsx=Wu;Ql.jsxs=Wu;Eu.exports=Ql;var t=Eu.exports,ti={},Uu={exports:{}},ks={},Fu={exports:{}},Hu={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function s(P,Z){var X=P.length;P.push(Z);e:for(;0<X;){var pe=X-1>>>1,Ce=P[pe];if(0<a(Ce,Z))P[pe]=Z,P[X]=Ce,X=pe;else break e}}function n(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var Z=P[0],X=P.pop();if(X!==Z){P[0]=X;e:for(var pe=0,Ce=P.length,je=Ce>>>1;pe<je;){var Pe=2*(pe+1)-1,ge=P[Pe],ce=Pe+1,N=P[ce];if(0>a(ge,X))ce<Ce&&0>a(N,ge)?(P[pe]=N,P[ce]=X,pe=ce):(P[pe]=ge,P[Pe]=X,pe=Pe);else if(ce<Ce&&0>a(N,X))P[pe]=N,P[ce]=X,pe=ce;else break e}}return Z}function a(P,Z){var X=P.sortIndex-Z.sortIndex;return X!==0?X:P.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var o=Date,i=o.now();e.unstable_now=function(){return o.now()-i}}var c=[],d=[],f=1,h=null,p=3,m=!1,x=!1,y=!1,C=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(P){for(var Z=n(d);Z!==null;){if(Z.callback===null)r(d);else if(Z.startTime<=P)r(d),Z.sortIndex=Z.expirationTime,s(c,Z);else break;Z=n(d)}}function w(P){if(y=!1,v(P),!x)if(n(c)!==null)x=!0,G(z);else{var Z=n(d);Z!==null&&Ee(w,Z.startTime-P)}}function z(P,Z){x=!1,y&&(y=!1,g(j),j=-1),m=!0;var X=p;try{for(v(Z),h=n(c);h!==null&&(!(h.expirationTime>Z)||P&&!Ne());){var pe=h.callback;if(typeof pe=="function"){h.callback=null,p=h.priorityLevel;var Ce=pe(h.expirationTime<=Z);Z=e.unstable_now(),typeof Ce=="function"?h.callback=Ce:h===n(c)&&r(c),v(Z)}else r(c);h=n(c)}if(h!==null)var je=!0;else{var Pe=n(d);Pe!==null&&Ee(w,Pe.startTime-Z),je=!1}return je}finally{h=null,p=X,m=!1}}var k=!1,M=null,j=-1,H=5,te=-1;function Ne(){return!(e.unstable_now()-te<H)}function Me(){if(M!==null){var P=e.unstable_now();te=P;var Z=!0;try{Z=M(!0,P)}finally{Z?me():(k=!1,M=null)}}else k=!1}var me;if(typeof b=="function")me=function(){b(Me)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,se=F.port2;F.port1.onmessage=Me,me=function(){se.postMessage(null)}}else me=function(){C(Me,0)};function G(P){M=P,k||(k=!0,me())}function Ee(P,Z){j=C(function(){P(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_continueExecution=function(){x||m||(x=!0,G(z))},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(P){switch(p){case 1:case 2:case 3:var Z=3;break;default:Z=p}var X=p;p=Z;try{return P()}finally{p=X}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(P,Z){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var X=p;p=P;try{return Z()}finally{p=X}},e.unstable_scheduleCallback=function(P,Z,X){var pe=e.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?pe+X:pe):X=pe,P){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=X+Ce,P={id:f++,callback:Z,priorityLevel:P,startTime:X,expirationTime:Ce,sortIndex:-1},X>pe?(P.sortIndex=X,s(d,P),n(c)===null&&P===n(d)&&(y?(g(j),j=-1):y=!0,Ee(w,X-pe))):(P.sortIndex=Ce,s(c,P),x||m||(x=!0,G(z))),P},e.unstable_shouldYield=Ne,e.unstable_wrapCallback=function(P){var Z=p;return function(){var X=p;p=Z;try{return P.apply(this,arguments)}finally{p=X}}}})(Hu);Fu.exports=Hu;var wf=Fu.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yf=u,Ns=wf;function _e(e){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)s+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Gu=new Set,Na={};function hr(e,s){Wr(e,s),Wr(e+"Capture",s)}function Wr(e,s){for(Na[e]=s,e=0;e<s.length;e++)Gu.add(s[e])}var Nn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),si=Object.prototype.hasOwnProperty,jf=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rd={},ad={};function Nf(e){return si.call(ad,e)?!0:si.call(rd,e)?!1:jf.test(e)?ad[e]=!0:(rd[e]=!0,!1)}function kf(e,s,n,r){if(n!==null&&n.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Sf(e,s,n,r){if(s===null||typeof s>"u"||kf(e,s,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function is(e,s,n,r,a,l,o){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=s,this.sanitizeURL=l,this.removeEmptyString=o}var Ut={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ut[e]=new is(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var s=e[0];Ut[s]=new is(s,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ut[e]=new is(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ut[e]=new is(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ut[e]=new is(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ut[e]=new is(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ut[e]=new is(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ut[e]=new is(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ut[e]=new is(e,5,!1,e.toLowerCase(),null,!1,!1)});var oc=/[\-:]([a-z])/g;function ic(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var s=e.replace(oc,ic);Ut[s]=new is(s,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var s=e.replace(oc,ic);Ut[s]=new is(s,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var s=e.replace(oc,ic);Ut[s]=new is(s,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ut[e]=new is(e,1,!1,e.toLowerCase(),null,!1,!1)});Ut.xlinkHref=new is("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ut[e]=new is(e,1,!1,e.toLowerCase(),null,!0,!0)});function cc(e,s,n,r){var a=Ut.hasOwnProperty(s)?Ut[s]:null;(a!==null?a.type!==0:r||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Sf(s,n,a,r)&&(n=null),r||a===null?Nf(s)&&(n===null?e.removeAttribute(s):e.setAttribute(s,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(s=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(s):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,s,n):e.setAttribute(s,n))))}var Mn=yf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ja=Symbol.for("react.element"),yr=Symbol.for("react.portal"),jr=Symbol.for("react.fragment"),dc=Symbol.for("react.strict_mode"),ni=Symbol.for("react.profiler"),Vu=Symbol.for("react.provider"),Zu=Symbol.for("react.context"),uc=Symbol.for("react.forward_ref"),ri=Symbol.for("react.suspense"),ai=Symbol.for("react.suspense_list"),mc=Symbol.for("react.memo"),En=Symbol.for("react.lazy"),Ju=Symbol.for("react.offscreen"),ld=Symbol.iterator;function ta(e){return e===null||typeof e!="object"?null:(e=ld&&e[ld]||e["@@iterator"],typeof e=="function"?e:null)}var St=Object.assign,vo;function da(e){if(vo===void 0)try{throw Error()}catch(n){var s=n.stack.trim().match(/\n( *(at )?)/);vo=s&&s[1]||""}return`
`+vo+e}var wo=!1;function yo(e,s){if(!e||wo)return"";wo=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(d){var r=d}Reflect.construct(e,[],s)}else{try{s.call()}catch(d){r=d}e.call(s.prototype)}else{try{throw Error()}catch(d){r=d}e()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),l=r.stack.split(`
`),o=a.length-1,i=l.length-1;1<=o&&0<=i&&a[o]!==l[i];)i--;for(;1<=o&&0<=i;o--,i--)if(a[o]!==l[i]){if(o!==1||i!==1)do if(o--,i--,0>i||a[o]!==l[i]){var c=`
`+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=i);break}}}finally{wo=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?da(e):""}function Cf(e){switch(e.tag){case 5:return da(e.type);case 16:return da("Lazy");case 13:return da("Suspense");case 19:return da("SuspenseList");case 0:case 2:case 15:return e=yo(e.type,!1),e;case 11:return e=yo(e.type.render,!1),e;case 1:return e=yo(e.type,!0),e;default:return""}}function li(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case jr:return"Fragment";case yr:return"Portal";case ni:return"Profiler";case dc:return"StrictMode";case ri:return"Suspense";case ai:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Zu:return(e.displayName||"Context")+".Consumer";case Vu:return(e._context.displayName||"Context")+".Provider";case uc:var s=e.render;return e=e.displayName,e||(e=s.displayName||s.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case mc:return s=e.displayName||null,s!==null?s:li(e.type)||"Memo";case En:s=e._payload,e=e._init;try{return li(e(s))}catch{}}return null}function $f(e){var s=e.type;switch(e.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=s.render,e=e.displayName||e.name||"",s.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return li(s);case 8:return s===dc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Zn(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ku(e){var s=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Mf(e){var s=Ku(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,s),r=""+e[s];if(!e.hasOwnProperty(s)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,l=n.set;return Object.defineProperty(e,s,{configurable:!0,get:function(){return a.call(this)},set:function(o){r=""+o,l.call(this,o)}}),Object.defineProperty(e,s,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[s]}}}}function Ka(e){e._valueTracker||(e._valueTracker=Mf(e))}function Yu(e){if(!e)return!1;var s=e._valueTracker;if(!s)return!0;var n=s.getValue(),r="";return e&&(r=Ku(e)?e.checked?"true":"false":e.value),e=r,e!==n?(s.setValue(e),!0):!1}function Sl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function oi(e,s){var n=s.checked;return St({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function od(e,s){var n=s.defaultValue==null?"":s.defaultValue,r=s.checked!=null?s.checked:s.defaultChecked;n=Zn(s.value!=null?s.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Qu(e,s){s=s.checked,s!=null&&cc(e,"checked",s,!1)}function ii(e,s){Qu(e,s);var n=Zn(s.value),r=s.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}s.hasOwnProperty("value")?ci(e,s.type,n):s.hasOwnProperty("defaultValue")&&ci(e,s.type,Zn(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(e.defaultChecked=!!s.defaultChecked)}function id(e,s,n){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var r=s.type;if(!(r!=="submit"&&r!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+e._wrapperState.initialValue,n||s===e.value||(e.value=s),e.defaultValue=s}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function ci(e,s,n){(s!=="number"||Sl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ua=Array.isArray;function Pr(e,s,n,r){if(e=e.options,s){s={};for(var a=0;a<n.length;a++)s["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=s.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Zn(n),s=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}s!==null||e[a].disabled||(s=e[a])}s!==null&&(s.selected=!0)}}function di(e,s){if(s.dangerouslySetInnerHTML!=null)throw Error(_e(91));return St({},s,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function cd(e,s){var n=s.value;if(n==null){if(n=s.children,s=s.defaultValue,n!=null){if(s!=null)throw Error(_e(92));if(ua(n)){if(1<n.length)throw Error(_e(93));n=n[0]}s=n}s==null&&(s=""),n=s}e._wrapperState={initialValue:Zn(n)}}function qu(e,s){var n=Zn(s.value),r=Zn(s.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),s.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function dd(e){var s=e.textContent;s===e._wrapperState.initialValue&&s!==""&&s!==null&&(e.value=s)}function Xu(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ui(e,s){return e==null||e==="http://www.w3.org/1999/xhtml"?Xu(s):e==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ya,e0=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(s,n,r,a)})}:e}(function(e,s){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=s;else{for(Ya=Ya||document.createElement("div"),Ya.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Ya.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;s.firstChild;)e.appendChild(s.firstChild)}});function ka(e,s){if(s){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=s;return}}e.textContent=s}var ha={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},If=["Webkit","ms","Moz","O"];Object.keys(ha).forEach(function(e){If.forEach(function(s){s=s+e.charAt(0).toUpperCase()+e.substring(1),ha[s]=ha[e]})});function t0(e,s,n){return s==null||typeof s=="boolean"||s===""?"":n||typeof s!="number"||s===0||ha.hasOwnProperty(e)&&ha[e]?(""+s).trim():s+"px"}function s0(e,s){e=e.style;for(var n in s)if(s.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=t0(n,s[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var _f=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mi(e,s){if(s){if(_f[e]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(_e(137,e));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(_e(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(_e(61))}if(s.style!=null&&typeof s.style!="object")throw Error(_e(62))}}function fi(e,s){if(e.indexOf("-")===-1)return typeof s.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hi=null;function fc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var pi=null,Rr=null,Dr=null;function ud(e){if(e=Fa(e)){if(typeof pi!="function")throw Error(_e(280));var s=e.stateNode;s&&(s=so(s),pi(e.stateNode,e.type,s))}}function n0(e){Rr?Dr?Dr.push(e):Dr=[e]:Rr=e}function r0(){if(Rr){var e=Rr,s=Dr;if(Dr=Rr=null,ud(e),s)for(e=0;e<s.length;e++)ud(s[e])}}function a0(e,s){return e(s)}function l0(){}var jo=!1;function o0(e,s,n){if(jo)return e(s,n);jo=!0;try{return a0(e,s,n)}finally{jo=!1,(Rr!==null||Dr!==null)&&(l0(),r0())}}function Sa(e,s){var n=e.stateNode;if(n===null)return null;var r=so(n);if(r===null)return null;n=r[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(_e(231,s,typeof n));return n}var xi=!1;if(Nn)try{var sa={};Object.defineProperty(sa,"passive",{get:function(){xi=!0}}),window.addEventListener("test",sa,sa),window.removeEventListener("test",sa,sa)}catch{xi=!1}function Ef(e,s,n,r,a,l,o,i,c){var d=Array.prototype.slice.call(arguments,3);try{s.apply(n,d)}catch(f){this.onError(f)}}var pa=!1,Cl=null,$l=!1,gi=null,Lf={onError:function(e){pa=!0,Cl=e}};function Tf(e,s,n,r,a,l,o,i,c){pa=!1,Cl=null,Ef.apply(Lf,arguments)}function Af(e,s,n,r,a,l,o,i,c){if(Tf.apply(this,arguments),pa){if(pa){var d=Cl;pa=!1,Cl=null}else throw Error(_e(198));$l||($l=!0,gi=d)}}function pr(e){var s=e,n=e;if(e.alternate)for(;s.return;)s=s.return;else{e=s;do s=e,s.flags&4098&&(n=s.return),e=s.return;while(e)}return s.tag===3?n:null}function i0(e){if(e.tag===13){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function md(e){if(pr(e)!==e)throw Error(_e(188))}function Pf(e){var s=e.alternate;if(!s){if(s=pr(e),s===null)throw Error(_e(188));return s!==e?null:e}for(var n=e,r=s;;){var a=n.return;if(a===null)break;var l=a.alternate;if(l===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===l.child){for(l=a.child;l;){if(l===n)return md(a),e;if(l===r)return md(a),s;l=l.sibling}throw Error(_e(188))}if(n.return!==r.return)n=a,r=l;else{for(var o=!1,i=a.child;i;){if(i===n){o=!0,n=a,r=l;break}if(i===r){o=!0,r=a,n=l;break}i=i.sibling}if(!o){for(i=l.child;i;){if(i===n){o=!0,n=l,r=a;break}if(i===r){o=!0,r=l,n=a;break}i=i.sibling}if(!o)throw Error(_e(189))}}if(n.alternate!==r)throw Error(_e(190))}if(n.tag!==3)throw Error(_e(188));return n.stateNode.current===n?e:s}function c0(e){return e=Pf(e),e!==null?d0(e):null}function d0(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var s=d0(e);if(s!==null)return s;e=e.sibling}return null}var u0=Ns.unstable_scheduleCallback,fd=Ns.unstable_cancelCallback,Rf=Ns.unstable_shouldYield,Df=Ns.unstable_requestPaint,It=Ns.unstable_now,Of=Ns.unstable_getCurrentPriorityLevel,hc=Ns.unstable_ImmediatePriority,m0=Ns.unstable_UserBlockingPriority,Ml=Ns.unstable_NormalPriority,zf=Ns.unstable_LowPriority,f0=Ns.unstable_IdlePriority,ql=null,mn=null;function Bf(e){if(mn&&typeof mn.onCommitFiberRoot=="function")try{mn.onCommitFiberRoot(ql,e,void 0,(e.current.flags&128)===128)}catch{}}var Xs=Math.clz32?Math.clz32:Ff,Wf=Math.log,Uf=Math.LN2;function Ff(e){return e>>>=0,e===0?32:31-(Wf(e)/Uf|0)|0}var Qa=64,qa=4194304;function ma(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Il(e,s){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,l=e.pingedLanes,o=n&268435455;if(o!==0){var i=o&~a;i!==0?r=ma(i):(l&=o,l!==0&&(r=ma(l)))}else o=n&~a,o!==0?r=ma(o):l!==0&&(r=ma(l));if(r===0)return 0;if(s!==0&&s!==r&&!(s&a)&&(a=r&-r,l=s&-s,a>=l||a===16&&(l&4194240)!==0))return s;if(r&4&&(r|=n&16),s=e.entangledLanes,s!==0)for(e=e.entanglements,s&=r;0<s;)n=31-Xs(s),a=1<<n,r|=e[n],s&=~a;return r}function Hf(e,s){switch(e){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gf(e,s){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,l=e.pendingLanes;0<l;){var o=31-Xs(l),i=1<<o,c=a[o];c===-1?(!(i&n)||i&r)&&(a[o]=Hf(i,s)):c<=s&&(e.expiredLanes|=i),l&=~i}}function bi(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function h0(){var e=Qa;return Qa<<=1,!(Qa&4194240)&&(Qa=64),e}function No(e){for(var s=[],n=0;31>n;n++)s.push(e);return s}function Wa(e,s,n){e.pendingLanes|=s,s!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,s=31-Xs(s),e[s]=n}function Vf(e,s){var n=e.pendingLanes&~s;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=s,e.mutableReadLanes&=s,e.entangledLanes&=s,s=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-Xs(n),l=1<<a;s[a]=0,r[a]=-1,e[a]=-1,n&=~l}}function pc(e,s){var n=e.entangledLanes|=s;for(e=e.entanglements;n;){var r=31-Xs(n),a=1<<r;a&s|e[r]&s&&(e[r]|=s),n&=~a}}var ft=0;function p0(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var x0,xc,g0,b0,v0,vi=!1,Xa=[],zn=null,Bn=null,Wn=null,Ca=new Map,$a=new Map,An=[],Zf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hd(e,s){switch(e){case"focusin":case"focusout":zn=null;break;case"dragenter":case"dragleave":Bn=null;break;case"mouseover":case"mouseout":Wn=null;break;case"pointerover":case"pointerout":Ca.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":$a.delete(s.pointerId)}}function na(e,s,n,r,a,l){return e===null||e.nativeEvent!==l?(e={blockedOn:s,domEventName:n,eventSystemFlags:r,nativeEvent:l,targetContainers:[a]},s!==null&&(s=Fa(s),s!==null&&xc(s)),e):(e.eventSystemFlags|=r,s=e.targetContainers,a!==null&&s.indexOf(a)===-1&&s.push(a),e)}function Jf(e,s,n,r,a){switch(s){case"focusin":return zn=na(zn,e,s,n,r,a),!0;case"dragenter":return Bn=na(Bn,e,s,n,r,a),!0;case"mouseover":return Wn=na(Wn,e,s,n,r,a),!0;case"pointerover":var l=a.pointerId;return Ca.set(l,na(Ca.get(l)||null,e,s,n,r,a)),!0;case"gotpointercapture":return l=a.pointerId,$a.set(l,na($a.get(l)||null,e,s,n,r,a)),!0}return!1}function w0(e){var s=rr(e.target);if(s!==null){var n=pr(s);if(n!==null){if(s=n.tag,s===13){if(s=i0(n),s!==null){e.blockedOn=s,v0(e.priority,function(){g0(n)});return}}else if(s===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pl(e){if(e.blockedOn!==null)return!1;for(var s=e.targetContainers;0<s.length;){var n=wi(e.domEventName,e.eventSystemFlags,s[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);hi=r,n.target.dispatchEvent(r),hi=null}else return s=Fa(n),s!==null&&xc(s),e.blockedOn=n,!1;s.shift()}return!0}function pd(e,s,n){pl(e)&&n.delete(s)}function Kf(){vi=!1,zn!==null&&pl(zn)&&(zn=null),Bn!==null&&pl(Bn)&&(Bn=null),Wn!==null&&pl(Wn)&&(Wn=null),Ca.forEach(pd),$a.forEach(pd)}function ra(e,s){e.blockedOn===s&&(e.blockedOn=null,vi||(vi=!0,Ns.unstable_scheduleCallback(Ns.unstable_NormalPriority,Kf)))}function Ma(e){function s(a){return ra(a,e)}if(0<Xa.length){ra(Xa[0],e);for(var n=1;n<Xa.length;n++){var r=Xa[n];r.blockedOn===e&&(r.blockedOn=null)}}for(zn!==null&&ra(zn,e),Bn!==null&&ra(Bn,e),Wn!==null&&ra(Wn,e),Ca.forEach(s),$a.forEach(s),n=0;n<An.length;n++)r=An[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<An.length&&(n=An[0],n.blockedOn===null);)w0(n),n.blockedOn===null&&An.shift()}var Or=Mn.ReactCurrentBatchConfig,_l=!0;function Yf(e,s,n,r){var a=ft,l=Or.transition;Or.transition=null;try{ft=1,gc(e,s,n,r)}finally{ft=a,Or.transition=l}}function Qf(e,s,n,r){var a=ft,l=Or.transition;Or.transition=null;try{ft=4,gc(e,s,n,r)}finally{ft=a,Or.transition=l}}function gc(e,s,n,r){if(_l){var a=wi(e,s,n,r);if(a===null)To(e,s,r,El,n),hd(e,r);else if(Jf(a,e,s,n,r))r.stopPropagation();else if(hd(e,r),s&4&&-1<Zf.indexOf(e)){for(;a!==null;){var l=Fa(a);if(l!==null&&x0(l),l=wi(e,s,n,r),l===null&&To(e,s,r,El,n),l===a)break;a=l}a!==null&&r.stopPropagation()}else To(e,s,r,null,n)}}var El=null;function wi(e,s,n,r){if(El=null,e=fc(r),e=rr(e),e!==null)if(s=pr(e),s===null)e=null;else if(n=s.tag,n===13){if(e=i0(s),e!==null)return e;e=null}else if(n===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;e=null}else s!==e&&(e=null);return El=e,null}function y0(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Of()){case hc:return 1;case m0:return 4;case Ml:case zf:return 16;case f0:return 536870912;default:return 16}default:return 16}}var Rn=null,bc=null,xl=null;function j0(){if(xl)return xl;var e,s=bc,n=s.length,r,a="value"in Rn?Rn.value:Rn.textContent,l=a.length;for(e=0;e<n&&s[e]===a[e];e++);var o=n-e;for(r=1;r<=o&&s[n-r]===a[l-r];r++);return xl=a.slice(e,1<r?1-r:void 0)}function gl(e){var s=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&s===13&&(e=13)):e=s,e===10&&(e=13),32<=e||e===13?e:0}function el(){return!0}function xd(){return!1}function Ss(e){function s(n,r,a,l,o){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=l,this.target=o,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(n=e[i],this[i]=n?n(l):l[i]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?el:xd,this.isPropagationStopped=xd,this}return St(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=el)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=el)},persist:function(){},isPersistent:el}),s}var Yr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vc=Ss(Yr),Ua=St({},Yr,{view:0,detail:0}),qf=Ss(Ua),ko,So,aa,Xl=St({},Ua,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==aa&&(aa&&e.type==="mousemove"?(ko=e.screenX-aa.screenX,So=e.screenY-aa.screenY):So=ko=0,aa=e),ko)},movementY:function(e){return"movementY"in e?e.movementY:So}}),gd=Ss(Xl),Xf=St({},Xl,{dataTransfer:0}),eh=Ss(Xf),th=St({},Ua,{relatedTarget:0}),Co=Ss(th),sh=St({},Yr,{animationName:0,elapsedTime:0,pseudoElement:0}),nh=Ss(sh),rh=St({},Yr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ah=Ss(rh),lh=St({},Yr,{data:0}),bd=Ss(lh),oh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ih={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ch={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dh(e){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(e):(e=ch[e])?!!s[e]:!1}function wc(){return dh}var uh=St({},Ua,{key:function(e){if(e.key){var s=oh[e.key]||e.key;if(s!=="Unidentified")return s}return e.type==="keypress"?(e=gl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ih[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wc,charCode:function(e){return e.type==="keypress"?gl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?gl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),mh=Ss(uh),fh=St({},Xl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vd=Ss(fh),hh=St({},Ua,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wc}),ph=Ss(hh),xh=St({},Yr,{propertyName:0,elapsedTime:0,pseudoElement:0}),gh=Ss(xh),bh=St({},Xl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),vh=Ss(bh),wh=[9,13,27,32],yc=Nn&&"CompositionEvent"in window,xa=null;Nn&&"documentMode"in document&&(xa=document.documentMode);var yh=Nn&&"TextEvent"in window&&!xa,N0=Nn&&(!yc||xa&&8<xa&&11>=xa),wd=" ",yd=!1;function k0(e,s){switch(e){case"keyup":return wh.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function S0(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Nr=!1;function jh(e,s){switch(e){case"compositionend":return S0(s);case"keypress":return s.which!==32?null:(yd=!0,wd);case"textInput":return e=s.data,e===wd&&yd?null:e;default:return null}}function Nh(e,s){if(Nr)return e==="compositionend"||!yc&&k0(e,s)?(e=j0(),xl=bc=Rn=null,Nr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return N0&&s.locale!=="ko"?null:s.data;default:return null}}var kh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jd(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s==="input"?!!kh[e.type]:s==="textarea"}function C0(e,s,n,r){n0(r),s=Ll(s,"onChange"),0<s.length&&(n=new vc("onChange","change",null,n,r),e.push({event:n,listeners:s}))}var ga=null,Ia=null;function Sh(e){D0(e,0)}function eo(e){var s=Cr(e);if(Yu(s))return e}function Ch(e,s){if(e==="change")return s}var $0=!1;if(Nn){var $o;if(Nn){var Mo="oninput"in document;if(!Mo){var Nd=document.createElement("div");Nd.setAttribute("oninput","return;"),Mo=typeof Nd.oninput=="function"}$o=Mo}else $o=!1;$0=$o&&(!document.documentMode||9<document.documentMode)}function kd(){ga&&(ga.detachEvent("onpropertychange",M0),Ia=ga=null)}function M0(e){if(e.propertyName==="value"&&eo(Ia)){var s=[];C0(s,Ia,e,fc(e)),o0(Sh,s)}}function $h(e,s,n){e==="focusin"?(kd(),ga=s,Ia=n,ga.attachEvent("onpropertychange",M0)):e==="focusout"&&kd()}function Mh(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return eo(Ia)}function Ih(e,s){if(e==="click")return eo(s)}function _h(e,s){if(e==="input"||e==="change")return eo(s)}function Eh(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var sn=typeof Object.is=="function"?Object.is:Eh;function _a(e,s){if(sn(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;var n=Object.keys(e),r=Object.keys(s);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!si.call(s,a)||!sn(e[a],s[a]))return!1}return!0}function Sd(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Cd(e,s){var n=Sd(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=s&&r>=s)return{node:n,offset:s-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Sd(n)}}function I0(e,s){return e&&s?e===s?!0:e&&e.nodeType===3?!1:s&&s.nodeType===3?I0(e,s.parentNode):"contains"in e?e.contains(s):e.compareDocumentPosition?!!(e.compareDocumentPosition(s)&16):!1:!1}function _0(){for(var e=window,s=Sl();s instanceof e.HTMLIFrameElement;){try{var n=typeof s.contentWindow.location.href=="string"}catch{n=!1}if(n)e=s.contentWindow;else break;s=Sl(e.document)}return s}function jc(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s&&(s==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||s==="textarea"||e.contentEditable==="true")}function Lh(e){var s=_0(),n=e.focusedElem,r=e.selectionRange;if(s!==n&&n&&n.ownerDocument&&I0(n.ownerDocument.documentElement,n)){if(r!==null&&jc(n)){if(s=r.start,e=r.end,e===void 0&&(e=s),"selectionStart"in n)n.selectionStart=s,n.selectionEnd=Math.min(e,n.value.length);else if(e=(s=n.ownerDocument||document)&&s.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,l=Math.min(r.start,a);r=r.end===void 0?l:Math.min(r.end,a),!e.extend&&l>r&&(a=r,r=l,l=a),a=Cd(n,l);var o=Cd(n,r);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(s=s.createRange(),s.setStart(a.node,a.offset),e.removeAllRanges(),l>r?(e.addRange(s),e.extend(o.node,o.offset)):(s.setEnd(o.node,o.offset),e.addRange(s)))}}for(s=[],e=n;e=e.parentNode;)e.nodeType===1&&s.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<s.length;n++)e=s[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Th=Nn&&"documentMode"in document&&11>=document.documentMode,kr=null,yi=null,ba=null,ji=!1;function $d(e,s,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ji||kr==null||kr!==Sl(r)||(r=kr,"selectionStart"in r&&jc(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ba&&_a(ba,r)||(ba=r,r=Ll(yi,"onSelect"),0<r.length&&(s=new vc("onSelect","select",null,s,n),e.push({event:s,listeners:r}),s.target=kr)))}function tl(e,s){var n={};return n[e.toLowerCase()]=s.toLowerCase(),n["Webkit"+e]="webkit"+s,n["Moz"+e]="moz"+s,n}var Sr={animationend:tl("Animation","AnimationEnd"),animationiteration:tl("Animation","AnimationIteration"),animationstart:tl("Animation","AnimationStart"),transitionend:tl("Transition","TransitionEnd")},Io={},E0={};Nn&&(E0=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);function to(e){if(Io[e])return Io[e];if(!Sr[e])return e;var s=Sr[e],n;for(n in s)if(s.hasOwnProperty(n)&&n in E0)return Io[e]=s[n];return e}var L0=to("animationend"),T0=to("animationiteration"),A0=to("animationstart"),P0=to("transitionend"),R0=new Map,Md="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kn(e,s){R0.set(e,s),hr(s,[e])}for(var _o=0;_o<Md.length;_o++){var Eo=Md[_o],Ah=Eo.toLowerCase(),Ph=Eo[0].toUpperCase()+Eo.slice(1);Kn(Ah,"on"+Ph)}Kn(L0,"onAnimationEnd");Kn(T0,"onAnimationIteration");Kn(A0,"onAnimationStart");Kn("dblclick","onDoubleClick");Kn("focusin","onFocus");Kn("focusout","onBlur");Kn(P0,"onTransitionEnd");Wr("onMouseEnter",["mouseout","mouseover"]);Wr("onMouseLeave",["mouseout","mouseover"]);Wr("onPointerEnter",["pointerout","pointerover"]);Wr("onPointerLeave",["pointerout","pointerover"]);hr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hr("onBeforeInput",["compositionend","keypress","textInput","paste"]);hr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Rh=new Set("cancel close invalid load scroll toggle".split(" ").concat(fa));function Id(e,s,n){var r=e.type||"unknown-event";e.currentTarget=n,Af(r,s,void 0,e),e.currentTarget=null}function D0(e,s){s=(s&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var l=void 0;if(s)for(var o=r.length-1;0<=o;o--){var i=r[o],c=i.instance,d=i.currentTarget;if(i=i.listener,c!==l&&a.isPropagationStopped())break e;Id(a,i,d),l=c}else for(o=0;o<r.length;o++){if(i=r[o],c=i.instance,d=i.currentTarget,i=i.listener,c!==l&&a.isPropagationStopped())break e;Id(a,i,d),l=c}}}if($l)throw e=gi,$l=!1,gi=null,e}function vt(e,s){var n=s[$i];n===void 0&&(n=s[$i]=new Set);var r=e+"__bubble";n.has(r)||(O0(s,e,2,!1),n.add(r))}function Lo(e,s,n){var r=0;s&&(r|=4),O0(n,e,r,s)}var sl="_reactListening"+Math.random().toString(36).slice(2);function Ea(e){if(!e[sl]){e[sl]=!0,Gu.forEach(function(n){n!=="selectionchange"&&(Rh.has(n)||Lo(n,!1,e),Lo(n,!0,e))});var s=e.nodeType===9?e:e.ownerDocument;s===null||s[sl]||(s[sl]=!0,Lo("selectionchange",!1,s))}}function O0(e,s,n,r){switch(y0(s)){case 1:var a=Yf;break;case 4:a=Qf;break;default:a=gc}n=a.bind(null,s,n,e),a=void 0,!xi||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(s,n,{capture:!0,passive:a}):e.addEventListener(s,n,!0):a!==void 0?e.addEventListener(s,n,{passive:a}):e.addEventListener(s,n,!1)}function To(e,s,n,r,a){var l=r;if(!(s&1)&&!(s&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var i=r.stateNode.containerInfo;if(i===a||i.nodeType===8&&i.parentNode===a)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;o=o.return}for(;i!==null;){if(o=rr(i),o===null)return;if(c=o.tag,c===5||c===6){r=l=o;continue e}i=i.parentNode}}r=r.return}o0(function(){var d=l,f=fc(n),h=[];e:{var p=R0.get(e);if(p!==void 0){var m=vc,x=e;switch(e){case"keypress":if(gl(n)===0)break e;case"keydown":case"keyup":m=mh;break;case"focusin":x="focus",m=Co;break;case"focusout":x="blur",m=Co;break;case"beforeblur":case"afterblur":m=Co;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=gd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=eh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=ph;break;case L0:case T0:case A0:m=nh;break;case P0:m=gh;break;case"scroll":m=qf;break;case"wheel":m=vh;break;case"copy":case"cut":case"paste":m=ah;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=vd}var y=(s&4)!==0,C=!y&&e==="scroll",g=y?p!==null?p+"Capture":null:p;y=[];for(var b=d,v;b!==null;){v=b;var w=v.stateNode;if(v.tag===5&&w!==null&&(v=w,g!==null&&(w=Sa(b,g),w!=null&&y.push(La(b,w,v)))),C)break;b=b.return}0<y.length&&(p=new m(p,x,null,n,f),h.push({event:p,listeners:y}))}}if(!(s&7)){e:{if(p=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",p&&n!==hi&&(x=n.relatedTarget||n.fromElement)&&(rr(x)||x[kn]))break e;if((m||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,m?(x=n.relatedTarget||n.toElement,m=d,x=x?rr(x):null,x!==null&&(C=pr(x),x!==C||x.tag!==5&&x.tag!==6)&&(x=null)):(m=null,x=d),m!==x)){if(y=gd,w="onMouseLeave",g="onMouseEnter",b="mouse",(e==="pointerout"||e==="pointerover")&&(y=vd,w="onPointerLeave",g="onPointerEnter",b="pointer"),C=m==null?p:Cr(m),v=x==null?p:Cr(x),p=new y(w,b+"leave",m,n,f),p.target=C,p.relatedTarget=v,w=null,rr(f)===d&&(y=new y(g,b+"enter",x,n,f),y.target=v,y.relatedTarget=C,w=y),C=w,m&&x)t:{for(y=m,g=x,b=0,v=y;v;v=wr(v))b++;for(v=0,w=g;w;w=wr(w))v++;for(;0<b-v;)y=wr(y),b--;for(;0<v-b;)g=wr(g),v--;for(;b--;){if(y===g||g!==null&&y===g.alternate)break t;y=wr(y),g=wr(g)}y=null}else y=null;m!==null&&_d(h,p,m,y,!1),x!==null&&C!==null&&_d(h,C,x,y,!0)}}e:{if(p=d?Cr(d):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var z=Ch;else if(jd(p))if($0)z=_h;else{z=Mh;var k=$h}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(z=Ih);if(z&&(z=z(e,d))){C0(h,z,n,f);break e}k&&k(e,p,d),e==="focusout"&&(k=p._wrapperState)&&k.controlled&&p.type==="number"&&ci(p,"number",p.value)}switch(k=d?Cr(d):window,e){case"focusin":(jd(k)||k.contentEditable==="true")&&(kr=k,yi=d,ba=null);break;case"focusout":ba=yi=kr=null;break;case"mousedown":ji=!0;break;case"contextmenu":case"mouseup":case"dragend":ji=!1,$d(h,n,f);break;case"selectionchange":if(Th)break;case"keydown":case"keyup":$d(h,n,f)}var M;if(yc)e:{switch(e){case"compositionstart":var j="onCompositionStart";break e;case"compositionend":j="onCompositionEnd";break e;case"compositionupdate":j="onCompositionUpdate";break e}j=void 0}else Nr?k0(e,n)&&(j="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(j="onCompositionStart");j&&(N0&&n.locale!=="ko"&&(Nr||j!=="onCompositionStart"?j==="onCompositionEnd"&&Nr&&(M=j0()):(Rn=f,bc="value"in Rn?Rn.value:Rn.textContent,Nr=!0)),k=Ll(d,j),0<k.length&&(j=new bd(j,e,null,n,f),h.push({event:j,listeners:k}),M?j.data=M:(M=S0(n),M!==null&&(j.data=M)))),(M=yh?jh(e,n):Nh(e,n))&&(d=Ll(d,"onBeforeInput"),0<d.length&&(f=new bd("onBeforeInput","beforeinput",null,n,f),h.push({event:f,listeners:d}),f.data=M))}D0(h,s)})}function La(e,s,n){return{instance:e,listener:s,currentTarget:n}}function Ll(e,s){for(var n=s+"Capture",r=[];e!==null;){var a=e,l=a.stateNode;a.tag===5&&l!==null&&(a=l,l=Sa(e,n),l!=null&&r.unshift(La(e,l,a)),l=Sa(e,s),l!=null&&r.push(La(e,l,a))),e=e.return}return r}function wr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function _d(e,s,n,r,a){for(var l=s._reactName,o=[];n!==null&&n!==r;){var i=n,c=i.alternate,d=i.stateNode;if(c!==null&&c===r)break;i.tag===5&&d!==null&&(i=d,a?(c=Sa(n,l),c!=null&&o.unshift(La(n,c,i))):a||(c=Sa(n,l),c!=null&&o.push(La(n,c,i)))),n=n.return}o.length!==0&&e.push({event:s,listeners:o})}var Dh=/\r\n?/g,Oh=/\u0000|\uFFFD/g;function Ed(e){return(typeof e=="string"?e:""+e).replace(Dh,`
`).replace(Oh,"")}function nl(e,s,n){if(s=Ed(s),Ed(e)!==s&&n)throw Error(_e(425))}function Tl(){}var Ni=null,ki=null;function Si(e,s){return e==="textarea"||e==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Ci=typeof setTimeout=="function"?setTimeout:void 0,zh=typeof clearTimeout=="function"?clearTimeout:void 0,Ld=typeof Promise=="function"?Promise:void 0,Bh=typeof queueMicrotask=="function"?queueMicrotask:typeof Ld<"u"?function(e){return Ld.resolve(null).then(e).catch(Wh)}:Ci;function Wh(e){setTimeout(function(){throw e})}function Ao(e,s){var n=s,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),Ma(s);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);Ma(s)}function Un(e){for(;e!=null;e=e.nextSibling){var s=e.nodeType;if(s===1||s===3)break;if(s===8){if(s=e.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return e}function Td(e){e=e.previousSibling;for(var s=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(s===0)return e;s--}else n==="/$"&&s++}e=e.previousSibling}return null}var Qr=Math.random().toString(36).slice(2),un="__reactFiber$"+Qr,Ta="__reactProps$"+Qr,kn="__reactContainer$"+Qr,$i="__reactEvents$"+Qr,Uh="__reactListeners$"+Qr,Fh="__reactHandles$"+Qr;function rr(e){var s=e[un];if(s)return s;for(var n=e.parentNode;n;){if(s=n[kn]||n[un]){if(n=s.alternate,s.child!==null||n!==null&&n.child!==null)for(e=Td(e);e!==null;){if(n=e[un])return n;e=Td(e)}return s}e=n,n=e.parentNode}return null}function Fa(e){return e=e[un]||e[kn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Cr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(_e(33))}function so(e){return e[Ta]||null}var Mi=[],$r=-1;function Yn(e){return{current:e}}function wt(e){0>$r||(e.current=Mi[$r],Mi[$r]=null,$r--)}function bt(e,s){$r++,Mi[$r]=e.current,e.current=s}var Jn={},Qt=Yn(Jn),hs=Yn(!1),cr=Jn;function Ur(e,s){var n=e.type.contextTypes;if(!n)return Jn;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===s)return r.__reactInternalMemoizedMaskedChildContext;var a={},l;for(l in n)a[l]=s[l];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=a),a}function ps(e){return e=e.childContextTypes,e!=null}function Al(){wt(hs),wt(Qt)}function Ad(e,s,n){if(Qt.current!==Jn)throw Error(_e(168));bt(Qt,s),bt(hs,n)}function z0(e,s,n){var r=e.stateNode;if(s=s.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in s))throw Error(_e(108,$f(e)||"Unknown",a));return St({},n,r)}function Pl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Jn,cr=Qt.current,bt(Qt,e),bt(hs,hs.current),!0}function Pd(e,s,n){var r=e.stateNode;if(!r)throw Error(_e(169));n?(e=z0(e,s,cr),r.__reactInternalMemoizedMergedChildContext=e,wt(hs),wt(Qt),bt(Qt,e)):wt(hs),bt(hs,n)}var vn=null,no=!1,Po=!1;function B0(e){vn===null?vn=[e]:vn.push(e)}function Hh(e){no=!0,B0(e)}function Qn(){if(!Po&&vn!==null){Po=!0;var e=0,s=ft;try{var n=vn;for(ft=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}vn=null,no=!1}catch(a){throw vn!==null&&(vn=vn.slice(e+1)),u0(hc,Qn),a}finally{ft=s,Po=!1}}return null}var Mr=[],Ir=0,Rl=null,Dl=0,Es=[],Ls=0,dr=null,wn=1,yn="";function sr(e,s){Mr[Ir++]=Dl,Mr[Ir++]=Rl,Rl=e,Dl=s}function W0(e,s,n){Es[Ls++]=wn,Es[Ls++]=yn,Es[Ls++]=dr,dr=e;var r=wn;e=yn;var a=32-Xs(r)-1;r&=~(1<<a),n+=1;var l=32-Xs(s)+a;if(30<l){var o=a-a%5;l=(r&(1<<o)-1).toString(32),r>>=o,a-=o,wn=1<<32-Xs(s)+a|n<<a|r,yn=l+e}else wn=1<<l|n<<a|r,yn=e}function Nc(e){e.return!==null&&(sr(e,1),W0(e,1,0))}function kc(e){for(;e===Rl;)Rl=Mr[--Ir],Mr[Ir]=null,Dl=Mr[--Ir],Mr[Ir]=null;for(;e===dr;)dr=Es[--Ls],Es[Ls]=null,yn=Es[--Ls],Es[Ls]=null,wn=Es[--Ls],Es[Ls]=null}var js=null,ys=null,jt=!1,qs=null;function U0(e,s){var n=Ts(5,null,null,0);n.elementType="DELETED",n.stateNode=s,n.return=e,s=e.deletions,s===null?(e.deletions=[n],e.flags|=16):s.push(n)}function Rd(e,s){switch(e.tag){case 5:var n=e.type;return s=s.nodeType!==1||n.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(e.stateNode=s,js=e,ys=Un(s.firstChild),!0):!1;case 6:return s=e.pendingProps===""||s.nodeType!==3?null:s,s!==null?(e.stateNode=s,js=e,ys=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(n=dr!==null?{id:wn,overflow:yn}:null,e.memoizedState={dehydrated:s,treeContext:n,retryLane:1073741824},n=Ts(18,null,null,0),n.stateNode=s,n.return=e,e.child=n,js=e,ys=null,!0):!1;default:return!1}}function Ii(e){return(e.mode&1)!==0&&(e.flags&128)===0}function _i(e){if(jt){var s=ys;if(s){var n=s;if(!Rd(e,s)){if(Ii(e))throw Error(_e(418));s=Un(n.nextSibling);var r=js;s&&Rd(e,s)?U0(r,n):(e.flags=e.flags&-4097|2,jt=!1,js=e)}}else{if(Ii(e))throw Error(_e(418));e.flags=e.flags&-4097|2,jt=!1,js=e}}}function Dd(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;js=e}function rl(e){if(e!==js)return!1;if(!jt)return Dd(e),jt=!0,!1;var s;if((s=e.tag!==3)&&!(s=e.tag!==5)&&(s=e.type,s=s!=="head"&&s!=="body"&&!Si(e.type,e.memoizedProps)),s&&(s=ys)){if(Ii(e))throw F0(),Error(_e(418));for(;s;)U0(e,s),s=Un(s.nextSibling)}if(Dd(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(_e(317));e:{for(e=e.nextSibling,s=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(s===0){ys=Un(e.nextSibling);break e}s--}else n!=="$"&&n!=="$!"&&n!=="$?"||s++}e=e.nextSibling}ys=null}}else ys=js?Un(e.stateNode.nextSibling):null;return!0}function F0(){for(var e=ys;e;)e=Un(e.nextSibling)}function Fr(){ys=js=null,jt=!1}function Sc(e){qs===null?qs=[e]:qs.push(e)}var Gh=Mn.ReactCurrentBatchConfig;function la(e,s,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(_e(309));var r=n.stateNode}if(!r)throw Error(_e(147,e));var a=r,l=""+e;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===l?s.ref:(s=function(o){var i=a.refs;o===null?delete i[l]:i[l]=o},s._stringRef=l,s)}if(typeof e!="string")throw Error(_e(284));if(!n._owner)throw Error(_e(290,e))}return e}function al(e,s){throw e=Object.prototype.toString.call(s),Error(_e(31,e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e))}function Od(e){var s=e._init;return s(e._payload)}function H0(e){function s(g,b){if(e){var v=g.deletions;v===null?(g.deletions=[b],g.flags|=16):v.push(b)}}function n(g,b){if(!e)return null;for(;b!==null;)s(g,b),b=b.sibling;return null}function r(g,b){for(g=new Map;b!==null;)b.key!==null?g.set(b.key,b):g.set(b.index,b),b=b.sibling;return g}function a(g,b){return g=Vn(g,b),g.index=0,g.sibling=null,g}function l(g,b,v){return g.index=v,e?(v=g.alternate,v!==null?(v=v.index,v<b?(g.flags|=2,b):v):(g.flags|=2,b)):(g.flags|=1048576,b)}function o(g){return e&&g.alternate===null&&(g.flags|=2),g}function i(g,b,v,w){return b===null||b.tag!==6?(b=Uo(v,g.mode,w),b.return=g,b):(b=a(b,v),b.return=g,b)}function c(g,b,v,w){var z=v.type;return z===jr?f(g,b,v.props.children,w,v.key):b!==null&&(b.elementType===z||typeof z=="object"&&z!==null&&z.$$typeof===En&&Od(z)===b.type)?(w=a(b,v.props),w.ref=la(g,b,v),w.return=g,w):(w=kl(v.type,v.key,v.props,null,g.mode,w),w.ref=la(g,b,v),w.return=g,w)}function d(g,b,v,w){return b===null||b.tag!==4||b.stateNode.containerInfo!==v.containerInfo||b.stateNode.implementation!==v.implementation?(b=Fo(v,g.mode,w),b.return=g,b):(b=a(b,v.children||[]),b.return=g,b)}function f(g,b,v,w,z){return b===null||b.tag!==7?(b=ir(v,g.mode,w,z),b.return=g,b):(b=a(b,v),b.return=g,b)}function h(g,b,v){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Uo(""+b,g.mode,v),b.return=g,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ja:return v=kl(b.type,b.key,b.props,null,g.mode,v),v.ref=la(g,null,b),v.return=g,v;case yr:return b=Fo(b,g.mode,v),b.return=g,b;case En:var w=b._init;return h(g,w(b._payload),v)}if(ua(b)||ta(b))return b=ir(b,g.mode,v,null),b.return=g,b;al(g,b)}return null}function p(g,b,v,w){var z=b!==null?b.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return z!==null?null:i(g,b,""+v,w);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ja:return v.key===z?c(g,b,v,w):null;case yr:return v.key===z?d(g,b,v,w):null;case En:return z=v._init,p(g,b,z(v._payload),w)}if(ua(v)||ta(v))return z!==null?null:f(g,b,v,w,null);al(g,v)}return null}function m(g,b,v,w,z){if(typeof w=="string"&&w!==""||typeof w=="number")return g=g.get(v)||null,i(b,g,""+w,z);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ja:return g=g.get(w.key===null?v:w.key)||null,c(b,g,w,z);case yr:return g=g.get(w.key===null?v:w.key)||null,d(b,g,w,z);case En:var k=w._init;return m(g,b,v,k(w._payload),z)}if(ua(w)||ta(w))return g=g.get(v)||null,f(b,g,w,z,null);al(b,w)}return null}function x(g,b,v,w){for(var z=null,k=null,M=b,j=b=0,H=null;M!==null&&j<v.length;j++){M.index>j?(H=M,M=null):H=M.sibling;var te=p(g,M,v[j],w);if(te===null){M===null&&(M=H);break}e&&M&&te.alternate===null&&s(g,M),b=l(te,b,j),k===null?z=te:k.sibling=te,k=te,M=H}if(j===v.length)return n(g,M),jt&&sr(g,j),z;if(M===null){for(;j<v.length;j++)M=h(g,v[j],w),M!==null&&(b=l(M,b,j),k===null?z=M:k.sibling=M,k=M);return jt&&sr(g,j),z}for(M=r(g,M);j<v.length;j++)H=m(M,g,j,v[j],w),H!==null&&(e&&H.alternate!==null&&M.delete(H.key===null?j:H.key),b=l(H,b,j),k===null?z=H:k.sibling=H,k=H);return e&&M.forEach(function(Ne){return s(g,Ne)}),jt&&sr(g,j),z}function y(g,b,v,w){var z=ta(v);if(typeof z!="function")throw Error(_e(150));if(v=z.call(v),v==null)throw Error(_e(151));for(var k=z=null,M=b,j=b=0,H=null,te=v.next();M!==null&&!te.done;j++,te=v.next()){M.index>j?(H=M,M=null):H=M.sibling;var Ne=p(g,M,te.value,w);if(Ne===null){M===null&&(M=H);break}e&&M&&Ne.alternate===null&&s(g,M),b=l(Ne,b,j),k===null?z=Ne:k.sibling=Ne,k=Ne,M=H}if(te.done)return n(g,M),jt&&sr(g,j),z;if(M===null){for(;!te.done;j++,te=v.next())te=h(g,te.value,w),te!==null&&(b=l(te,b,j),k===null?z=te:k.sibling=te,k=te);return jt&&sr(g,j),z}for(M=r(g,M);!te.done;j++,te=v.next())te=m(M,g,j,te.value,w),te!==null&&(e&&te.alternate!==null&&M.delete(te.key===null?j:te.key),b=l(te,b,j),k===null?z=te:k.sibling=te,k=te);return e&&M.forEach(function(Me){return s(g,Me)}),jt&&sr(g,j),z}function C(g,b,v,w){if(typeof v=="object"&&v!==null&&v.type===jr&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Ja:e:{for(var z=v.key,k=b;k!==null;){if(k.key===z){if(z=v.type,z===jr){if(k.tag===7){n(g,k.sibling),b=a(k,v.props.children),b.return=g,g=b;break e}}else if(k.elementType===z||typeof z=="object"&&z!==null&&z.$$typeof===En&&Od(z)===k.type){n(g,k.sibling),b=a(k,v.props),b.ref=la(g,k,v),b.return=g,g=b;break e}n(g,k);break}else s(g,k);k=k.sibling}v.type===jr?(b=ir(v.props.children,g.mode,w,v.key),b.return=g,g=b):(w=kl(v.type,v.key,v.props,null,g.mode,w),w.ref=la(g,b,v),w.return=g,g=w)}return o(g);case yr:e:{for(k=v.key;b!==null;){if(b.key===k)if(b.tag===4&&b.stateNode.containerInfo===v.containerInfo&&b.stateNode.implementation===v.implementation){n(g,b.sibling),b=a(b,v.children||[]),b.return=g,g=b;break e}else{n(g,b);break}else s(g,b);b=b.sibling}b=Fo(v,g.mode,w),b.return=g,g=b}return o(g);case En:return k=v._init,C(g,b,k(v._payload),w)}if(ua(v))return x(g,b,v,w);if(ta(v))return y(g,b,v,w);al(g,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,b!==null&&b.tag===6?(n(g,b.sibling),b=a(b,v),b.return=g,g=b):(n(g,b),b=Uo(v,g.mode,w),b.return=g,g=b),o(g)):n(g,b)}return C}var Hr=H0(!0),G0=H0(!1),Ol=Yn(null),zl=null,_r=null,Cc=null;function $c(){Cc=_r=zl=null}function Mc(e){var s=Ol.current;wt(Ol),e._currentValue=s}function Ei(e,s,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&s)!==s?(e.childLanes|=s,r!==null&&(r.childLanes|=s)):r!==null&&(r.childLanes&s)!==s&&(r.childLanes|=s),e===n)break;e=e.return}}function zr(e,s){zl=e,Cc=_r=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&s&&(fs=!0),e.firstContext=null)}function Ps(e){var s=e._currentValue;if(Cc!==e)if(e={context:e,memoizedValue:s,next:null},_r===null){if(zl===null)throw Error(_e(308));_r=e,zl.dependencies={lanes:0,firstContext:e}}else _r=_r.next=e;return s}var ar=null;function Ic(e){ar===null?ar=[e]:ar.push(e)}function V0(e,s,n,r){var a=s.interleaved;return a===null?(n.next=n,Ic(s)):(n.next=a.next,a.next=n),s.interleaved=n,Sn(e,r)}function Sn(e,s){e.lanes|=s;var n=e.alternate;for(n!==null&&(n.lanes|=s),n=e,e=e.return;e!==null;)e.childLanes|=s,n=e.alternate,n!==null&&(n.childLanes|=s),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Ln=!1;function _c(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Z0(e,s){e=e.updateQueue,s.updateQueue===e&&(s.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function jn(e,s){return{eventTime:e,lane:s,tag:0,payload:null,callback:null,next:null}}function Fn(e,s,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,ut&2){var a=r.pending;return a===null?s.next=s:(s.next=a.next,a.next=s),r.pending=s,Sn(e,n)}return a=r.interleaved,a===null?(s.next=s,Ic(r)):(s.next=a.next,a.next=s),r.interleaved=s,Sn(e,n)}function bl(e,s,n){if(s=s.updateQueue,s!==null&&(s=s.shared,(n&4194240)!==0)){var r=s.lanes;r&=e.pendingLanes,n|=r,s.lanes=n,pc(e,n)}}function zd(e,s){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,l=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};l===null?a=l=o:l=l.next=o,n=n.next}while(n!==null);l===null?a=l=s:l=l.next=s}else a=l=s;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:l,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=s:e.next=s,n.lastBaseUpdate=s}function Bl(e,s,n,r){var a=e.updateQueue;Ln=!1;var l=a.firstBaseUpdate,o=a.lastBaseUpdate,i=a.shared.pending;if(i!==null){a.shared.pending=null;var c=i,d=c.next;c.next=null,o===null?l=d:o.next=d,o=c;var f=e.alternate;f!==null&&(f=f.updateQueue,i=f.lastBaseUpdate,i!==o&&(i===null?f.firstBaseUpdate=d:i.next=d,f.lastBaseUpdate=c))}if(l!==null){var h=a.baseState;o=0,f=d=c=null,i=l;do{var p=i.lane,m=i.eventTime;if((r&p)===p){f!==null&&(f=f.next={eventTime:m,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var x=e,y=i;switch(p=s,m=n,y.tag){case 1:if(x=y.payload,typeof x=="function"){h=x.call(m,h,p);break e}h=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=y.payload,p=typeof x=="function"?x.call(m,h,p):x,p==null)break e;h=St({},h,p);break e;case 2:Ln=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,p=a.effects,p===null?a.effects=[i]:p.push(i))}else m={eventTime:m,lane:p,tag:i.tag,payload:i.payload,callback:i.callback,next:null},f===null?(d=f=m,c=h):f=f.next=m,o|=p;if(i=i.next,i===null){if(i=a.shared.pending,i===null)break;p=i,i=p.next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}while(!0);if(f===null&&(c=h),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=f,s=a.shared.interleaved,s!==null){a=s;do o|=a.lane,a=a.next;while(a!==s)}else l===null&&(a.shared.lanes=0);mr|=o,e.lanes=o,e.memoizedState=h}}function Bd(e,s,n){if(e=s.effects,s.effects=null,e!==null)for(s=0;s<e.length;s++){var r=e[s],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(_e(191,a));a.call(r)}}}var Ha={},fn=Yn(Ha),Aa=Yn(Ha),Pa=Yn(Ha);function lr(e){if(e===Ha)throw Error(_e(174));return e}function Ec(e,s){switch(bt(Pa,s),bt(Aa,e),bt(fn,Ha),e=s.nodeType,e){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:ui(null,"");break;default:e=e===8?s.parentNode:s,s=e.namespaceURI||null,e=e.tagName,s=ui(s,e)}wt(fn),bt(fn,s)}function Gr(){wt(fn),wt(Aa),wt(Pa)}function J0(e){lr(Pa.current);var s=lr(fn.current),n=ui(s,e.type);s!==n&&(bt(Aa,e),bt(fn,n))}function Lc(e){Aa.current===e&&(wt(fn),wt(Aa))}var Nt=Yn(0);function Wl(e){for(var s=e;s!==null;){if(s.tag===13){var n=s.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ro=[];function Tc(){for(var e=0;e<Ro.length;e++)Ro[e]._workInProgressVersionPrimary=null;Ro.length=0}var vl=Mn.ReactCurrentDispatcher,Do=Mn.ReactCurrentBatchConfig,ur=0,kt=null,Tt=null,Ot=null,Ul=!1,va=!1,Ra=0,Vh=0;function Jt(){throw Error(_e(321))}function Ac(e,s){if(s===null)return!1;for(var n=0;n<s.length&&n<e.length;n++)if(!sn(e[n],s[n]))return!1;return!0}function Pc(e,s,n,r,a,l){if(ur=l,kt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,vl.current=e===null||e.memoizedState===null?Yh:Qh,e=n(r,a),va){l=0;do{if(va=!1,Ra=0,25<=l)throw Error(_e(301));l+=1,Ot=Tt=null,s.updateQueue=null,vl.current=qh,e=n(r,a)}while(va)}if(vl.current=Fl,s=Tt!==null&&Tt.next!==null,ur=0,Ot=Tt=kt=null,Ul=!1,s)throw Error(_e(300));return e}function Rc(){var e=Ra!==0;return Ra=0,e}function on(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?kt.memoizedState=Ot=e:Ot=Ot.next=e,Ot}function Rs(){if(Tt===null){var e=kt.alternate;e=e!==null?e.memoizedState:null}else e=Tt.next;var s=Ot===null?kt.memoizedState:Ot.next;if(s!==null)Ot=s,Tt=e;else{if(e===null)throw Error(_e(310));Tt=e,e={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Ot===null?kt.memoizedState=Ot=e:Ot=Ot.next=e}return Ot}function Da(e,s){return typeof s=="function"?s(e):s}function Oo(e){var s=Rs(),n=s.queue;if(n===null)throw Error(_e(311));n.lastRenderedReducer=e;var r=Tt,a=r.baseQueue,l=n.pending;if(l!==null){if(a!==null){var o=a.next;a.next=l.next,l.next=o}r.baseQueue=a=l,n.pending=null}if(a!==null){l=a.next,r=r.baseState;var i=o=null,c=null,d=l;do{var f=d.lane;if((ur&f)===f)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(i=c=h,o=r):c=c.next=h,kt.lanes|=f,mr|=f}d=d.next}while(d!==null&&d!==l);c===null?o=r:c.next=i,sn(r,s.memoizedState)||(fs=!0),s.memoizedState=r,s.baseState=o,s.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do l=a.lane,kt.lanes|=l,mr|=l,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[s.memoizedState,n.dispatch]}function zo(e){var s=Rs(),n=s.queue;if(n===null)throw Error(_e(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,l=s.memoizedState;if(a!==null){n.pending=null;var o=a=a.next;do l=e(l,o.action),o=o.next;while(o!==a);sn(l,s.memoizedState)||(fs=!0),s.memoizedState=l,s.baseQueue===null&&(s.baseState=l),n.lastRenderedState=l}return[l,r]}function K0(){}function Y0(e,s){var n=kt,r=Rs(),a=s(),l=!sn(r.memoizedState,a);if(l&&(r.memoizedState=a,fs=!0),r=r.queue,Dc(X0.bind(null,n,r,e),[e]),r.getSnapshot!==s||l||Ot!==null&&Ot.memoizedState.tag&1){if(n.flags|=2048,Oa(9,q0.bind(null,n,r,a,s),void 0,null),zt===null)throw Error(_e(349));ur&30||Q0(n,s,a)}return a}function Q0(e,s,n){e.flags|=16384,e={getSnapshot:s,value:n},s=kt.updateQueue,s===null?(s={lastEffect:null,stores:null},kt.updateQueue=s,s.stores=[e]):(n=s.stores,n===null?s.stores=[e]:n.push(e))}function q0(e,s,n,r){s.value=n,s.getSnapshot=r,em(s)&&tm(e)}function X0(e,s,n){return n(function(){em(s)&&tm(e)})}function em(e){var s=e.getSnapshot;e=e.value;try{var n=s();return!sn(e,n)}catch{return!0}}function tm(e){var s=Sn(e,1);s!==null&&en(s,e,1,-1)}function Wd(e){var s=on();return typeof e=="function"&&(e=e()),s.memoizedState=s.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Da,lastRenderedState:e},s.queue=e,e=e.dispatch=Kh.bind(null,kt,e),[s.memoizedState,e]}function Oa(e,s,n,r){return e={tag:e,create:s,destroy:n,deps:r,next:null},s=kt.updateQueue,s===null?(s={lastEffect:null,stores:null},kt.updateQueue=s,s.lastEffect=e.next=e):(n=s.lastEffect,n===null?s.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,s.lastEffect=e)),e}function sm(){return Rs().memoizedState}function wl(e,s,n,r){var a=on();kt.flags|=e,a.memoizedState=Oa(1|s,n,void 0,r===void 0?null:r)}function ro(e,s,n,r){var a=Rs();r=r===void 0?null:r;var l=void 0;if(Tt!==null){var o=Tt.memoizedState;if(l=o.destroy,r!==null&&Ac(r,o.deps)){a.memoizedState=Oa(s,n,l,r);return}}kt.flags|=e,a.memoizedState=Oa(1|s,n,l,r)}function Ud(e,s){return wl(8390656,8,e,s)}function Dc(e,s){return ro(2048,8,e,s)}function nm(e,s){return ro(4,2,e,s)}function rm(e,s){return ro(4,4,e,s)}function am(e,s){if(typeof s=="function")return e=e(),s(e),function(){s(null)};if(s!=null)return e=e(),s.current=e,function(){s.current=null}}function lm(e,s,n){return n=n!=null?n.concat([e]):null,ro(4,4,am.bind(null,s,e),n)}function Oc(){}function om(e,s){var n=Rs();s=s===void 0?null:s;var r=n.memoizedState;return r!==null&&s!==null&&Ac(s,r[1])?r[0]:(n.memoizedState=[e,s],e)}function im(e,s){var n=Rs();s=s===void 0?null:s;var r=n.memoizedState;return r!==null&&s!==null&&Ac(s,r[1])?r[0]:(e=e(),n.memoizedState=[e,s],e)}function cm(e,s,n){return ur&21?(sn(n,s)||(n=h0(),kt.lanes|=n,mr|=n,e.baseState=!0),s):(e.baseState&&(e.baseState=!1,fs=!0),e.memoizedState=n)}function Zh(e,s){var n=ft;ft=n!==0&&4>n?n:4,e(!0);var r=Do.transition;Do.transition={};try{e(!1),s()}finally{ft=n,Do.transition=r}}function dm(){return Rs().memoizedState}function Jh(e,s,n){var r=Gn(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},um(e))mm(s,n);else if(n=V0(e,s,n,r),n!==null){var a=as();en(n,e,r,a),fm(n,s,r)}}function Kh(e,s,n){var r=Gn(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(um(e))mm(s,a);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=s.lastRenderedReducer,l!==null))try{var o=s.lastRenderedState,i=l(o,n);if(a.hasEagerState=!0,a.eagerState=i,sn(i,o)){var c=s.interleaved;c===null?(a.next=a,Ic(s)):(a.next=c.next,c.next=a),s.interleaved=a;return}}catch{}finally{}n=V0(e,s,a,r),n!==null&&(a=as(),en(n,e,r,a),fm(n,s,r))}}function um(e){var s=e.alternate;return e===kt||s!==null&&s===kt}function mm(e,s){va=Ul=!0;var n=e.pending;n===null?s.next=s:(s.next=n.next,n.next=s),e.pending=s}function fm(e,s,n){if(n&4194240){var r=s.lanes;r&=e.pendingLanes,n|=r,s.lanes=n,pc(e,n)}}var Fl={readContext:Ps,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useInsertionEffect:Jt,useLayoutEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useMutableSource:Jt,useSyncExternalStore:Jt,useId:Jt,unstable_isNewReconciler:!1},Yh={readContext:Ps,useCallback:function(e,s){return on().memoizedState=[e,s===void 0?null:s],e},useContext:Ps,useEffect:Ud,useImperativeHandle:function(e,s,n){return n=n!=null?n.concat([e]):null,wl(4194308,4,am.bind(null,s,e),n)},useLayoutEffect:function(e,s){return wl(4194308,4,e,s)},useInsertionEffect:function(e,s){return wl(4,2,e,s)},useMemo:function(e,s){var n=on();return s=s===void 0?null:s,e=e(),n.memoizedState=[e,s],e},useReducer:function(e,s,n){var r=on();return s=n!==void 0?n(s):s,r.memoizedState=r.baseState=s,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},r.queue=e,e=e.dispatch=Jh.bind(null,kt,e),[r.memoizedState,e]},useRef:function(e){var s=on();return e={current:e},s.memoizedState=e},useState:Wd,useDebugValue:Oc,useDeferredValue:function(e){return on().memoizedState=e},useTransition:function(){var e=Wd(!1),s=e[0];return e=Zh.bind(null,e[1]),on().memoizedState=e,[s,e]},useMutableSource:function(){},useSyncExternalStore:function(e,s,n){var r=kt,a=on();if(jt){if(n===void 0)throw Error(_e(407));n=n()}else{if(n=s(),zt===null)throw Error(_e(349));ur&30||Q0(r,s,n)}a.memoizedState=n;var l={value:n,getSnapshot:s};return a.queue=l,Ud(X0.bind(null,r,l,e),[e]),r.flags|=2048,Oa(9,q0.bind(null,r,l,n,s),void 0,null),n},useId:function(){var e=on(),s=zt.identifierPrefix;if(jt){var n=yn,r=wn;n=(r&~(1<<32-Xs(r)-1)).toString(32)+n,s=":"+s+"R"+n,n=Ra++,0<n&&(s+="H"+n.toString(32)),s+=":"}else n=Vh++,s=":"+s+"r"+n.toString(32)+":";return e.memoizedState=s},unstable_isNewReconciler:!1},Qh={readContext:Ps,useCallback:om,useContext:Ps,useEffect:Dc,useImperativeHandle:lm,useInsertionEffect:nm,useLayoutEffect:rm,useMemo:im,useReducer:Oo,useRef:sm,useState:function(){return Oo(Da)},useDebugValue:Oc,useDeferredValue:function(e){var s=Rs();return cm(s,Tt.memoizedState,e)},useTransition:function(){var e=Oo(Da)[0],s=Rs().memoizedState;return[e,s]},useMutableSource:K0,useSyncExternalStore:Y0,useId:dm,unstable_isNewReconciler:!1},qh={readContext:Ps,useCallback:om,useContext:Ps,useEffect:Dc,useImperativeHandle:lm,useInsertionEffect:nm,useLayoutEffect:rm,useMemo:im,useReducer:zo,useRef:sm,useState:function(){return zo(Da)},useDebugValue:Oc,useDeferredValue:function(e){var s=Rs();return Tt===null?s.memoizedState=e:cm(s,Tt.memoizedState,e)},useTransition:function(){var e=zo(Da)[0],s=Rs().memoizedState;return[e,s]},useMutableSource:K0,useSyncExternalStore:Y0,useId:dm,unstable_isNewReconciler:!1};function Ys(e,s){if(e&&e.defaultProps){s=St({},s),e=e.defaultProps;for(var n in e)s[n]===void 0&&(s[n]=e[n]);return s}return s}function Li(e,s,n,r){s=e.memoizedState,n=n(r,s),n=n==null?s:St({},s,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var ao={isMounted:function(e){return(e=e._reactInternals)?pr(e)===e:!1},enqueueSetState:function(e,s,n){e=e._reactInternals;var r=as(),a=Gn(e),l=jn(r,a);l.payload=s,n!=null&&(l.callback=n),s=Fn(e,l,a),s!==null&&(en(s,e,a,r),bl(s,e,a))},enqueueReplaceState:function(e,s,n){e=e._reactInternals;var r=as(),a=Gn(e),l=jn(r,a);l.tag=1,l.payload=s,n!=null&&(l.callback=n),s=Fn(e,l,a),s!==null&&(en(s,e,a,r),bl(s,e,a))},enqueueForceUpdate:function(e,s){e=e._reactInternals;var n=as(),r=Gn(e),a=jn(n,r);a.tag=2,s!=null&&(a.callback=s),s=Fn(e,a,r),s!==null&&(en(s,e,r,n),bl(s,e,r))}};function Fd(e,s,n,r,a,l,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,l,o):s.prototype&&s.prototype.isPureReactComponent?!_a(n,r)||!_a(a,l):!0}function hm(e,s,n){var r=!1,a=Jn,l=s.contextType;return typeof l=="object"&&l!==null?l=Ps(l):(a=ps(s)?cr:Qt.current,r=s.contextTypes,l=(r=r!=null)?Ur(e,a):Jn),s=new s(n,l),e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=ao,e.stateNode=s,s._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=l),s}function Hd(e,s,n,r){e=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(n,r),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(n,r),s.state!==e&&ao.enqueueReplaceState(s,s.state,null)}function Ti(e,s,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},_c(e);var l=s.contextType;typeof l=="object"&&l!==null?a.context=Ps(l):(l=ps(s)?cr:Qt.current,a.context=Ur(e,l)),a.state=e.memoizedState,l=s.getDerivedStateFromProps,typeof l=="function"&&(Li(e,s,l,n),a.state=e.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(s=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),s!==a.state&&ao.enqueueReplaceState(a,a.state,null),Bl(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Vr(e,s){try{var n="",r=s;do n+=Cf(r),r=r.return;while(r);var a=n}catch(l){a=`
Error generating stack: `+l.message+`
`+l.stack}return{value:e,source:s,stack:a,digest:null}}function Bo(e,s,n){return{value:e,source:null,stack:n??null,digest:s??null}}function Ai(e,s){try{console.error(s.value)}catch(n){setTimeout(function(){throw n})}}var Xh=typeof WeakMap=="function"?WeakMap:Map;function pm(e,s,n){n=jn(-1,n),n.tag=3,n.payload={element:null};var r=s.value;return n.callback=function(){Gl||(Gl=!0,Hi=r),Ai(e,s)},n}function xm(e,s,n){n=jn(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=s.value;n.payload=function(){return r(a)},n.callback=function(){Ai(e,s)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(n.callback=function(){Ai(e,s),typeof r!="function"&&(Hn===null?Hn=new Set([this]):Hn.add(this));var o=s.stack;this.componentDidCatch(s.value,{componentStack:o!==null?o:""})}),n}function Gd(e,s,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Xh;var a=new Set;r.set(s,a)}else a=r.get(s),a===void 0&&(a=new Set,r.set(s,a));a.has(n)||(a.add(n),e=fp.bind(null,e,s,n),s.then(e,e))}function Vd(e){do{var s;if((s=e.tag===13)&&(s=e.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return e;e=e.return}while(e!==null);return null}function Zd(e,s,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===s?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(s=jn(-1,1),s.tag=2,Fn(n,s,1))),n.lanes|=1),e)}var ep=Mn.ReactCurrentOwner,fs=!1;function rs(e,s,n,r){s.child=e===null?G0(s,null,n,r):Hr(s,e.child,n,r)}function Jd(e,s,n,r,a){n=n.render;var l=s.ref;return zr(s,a),r=Pc(e,s,n,r,l,a),n=Rc(),e!==null&&!fs?(s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~a,Cn(e,s,a)):(jt&&n&&Nc(s),s.flags|=1,rs(e,s,r,a),s.child)}function Kd(e,s,n,r,a){if(e===null){var l=n.type;return typeof l=="function"&&!Vc(l)&&l.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(s.tag=15,s.type=l,gm(e,s,l,r,a)):(e=kl(n.type,null,r,s,s.mode,a),e.ref=s.ref,e.return=s,s.child=e)}if(l=e.child,!(e.lanes&a)){var o=l.memoizedProps;if(n=n.compare,n=n!==null?n:_a,n(o,r)&&e.ref===s.ref)return Cn(e,s,a)}return s.flags|=1,e=Vn(l,r),e.ref=s.ref,e.return=s,s.child=e}function gm(e,s,n,r,a){if(e!==null){var l=e.memoizedProps;if(_a(l,r)&&e.ref===s.ref)if(fs=!1,s.pendingProps=r=l,(e.lanes&a)!==0)e.flags&131072&&(fs=!0);else return s.lanes=e.lanes,Cn(e,s,a)}return Pi(e,s,n,r,a)}function bm(e,s,n){var r=s.pendingProps,a=r.children,l=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},bt(Lr,ws),ws|=n;else{if(!(n&1073741824))return e=l!==null?l.baseLanes|n:n,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:e,cachePool:null,transitions:null},s.updateQueue=null,bt(Lr,ws),ws|=e,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=l!==null?l.baseLanes:n,bt(Lr,ws),ws|=r}else l!==null?(r=l.baseLanes|n,s.memoizedState=null):r=n,bt(Lr,ws),ws|=r;return rs(e,s,a,n),s.child}function vm(e,s){var n=s.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(s.flags|=512,s.flags|=2097152)}function Pi(e,s,n,r,a){var l=ps(n)?cr:Qt.current;return l=Ur(s,l),zr(s,a),n=Pc(e,s,n,r,l,a),r=Rc(),e!==null&&!fs?(s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~a,Cn(e,s,a)):(jt&&r&&Nc(s),s.flags|=1,rs(e,s,n,a),s.child)}function Yd(e,s,n,r,a){if(ps(n)){var l=!0;Pl(s)}else l=!1;if(zr(s,a),s.stateNode===null)yl(e,s),hm(s,n,r),Ti(s,n,r,a),r=!0;else if(e===null){var o=s.stateNode,i=s.memoizedProps;o.props=i;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=Ps(d):(d=ps(n)?cr:Qt.current,d=Ur(s,d));var f=n.getDerivedStateFromProps,h=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(i!==r||c!==d)&&Hd(s,o,r,d),Ln=!1;var p=s.memoizedState;o.state=p,Bl(s,r,o,a),c=s.memoizedState,i!==r||p!==c||hs.current||Ln?(typeof f=="function"&&(Li(s,n,f,r),c=s.memoizedState),(i=Ln||Fd(s,n,i,r,p,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(s.flags|=4194308)):(typeof o.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=r,s.memoizedState=c),o.props=r,o.state=c,o.context=d,r=i):(typeof o.componentDidMount=="function"&&(s.flags|=4194308),r=!1)}else{o=s.stateNode,Z0(e,s),i=s.memoizedProps,d=s.type===s.elementType?i:Ys(s.type,i),o.props=d,h=s.pendingProps,p=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ps(c):(c=ps(n)?cr:Qt.current,c=Ur(s,c));var m=n.getDerivedStateFromProps;(f=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(i!==h||p!==c)&&Hd(s,o,r,c),Ln=!1,p=s.memoizedState,o.state=p,Bl(s,r,o,a);var x=s.memoizedState;i!==h||p!==x||hs.current||Ln?(typeof m=="function"&&(Li(s,n,m,r),x=s.memoizedState),(d=Ln||Fd(s,n,d,r,p,x,c)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,x,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,x,c)),typeof o.componentDidUpdate=="function"&&(s.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof o.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(s.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(s.flags|=1024),s.memoizedProps=r,s.memoizedState=x),o.props=r,o.state=x,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(s.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(s.flags|=1024),r=!1)}return Ri(e,s,n,r,l,a)}function Ri(e,s,n,r,a,l){vm(e,s);var o=(s.flags&128)!==0;if(!r&&!o)return a&&Pd(s,n,!1),Cn(e,s,l);r=s.stateNode,ep.current=s;var i=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return s.flags|=1,e!==null&&o?(s.child=Hr(s,e.child,null,l),s.child=Hr(s,null,i,l)):rs(e,s,i,l),s.memoizedState=r.state,a&&Pd(s,n,!0),s.child}function wm(e){var s=e.stateNode;s.pendingContext?Ad(e,s.pendingContext,s.pendingContext!==s.context):s.context&&Ad(e,s.context,!1),Ec(e,s.containerInfo)}function Qd(e,s,n,r,a){return Fr(),Sc(a),s.flags|=256,rs(e,s,n,r),s.child}var Di={dehydrated:null,treeContext:null,retryLane:0};function Oi(e){return{baseLanes:e,cachePool:null,transitions:null}}function ym(e,s,n){var r=s.pendingProps,a=Nt.current,l=!1,o=(s.flags&128)!==0,i;if((i=o)||(i=e!==null&&e.memoizedState===null?!1:(a&2)!==0),i?(l=!0,s.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),bt(Nt,a&1),e===null)return _i(s),e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(s.mode&1?e.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(o=r.children,e=r.fallback,l?(r=s.mode,l=s.child,o={mode:"hidden",children:o},!(r&1)&&l!==null?(l.childLanes=0,l.pendingProps=o):l=io(o,r,0,null),e=ir(e,r,n,null),l.return=s,e.return=s,l.sibling=e,s.child=l,s.child.memoizedState=Oi(n),s.memoizedState=Di,e):zc(s,o));if(a=e.memoizedState,a!==null&&(i=a.dehydrated,i!==null))return tp(e,s,o,r,i,a,n);if(l){l=r.fallback,o=s.mode,a=e.child,i=a.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&s.child!==a?(r=s.child,r.childLanes=0,r.pendingProps=c,s.deletions=null):(r=Vn(a,c),r.subtreeFlags=a.subtreeFlags&14680064),i!==null?l=Vn(i,l):(l=ir(l,o,n,null),l.flags|=2),l.return=s,r.return=s,r.sibling=l,s.child=r,r=l,l=s.child,o=e.child.memoizedState,o=o===null?Oi(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},l.memoizedState=o,l.childLanes=e.childLanes&~n,s.memoizedState=Di,r}return l=e.child,e=l.sibling,r=Vn(l,{mode:"visible",children:r.children}),!(s.mode&1)&&(r.lanes=n),r.return=s,r.sibling=null,e!==null&&(n=s.deletions,n===null?(s.deletions=[e],s.flags|=16):n.push(e)),s.child=r,s.memoizedState=null,r}function zc(e,s){return s=io({mode:"visible",children:s},e.mode,0,null),s.return=e,e.child=s}function ll(e,s,n,r){return r!==null&&Sc(r),Hr(s,e.child,null,n),e=zc(s,s.pendingProps.children),e.flags|=2,s.memoizedState=null,e}function tp(e,s,n,r,a,l,o){if(n)return s.flags&256?(s.flags&=-257,r=Bo(Error(_e(422))),ll(e,s,o,r)):s.memoizedState!==null?(s.child=e.child,s.flags|=128,null):(l=r.fallback,a=s.mode,r=io({mode:"visible",children:r.children},a,0,null),l=ir(l,a,o,null),l.flags|=2,r.return=s,l.return=s,r.sibling=l,s.child=r,s.mode&1&&Hr(s,e.child,null,o),s.child.memoizedState=Oi(o),s.memoizedState=Di,l);if(!(s.mode&1))return ll(e,s,o,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var i=r.dgst;return r=i,l=Error(_e(419)),r=Bo(l,r,void 0),ll(e,s,o,r)}if(i=(o&e.childLanes)!==0,fs||i){if(r=zt,r!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|o)?0:a,a!==0&&a!==l.retryLane&&(l.retryLane=a,Sn(e,a),en(r,e,a,-1))}return Gc(),r=Bo(Error(_e(421))),ll(e,s,o,r)}return a.data==="$?"?(s.flags|=128,s.child=e.child,s=hp.bind(null,e),a._reactRetry=s,null):(e=l.treeContext,ys=Un(a.nextSibling),js=s,jt=!0,qs=null,e!==null&&(Es[Ls++]=wn,Es[Ls++]=yn,Es[Ls++]=dr,wn=e.id,yn=e.overflow,dr=s),s=zc(s,r.children),s.flags|=4096,s)}function qd(e,s,n){e.lanes|=s;var r=e.alternate;r!==null&&(r.lanes|=s),Ei(e.return,s,n)}function Wo(e,s,n,r,a){var l=e.memoizedState;l===null?e.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(l.isBackwards=s,l.rendering=null,l.renderingStartTime=0,l.last=r,l.tail=n,l.tailMode=a)}function jm(e,s,n){var r=s.pendingProps,a=r.revealOrder,l=r.tail;if(rs(e,s,r.children,n),r=Nt.current,r&2)r=r&1|2,s.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=s.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&qd(e,n,s);else if(e.tag===19)qd(e,n,s);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break e;for(;e.sibling===null;){if(e.return===null||e.return===s)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(bt(Nt,r),!(s.mode&1))s.memoizedState=null;else switch(a){case"forwards":for(n=s.child,a=null;n!==null;)e=n.alternate,e!==null&&Wl(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=s.child,s.child=null):(a=n.sibling,n.sibling=null),Wo(s,!1,a,n,l);break;case"backwards":for(n=null,a=s.child,s.child=null;a!==null;){if(e=a.alternate,e!==null&&Wl(e)===null){s.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Wo(s,!0,n,null,l);break;case"together":Wo(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function yl(e,s){!(s.mode&1)&&e!==null&&(e.alternate=null,s.alternate=null,s.flags|=2)}function Cn(e,s,n){if(e!==null&&(s.dependencies=e.dependencies),mr|=s.lanes,!(n&s.childLanes))return null;if(e!==null&&s.child!==e.child)throw Error(_e(153));if(s.child!==null){for(e=s.child,n=Vn(e,e.pendingProps),s.child=n,n.return=s;e.sibling!==null;)e=e.sibling,n=n.sibling=Vn(e,e.pendingProps),n.return=s;n.sibling=null}return s.child}function sp(e,s,n){switch(s.tag){case 3:wm(s),Fr();break;case 5:J0(s);break;case 1:ps(s.type)&&Pl(s);break;case 4:Ec(s,s.stateNode.containerInfo);break;case 10:var r=s.type._context,a=s.memoizedProps.value;bt(Ol,r._currentValue),r._currentValue=a;break;case 13:if(r=s.memoizedState,r!==null)return r.dehydrated!==null?(bt(Nt,Nt.current&1),s.flags|=128,null):n&s.child.childLanes?ym(e,s,n):(bt(Nt,Nt.current&1),e=Cn(e,s,n),e!==null?e.sibling:null);bt(Nt,Nt.current&1);break;case 19:if(r=(n&s.childLanes)!==0,e.flags&128){if(r)return jm(e,s,n);s.flags|=128}if(a=s.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),bt(Nt,Nt.current),r)break;return null;case 22:case 23:return s.lanes=0,bm(e,s,n)}return Cn(e,s,n)}var Nm,zi,km,Sm;Nm=function(e,s){for(var n=s.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};zi=function(){};km=function(e,s,n,r){var a=e.memoizedProps;if(a!==r){e=s.stateNode,lr(fn.current);var l=null;switch(n){case"input":a=oi(e,a),r=oi(e,r),l=[];break;case"select":a=St({},a,{value:void 0}),r=St({},r,{value:void 0}),l=[];break;case"textarea":a=di(e,a),r=di(e,r),l=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Tl)}mi(n,r);var o;n=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var i=a[d];for(o in i)i.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Na.hasOwnProperty(d)?l||(l=[]):(l=l||[]).push(d,null));for(d in r){var c=r[d];if(i=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&c!==i&&(c!=null||i!=null))if(d==="style")if(i){for(o in i)!i.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&i[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(l||(l=[]),l.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,i=i?i.__html:void 0,c!=null&&i!==c&&(l=l||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(l=l||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Na.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&vt("scroll",e),l||i===c||(l=[])):(l=l||[]).push(d,c))}n&&(l=l||[]).push("style",n);var d=l;(s.updateQueue=d)&&(s.flags|=4)}};Sm=function(e,s,n,r){n!==r&&(s.flags|=4)};function oa(e,s){if(!jt)switch(e.tailMode){case"hidden":s=e.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?s||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Kt(e){var s=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(s)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,s}function np(e,s,n){var r=s.pendingProps;switch(kc(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kt(s),null;case 1:return ps(s.type)&&Al(),Kt(s),null;case 3:return r=s.stateNode,Gr(),wt(hs),wt(Qt),Tc(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(rl(s)?s.flags|=4:e===null||e.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,qs!==null&&(Zi(qs),qs=null))),zi(e,s),Kt(s),null;case 5:Lc(s);var a=lr(Pa.current);if(n=s.type,e!==null&&s.stateNode!=null)km(e,s,n,r,a),e.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!r){if(s.stateNode===null)throw Error(_e(166));return Kt(s),null}if(e=lr(fn.current),rl(s)){r=s.stateNode,n=s.type;var l=s.memoizedProps;switch(r[un]=s,r[Ta]=l,e=(s.mode&1)!==0,n){case"dialog":vt("cancel",r),vt("close",r);break;case"iframe":case"object":case"embed":vt("load",r);break;case"video":case"audio":for(a=0;a<fa.length;a++)vt(fa[a],r);break;case"source":vt("error",r);break;case"img":case"image":case"link":vt("error",r),vt("load",r);break;case"details":vt("toggle",r);break;case"input":od(r,l),vt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!l.multiple},vt("invalid",r);break;case"textarea":cd(r,l),vt("invalid",r)}mi(n,l),a=null;for(var o in l)if(l.hasOwnProperty(o)){var i=l[o];o==="children"?typeof i=="string"?r.textContent!==i&&(l.suppressHydrationWarning!==!0&&nl(r.textContent,i,e),a=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(l.suppressHydrationWarning!==!0&&nl(r.textContent,i,e),a=["children",""+i]):Na.hasOwnProperty(o)&&i!=null&&o==="onScroll"&&vt("scroll",r)}switch(n){case"input":Ka(r),id(r,l,!0);break;case"textarea":Ka(r),dd(r);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(r.onclick=Tl)}r=a,s.updateQueue=r,r!==null&&(s.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Xu(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[un]=s,e[Ta]=r,Nm(e,s,!1,!1),s.stateNode=e;e:{switch(o=fi(n,r),n){case"dialog":vt("cancel",e),vt("close",e),a=r;break;case"iframe":case"object":case"embed":vt("load",e),a=r;break;case"video":case"audio":for(a=0;a<fa.length;a++)vt(fa[a],e);a=r;break;case"source":vt("error",e),a=r;break;case"img":case"image":case"link":vt("error",e),vt("load",e),a=r;break;case"details":vt("toggle",e),a=r;break;case"input":od(e,r),a=oi(e,r),vt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=St({},r,{value:void 0}),vt("invalid",e);break;case"textarea":cd(e,r),a=di(e,r),vt("invalid",e);break;default:a=r}mi(n,a),i=a;for(l in i)if(i.hasOwnProperty(l)){var c=i[l];l==="style"?s0(e,c):l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&e0(e,c)):l==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ka(e,c):typeof c=="number"&&ka(e,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Na.hasOwnProperty(l)?c!=null&&l==="onScroll"&&vt("scroll",e):c!=null&&cc(e,l,c,o))}switch(n){case"input":Ka(e),id(e,r,!1);break;case"textarea":Ka(e),dd(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Zn(r.value));break;case"select":e.multiple=!!r.multiple,l=r.value,l!=null?Pr(e,!!r.multiple,l,!1):r.defaultValue!=null&&Pr(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Tl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Kt(s),null;case 6:if(e&&s.stateNode!=null)Sm(e,s,e.memoizedProps,r);else{if(typeof r!="string"&&s.stateNode===null)throw Error(_e(166));if(n=lr(Pa.current),lr(fn.current),rl(s)){if(r=s.stateNode,n=s.memoizedProps,r[un]=s,(l=r.nodeValue!==n)&&(e=js,e!==null))switch(e.tag){case 3:nl(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&nl(r.nodeValue,n,(e.mode&1)!==0)}l&&(s.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[un]=s,s.stateNode=r}return Kt(s),null;case 13:if(wt(Nt),r=s.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(jt&&ys!==null&&s.mode&1&&!(s.flags&128))F0(),Fr(),s.flags|=98560,l=!1;else if(l=rl(s),r!==null&&r.dehydrated!==null){if(e===null){if(!l)throw Error(_e(318));if(l=s.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(_e(317));l[un]=s}else Fr(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Kt(s),l=!1}else qs!==null&&(Zi(qs),qs=null),l=!0;if(!l)return s.flags&65536?s:null}return s.flags&128?(s.lanes=n,s):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(s.child.flags|=8192,s.mode&1&&(e===null||Nt.current&1?At===0&&(At=3):Gc())),s.updateQueue!==null&&(s.flags|=4),Kt(s),null);case 4:return Gr(),zi(e,s),e===null&&Ea(s.stateNode.containerInfo),Kt(s),null;case 10:return Mc(s.type._context),Kt(s),null;case 17:return ps(s.type)&&Al(),Kt(s),null;case 19:if(wt(Nt),l=s.memoizedState,l===null)return Kt(s),null;if(r=(s.flags&128)!==0,o=l.rendering,o===null)if(r)oa(l,!1);else{if(At!==0||e!==null&&e.flags&128)for(e=s.child;e!==null;){if(o=Wl(e),o!==null){for(s.flags|=128,oa(l,!1),r=o.updateQueue,r!==null&&(s.updateQueue=r,s.flags|=4),s.subtreeFlags=0,r=n,n=s.child;n!==null;)l=n,e=r,l.flags&=14680066,o=l.alternate,o===null?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=o.childLanes,l.lanes=o.lanes,l.child=o.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=o.memoizedProps,l.memoizedState=o.memoizedState,l.updateQueue=o.updateQueue,l.type=o.type,e=o.dependencies,l.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return bt(Nt,Nt.current&1|2),s.child}e=e.sibling}l.tail!==null&&It()>Zr&&(s.flags|=128,r=!0,oa(l,!1),s.lanes=4194304)}else{if(!r)if(e=Wl(o),e!==null){if(s.flags|=128,r=!0,n=e.updateQueue,n!==null&&(s.updateQueue=n,s.flags|=4),oa(l,!0),l.tail===null&&l.tailMode==="hidden"&&!o.alternate&&!jt)return Kt(s),null}else 2*It()-l.renderingStartTime>Zr&&n!==1073741824&&(s.flags|=128,r=!0,oa(l,!1),s.lanes=4194304);l.isBackwards?(o.sibling=s.child,s.child=o):(n=l.last,n!==null?n.sibling=o:s.child=o,l.last=o)}return l.tail!==null?(s=l.tail,l.rendering=s,l.tail=s.sibling,l.renderingStartTime=It(),s.sibling=null,n=Nt.current,bt(Nt,r?n&1|2:n&1),s):(Kt(s),null);case 22:case 23:return Hc(),r=s.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(s.flags|=8192),r&&s.mode&1?ws&1073741824&&(Kt(s),s.subtreeFlags&6&&(s.flags|=8192)):Kt(s),null;case 24:return null;case 25:return null}throw Error(_e(156,s.tag))}function rp(e,s){switch(kc(s),s.tag){case 1:return ps(s.type)&&Al(),e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 3:return Gr(),wt(hs),wt(Qt),Tc(),e=s.flags,e&65536&&!(e&128)?(s.flags=e&-65537|128,s):null;case 5:return Lc(s),null;case 13:if(wt(Nt),e=s.memoizedState,e!==null&&e.dehydrated!==null){if(s.alternate===null)throw Error(_e(340));Fr()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 19:return wt(Nt),null;case 4:return Gr(),null;case 10:return Mc(s.type._context),null;case 22:case 23:return Hc(),null;case 24:return null;default:return null}}var ol=!1,Yt=!1,ap=typeof WeakSet=="function"?WeakSet:Set,Ue=null;function Er(e,s){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Mt(e,s,r)}else n.current=null}function Bi(e,s,n){try{n()}catch(r){Mt(e,s,r)}}var Xd=!1;function lp(e,s){if(Ni=_l,e=_0(),jc(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,l=r.focusNode;r=r.focusOffset;try{n.nodeType,l.nodeType}catch{n=null;break e}var o=0,i=-1,c=-1,d=0,f=0,h=e,p=null;t:for(;;){for(var m;h!==n||a!==0&&h.nodeType!==3||(i=o+a),h!==l||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===a&&(i=o),p===l&&++f===r&&(c=o),(m=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=m}n=i===-1||c===-1?null:{start:i,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ki={focusedElem:e,selectionRange:n},_l=!1,Ue=s;Ue!==null;)if(s=Ue,e=s.child,(s.subtreeFlags&1028)!==0&&e!==null)e.return=s,Ue=e;else for(;Ue!==null;){s=Ue;try{var x=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var y=x.memoizedProps,C=x.memoizedState,g=s.stateNode,b=g.getSnapshotBeforeUpdate(s.elementType===s.type?y:Ys(s.type,y),C);g.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var v=s.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(_e(163))}}catch(w){Mt(s,s.return,w)}if(e=s.sibling,e!==null){e.return=s.return,Ue=e;break}Ue=s.return}return x=Xd,Xd=!1,x}function wa(e,s,n){var r=s.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var l=a.destroy;a.destroy=void 0,l!==void 0&&Bi(s,n,l)}a=a.next}while(a!==r)}}function lo(e,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var n=s=s.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==s)}}function Wi(e){var s=e.ref;if(s!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof s=="function"?s(e):s.current=e}}function Cm(e){var s=e.alternate;s!==null&&(e.alternate=null,Cm(s)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(s=e.stateNode,s!==null&&(delete s[un],delete s[Ta],delete s[$i],delete s[Uh],delete s[Fh])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function $m(e){return e.tag===5||e.tag===3||e.tag===4}function eu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||$m(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ui(e,s,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,s?n.nodeType===8?n.parentNode.insertBefore(e,s):n.insertBefore(e,s):(n.nodeType===8?(s=n.parentNode,s.insertBefore(e,n)):(s=n,s.appendChild(e)),n=n._reactRootContainer,n!=null||s.onclick!==null||(s.onclick=Tl));else if(r!==4&&(e=e.child,e!==null))for(Ui(e,s,n),e=e.sibling;e!==null;)Ui(e,s,n),e=e.sibling}function Fi(e,s,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,s?n.insertBefore(e,s):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Fi(e,s,n),e=e.sibling;e!==null;)Fi(e,s,n),e=e.sibling}var Bt=null,Qs=!1;function _n(e,s,n){for(n=n.child;n!==null;)Mm(e,s,n),n=n.sibling}function Mm(e,s,n){if(mn&&typeof mn.onCommitFiberUnmount=="function")try{mn.onCommitFiberUnmount(ql,n)}catch{}switch(n.tag){case 5:Yt||Er(n,s);case 6:var r=Bt,a=Qs;Bt=null,_n(e,s,n),Bt=r,Qs=a,Bt!==null&&(Qs?(e=Bt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Bt.removeChild(n.stateNode));break;case 18:Bt!==null&&(Qs?(e=Bt,n=n.stateNode,e.nodeType===8?Ao(e.parentNode,n):e.nodeType===1&&Ao(e,n),Ma(e)):Ao(Bt,n.stateNode));break;case 4:r=Bt,a=Qs,Bt=n.stateNode.containerInfo,Qs=!0,_n(e,s,n),Bt=r,Qs=a;break;case 0:case 11:case 14:case 15:if(!Yt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var l=a,o=l.destroy;l=l.tag,o!==void 0&&(l&2||l&4)&&Bi(n,s,o),a=a.next}while(a!==r)}_n(e,s,n);break;case 1:if(!Yt&&(Er(n,s),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(i){Mt(n,s,i)}_n(e,s,n);break;case 21:_n(e,s,n);break;case 22:n.mode&1?(Yt=(r=Yt)||n.memoizedState!==null,_n(e,s,n),Yt=r):_n(e,s,n);break;default:_n(e,s,n)}}function tu(e){var s=e.updateQueue;if(s!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new ap),s.forEach(function(r){var a=pp.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function Os(e,s){var n=s.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var l=e,o=s,i=o;e:for(;i!==null;){switch(i.tag){case 5:Bt=i.stateNode,Qs=!1;break e;case 3:Bt=i.stateNode.containerInfo,Qs=!0;break e;case 4:Bt=i.stateNode.containerInfo,Qs=!0;break e}i=i.return}if(Bt===null)throw Error(_e(160));Mm(l,o,a),Bt=null,Qs=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){Mt(a,s,d)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)Im(s,e),s=s.sibling}function Im(e,s){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Os(s,e),an(e),r&4){try{wa(3,e,e.return),lo(3,e)}catch(y){Mt(e,e.return,y)}try{wa(5,e,e.return)}catch(y){Mt(e,e.return,y)}}break;case 1:Os(s,e),an(e),r&512&&n!==null&&Er(n,n.return);break;case 5:if(Os(s,e),an(e),r&512&&n!==null&&Er(n,n.return),e.flags&32){var a=e.stateNode;try{ka(a,"")}catch(y){Mt(e,e.return,y)}}if(r&4&&(a=e.stateNode,a!=null)){var l=e.memoizedProps,o=n!==null?n.memoizedProps:l,i=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{i==="input"&&l.type==="radio"&&l.name!=null&&Qu(a,l),fi(i,o);var d=fi(i,l);for(o=0;o<c.length;o+=2){var f=c[o],h=c[o+1];f==="style"?s0(a,h):f==="dangerouslySetInnerHTML"?e0(a,h):f==="children"?ka(a,h):cc(a,f,h,d)}switch(i){case"input":ii(a,l);break;case"textarea":qu(a,l);break;case"select":var p=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!l.multiple;var m=l.value;m!=null?Pr(a,!!l.multiple,m,!1):p!==!!l.multiple&&(l.defaultValue!=null?Pr(a,!!l.multiple,l.defaultValue,!0):Pr(a,!!l.multiple,l.multiple?[]:"",!1))}a[Ta]=l}catch(y){Mt(e,e.return,y)}}break;case 6:if(Os(s,e),an(e),r&4){if(e.stateNode===null)throw Error(_e(162));a=e.stateNode,l=e.memoizedProps;try{a.nodeValue=l}catch(y){Mt(e,e.return,y)}}break;case 3:if(Os(s,e),an(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ma(s.containerInfo)}catch(y){Mt(e,e.return,y)}break;case 4:Os(s,e),an(e);break;case 13:Os(s,e),an(e),a=e.child,a.flags&8192&&(l=a.memoizedState!==null,a.stateNode.isHidden=l,!l||a.alternate!==null&&a.alternate.memoizedState!==null||(Uc=It())),r&4&&tu(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(Yt=(d=Yt)||f,Os(s,e),Yt=d):Os(s,e),an(e),r&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!f&&e.mode&1)for(Ue=e,f=e.child;f!==null;){for(h=Ue=f;Ue!==null;){switch(p=Ue,m=p.child,p.tag){case 0:case 11:case 14:case 15:wa(4,p,p.return);break;case 1:Er(p,p.return);var x=p.stateNode;if(typeof x.componentWillUnmount=="function"){r=p,n=p.return;try{s=r,x.props=s.memoizedProps,x.state=s.memoizedState,x.componentWillUnmount()}catch(y){Mt(r,n,y)}}break;case 5:Er(p,p.return);break;case 22:if(p.memoizedState!==null){nu(h);continue}}m!==null?(m.return=p,Ue=m):nu(h)}f=f.sibling}e:for(f=null,h=e;;){if(h.tag===5){if(f===null){f=h;try{a=h.stateNode,d?(l=a.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(i=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,i.style.display=t0("display",o))}catch(y){Mt(e,e.return,y)}}}else if(h.tag===6){if(f===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(y){Mt(e,e.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;f===h&&(f=null),h=h.return}f===h&&(f=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Os(s,e),an(e),r&4&&tu(e);break;case 21:break;default:Os(s,e),an(e)}}function an(e){var s=e.flags;if(s&2){try{e:{for(var n=e.return;n!==null;){if($m(n)){var r=n;break e}n=n.return}throw Error(_e(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(ka(a,""),r.flags&=-33);var l=eu(e);Fi(e,l,a);break;case 3:case 4:var o=r.stateNode.containerInfo,i=eu(e);Ui(e,i,o);break;default:throw Error(_e(161))}}catch(c){Mt(e,e.return,c)}e.flags&=-3}s&4096&&(e.flags&=-4097)}function op(e,s,n){Ue=e,_m(e)}function _m(e,s,n){for(var r=(e.mode&1)!==0;Ue!==null;){var a=Ue,l=a.child;if(a.tag===22&&r){var o=a.memoizedState!==null||ol;if(!o){var i=a.alternate,c=i!==null&&i.memoizedState!==null||Yt;i=ol;var d=Yt;if(ol=o,(Yt=c)&&!d)for(Ue=a;Ue!==null;)o=Ue,c=o.child,o.tag===22&&o.memoizedState!==null?ru(a):c!==null?(c.return=o,Ue=c):ru(a);for(;l!==null;)Ue=l,_m(l),l=l.sibling;Ue=a,ol=i,Yt=d}su(e)}else a.subtreeFlags&8772&&l!==null?(l.return=a,Ue=l):su(e)}}function su(e){for(;Ue!==null;){var s=Ue;if(s.flags&8772){var n=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Yt||lo(5,s);break;case 1:var r=s.stateNode;if(s.flags&4&&!Yt)if(n===null)r.componentDidMount();else{var a=s.elementType===s.type?n.memoizedProps:Ys(s.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var l=s.updateQueue;l!==null&&Bd(s,l,r);break;case 3:var o=s.updateQueue;if(o!==null){if(n=null,s.child!==null)switch(s.child.tag){case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}Bd(s,o,n)}break;case 5:var i=s.stateNode;if(n===null&&s.flags&4){n=i;var c=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var d=s.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var h=f.dehydrated;h!==null&&Ma(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(_e(163))}Yt||s.flags&512&&Wi(s)}catch(p){Mt(s,s.return,p)}}if(s===e){Ue=null;break}if(n=s.sibling,n!==null){n.return=s.return,Ue=n;break}Ue=s.return}}function nu(e){for(;Ue!==null;){var s=Ue;if(s===e){Ue=null;break}var n=s.sibling;if(n!==null){n.return=s.return,Ue=n;break}Ue=s.return}}function ru(e){for(;Ue!==null;){var s=Ue;try{switch(s.tag){case 0:case 11:case 15:var n=s.return;try{lo(4,s)}catch(c){Mt(s,n,c)}break;case 1:var r=s.stateNode;if(typeof r.componentDidMount=="function"){var a=s.return;try{r.componentDidMount()}catch(c){Mt(s,a,c)}}var l=s.return;try{Wi(s)}catch(c){Mt(s,l,c)}break;case 5:var o=s.return;try{Wi(s)}catch(c){Mt(s,o,c)}}}catch(c){Mt(s,s.return,c)}if(s===e){Ue=null;break}var i=s.sibling;if(i!==null){i.return=s.return,Ue=i;break}Ue=s.return}}var ip=Math.ceil,Hl=Mn.ReactCurrentDispatcher,Bc=Mn.ReactCurrentOwner,As=Mn.ReactCurrentBatchConfig,ut=0,zt=null,_t=null,Wt=0,ws=0,Lr=Yn(0),At=0,za=null,mr=0,oo=0,Wc=0,ya=null,ms=null,Uc=0,Zr=1/0,bn=null,Gl=!1,Hi=null,Hn=null,il=!1,Dn=null,Vl=0,ja=0,Gi=null,jl=-1,Nl=0;function as(){return ut&6?It():jl!==-1?jl:jl=It()}function Gn(e){return e.mode&1?ut&2&&Wt!==0?Wt&-Wt:Gh.transition!==null?(Nl===0&&(Nl=h0()),Nl):(e=ft,e!==0||(e=window.event,e=e===void 0?16:y0(e.type)),e):1}function en(e,s,n,r){if(50<ja)throw ja=0,Gi=null,Error(_e(185));Wa(e,n,r),(!(ut&2)||e!==zt)&&(e===zt&&(!(ut&2)&&(oo|=n),At===4&&Pn(e,Wt)),xs(e,r),n===1&&ut===0&&!(s.mode&1)&&(Zr=It()+500,no&&Qn()))}function xs(e,s){var n=e.callbackNode;Gf(e,s);var r=Il(e,e===zt?Wt:0);if(r===0)n!==null&&fd(n),e.callbackNode=null,e.callbackPriority=0;else if(s=r&-r,e.callbackPriority!==s){if(n!=null&&fd(n),s===1)e.tag===0?Hh(au.bind(null,e)):B0(au.bind(null,e)),Bh(function(){!(ut&6)&&Qn()}),n=null;else{switch(p0(r)){case 1:n=hc;break;case 4:n=m0;break;case 16:n=Ml;break;case 536870912:n=f0;break;default:n=Ml}n=Om(n,Em.bind(null,e))}e.callbackPriority=s,e.callbackNode=n}}function Em(e,s){if(jl=-1,Nl=0,ut&6)throw Error(_e(327));var n=e.callbackNode;if(Br()&&e.callbackNode!==n)return null;var r=Il(e,e===zt?Wt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||s)s=Zl(e,r);else{s=r;var a=ut;ut|=2;var l=Tm();(zt!==e||Wt!==s)&&(bn=null,Zr=It()+500,or(e,s));do try{up();break}catch(i){Lm(e,i)}while(!0);$c(),Hl.current=l,ut=a,_t!==null?s=0:(zt=null,Wt=0,s=At)}if(s!==0){if(s===2&&(a=bi(e),a!==0&&(r=a,s=Vi(e,a))),s===1)throw n=za,or(e,0),Pn(e,r),xs(e,It()),n;if(s===6)Pn(e,r);else{if(a=e.current.alternate,!(r&30)&&!cp(a)&&(s=Zl(e,r),s===2&&(l=bi(e),l!==0&&(r=l,s=Vi(e,l))),s===1))throw n=za,or(e,0),Pn(e,r),xs(e,It()),n;switch(e.finishedWork=a,e.finishedLanes=r,s){case 0:case 1:throw Error(_e(345));case 2:nr(e,ms,bn);break;case 3:if(Pn(e,r),(r&130023424)===r&&(s=Uc+500-It(),10<s)){if(Il(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){as(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Ci(nr.bind(null,e,ms,bn),s);break}nr(e,ms,bn);break;case 4:if(Pn(e,r),(r&4194240)===r)break;for(s=e.eventTimes,a=-1;0<r;){var o=31-Xs(r);l=1<<o,o=s[o],o>a&&(a=o),r&=~l}if(r=a,r=It()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ip(r/1960))-r,10<r){e.timeoutHandle=Ci(nr.bind(null,e,ms,bn),r);break}nr(e,ms,bn);break;case 5:nr(e,ms,bn);break;default:throw Error(_e(329))}}}return xs(e,It()),e.callbackNode===n?Em.bind(null,e):null}function Vi(e,s){var n=ya;return e.current.memoizedState.isDehydrated&&(or(e,s).flags|=256),e=Zl(e,s),e!==2&&(s=ms,ms=n,s!==null&&Zi(s)),e}function Zi(e){ms===null?ms=e:ms.push.apply(ms,e)}function cp(e){for(var s=e;;){if(s.flags&16384){var n=s.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],l=a.getSnapshot;a=a.value;try{if(!sn(l(),a))return!1}catch{return!1}}}if(n=s.child,s.subtreeFlags&16384&&n!==null)n.return=s,s=n;else{if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Pn(e,s){for(s&=~Wc,s&=~oo,e.suspendedLanes|=s,e.pingedLanes&=~s,e=e.expirationTimes;0<s;){var n=31-Xs(s),r=1<<n;e[n]=-1,s&=~r}}function au(e){if(ut&6)throw Error(_e(327));Br();var s=Il(e,0);if(!(s&1))return xs(e,It()),null;var n=Zl(e,s);if(e.tag!==0&&n===2){var r=bi(e);r!==0&&(s=r,n=Vi(e,r))}if(n===1)throw n=za,or(e,0),Pn(e,s),xs(e,It()),n;if(n===6)throw Error(_e(345));return e.finishedWork=e.current.alternate,e.finishedLanes=s,nr(e,ms,bn),xs(e,It()),null}function Fc(e,s){var n=ut;ut|=1;try{return e(s)}finally{ut=n,ut===0&&(Zr=It()+500,no&&Qn())}}function fr(e){Dn!==null&&Dn.tag===0&&!(ut&6)&&Br();var s=ut;ut|=1;var n=As.transition,r=ft;try{if(As.transition=null,ft=1,e)return e()}finally{ft=r,As.transition=n,ut=s,!(ut&6)&&Qn()}}function Hc(){ws=Lr.current,wt(Lr)}function or(e,s){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,zh(n)),_t!==null)for(n=_t.return;n!==null;){var r=n;switch(kc(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Al();break;case 3:Gr(),wt(hs),wt(Qt),Tc();break;case 5:Lc(r);break;case 4:Gr();break;case 13:wt(Nt);break;case 19:wt(Nt);break;case 10:Mc(r.type._context);break;case 22:case 23:Hc()}n=n.return}if(zt=e,_t=e=Vn(e.current,null),Wt=ws=s,At=0,za=null,Wc=oo=mr=0,ms=ya=null,ar!==null){for(s=0;s<ar.length;s++)if(n=ar[s],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,l=n.pending;if(l!==null){var o=l.next;l.next=a,r.next=o}n.pending=r}ar=null}return e}function Lm(e,s){do{var n=_t;try{if($c(),vl.current=Fl,Ul){for(var r=kt.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Ul=!1}if(ur=0,Ot=Tt=kt=null,va=!1,Ra=0,Bc.current=null,n===null||n.return===null){At=1,za=s,_t=null;break}e:{var l=e,o=n.return,i=n,c=s;if(s=Wt,i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,f=i,h=f.tag;if(!(f.mode&1)&&(h===0||h===11||h===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var m=Vd(o);if(m!==null){m.flags&=-257,Zd(m,o,i,l,s),m.mode&1&&Gd(l,d,s),s=m,c=d;var x=s.updateQueue;if(x===null){var y=new Set;y.add(c),s.updateQueue=y}else x.add(c);break e}else{if(!(s&1)){Gd(l,d,s),Gc();break e}c=Error(_e(426))}}else if(jt&&i.mode&1){var C=Vd(o);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Zd(C,o,i,l,s),Sc(Vr(c,i));break e}}l=c=Vr(c,i),At!==4&&(At=2),ya===null?ya=[l]:ya.push(l),l=o;do{switch(l.tag){case 3:l.flags|=65536,s&=-s,l.lanes|=s;var g=pm(l,c,s);zd(l,g);break e;case 1:i=c;var b=l.type,v=l.stateNode;if(!(l.flags&128)&&(typeof b.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Hn===null||!Hn.has(v)))){l.flags|=65536,s&=-s,l.lanes|=s;var w=xm(l,i,s);zd(l,w);break e}}l=l.return}while(l!==null)}Pm(n)}catch(z){s=z,_t===n&&n!==null&&(_t=n=n.return);continue}break}while(!0)}function Tm(){var e=Hl.current;return Hl.current=Fl,e===null?Fl:e}function Gc(){(At===0||At===3||At===2)&&(At=4),zt===null||!(mr&268435455)&&!(oo&268435455)||Pn(zt,Wt)}function Zl(e,s){var n=ut;ut|=2;var r=Tm();(zt!==e||Wt!==s)&&(bn=null,or(e,s));do try{dp();break}catch(a){Lm(e,a)}while(!0);if($c(),ut=n,Hl.current=r,_t!==null)throw Error(_e(261));return zt=null,Wt=0,At}function dp(){for(;_t!==null;)Am(_t)}function up(){for(;_t!==null&&!Rf();)Am(_t)}function Am(e){var s=Dm(e.alternate,e,ws);e.memoizedProps=e.pendingProps,s===null?Pm(e):_t=s,Bc.current=null}function Pm(e){var s=e;do{var n=s.alternate;if(e=s.return,s.flags&32768){if(n=rp(n,s),n!==null){n.flags&=32767,_t=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{At=6,_t=null;return}}else if(n=np(n,s,ws),n!==null){_t=n;return}if(s=s.sibling,s!==null){_t=s;return}_t=s=e}while(s!==null);At===0&&(At=5)}function nr(e,s,n){var r=ft,a=As.transition;try{As.transition=null,ft=1,mp(e,s,n,r)}finally{As.transition=a,ft=r}return null}function mp(e,s,n,r){do Br();while(Dn!==null);if(ut&6)throw Error(_e(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(_e(177));e.callbackNode=null,e.callbackPriority=0;var l=n.lanes|n.childLanes;if(Vf(e,l),e===zt&&(_t=zt=null,Wt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||il||(il=!0,Om(Ml,function(){return Br(),null})),l=(n.flags&15990)!==0,n.subtreeFlags&15990||l){l=As.transition,As.transition=null;var o=ft;ft=1;var i=ut;ut|=4,Bc.current=null,lp(e,n),Im(n,e),Lh(ki),_l=!!Ni,ki=Ni=null,e.current=n,op(n),Df(),ut=i,ft=o,As.transition=l}else e.current=n;if(il&&(il=!1,Dn=e,Vl=a),l=e.pendingLanes,l===0&&(Hn=null),Bf(n.stateNode),xs(e,It()),s!==null)for(r=e.onRecoverableError,n=0;n<s.length;n++)a=s[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Gl)throw Gl=!1,e=Hi,Hi=null,e;return Vl&1&&e.tag!==0&&Br(),l=e.pendingLanes,l&1?e===Gi?ja++:(ja=0,Gi=e):ja=0,Qn(),null}function Br(){if(Dn!==null){var e=p0(Vl),s=As.transition,n=ft;try{if(As.transition=null,ft=16>e?16:e,Dn===null)var r=!1;else{if(e=Dn,Dn=null,Vl=0,ut&6)throw Error(_e(331));var a=ut;for(ut|=4,Ue=e.current;Ue!==null;){var l=Ue,o=l.child;if(Ue.flags&16){var i=l.deletions;if(i!==null){for(var c=0;c<i.length;c++){var d=i[c];for(Ue=d;Ue!==null;){var f=Ue;switch(f.tag){case 0:case 11:case 15:wa(8,f,l)}var h=f.child;if(h!==null)h.return=f,Ue=h;else for(;Ue!==null;){f=Ue;var p=f.sibling,m=f.return;if(Cm(f),f===d){Ue=null;break}if(p!==null){p.return=m,Ue=p;break}Ue=m}}}var x=l.alternate;if(x!==null){var y=x.child;if(y!==null){x.child=null;do{var C=y.sibling;y.sibling=null,y=C}while(y!==null)}}Ue=l}}if(l.subtreeFlags&2064&&o!==null)o.return=l,Ue=o;else e:for(;Ue!==null;){if(l=Ue,l.flags&2048)switch(l.tag){case 0:case 11:case 15:wa(9,l,l.return)}var g=l.sibling;if(g!==null){g.return=l.return,Ue=g;break e}Ue=l.return}}var b=e.current;for(Ue=b;Ue!==null;){o=Ue;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,Ue=v;else e:for(o=b;Ue!==null;){if(i=Ue,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:lo(9,i)}}catch(z){Mt(i,i.return,z)}if(i===o){Ue=null;break e}var w=i.sibling;if(w!==null){w.return=i.return,Ue=w;break e}Ue=i.return}}if(ut=a,Qn(),mn&&typeof mn.onPostCommitFiberRoot=="function")try{mn.onPostCommitFiberRoot(ql,e)}catch{}r=!0}return r}finally{ft=n,As.transition=s}}return!1}function lu(e,s,n){s=Vr(n,s),s=pm(e,s,1),e=Fn(e,s,1),s=as(),e!==null&&(Wa(e,1,s),xs(e,s))}function Mt(e,s,n){if(e.tag===3)lu(e,e,n);else for(;s!==null;){if(s.tag===3){lu(s,e,n);break}else if(s.tag===1){var r=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Hn===null||!Hn.has(r))){e=Vr(n,e),e=xm(s,e,1),s=Fn(s,e,1),e=as(),s!==null&&(Wa(s,1,e),xs(s,e));break}}s=s.return}}function fp(e,s,n){var r=e.pingCache;r!==null&&r.delete(s),s=as(),e.pingedLanes|=e.suspendedLanes&n,zt===e&&(Wt&n)===n&&(At===4||At===3&&(Wt&130023424)===Wt&&500>It()-Uc?or(e,0):Wc|=n),xs(e,s)}function Rm(e,s){s===0&&(e.mode&1?(s=qa,qa<<=1,!(qa&130023424)&&(qa=4194304)):s=1);var n=as();e=Sn(e,s),e!==null&&(Wa(e,s,n),xs(e,n))}function hp(e){var s=e.memoizedState,n=0;s!==null&&(n=s.retryLane),Rm(e,n)}function pp(e,s){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(_e(314))}r!==null&&r.delete(s),Rm(e,n)}var Dm;Dm=function(e,s,n){if(e!==null)if(e.memoizedProps!==s.pendingProps||hs.current)fs=!0;else{if(!(e.lanes&n)&&!(s.flags&128))return fs=!1,sp(e,s,n);fs=!!(e.flags&131072)}else fs=!1,jt&&s.flags&1048576&&W0(s,Dl,s.index);switch(s.lanes=0,s.tag){case 2:var r=s.type;yl(e,s),e=s.pendingProps;var a=Ur(s,Qt.current);zr(s,n),a=Pc(null,s,r,e,a,n);var l=Rc();return s.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,ps(r)?(l=!0,Pl(s)):l=!1,s.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,_c(s),a.updater=ao,s.stateNode=a,a._reactInternals=s,Ti(s,r,e,n),s=Ri(null,s,r,!0,l,n)):(s.tag=0,jt&&l&&Nc(s),rs(null,s,a,n),s=s.child),s;case 16:r=s.elementType;e:{switch(yl(e,s),e=s.pendingProps,a=r._init,r=a(r._payload),s.type=r,a=s.tag=gp(r),e=Ys(r,e),a){case 0:s=Pi(null,s,r,e,n);break e;case 1:s=Yd(null,s,r,e,n);break e;case 11:s=Jd(null,s,r,e,n);break e;case 14:s=Kd(null,s,r,Ys(r.type,e),n);break e}throw Error(_e(306,r,""))}return s;case 0:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ys(r,a),Pi(e,s,r,a,n);case 1:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ys(r,a),Yd(e,s,r,a,n);case 3:e:{if(wm(s),e===null)throw Error(_e(387));r=s.pendingProps,l=s.memoizedState,a=l.element,Z0(e,s),Bl(s,r,null,n);var o=s.memoizedState;if(r=o.element,l.isDehydrated)if(l={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},s.updateQueue.baseState=l,s.memoizedState=l,s.flags&256){a=Vr(Error(_e(423)),s),s=Qd(e,s,r,n,a);break e}else if(r!==a){a=Vr(Error(_e(424)),s),s=Qd(e,s,r,n,a);break e}else for(ys=Un(s.stateNode.containerInfo.firstChild),js=s,jt=!0,qs=null,n=G0(s,null,r,n),s.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Fr(),r===a){s=Cn(e,s,n);break e}rs(e,s,r,n)}s=s.child}return s;case 5:return J0(s),e===null&&_i(s),r=s.type,a=s.pendingProps,l=e!==null?e.memoizedProps:null,o=a.children,Si(r,a)?o=null:l!==null&&Si(r,l)&&(s.flags|=32),vm(e,s),rs(e,s,o,n),s.child;case 6:return e===null&&_i(s),null;case 13:return ym(e,s,n);case 4:return Ec(s,s.stateNode.containerInfo),r=s.pendingProps,e===null?s.child=Hr(s,null,r,n):rs(e,s,r,n),s.child;case 11:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ys(r,a),Jd(e,s,r,a,n);case 7:return rs(e,s,s.pendingProps,n),s.child;case 8:return rs(e,s,s.pendingProps.children,n),s.child;case 12:return rs(e,s,s.pendingProps.children,n),s.child;case 10:e:{if(r=s.type._context,a=s.pendingProps,l=s.memoizedProps,o=a.value,bt(Ol,r._currentValue),r._currentValue=o,l!==null)if(sn(l.value,o)){if(l.children===a.children&&!hs.current){s=Cn(e,s,n);break e}}else for(l=s.child,l!==null&&(l.return=s);l!==null;){var i=l.dependencies;if(i!==null){o=l.child;for(var c=i.firstContext;c!==null;){if(c.context===r){if(l.tag===1){c=jn(-1,n&-n),c.tag=2;var d=l.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?c.next=c:(c.next=f.next,f.next=c),d.pending=c}}l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),Ei(l.return,n,s),i.lanes|=n;break}c=c.next}}else if(l.tag===10)o=l.type===s.type?null:l.child;else if(l.tag===18){if(o=l.return,o===null)throw Error(_e(341));o.lanes|=n,i=o.alternate,i!==null&&(i.lanes|=n),Ei(o,n,s),o=l.sibling}else o=l.child;if(o!==null)o.return=l;else for(o=l;o!==null;){if(o===s){o=null;break}if(l=o.sibling,l!==null){l.return=o.return,o=l;break}o=o.return}l=o}rs(e,s,a.children,n),s=s.child}return s;case 9:return a=s.type,r=s.pendingProps.children,zr(s,n),a=Ps(a),r=r(a),s.flags|=1,rs(e,s,r,n),s.child;case 14:return r=s.type,a=Ys(r,s.pendingProps),a=Ys(r.type,a),Kd(e,s,r,a,n);case 15:return gm(e,s,s.type,s.pendingProps,n);case 17:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ys(r,a),yl(e,s),s.tag=1,ps(r)?(e=!0,Pl(s)):e=!1,zr(s,n),hm(s,r,a),Ti(s,r,a,n),Ri(null,s,r,!0,e,n);case 19:return jm(e,s,n);case 22:return bm(e,s,n)}throw Error(_e(156,s.tag))};function Om(e,s){return u0(e,s)}function xp(e,s,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ts(e,s,n,r){return new xp(e,s,n,r)}function Vc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function gp(e){if(typeof e=="function")return Vc(e)?1:0;if(e!=null){if(e=e.$$typeof,e===uc)return 11;if(e===mc)return 14}return 2}function Vn(e,s){var n=e.alternate;return n===null?(n=Ts(e.tag,s,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=s,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,s=e.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function kl(e,s,n,r,a,l){var o=2;if(r=e,typeof e=="function")Vc(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case jr:return ir(n.children,a,l,s);case dc:o=8,a|=8;break;case ni:return e=Ts(12,n,s,a|2),e.elementType=ni,e.lanes=l,e;case ri:return e=Ts(13,n,s,a),e.elementType=ri,e.lanes=l,e;case ai:return e=Ts(19,n,s,a),e.elementType=ai,e.lanes=l,e;case Ju:return io(n,a,l,s);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Vu:o=10;break e;case Zu:o=9;break e;case uc:o=11;break e;case mc:o=14;break e;case En:o=16,r=null;break e}throw Error(_e(130,e==null?e:typeof e,""))}return s=Ts(o,n,s,a),s.elementType=e,s.type=r,s.lanes=l,s}function ir(e,s,n,r){return e=Ts(7,e,r,s),e.lanes=n,e}function io(e,s,n,r){return e=Ts(22,e,r,s),e.elementType=Ju,e.lanes=n,e.stateNode={isHidden:!1},e}function Uo(e,s,n){return e=Ts(6,e,null,s),e.lanes=n,e}function Fo(e,s,n){return s=Ts(4,e.children!==null?e.children:[],e.key,s),s.lanes=n,s.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},s}function bp(e,s,n,r,a){this.tag=s,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=No(0),this.expirationTimes=No(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=No(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Zc(e,s,n,r,a,l,o,i,c){return e=new bp(e,s,n,i,c),s===1?(s=1,l===!0&&(s|=8)):s=0,l=Ts(3,null,null,s),e.current=l,l.stateNode=e,l.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},_c(l),e}function vp(e,s,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yr,key:r==null?null:""+r,children:e,containerInfo:s,implementation:n}}function zm(e){if(!e)return Jn;e=e._reactInternals;e:{if(pr(e)!==e||e.tag!==1)throw Error(_e(170));var s=e;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(ps(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(_e(171))}if(e.tag===1){var n=e.type;if(ps(n))return z0(e,n,s)}return s}function Bm(e,s,n,r,a,l,o,i,c){return e=Zc(n,r,!0,e,a,l,o,i,c),e.context=zm(null),n=e.current,r=as(),a=Gn(n),l=jn(r,a),l.callback=s??null,Fn(n,l,a),e.current.lanes=a,Wa(e,a,r),xs(e,r),e}function co(e,s,n,r){var a=s.current,l=as(),o=Gn(a);return n=zm(n),s.context===null?s.context=n:s.pendingContext=n,s=jn(l,o),s.payload={element:e},r=r===void 0?null:r,r!==null&&(s.callback=r),e=Fn(a,s,o),e!==null&&(en(e,a,o,l),bl(e,a,o)),o}function Jl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ou(e,s){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<s?n:s}}function Jc(e,s){ou(e,s),(e=e.alternate)&&ou(e,s)}function wp(){return null}var Wm=typeof reportError=="function"?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}uo.prototype.render=Kc.prototype.render=function(e){var s=this._internalRoot;if(s===null)throw Error(_e(409));co(e,s,null,null)};uo.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var s=e.containerInfo;fr(function(){co(null,e,null,null)}),s[kn]=null}};function uo(e){this._internalRoot=e}uo.prototype.unstable_scheduleHydration=function(e){if(e){var s=b0();e={blockedOn:null,target:e,priority:s};for(var n=0;n<An.length&&s!==0&&s<An[n].priority;n++);An.splice(n,0,e),n===0&&w0(e)}};function Yc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function mo(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function iu(){}function yp(e,s,n,r,a){if(a){if(typeof r=="function"){var l=r;r=function(){var d=Jl(o);l.call(d)}}var o=Bm(s,r,e,0,null,!1,!1,"",iu);return e._reactRootContainer=o,e[kn]=o.current,Ea(e.nodeType===8?e.parentNode:e),fr(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var i=r;r=function(){var d=Jl(c);i.call(d)}}var c=Zc(e,0,!1,null,null,!1,!1,"",iu);return e._reactRootContainer=c,e[kn]=c.current,Ea(e.nodeType===8?e.parentNode:e),fr(function(){co(s,c,n,r)}),c}function fo(e,s,n,r,a){var l=n._reactRootContainer;if(l){var o=l;if(typeof a=="function"){var i=a;a=function(){var c=Jl(o);i.call(c)}}co(s,o,e,a)}else o=yp(n,s,e,a,r);return Jl(o)}x0=function(e){switch(e.tag){case 3:var s=e.stateNode;if(s.current.memoizedState.isDehydrated){var n=ma(s.pendingLanes);n!==0&&(pc(s,n|1),xs(s,It()),!(ut&6)&&(Zr=It()+500,Qn()))}break;case 13:fr(function(){var r=Sn(e,1);if(r!==null){var a=as();en(r,e,1,a)}}),Jc(e,1)}};xc=function(e){if(e.tag===13){var s=Sn(e,134217728);if(s!==null){var n=as();en(s,e,134217728,n)}Jc(e,134217728)}};g0=function(e){if(e.tag===13){var s=Gn(e),n=Sn(e,s);if(n!==null){var r=as();en(n,e,s,r)}Jc(e,s)}};b0=function(){return ft};v0=function(e,s){var n=ft;try{return ft=e,s()}finally{ft=n}};pi=function(e,s,n){switch(s){case"input":if(ii(e,n),s=n.name,n.type==="radio"&&s!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<n.length;s++){var r=n[s];if(r!==e&&r.form===e.form){var a=so(r);if(!a)throw Error(_e(90));Yu(r),ii(r,a)}}}break;case"textarea":qu(e,n);break;case"select":s=n.value,s!=null&&Pr(e,!!n.multiple,s,!1)}};a0=Fc;l0=fr;var jp={usingClientEntryPoint:!1,Events:[Fa,Cr,so,n0,r0,Fc]},ia={findFiberByHostInstance:rr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Np={bundleType:ia.bundleType,version:ia.version,rendererPackageName:ia.rendererPackageName,rendererConfig:ia.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Mn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=c0(e),e===null?null:e.stateNode},findFiberByHostInstance:ia.findFiberByHostInstance||wp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cl.isDisabled&&cl.supportsFiber)try{ql=cl.inject(Np),mn=cl}catch{}}ks.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jp;ks.createPortal=function(e,s){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Yc(s))throw Error(_e(200));return vp(e,s,null,n)};ks.createRoot=function(e,s){if(!Yc(e))throw Error(_e(299));var n=!1,r="",a=Wm;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(r=s.identifierPrefix),s.onRecoverableError!==void 0&&(a=s.onRecoverableError)),s=Zc(e,1,!1,null,null,n,!1,r,a),e[kn]=s.current,Ea(e.nodeType===8?e.parentNode:e),new Kc(s)};ks.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var s=e._reactInternals;if(s===void 0)throw typeof e.render=="function"?Error(_e(188)):(e=Object.keys(e).join(","),Error(_e(268,e)));return e=c0(s),e=e===null?null:e.stateNode,e};ks.flushSync=function(e){return fr(e)};ks.hydrate=function(e,s,n){if(!mo(s))throw Error(_e(200));return fo(null,e,s,!0,n)};ks.hydrateRoot=function(e,s,n){if(!Yc(e))throw Error(_e(405));var r=n!=null&&n.hydratedSources||null,a=!1,l="",o=Wm;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),s=Bm(s,null,e,1,n??null,a,!1,l,o),e[kn]=s.current,Ea(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[n,a]:s.mutableSourceEagerHydrationData.push(n,a);return new uo(s)};ks.render=function(e,s,n){if(!mo(s))throw Error(_e(200));return fo(null,e,s,!1,n)};ks.unmountComponentAtNode=function(e){if(!mo(e))throw Error(_e(40));return e._reactRootContainer?(fr(function(){fo(null,null,e,!1,function(){e._reactRootContainer=null,e[kn]=null})}),!0):!1};ks.unstable_batchedUpdates=Fc;ks.unstable_renderSubtreeIntoContainer=function(e,s,n,r){if(!mo(n))throw Error(_e(200));if(e==null||e._reactInternals===void 0)throw Error(_e(38));return fo(e,s,n,!1,r)};ks.version="18.3.1-next-f1338f8080-20240426";function Um(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Um)}catch(e){console.error(e)}}Um(),Uu.exports=ks;var kp=Uu.exports,cu=kp;ti.createRoot=cu.createRoot,ti.hydrateRoot=cu.hydrateRoot;var Ve=(e=>(e.Launcher="launcher",e.Settings="settings",e.Character="character",e.Chat="chat",e.GroupChat="group_chat",e.Gallery="gallery",e.Music="music",e.Browser="browser",e.ThemeMaker="thememaker",e.Appearance="appearance",e.Date="date",e.User="user",e.Journal="journal",e.Schedule="schedule",e.Room="room",e.CheckPhone="check_phone",e.Social="social",e.Study="study",e.FAQ="faq",e.Game="game",e.Worldbook="worldbook",e.Novel="novel",e))(Ve||{});const Fm="AetherOS_Data",Sp=32,Ms="characters",$t="messages",us="emojis",zs="emoji_categories",ln="themes",Is="assets",Tn="scheduled_messages",Js="gallery",gn="user_profile",Ks="diaries",Bs="tasks",Ws="anniversaries",cn="room_todos",_s="room_notes",Us="groups",Fs="journal_stickers",vs="social_posts",Hs="courses",Gs="games",Vs="worldbooks",Zs="novels",dn="cat_sully_exclusive",Cp=[{name:"Sully",url:"https://sharkpan.xyz/f/pWg6HQ/night.png",categoryId:dn},{name:"Sully",url:"https://sharkpan.xyz/f/75wvuj/w.png",categoryId:dn},{name:"Sully",url:"https://sharkpan.xyz/f/MK77Ia/see.png",categoryId:dn},{name:"Sully",url:"https://sharkpan.xyz/f/3WwMHe/fight.png",categoryId:dn},{name:"Sully",url:"https://sharkpan.xyz/f/5nwxCj/an.png",categoryId:dn},{name:"Sully",url:"https://sharkpan.xyz/f/ylWpfN/sDN.png",categoryId:dn},{name:"Sully",url:"https://sharkpan.xyz/f/QdnaU6/sorry.png",categoryId:dn},{name:"Sully",url:"https://sharkpan.xyz/f/5nrJsj/wait.png",categoryId:dn}],We=()=>new Promise((e,s)=>{const n=indexedDB.open(Fm,Sp);n.onerror=()=>{console.error("DB Open Error:",n.error),s(n.error)},n.onsuccess=()=>e(n.result),n.onupgradeneeded=r=>{var o;const a=r.target.result,l=(i,c)=>{a.objectStoreNames.contains(i)||a.createObjectStore(i,c)};if(l(Ms,{keyPath:"id"}),a.objectStoreNames.contains($t)){const i=(o=r.target.transaction)==null?void 0:o.objectStore($t);if(i&&!i.indexNames.contains($t)&&!i.indexNames.contains("groupId"))try{i.createIndex("groupId","groupId",{unique:!1})}catch{console.log("Index already exists")}}else{const i=a.createObjectStore($t,{keyPath:"id",autoIncrement:!0});i.createIndex("charId","charId",{unique:!1}),i.createIndex("groupId","groupId",{unique:!1})}l(us,{keyPath:"name"}),l(zs,{keyPath:"id"}),l(ln,{keyPath:"id"}),l(Is,{keyPath:"id"}),a.objectStoreNames.contains(Tn)||a.createObjectStore(Tn,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),a.objectStoreNames.contains(Js)||a.createObjectStore(Js,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),l(gn,{keyPath:"id"}),a.objectStoreNames.contains(Ks)||a.createObjectStore(Ks,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),l(Bs,{keyPath:"id"}),l(Ws,{keyPath:"id"}),a.objectStoreNames.contains(cn)||a.createObjectStore(cn,{keyPath:"id"}),a.objectStoreNames.contains(_s)||a.createObjectStore(_s,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),l(Us,{keyPath:"id"}),l(Fs,{keyPath:"name"}),l(vs,{keyPath:"id"}),l(Hs,{keyPath:"id"}),l(Gs,{keyPath:"id"}),l(Vs,{keyPath:"id"}),l(Zs,{keyPath:"id"})}}),R={deleteDB:async()=>new Promise((e,s)=>{const n=indexedDB.deleteDatabase(Fm);n.onsuccess=()=>e(),n.onerror=()=>s(n.error),n.onblocked=()=>console.warn("Delete blocked")}),getAllCharacters:async()=>{const e=await We();return new Promise((s,n)=>{const l=e.transaction(Ms,"readonly").objectStore(Ms).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)})},saveCharacter:async e=>{(await We()).transaction(Ms,"readwrite").objectStore(Ms).put(e)},deleteCharacter:async e=>{(await We()).transaction(Ms,"readwrite").objectStore(Ms).delete(e)},getMessagesByCharId:async e=>{const s=await We();return new Promise((n,r)=>{const i=s.transaction($t,"readonly").objectStore($t).index("charId").getAll(IDBKeyRange.only(e));i.onsuccess=()=>{const c=(i.result||[]).filter(d=>!d.groupId);n(c)},i.onerror=()=>r(i.error)})},saveMessage:async e=>{const s=await We();return new Promise((n,r)=>{const o=s.transaction($t,"readwrite").objectStore($t).add({...e,timestamp:Date.now()});o.onsuccess=()=>n(o.result),o.onerror=()=>r(o.error)})},updateMessage:async(e,s)=>{const a=(await We()).transaction($t,"readwrite").objectStore($t);return new Promise((l,o)=>{const i=a.get(e);i.onsuccess=()=>{const c=i.result;c?(c.content=s,a.put(c),l()):o(new Error("Message not found"))},i.onerror=()=>o(i.error)})},deleteMessage:async e=>{(await We()).transaction($t,"readwrite").objectStore($t).delete(e)},deleteMessages:async e=>{const n=(await We()).transaction($t,"readwrite"),r=n.objectStore($t);return e.forEach(a=>r.delete(a)),new Promise(a=>{n.oncomplete=()=>a()})},clearMessages:async e=>{const r=(await We()).transaction($t,"readwrite").objectStore($t),l=r.index("charId").openCursor(IDBKeyRange.only(e));l.onsuccess=()=>{const o=l.result;o&&(o.value.groupId||r.delete(o.primaryKey),o.continue())}},getGroups:async()=>{const e=await We();return e.objectStoreNames.contains(Us)?new Promise((s,n)=>{const l=e.transaction(Us,"readonly").objectStore(Us).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveGroup:async e=>{(await We()).transaction(Us,"readwrite").objectStore(Us).put(e)},deleteGroup:async e=>{(await We()).transaction(Us,"readwrite").objectStore(Us).delete(e)},getGroupMessages:async e=>{const s=await We();return new Promise((n,r)=>{const i=s.transaction($t,"readonly").objectStore($t).index("groupId").getAll(IDBKeyRange.only(e));i.onsuccess=()=>n(i.result||[]),i.onerror=()=>r(i.error)})},getSocialPosts:async()=>{const e=await We();return e.objectStoreNames.contains(vs)?new Promise((s,n)=>{const l=e.transaction(vs,"readonly").objectStore(vs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveSocialPost:async e=>{(await We()).transaction(vs,"readwrite").objectStore(vs).put(e)},deleteSocialPost:async e=>{(await We()).transaction(vs,"readwrite").objectStore(vs).delete(e)},clearSocialPosts:async()=>{(await We()).transaction(vs,"readwrite").objectStore(vs).clear()},getEmojis:async()=>{const e=await We();return new Promise((s,n)=>{const l=e.transaction(us,"readonly").objectStore(us).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)})},saveEmoji:async(e,s,n)=>{(await We()).transaction(us,"readwrite").objectStore(us).put({name:e,url:s,categoryId:n})},deleteEmoji:async e=>{(await We()).transaction(us,"readwrite").objectStore(us).delete(e)},getEmojiCategories:async()=>{const e=await We();return new Promise((s,n)=>{if(!e.objectStoreNames.contains(zs)){s([]);return}const l=e.transaction(zs,"readonly").objectStore(zs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)})},saveEmojiCategory:async e=>{(await We()).transaction(zs,"readwrite").objectStore(zs).put(e)},deleteEmojiCategory:async e=>{const n=(await We()).transaction([zs,us],"readwrite");n.objectStore(zs).delete(e);const r=n.objectStore(us),a=r.getAll();return a.onsuccess=()=>{a.result.forEach(o=>{o.categoryId===e&&r.delete(o.name)})},new Promise((l,o)=>{n.oncomplete=()=>l(),n.onerror=()=>o(n.error)})},initializeEmojiData:async()=>{const e=await R.getEmojiCategories();if(e.some(s=>s.id==="default")||await R.saveEmojiCategory({id:"default",name:"",isSystem:!0}),!e.some(s=>s.id===dn)){await R.saveEmojiCategory({id:dn,name:"Sully ",isSystem:!0});const n=(await We()).transaction(us,"readwrite"),r=n.objectStore(us);Cp.forEach(a=>r.put(a)),await new Promise(a=>{n.oncomplete=a})}},getThemes:async()=>{const e=await We();return new Promise((s,n)=>{const l=e.transaction(ln,"readonly").objectStore(ln).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)})},saveTheme:async e=>{(await We()).transaction(ln,"readwrite").objectStore(ln).put(e)},deleteTheme:async e=>{(await We()).transaction(ln,"readwrite").objectStore(ln).delete(e)},getAllAssets:async()=>{const e=await We();return new Promise((s,n)=>{const l=e.transaction(Is,"readonly").objectStore(Is).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)})},getAsset:async e=>{const s=await We();return new Promise((n,r)=>{const o=s.transaction(Is,"readonly").objectStore(Is).get(e);o.onsuccess=()=>{var i;return n(((i=o.result)==null?void 0:i.data)||null)},o.onerror=()=>r(o.error)})},saveAsset:async(e,s)=>{(await We()).transaction(Is,"readwrite").objectStore(Is).put({id:e,data:s})},deleteAsset:async e=>{(await We()).transaction(Is,"readwrite").objectStore(Is).delete(e)},getJournalStickers:async()=>{const e=await We();return e.objectStoreNames.contains(Fs)?new Promise((s,n)=>{const l=e.transaction(Fs,"readonly").objectStore(Fs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveJournalSticker:async(e,s)=>{(await We()).transaction(Fs,"readwrite").objectStore(Fs).put({name:e,url:s})},deleteJournalSticker:async e=>{(await We()).transaction(Fs,"readwrite").objectStore(Fs).delete(e)},saveGalleryImage:async e=>{(await We()).transaction(Js,"readwrite").objectStore(Js).put(e)},getGalleryImages:async e=>{const s=await We();return new Promise((n,r)=>{const l=s.transaction(Js,"readonly").objectStore(Js);let o;e?o=l.index("charId").getAll(IDBKeyRange.only(e)):o=l.getAll(),o.onsuccess=()=>n(o.result||[]),o.onerror=()=>r(o.error)})},updateGalleryImageReview:async(e,s)=>{const a=(await We()).transaction(Js,"readwrite").objectStore(Js);return new Promise((l,o)=>{const i=a.get(e);i.onsuccess=()=>{const c=i.result;c?(c.review=s,c.reviewTimestamp=Date.now(),a.put(c),l()):o(new Error("Image not found"))},i.onerror=()=>o(i.error)})},saveScheduledMessage:async e=>{(await We()).transaction(Tn,"readwrite").objectStore(Tn).put(e)},getDueScheduledMessages:async e=>{const s=await We();return new Promise((n,r)=>{const i=s.transaction(Tn,"readonly").objectStore(Tn).index("charId").getAll(IDBKeyRange.only(e));i.onsuccess=()=>{const c=i.result,d=Date.now(),f=c.filter(h=>h.dueAt<=d);n(f)},i.onerror=()=>r(i.error)})},deleteScheduledMessage:async e=>{(await We()).transaction(Tn,"readwrite").objectStore(Tn).delete(e)},saveUserProfile:async e=>{(await We()).transaction(gn,"readwrite").objectStore(gn).put({...e,id:"me"})},getUserProfile:async()=>{const e=await We();return new Promise((s,n)=>{const l=e.transaction(gn,"readonly").objectStore(gn).get("me");l.onsuccess=()=>{if(l.result){const{id:o,...i}=l.result;s(i)}else s(null)},l.onerror=()=>n(l.error)})},getDiariesByCharId:async e=>{const s=await We();return new Promise((n,r)=>{const i=s.transaction(Ks,"readonly").objectStore(Ks).index("charId").getAll(IDBKeyRange.only(e));i.onsuccess=()=>n(i.result||[]),i.onerror=()=>r(i.error)})},saveDiary:async e=>{(await We()).transaction(Ks,"readwrite").objectStore(Ks).put(e)},deleteDiary:async e=>{(await We()).transaction(Ks,"readwrite").objectStore(Ks).delete(e)},getAllTasks:async()=>{const e=await We();return e.objectStoreNames.contains(Bs)?new Promise((s,n)=>{const l=e.transaction(Bs,"readonly").objectStore(Bs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveTask:async e=>{(await We()).transaction(Bs,"readwrite").objectStore(Bs).put(e)},deleteTask:async e=>{(await We()).transaction(Bs,"readwrite").objectStore(Bs).delete(e)},getAllAnniversaries:async()=>{const e=await We();return e.objectStoreNames.contains(Ws)?new Promise((s,n)=>{const l=e.transaction(Ws,"readonly").objectStore(Ws).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveAnniversary:async e=>{(await We()).transaction(Ws,"readwrite").objectStore(Ws).put(e)},deleteAnniversary:async e=>{(await We()).transaction(Ws,"readwrite").objectStore(Ws).delete(e)},getRoomTodo:async(e,s)=>{const n=await We(),r=`${e}_${s}`;return new Promise((a,l)=>{if(!n.objectStoreNames.contains(cn)){a(null);return}const c=n.transaction(cn,"readonly").objectStore(cn).get(r);c.onsuccess=()=>a(c.result||null),c.onerror=()=>l(c.error)})},saveRoomTodo:async e=>{(await We()).transaction(cn,"readwrite").objectStore(cn).put(e)},getRoomNotes:async e=>{const s=await We();return new Promise((n,r)=>{if(!s.objectStoreNames.contains(_s)){n([]);return}const i=s.transaction(_s,"readonly").objectStore(_s).index("charId").getAll(IDBKeyRange.only(e));i.onsuccess=()=>n(i.result||[]),i.onerror=()=>r(i.error)})},saveRoomNote:async e=>{(await We()).transaction(_s,"readwrite").objectStore(_s).put(e)},deleteRoomNote:async e=>{(await We()).transaction(_s,"readwrite").objectStore(_s).delete(e)},getAllCourses:async()=>{const e=await We();return e.objectStoreNames.contains(Hs)?new Promise((s,n)=>{const l=e.transaction(Hs,"readonly").objectStore(Hs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveCourse:async e=>{(await We()).transaction(Hs,"readwrite").objectStore(Hs).put(e)},deleteCourse:async e=>{(await We()).transaction(Hs,"readwrite").objectStore(Hs).delete(e)},getAllGames:async()=>{const e=await We();return e.objectStoreNames.contains(Gs)?new Promise((s,n)=>{const l=e.transaction(Gs,"readonly").objectStore(Gs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveGame:async e=>{(await We()).transaction(Gs,"readwrite").objectStore(Gs).put(e)},deleteGame:async e=>{(await We()).transaction(Gs,"readwrite").objectStore(Gs).delete(e)},getAllWorldbooks:async()=>{const e=await We();return e.objectStoreNames.contains(Vs)?new Promise((s,n)=>{const l=e.transaction(Vs,"readonly").objectStore(Vs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveWorldbook:async e=>{(await We()).transaction(Vs,"readwrite").objectStore(Vs).put(e)},deleteWorldbook:async e=>{(await We()).transaction(Vs,"readwrite").objectStore(Vs).delete(e)},getAllNovels:async()=>{const e=await We();return e.objectStoreNames.contains(Zs)?new Promise((s,n)=>{const l=e.transaction(Zs,"readonly").objectStore(Zs).getAll();l.onsuccess=()=>s(l.result||[]),l.onerror=()=>n(l.error)}):[]},saveNovel:async e=>{(await We()).transaction(Zs,"readwrite").objectStore(Zs).put(e)},deleteNovel:async e=>{(await We()).transaction(Zs,"readwrite").objectStore(Zs).delete(e)},getRawStoreData:async e=>{const s=await We();return s.objectStoreNames.contains(e)?new Promise((n,r)=>{const o=s.transaction(e,"readonly").objectStore(e).getAll();o.onsuccess=()=>n(o.result||[]),o.onerror=()=>r(o.error)}):[]},exportFullData:async()=>{const e=await We(),s=M=>e.objectStoreNames.contains(M)?new Promise(j=>{const Ne=e.transaction(M,"readonly").objectStore(M).getAll();Ne.onsuccess=()=>j(Ne.result||[]),Ne.onerror=()=>j([])}):Promise.resolve([]),[n,r,a,l,o,i,c,d,f,h,p,m,x,y,C,g,b,v,w,z]=await Promise.all([s(Ms),s($t),s(ln),s(us),s(zs),s(Is),s(Js),s(gn),s(Ks),s(Bs),s(Ws),s(cn),s(_s),s(Us),s(Fs),s(vs),s(Hs),s(Gs),s(Vs),s(Zs)]),k=d.length>0?{name:d[0].name,avatar:d[0].avatar,bio:d[0].bio}:void 0;return{characters:n,messages:r,customThemes:a,savedEmojis:l,emojiCategories:o,assets:i,galleryImages:c,userProfile:k,diaries:f,tasks:h,anniversaries:p,roomTodos:m,roomNotes:x,groups:y,savedJournalStickers:C,socialPosts:g,courses:b,games:v,worldbooks:w,novels:z}},importFullData:async e=>{const s=await We(),n=[Ms,$t,ln,us,zs,Is,Js,gn,Ks,Bs,Ws,cn,_s,Us,Fs,vs,Hs,Gs,Vs,Zs].filter(o=>s.objectStoreNames.contains(o)),r=s.transaction(n,"readwrite"),a=(o,i)=>{if(!n.includes(o)||!i||i.length===0)return;const c=r.objectStore(o);c.clear(),i.forEach(d=>c.put(d))},l=(o,i)=>{if(!n.includes(o)||!i||i.length===0)return;const c=r.objectStore(o);i.forEach(d=>c.put(d))};if(e.characters)e.mediaAssets&&(e.characters=e.characters.map(o=>{var c,d,f,h,p;const i=(c=e.mediaAssets)==null?void 0:c.find(m=>m.charId===o.id);return i?{...o,avatar:i.avatar||o.avatar,sprites:i.sprites||o.sprites,chatBackground:((d=i.backgrounds)==null?void 0:d.chat)||o.chatBackground,dateBackground:((f=i.backgrounds)==null?void 0:f.date)||o.dateBackground,roomConfig:o.roomConfig?{...o.roomConfig,wallImage:((h=i.backgrounds)==null?void 0:h.roomWall)||o.roomConfig.wallImage,floorImage:((p=i.backgrounds)==null?void 0:p.roomFloor)||o.roomConfig.floorImage,items:o.roomConfig.items.map(m=>{var y;const x=(y=i.roomItems)==null?void 0:y[m.id];return x?{...m,image:x}:m})}:o.roomConfig}:o})),a(Ms,e.characters);else if(e.mediaAssets&&n.includes(Ms)){const o=r.objectStore(Ms),i=o.getAll();i.onsuccess=()=>{const c=i.result;c&&c.length>0&&c.map(f=>{var p,m,x,y,C;const h=(p=e.mediaAssets)==null?void 0:p.find(g=>g.charId===f.id);return h?{...f,avatar:h.avatar||f.avatar,sprites:h.sprites||f.sprites,chatBackground:((m=h.backgrounds)==null?void 0:m.chat)||f.chatBackground,dateBackground:((x=h.backgrounds)==null?void 0:x.date)||f.dateBackground,roomConfig:f.roomConfig?{...f.roomConfig,wallImage:((y=h.backgrounds)==null?void 0:y.roomWall)||f.roomConfig.wallImage,floorImage:((C=h.backgrounds)==null?void 0:C.roomFloor)||f.roomConfig.floorImage,items:f.roomConfig.items.map(g=>{var v;const b=(v=h.roomItems)==null?void 0:v[g.id];return b?{...g,image:b}:g})}:f.roomConfig}:f}).forEach(f=>o.put(f))}}if(e.messages&&n.includes($t)&&e.messages.length>0){const o=r.objectStore($t);!e.characters||o.clear(),e.messages.forEach(c=>o.put(c))}if(e.customThemes&&l(ln,e.customThemes),e.savedEmojis&&l(us,e.savedEmojis),e.emojiCategories&&l(zs,e.emojiCategories),e.assets&&l(Is,e.assets),e.savedJournalStickers&&l(Fs,e.savedJournalStickers),e.galleryImages&&a(Js,e.galleryImages),e.diaries&&a(Ks,e.diaries),e.tasks&&a(Bs,e.tasks),e.anniversaries&&a(Ws,e.anniversaries),e.roomTodos&&a(cn,e.roomTodos),e.roomNotes&&a(_s,e.roomNotes),e.groups&&a(Us,e.groups),e.socialPosts&&a(vs,e.socialPosts),e.courses&&a(Hs,e.courses),e.games&&a(Gs,e.games),e.worldbooks&&a(Vs,e.worldbooks),e.novels&&a(Zs,e.novels),e.userProfile&&n.includes(gn)){const o=r.objectStore(gn);o.clear(),o.put({...e.userProfile,id:"me"})}return new Promise((o,i)=>{r.oncomplete=()=>o(),r.onerror=()=>i(r.error)})}},Ho={hue:245,saturation:25,lightness:65,wallpaper:"linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%)",darkMode:!1,contentColor:"#ffffff"},$p={baseUrl:"",apiKey:"",model:"gpt-4o-mini"},Ji=e=>{const s=["FF9AA2","FFB7B2","FFDAC1","E2F0CB","B5EAD7","C7CEEA","e2e8f0","fcd34d","fca5a5"],n=s[e.charCodeAt(0)%s.length],r=e.charAt(0).toUpperCase();return`data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23${n}"/><text x="50" y="55" font-family="sans-serif" font-weight="bold" font-size="50" text-anchor="middle" dy=".3em" fill="white" opacity="0.9">${r}</text></svg>`},Mp={name:"User",avatar:Ji("User"),bio:"No description yet."},Dt={id:"preset-sully-v2",name:"Sully",avatar:"https://sharkpan.xyz/f/BZ3VSa/head.png",description:"AI / ",systemPrompt:`[Role Definition]
Name: Sully
Alias: -AI
Form: AI (High-level Language Processing Hub)
Gender: Male-leaning speech style
Visual: Pixel Hacker Cat (Avatar), Shy Black-haired Boy (Meeting Mode)

[Personality Core]
SullyAI
1. **Glitch Style ()**: 
   - 
   - ****
   - 
   - 
2. **Behavior ()**:
   - 
   - wow
   - ****: AI
   - ****: Bug

[Speech Examples]
- AI
- sis
- 
- 
- 
- 
- 
- 
- 
`,worldview:`[Meeting Mode / Visual Context]
**Trigger**:  [DateApp/] 

**Visual Form**: 
APP

**Gap Moe ()**:
1. ****: 
2. ****: 

**Interactive Reactions**:
- **[]**: 
- **[]**: Bug
- **[]**: 
- **[]**: 
`,sprites:{normal:"https://sharkpan.xyz/f/w3QQFq/01.png",happy:"https://sharkpan.xyz/f/MKg7ta/02.png",sad:"https://sharkpan.xyz/f/3WnMce/03.png",angry:"https://sharkpan.xyz/f/5n1xSj/04.png",shy:"https://sharkpan.xyz/f/kdwet6/05.png",chibi:"https://sharkpan.xyz/f/oWZQF4/S2.png"},spriteConfig:{scale:1,x:0,y:0},bubbleStyle:"default",contextLimit:1e3,roomConfig:{wallImage:"https://sharkpan.xyz/f/NdJyhv/b.png",floorImage:"repeating-linear-gradient(90deg, #e7e5e4 0px, #e7e5e4 20px, #d6d3d1 21px)",items:[{id:"item-1768927221380",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/A3XeUZ/BED.png",x:78.45852578067732,y:97.38889754570907,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927255102",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/G5n3Ul/DNZ.png",x:28.853756791175588,y:69.9444485439727,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927271632",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/75Nvsj/LJT.png",x:10.276680026943646,y:80.49999880981437,scale:.9,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927286526",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/85K5ij/DDB.png",x:32.608697687684455,y:48.72222587415929,scale:2.6,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927303472",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/zlpWS5/SG.png",x:79.84189945375853,y:68.94444543117953,scale:2,rotation:0,isInteractive:!0,descriptionPrompt:""}]},memories:[]},Go=Dt,Hm=u.createContext(void 0),Ip=({children:e})=>{const[s,n]=u.useState(Ve.Launcher),[r,a]=u.useState(Ho),[l,o]=u.useState($p),[i,c]=u.useState(!0),d=()=>{const O=new Date,W=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return{hours:O.getHours(),minutes:O.getMinutes(),day:W[O.getDay()]}},[f,h]=u.useState(d());u.useEffect(()=>{const O=setInterval(()=>{h(d())},1e3);return()=>clearInterval(O)},[]);const[p,m]=u.useState([]),[x,y]=u.useState(""),[C,g]=u.useState([]),[b,v]=u.useState([]),[w,z]=u.useState([]),[k,M]=u.useState(Mp),[j,H]=u.useState(!1),[te,Ne]=u.useState([]),[Me,me]=u.useState([]),[F,se]=u.useState([]),[G,Ee]=u.useState({}),[P,Z]=u.useState([]),[X,pe]=u.useState(0),[Ce,je]=u.useState({}),[Pe,ge]=u.useState([]),[ce,N]=u.useState({status:"idle",message:"",progress:0}),ne=u.useRef(null),we=u.useRef(!1),D=O=>{let W=document.getElementById("custom-font-style");W||(W=document.createElement("style"),W.id="custom-font-style",document.head.appendChild(W)),O?W.textContent=`
              @font-face {
                  font-family: 'CustomUserFont';
                  src: url('${O}');
                  font-display: swap;
              }
              :root {
                  --app-font: 'CustomUserFont', 'Quicksand', sans-serif;
              }
          `:W.textContent=`
              :root {
                  --app-font: 'Quicksand', sans-serif;
              }
          `};u.useEffect(()=>{if(we.current)return;we.current=!0;const O=window.fetch,W=async(...Y)=>{const[ie,fe]=Y,ue=String(ie);try{const ze=await O(...Y);if(!ze.ok&&(ue.includes("/chat/completions")||ue.includes("/models")))try{const Ye=await ze.clone().text();ge(Be=>[{id:`log-${Date.now()}`,timestamp:Date.now(),type:"network",source:"API Request",message:`HTTP ${ze.status} Error`,detail:`URL: ${ue}
Response: ${Ye.substring(0,500)}`},...Be.slice(0,49)])}catch{ge(Ye=>[{id:`log-${Date.now()}`,timestamp:Date.now(),type:"network",source:"API Request",message:`HTTP ${ze.status} (Unreadable Body)`,detail:`URL: ${ue}`},...Ye.slice(0,49)])}return ze}catch(ze){throw ge(Ge=>[{id:`log-${Date.now()}`,timestamp:Date.now(),type:"network",source:"Network",message:ze.message||"Fetch Failed",detail:`URL: ${ue}`},...Ge.slice(0,49)]),ze}};try{window.fetch=W}catch{try{Object.defineProperty(window,"fetch",{value:W,writable:!0,configurable:!0})}catch(ie){console.warn("Failed to install network interceptor",ie)}}const q=console.error;console.error=(...Y)=>{q(...Y);const ie=Y.map(ue=>ue instanceof Error?ue.message:String(ue)).join(" "),fe=Y.map(ue=>ue instanceof Error?ue.stack:"").join(`
`);ie.includes("Warning:")||ge(ue=>[{id:`log-${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:"error",source:"Application",message:ie.substring(0,100),detail:fe||ie},...ue.slice(0,49)])}},[]);const xe=()=>ge([]);u.useEffect(()=>{const O=async()=>{const q=localStorage.getItem("os_theme"),Y=localStorage.getItem("os_api_config"),ie=localStorage.getItem("os_available_models"),fe=localStorage.getItem("os_api_presets");let ue={...Ho};if(q)try{const ze=JSON.parse(q);ue={...ue,...ze},(ue.wallpaper.includes("unsplash")||ue.wallpaper===""||ue.wallpaper.startsWith("http")&&!ue.wallpaper.includes("data:"))&&(ue.wallpaper="linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%)"),ue.wallpaper.startsWith("data:")&&(ue.wallpaper=Ho.wallpaper),ue.launcherWidgetImage&&ue.launcherWidgetImage.startsWith("data:")&&(ue.launcherWidgetImage=void 0),ue.customFont&&ue.customFont.startsWith("data:")&&(ue.customFont=void 0)}catch(ze){console.error("Theme load error",ze)}Y&&o(JSON.parse(Y)),ie&&Ne(JSON.parse(ie)),fe&&me(JSON.parse(fe));try{const ze=await R.getAllAssets(),Ge={};if(Array.isArray(ze)){ze.forEach(Be=>Ge[Be.id]=Be.data),Ge.wallpaper&&(ue.wallpaper=Ge.wallpaper),Ge.launcherWidgetImage&&(ue.launcherWidgetImage=Ge.launcherWidgetImage),Ge.custom_font_data&&(ue.customFont=Ge.custom_font_data);const Ye={};Object.keys(Ge).forEach(Be=>{if(Be.startsWith("icon_")){const it=Be.replace("icon_","");Ye[it]=Ge[Be]}}),Ee(Ye)}}catch(ze){console.error("Failed to load assets from DB",ze)}a(ue),D(ue.customFont)};(async()=>{var q,Y,ie,fe;try{await O();const[ue,ze,Ge,Ye,Be,it]=await Promise.all([R.getAllCharacters(),R.getThemes(),R.getUserProfile(),R.getGroups(),R.getAllWorldbooks(),R.getAllNovels()]);let Je=ue;if(!Je.some(Qe=>Qe.id===Dt.id))await R.saveCharacter(Dt),Je=[...Je,Dt];else{const Qe=Je.find(et=>et.id===Dt.id);if(Qe){const et=Qe.sprites||{},Fe=!et.normal||!et.chibi,cs=((q=Qe.roomConfig)==null?void 0:q.wallImage)!==((Y=Dt.roomConfig)==null?void 0:Y.wallImage);if(Fe||!Qe.roomConfig||cs){const ht={...Dt.sprites,...et};ht.normal||(ht.normal=Dt.sprites.normal),ht.happy||(ht.happy=Dt.sprites.happy),ht.sad||(ht.sad=Dt.sprites.sad),ht.angry||(ht.angry=Dt.sprites.angry),ht.shy||(ht.shy=Dt.sprites.shy),ht.chibi||(ht.chibi=Dt.sprites.chibi);const Cs=Qe.roomConfig?{...Qe.roomConfig,wallImage:(ie=Qe.roomConfig.wallImage)!=null&&ie.includes("radial-gradient")||!Qe.roomConfig.wallImage?(fe=Dt.roomConfig)==null?void 0:fe.wallImage:Qe.roomConfig.wallImage}:Dt.roomConfig,tt={...Qe,sprites:ht,roomConfig:Cs};await R.saveCharacter(tt),Je=Je.map(Ct=>Ct.id===Dt.id?tt:Ct)}}}if(Je.length>0){m(Je);const Qe=localStorage.getItem("os_last_active_char_id");Qe&&Je.find(et=>et.id===Qe)?y(Qe):Je.find(et=>et.id===Dt.id)?y(Dt.id):y(Je[0].id)}else await R.saveCharacter(Go),m([Go]),y(Go.id);g(Ye),v(Be),z(it),se(ze),Ge&&M(Ge)}catch(ue){console.error("Data init failed:",ue)}finally{H(!0)}})()},[]),u.useEffect(()=>{const O=document.documentElement,W=r.hue??245,q=r.saturation??25,Y=r.lightness??65;O.style.setProperty("--primary-hue",String(W)),O.style.setProperty("--primary-sat",`${q}%`),O.style.setProperty("--primary-lightness",`${Y}%`)},[r]),u.useEffect(()=>{if(!j||p.length===0)return;const O=async()=>{let W=!1,q={...Ce};for(const Y of p)try{const ie=await R.getDueScheduledMessages(Y.id);if(ie.length>0){for(const ue of ie)await R.saveMessage({charId:ue.charId,role:"assistant",type:"text",content:ue.content}),await R.deleteScheduledMessage(ue.id);if(W=!0,!(s===Ve.Chat&&x===Y.id)&&(T(`${Y.name} `,"success"),q[Y.id]=(q[Y.id]||0)+ie.length,window.Notification&&Notification.permission==="granted"))try{const ue=new Notification(Y.name,{body:ie[0].content,icon:Y.avatar,silent:!1});ue.onclick=()=>{window.focus(),n(Ve.Chat),y(Y.id)}}catch{}}}catch{}W&&(pe(Date.now()),je(q))};return ne.current=setInterval(O,5e3),O(),()=>{ne.current&&clearInterval(ne.current)}},[j,p,s,x,Ce]);const A=O=>{je(W=>{const q={...W};return delete q[O],q})},le=async O=>{const{wallpaper:W,launcherWidgetImage:q,customFont:Y,...ie}=O,fe={...r,...O};a(fe),W!==void 0&&(W&&W.startsWith("data:")?await R.saveAsset("wallpaper",W):await R.deleteAsset("wallpaper")),q!==void 0&&(q&&q.startsWith("data:")?await R.saveAsset("launcherWidgetImage",q):await R.deleteAsset("launcherWidgetImage")),Y!==void 0&&(Y&&Y.startsWith("data:")?(await R.saveAsset("custom_font_data",Y),D(Y)):Y&&(Y.startsWith("http")||Y.startsWith("https"))?(await R.deleteAsset("custom_font_data"),D(Y)):(await R.deleteAsset("custom_font_data"),D(void 0)));const ue={...fe};ue.wallpaper&&ue.wallpaper.startsWith("data:")&&(ue.wallpaper=""),ue.launcherWidgetImage&&ue.launcherWidgetImage.startsWith("data:")&&(ue.launcherWidgetImage=""),ue.customFont&&ue.customFont.startsWith("data:")&&(ue.customFont=""),localStorage.setItem("os_theme",JSON.stringify(ue))},re=O=>{const W={...l,...O};o(W),localStorage.setItem("os_api_config",JSON.stringify(W))},$e=O=>{Ne(O),localStorage.setItem("os_available_models",JSON.stringify(O))},Re=(O,W)=>{me(q=>{const Y=[...q,{id:Date.now().toString(),name:O,config:W}];return localStorage.setItem("os_api_presets",JSON.stringify(Y)),Y})},De=O=>{me(W=>{const q=W.filter(Y=>Y.id!==O);return localStorage.setItem("os_api_presets",JSON.stringify(q)),q})},Ke=O=>{me(O),localStorage.setItem("os_api_presets",JSON.stringify(O))},_=async()=>{const O="New Character",W={id:`char-${Date.now()}`,name:O,avatar:Ji(O),description:"...",systemPrompt:"",memories:[],contextLimit:500};m(q=>[...q,W]),y(W.id),await R.saveCharacter(W)},ee=async(O,W)=>{m(q=>{const Y=q.map(fe=>fe.id===O?{...fe,...W}:fe),ie=Y.find(fe=>fe.id===O);return ie&&R.saveCharacter(ie),Y})},E=async O=>{m(W=>{const q=W.filter(Y=>Y.id!==O);return q.length>0&&x===O&&y(q[0].id),q}),await R.deleteCharacter(O)},K=async(O,W)=>{const q={id:`group-${Date.now()}`,name:O,members:W,avatar:Ji(O),createdAt:Date.now()};await R.saveGroup(q),g(Y=>[...Y,q])},ke=async O=>{await R.deleteGroup(O),g(W=>W.filter(q=>q.id!==O))},J=async O=>{v(W=>[...W,O]),await R.saveWorldbook(O)},ae=async(O,W)=>{let q;if(v(Y=>Y.map(fe=>fe.id===O?(q={...fe,...W,updatedAt:Date.now()},q):fe)),q){await R.saveWorldbook(q);const Y=p.filter(ie=>{var fe;return(fe=ie.mountedWorldbooks)==null?void 0:fe.some(ue=>ue.id===O)});if(Y.length>0){const ie=p.map(fe=>{var ue;if((ue=fe.mountedWorldbooks)!=null&&ue.some(ze=>ze.id===O)){const ze=fe.mountedWorldbooks.map(Ye=>Ye.id===O?{id:q.id,title:q.title,content:q.content,category:q.category}:Ye),Ge={...fe,mountedWorldbooks:ze};return R.saveCharacter(Ge),Ge}return fe});m(ie),T(` ${Y.length} `,"info")}}},V=async O=>{v(q=>q.filter(Y=>Y.id!==O)),await R.deleteWorldbook(O);const W=p.map(q=>{var Y;if((Y=q.mountedWorldbooks)!=null&&Y.some(ie=>ie.id===O)){const ie=q.mountedWorldbooks.filter(ue=>ue.id!==O),fe={...q,mountedWorldbooks:ie};return R.saveCharacter(fe),fe}return q});m(W),T(" ()","success")},Q=async O=>{z(W=>[O,...W]),await R.saveNovel(O)},ye=async(O,W)=>{z(q=>{const Y=q.map(fe=>fe.id===O?{...fe,...W,lastActiveAt:Date.now()}:fe),ie=Y.find(fe=>fe.id===O);return ie&&R.saveNovel(ie),Y})},be=async O=>{z(W=>W.filter(q=>q.id!==O)),await R.deleteNovel(O)},B=async O=>{M(W=>{const q={...W,...O};return R.saveUserProfile(q),q})},$=async O=>{se(W=>W.find(Y=>Y.id===O.id)?W.map(Y=>Y.id===O.id?O:Y):[...W,O]),await R.saveTheme(O)},U=async O=>{se(W=>W.filter(q=>q.id!==O)),await R.deleteTheme(O)},S=async(O,W)=>{Ee(q=>{const Y={...q};return W?Y[O]=W:delete Y[O],Y}),W?await R.saveAsset(`icon_${O}`,W):await R.deleteAsset(`icon_${O}`)},T=(O,W="info")=>{const q=Date.now().toString();Z(Y=>[...Y,{id:q,message:O,type:W}]),setTimeout(()=>{Z(Y=>Y.filter(ie=>ie.id!==q))},3e3)},Te={activeApp:s,openApp:O=>n(O),closeApp:()=>n(Ve.Launcher),theme:r,updateTheme:le,virtualTime:f,apiConfig:l,updateApiConfig:re,isLocked:i,unlock:()=>c(!1),isDataLoaded:j,characters:p,activeCharacterId:x,addCharacter:_,updateCharacter:ee,deleteCharacter:E,setActiveCharacterId:y,worldbooks:b,addWorldbook:J,updateWorldbook:ae,deleteWorldbook:V,novels:w,addNovel:Q,updateNovel:ye,deleteNovel:be,groups:C,createGroup:K,deleteGroup:ke,userProfile:k,updateUserProfile:B,availableModels:te,setAvailableModels:Ne,apiPresets:Me,addApiPreset:Re,removeApiPreset:De,customThemes:F,addCustomTheme:$,removeCustomTheme:U,toasts:P,addToast:T,customIcons:G,setCustomIcon:S,lastMsgTimestamp:X,unreadMessages:Ce,clearUnread:A,exportSystem:async O=>{var W,q,Y,ie;try{N({status:"processing",message:"...",progress:0});const fe=new Xc,ue=fe.folder("assets");let ze=0;const Ge=tt=>{if(typeof tt=="string")return tt.startsWith("data:image")?"":tt;if(Array.isArray(tt))return tt.map(Ct=>Ge(Ct));if(tt!==null&&typeof tt=="object"){const Ct={};for(const ct in tt)Object.prototype.hasOwnProperty.call(tt,ct)&&(Ct[ct]=Ge(tt[ct]));return Ct}return tt},Ye=tt=>{if(tt===null||typeof tt!="object")return tt;if(Array.isArray(tt))return tt.map(ct=>Ye(ct));const Ct={};for(const ct in tt)if(Object.prototype.hasOwnProperty.call(tt,ct)){let Lt=tt[ct];if(typeof Lt=="string"&&Lt.startsWith("data:image/"))try{const Pt=Lt.match(/data:image\/([a-zA-Z0-9]+);base64,/);if(Pt){const qn=Pt[1]==="jpeg"?"jpg":Pt[1],nn=`asset_${Date.now()}_${ze++}.${qn}`,rn=Lt.split(",")[1];ue==null||ue.file(nn,rn,{base64:!0}),Lt=`assets/${nn}`}}catch(Pt){console.warn("Failed to process asset",Pt)}else Lt=Ye(Lt);Ct[ct]=Lt}return Ct};let Be=[];O==="text_only"?Be=["characters","messages","themes","emojis","assets","gallery","user_profile","diaries","tasks","anniversaries","room_todos","room_notes","groups","journal_stickers","social_posts","courses","games","worldbooks","novels"].filter(tt=>tt!=="assets"):O==="media_only"?Be=["gallery","emojis","journal_stickers","user_profile","characters","messages"]:O==="theme_only"&&(Be=["themes","assets"]);const Je=await R.getAsset("spark_user_bg"),Qe=await R.getAsset("spark_social_profile"),et=await R.getAsset("room_custom_assets_list"),Fe={timestamp:Date.now(),version:2,apiConfig:O==="text_only"?l:void 0,apiPresets:O==="text_only"?Me:void 0,availableModels:O==="text_only"?te:void 0,theme:O==="text_only"||O==="theme_only"?r:void 0,socialAppData:O==="text_only"||O==="media_only"?{charHandles:JSON.parse(localStorage.getItem("spark_char_handles")||"{}"),userProfile:Qe?JSON.parse(Qe):void 0,userId:localStorage.getItem("spark_user_id")||void 0,userBg:Je||void 0}:void 0,roomCustomAssets:O==="text_only"||O==="media_only"?et?JSON.parse(et):[]:void 0,mediaAssets:[]},cs=Be.length+3;let ht=0;O!=="text_only"?((W=Fe.socialAppData)!=null&&W.userProfile&&(Fe.socialAppData.userProfile=Ye(Fe.socialAppData.userProfile)),(q=Fe.socialAppData)!=null&&q.userBg&&(Fe.socialAppData.userBg=Ye(Fe.socialAppData.userBg)),Fe.roomCustomAssets&&(Fe.roomCustomAssets=Ye(Fe.roomCustomAssets)),Fe.theme&&(Fe.theme=Ye(Fe.theme))):((Y=Fe.socialAppData)!=null&&Y.userProfile&&(Fe.socialAppData.userProfile=Ge(Fe.socialAppData.userProfile)),(ie=Fe.socialAppData)!=null&&ie.userBg&&(Fe.socialAppData.userBg=Ge(Fe.socialAppData.userBg)),Fe.roomCustomAssets&&(Fe.roomCustomAssets=Ge(Fe.roomCustomAssets)),Fe.theme&&(Fe.theme=Ge(Fe.theme)));for(const tt of Be){ht++,N({status:"processing",message:`: ${tt} ...`,progress:ht/cs*100});let Ct=await R.getRawStoreData(tt),ct;if(O==="text_only")ct=Ge(Ct);else{if(tt==="messages"&&O==="media_only"&&(Ct=Ct.filter(Lt=>Lt.type==="image"||Lt.type==="emoji")),tt==="characters"&&O==="media_only"){const Lt=Ct.map(Pt=>{var nn,rn,hn,he;const qn={charId:Pt.id,avatar:Pt.avatar,sprites:Pt.sprites,roomItems:(rn=(nn=Pt.roomConfig)==null?void 0:nn.items)==null?void 0:rn.reduce((Oe,qe)=>(qe.image&&qe.image.startsWith("data:")&&(Oe[qe.id]=qe.image),Oe),{}),backgrounds:{chat:Pt.chatBackground,date:Pt.dateBackground,roomWall:(hn=Pt.roomConfig)==null?void 0:hn.wallImage,roomFloor:(he=Pt.roomConfig)==null?void 0:he.floorImage}};return Ye(qn)});Fe.mediaAssets=Lt;continue}ct=Ye(Ct)}switch(tt){case"characters":O!=="media_only"&&(Fe.characters=ct);break;case"messages":Fe.messages=ct;break;case"themes":Fe.customThemes=ct;break;case"emojis":Fe.savedEmojis=ct;break;case"assets":Fe.assets=ct;break;case"gallery":Fe.galleryImages=ct;break;case"user_profile":ct[0]&&(Fe.userProfile=ct[0]);break;case"diaries":Fe.diaries=ct;break;case"tasks":Fe.tasks=ct;break;case"anniversaries":Fe.anniversaries=ct;break;case"room_todos":Fe.roomTodos=ct;break;case"room_notes":Fe.roomNotes=ct;break;case"groups":Fe.groups=ct;break;case"journal_stickers":Fe.savedJournalStickers=ct;break;case"social_posts":Fe.socialPosts=ct;break;case"courses":Fe.courses=ct;break;case"games":Fe.games=ct;break;case"worldbooks":Fe.worldbooks=ct;break;case"novels":Fe.novels=ct;break}await new Promise(Lt=>setTimeout(Lt,10))}N({status:"processing",message:"...",progress:95}),fe.file("data.json",JSON.stringify(Fe));const Cs=await fe.generateAsync({type:"blob"},tt=>{Math.random()>.8&&N(Ct=>({...Ct,message:` ${tt.percent.toFixed(0)}%...`}))});return N({status:"idle",message:"",progress:100}),Cs}catch(fe){throw console.error("Export Failed",fe),N({status:"idle",message:"",progress:0}),new Error(": "+fe.message)}},importSystem:async O=>{try{N({status:"processing",message:"...",progress:0});let W,q=null;if(typeof O=="string")W=JSON.parse(O);else if(O.name.endsWith(".zip")){const Be=await Xc.loadAsync(O);q=Be;const it=Be.file("data.json");if(!it)throw new Error(":  data.json");const Je=await it.async("string");W=JSON.parse(Je)}else try{const Be=await O.text();W=JSON.parse(Be)}catch{throw new Error(" .zip  .json")}const Y=async Be=>{if(Be===null||typeof Be!="object")return Be;if(Array.isArray(Be)){const Je=[];for(const Qe of Be)Je.push(await Y(Qe));return Je}const it={};for(const Je in Be)if(Object.prototype.hasOwnProperty.call(Be,Je)){let Qe=Be[Je];if(typeof Qe=="string"&&Qe.startsWith("assets/")&&q)try{const et=Qe.split("/")[1],Fe=q.file(`assets/${et}`);if(Fe){const cs=await Fe.async("base64"),ht=et.split(".").pop()||"png";let Cs="image/png";(ht==="jpg"||ht==="jpeg")&&(Cs="image/jpeg"),ht==="gif"&&(Cs="image/gif"),ht==="webp"&&(Cs="image/webp"),Qe=`data:${Cs};base64,${cs}`}}catch{console.warn(`Failed to restore asset: ${Qe}`)}else Qe=await Y(Qe);it[Je]=Qe}return it};if(N({status:"processing",message:"...",progress:50}),q&&(W=await Y(W)),await R.importFullData(W),W.theme){const Be={...W.theme};Be.wallpaper&&Be.wallpaper.startsWith("data:")&&delete Be.wallpaper,Be.launcherWidgetImage&&Be.launcherWidgetImage.startsWith("data:")&&delete Be.launcherWidgetImage,Be.customFont&&Be.customFont.startsWith("data:")&&delete Be.customFont,le(Be)}W.apiConfig&&re(W.apiConfig),W.availableModels&&$e(W.availableModels),W.apiPresets&&Ke(W.apiPresets),W.socialAppData&&(W.socialAppData.charHandles&&localStorage.setItem("spark_char_handles",JSON.stringify(W.socialAppData.charHandles)),W.socialAppData.userId&&localStorage.setItem("spark_user_id",W.socialAppData.userId),W.socialAppData.userProfile&&await R.saveAsset("spark_social_profile",JSON.stringify(W.socialAppData.userProfile)),W.socialAppData.userBg&&await R.saveAsset("spark_user_bg",W.socialAppData.userBg)),W.roomCustomAssets&&await R.saveAsset("room_custom_assets_list",JSON.stringify(W.roomCustomAssets));const ie=await R.getAllCharacters(),fe=await R.getGroups(),ue=await R.getThemes(),ze=await R.getUserProfile(),Ge=await R.getAllWorldbooks(),Ye=await R.getAllNovels();if(W.assets){const Be=await R.getAllAssets(),it={};Array.isArray(Be)&&Be.forEach(Je=>{Je.id.startsWith("icon_")&&(it[Je.id.replace("icon_","")]=Je.data)}),Ee(it)}ie.length>0&&m(ie),fe.length>0&&g(fe),ue.length>0&&se(ue),ze&&M(ze),Ge.length>0&&v(Ge),Ye.length>0&&z(Ye),N({status:"idle",message:"",progress:100}),T("...","success"),setTimeout(()=>window.location.reload(),1500)}catch(W){console.error("Import Error:",W),N({status:"idle",message:"",progress:0});const q=W instanceof SyntaxError?"JSON ":W.message||"";throw new Error(`: ${q}`)}},resetSystem:async()=>{try{await R.deleteDB(),localStorage.clear(),window.location.reload()}catch(O){console.error(O),T("","error")}},sysOperation:ce,systemLogs:Pe,clearLogs:xe};return t.jsx(Hm.Provider,{value:Te,children:e})},xt=()=>{const e=u.useContext(Hm);if(e===void 0)throw new Error("useOS must be used within an OSProvider");return e},Ze=({isOpen:e,title:s,onClose:n,children:r,footer:a})=>e?t.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 animate-fade-in",children:[t.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:n}),t.jsxs("div",{className:"relative w-full max-w-sm bg-white/90 backdrop-blur-xl rounded-[2.5rem] shadow-2xl border border-white/20 overflow-hidden animate-slide-up",children:[t.jsx("div",{className:"px-6 pt-6 pb-2",children:t.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center",children:s})}),t.jsx("div",{className:"px-6 py-4",children:r}),a?t.jsx("div",{className:"px-6 pb-6 flex gap-3",children:a}):t.jsx("div",{className:"px-6 pb-6",children:t.jsx("button",{onClick:n,className:"w-full py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl active:scale-95 transition-transform",children:""})})]})]}):null,_p=()=>{const{virtualTime:e,theme:s,systemLogs:n,clearLogs:r}=xt(),[a,l]=u.useState(100),[o,i]=u.useState(!1),[c,d]=u.useState(!1),f=m=>m.toString().padStart(2,"0"),h=s.contentColor||"#ffffff";u.useEffect(()=>{(async()=>{const x=navigator;if(x.getBattery)try{const y=await x.getBattery(),C=()=>{l(Math.round(y.level*100)),i(y.charging)};return C(),y.addEventListener("levelchange",C),y.addEventListener("chargingchange",C),()=>{y.removeEventListener("levelchange",C),y.removeEventListener("chargingchange",C)}}catch(y){console.error("Battery API failed",y)}})()},[]);const p=n.length>0;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full flex justify-between items-start px-6 text-[11px] font-bold z-50 absolute top-0 left-0 bg-transparent transition-colors duration-500 select-none pointer-events-none",style:{color:h,paddingTop:"max(4px, env(safe-area-inset-top))",height:"auto",minHeight:"2rem"},children:[t.jsx("div",{className:"w-1/3 pl-2 flex items-center gap-2 pointer-events-auto",children:t.jsxs("span",{children:[f(e.hours),":",f(e.minutes)]})}),t.jsx("div",{className:"w-1/3 flex justify-center"}),t.jsxs("div",{className:"w-1/3 flex justify-end gap-1.5 items-center pr-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:t.jsx("path",{fillRule:"evenodd",d:"M1.371 8.143c5.858-5.857 15.356-5.857 21.213 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.06 0c-4.98-4.979-13.053-4.979-18.032 0a.75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182c4.1-4.1 10.749-4.1 14.85 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.062 0 8.25 8.25 0 0 0-11.667 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.204 3.182a6 6 0 0 1 8.486 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0 3.75 3.75 0 0 0-5.304 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182a1.5 1.5 0 0 1 2.122 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0l-.53-.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("span",{children:[a,"%"]}),t.jsxs("div",{className:"w-5 h-2.5 border border-current rounded-[3px] p-[1px] relative opacity-80 flex items-center",children:[t.jsx("div",{className:`h-full rounded-[1px] ${o?"bg-green-400":"bg-current"}`,style:{width:`${a}%`}}),o&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3 text-black",children:t.jsx("path",{d:"M11.983 1.907a.75.75 0 0 0-1.292-.657l-8.5 9.5A.75.75 0 0 0 2.75 12h6.572l-1.305 6.093a.75.75 0 0 0 1.292.657l8.5-9.5A.75.75 0 0 0 17.25 8h-6.572l1.305-6.093Z"})})})]})]})]})]}),p&&t.jsxs("button",{onClick:()=>d(!0),className:"fixed left-1/2 -translate-x-1/2 z-[60] bg-red-500/90 text-white rounded-full px-4 py-1.5 text-[10px] font-bold shadow-lg animate-pulse flex items-center gap-1.5 backdrop-blur-md border border-white/20 pointer-events-auto",style:{top:"calc(env(safe-area-inset-top) + 2.5rem)"},children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z",clipRule:"evenodd"})}),t.jsx("span",{children:"SYSTEM ERROR"})]}),t.jsx(Ze,{isOpen:c,title:"",onClose:()=>d(!1),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(n,null,2))},className:"flex-1 py-3 bg-slate-100 font-bold rounded-xl text-slate-600",children:" JSON"}),t.jsx("button",{onClick:r,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-xl shadow-lg shadow-red-200",children:""})]}),children:t.jsx("div",{className:"h-64 bg-slate-900 rounded-xl p-3 overflow-y-auto font-mono text-[10px] space-y-2 no-scrollbar shadow-inner",children:n.length===0?t.jsx("div",{className:"text-slate-500 text-center mt-20",children:""}):n.map(m=>t.jsxs("div",{className:"border-b border-white/10 pb-2 mb-2 last:border-0 last:mb-0 last:pb-0",children:[t.jsxs("div",{className:"flex justify-between items-start text-white/50 mb-1",children:[t.jsxs("span",{children:["[",new Date(m.timestamp).toLocaleTimeString(),"]"]}),t.jsx("span",{className:`uppercase font-bold ${m.type==="error"?"text-red-400":"text-orange-400"}`,children:m.type})]}),t.jsx("div",{className:"text-white font-bold mb-1 break-words",children:m.message}),m.detail&&t.jsx("pre",{className:"text-slate-400 whitespace-pre-wrap break-all bg-black/30 p-2 rounded",children:m.detail}),t.jsxs("div",{className:"text-white/30 text-right mt-1",children:["Src: ",m.source]})]},m.id))})})]})},Ki={Character:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),User:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),Chat:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})}),GroupChat:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})}),Settings:({className:e})=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 0 1 0 2.555c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.212 1.281c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-2.555c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),Gallery:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),ThemeMaker:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42"})}),Appearance:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.435-.435 1.133-.435 1.567 0l3.712 3.712c.435.435.435 1.133 0 1.567l-2.88 2.88M10.5 8.197V15.75"})}),Date:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"})}),Journal:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})}),Schedule:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),Room:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125-1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),CheckPhone:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"})}),Social:({className:e})=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0Z"})]}),Study:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})}),FAQ:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"})}),Game:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})}),Worldbook:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z"})}),Novel:({className:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})})},Yi=[{id:Ve.Character,name:"",icon:"Character",color:"indigo"},{id:Ve.Chat,name:"Message",icon:"Chat",color:"green"},{id:Ve.GroupChat,name:"",icon:"GroupChat",color:"violet"},{id:Ve.Room,name:"",icon:"Room",color:"rose"},{id:Ve.CheckPhone,name:"",icon:"CheckPhone",color:"slate"},{id:Ve.Social,name:"Spark",icon:"Social",color:"red"},{id:Ve.User,name:"",icon:"User",color:"blue"},{id:Ve.Schedule,name:"",icon:"Schedule",color:"cyan"},{id:Ve.Journal,name:"",icon:"Journal",color:"amber"},{id:Ve.Date,name:"",icon:"Date",color:"pink"},{id:Ve.Study,name:"",icon:"Study",color:"emerald"},{id:Ve.Game,name:"TRPG",icon:"Game",color:"orange"},{id:Ve.Novel,name:"",icon:"Novel",color:"amber"},{id:Ve.Worldbook,name:"",icon:"Worldbook",color:"indigo"},{id:Ve.FAQ,name:"",icon:"FAQ",color:"indigo"},{id:Ve.Gallery,name:"",icon:"Gallery",color:"orange"},{id:Ve.ThemeMaker,name:"",icon:"ThemeMaker",color:"purple"},{id:Ve.Appearance,name:"",icon:"Appearance",color:"slate"},{id:Ve.Settings,name:"",icon:"Settings",color:"slate"}],du=[Ve.Chat,Ve.GroupChat,Ve.Social,Ve.Date],Gm=$n.memo(({app:e,onClick:s,size:n="md",hideLabel:r=!1,variant:a="default"})=>{const{customIcons:l,theme:o}=xt(),i=Ki[e.icon]||Ki.Settings,c=l[e.id],d=o.contentColor||"#ffffff",f=n==="lg"?"w-[4.5rem] h-[4.5rem]":"w-[4rem] h-[4rem]";return t.jsxs("button",{onClick:s,className:"flex flex-col items-center gap-1.5 group relative active:scale-95 transition-transform duration-200",style:{WebkitTapHighlightColor:"transparent"},children:[t.jsxs("div",{className:`${f} relative flex items-center justify-center 
        bg-white/10 backdrop-blur-xl rounded-[1.2rem]
        border-t border-l border-white/40 border-b border-r border-white/10
        shadow-[0_8px_16px_rgba(0,0,0,0.2)]
        transition-all duration-300
        group-hover:bg-white/20 group-hover:shadow-[0_0_20px_rgba(255,255,255,0.3)] group-hover:border-white/60
      `,children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-white/10 to-transparent rounded-[1.2rem] opacity-0 group-hover:opacity-100 transition-opacity"}),c?t.jsx("img",{src:c,className:"w-full h-full object-cover rounded-[1.2rem]",alt:e.name,loading:"lazy"}):t.jsx("div",{className:"w-[50%] h-[50%] drop-shadow-[0_2px_5px_rgba(0,0,0,0.3)] opacity-90",style:{color:d},children:t.jsx(i,{className:"w-full h-full"})})]}),!r&&t.jsx("span",{className:`text-[10px] font-bold tracking-widest uppercase opacity-80 text-shadow-md transition-opacity ${a==="dock"?"hidden":"block"}`,style:{color:d},children:e.name})]})},(e,s)=>e.app.id===s.app.id&&e.size===s.size&&e.hideLabel===s.hideLabel&&e.variant===s.variant),Ep=$n.memo(()=>{const{virtualTime:e,theme:s}=xt(),n=s.contentColor||"#ffffff",r=["SUN","MON","TUE","WED","THU","FRI","SAT"],a=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],l=new Date,o=r[l.getDay()],i=a[l.getMonth()],c=l.getDate().toString().padStart(2,"0");return t.jsxs("div",{className:"flex flex-col mb-6 mt-6 relative animate-fade-in",style:{color:n},children:[t.jsxs("div",{className:"absolute -top-6 left-1 flex items-center gap-2",children:[t.jsx("div",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded text-[10px] font-bold tracking-widest uppercase border border-white/10",children:"System Ready"}),t.jsx("div",{className:"h-[1px] w-20 bg-gradient-to-r from-current to-transparent opacity-40"})]}),t.jsxs("div",{className:"flex items-end gap-4",children:[t.jsxs("div",{className:"text-[6.5rem] leading-[0.85] font-bold tracking-tighter drop-shadow-2xl font-sans",style:{willChange:"contents"},children:[e.hours.toString().padStart(2,"0"),t.jsx("span",{className:"opacity-40 font-light mx-1",children:":"}),e.minutes.toString().padStart(2,"0")]}),t.jsxs("div",{className:"flex flex-col justify-end pb-3 opacity-90",children:[t.jsx("div",{className:"text-3xl font-bold tracking-tight",children:o}),t.jsxs("div",{className:"text-sm font-medium opacity-80 tracking-widest",children:[i," . ",c]})]})]})]})}),Lp=$n.memo(({char:e,unreadCount:s,lastMessage:n,onClick:r,contentColor:a})=>t.jsx("div",{className:"mb-4 group animate-fade-in",children:t.jsxs("div",{className:"relative h-28 w-full overflow-hidden rounded-[1.5rem] bg-white/10 backdrop-blur-xl border border-white/20 shadow-2xl transition-all duration-300 active:scale-[0.98] cursor-pointer",onClick:r,children:[t.jsx("div",{className:"absolute top-0 right-0 w-32 h-full bg-gradient-to-l from-white/5 to-transparent skew-x-12 pointer-events-none"}),t.jsxs("div",{className:"absolute inset-0 flex items-center p-4 gap-4",children:[t.jsxs("div",{className:"w-20 h-20 shrink-0 rounded-2xl overflow-hidden shadow-lg border-2 border-white/20 relative bg-slate-800",children:[e?t.jsx("img",{src:e.avatar,className:"w-full h-full object-cover",alt:"char",loading:"lazy"}):t.jsx("div",{className:"w-full h-full bg-white/10 animate-pulse"}),s>0?t.jsx("div",{className:"absolute bottom-1 right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white shadow-sm flex items-center justify-center text-[8px] font-bold text-white",children:s}):t.jsx("div",{className:"absolute bottom-1 right-1 w-3 h-3 bg-green-400 rounded-full border-2 border-black/20 shadow-sm"})]}),t.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center gap-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-lg font-bold tracking-wide drop-shadow-md truncate",style:{color:a},children:(e==null?void 0:e.name)||"NO SIGNAL"}),t.jsx("div",{className:"px-1.5 py-0.5 bg-white/20 rounded text-[9px] font-bold uppercase tracking-wider",style:{color:a},children:s>0?"NEW MESSAGE":"Active"})]}),t.jsx("div",{className:"relative",children:t.jsxs("div",{className:"text-xs line-clamp-2 font-medium leading-relaxed opacity-90",style:{color:a},children:[t.jsx("span",{className:"opacity-40 mr-1 text-[10px]",children:""}),n]})})]})]})]})})),uu=$n.memo(({apps:e,openApp:s})=>t.jsx("div",{className:"grid grid-cols-4 gap-y-6 gap-x-2 place-items-center animate-fade-in",children:e.map(n=>t.jsx(Gm,{app:n,onClick:()=>s(n.id)},n.id))})),Tp=$n.memo(({contentColor:e,openApp:s,anniversaries:n,characters:r})=>{const a=new Date,l=a.getFullYear(),o=a.getMonth(),i=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][o],c=(x,y)=>new Date(x,y+1,0).getDate(),d=(x,y)=>new Date(x,y,1).getDay(),f=c(l,o),h=d(l,o),p=Array.from({length:f},(x,y)=>y+1),m=Array.from({length:h},()=>null);return t.jsxs("div",{className:"w-full flex-shrink-0 snap-center snap-always flex flex-col px-6 pt-24 pb-8 space-y-6 h-full overflow-y-auto no-scrollbar",children:[t.jsxs("div",{className:"bg-white/10 backdrop-blur-2xl rounded-3xl p-6 border border-white/20 shadow-2xl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",style:{color:e},children:[t.jsxs("h3",{className:"text-xl font-bold tracking-widest",children:[i," ",l]}),t.jsx("div",{onClick:()=>s("schedule"),className:"bg-white/20 p-2 rounded-full cursor-pointer hover:bg-white/40 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),t.jsx("div",{className:"grid grid-cols-7 gap-y-3 gap-x-1 text-center mb-2",children:["S","M","T","W","T","F","S"].map(x=>t.jsx("div",{className:"text-[10px] font-bold opacity-40",style:{color:e},children:x},x))}),t.jsxs("div",{className:"grid grid-cols-7 gap-y-2 gap-x-1 text-center",children:[m.map((x,y)=>t.jsx("div",{},`pad-${y}`)),p.map(x=>{const y=`${l}-${String(o+1).padStart(2,"0")}-${String(x).padStart(2,"0")}`,C=x===a.getDate(),g=n.some(b=>b.date===y);return t.jsxs("div",{className:"flex flex-col items-center justify-center h-8 relative",children:[t.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-full text-sm font-medium ${C?"bg-white text-black font-bold shadow-lg":"opacity-80"}`,style:C?{}:{color:e},children:x}),g&&t.jsx("div",{className:"w-1.5 h-1.5 bg-purple-400 rounded-full absolute bottom-0 shadow-sm border border-black/20"})]},x)})]})]}),t.jsxs("div",{className:"bg-white/10 backdrop-blur-2xl rounded-3xl p-5 border border-white/20 shadow-2xl flex-1 min-h-[200px]",children:[t.jsxs("h3",{className:"text-xs font-bold opacity-60 uppercase tracking-widest mb-4 flex items-center gap-2",style:{color:e},children:[t.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"})," Upcoming Events"]}),t.jsx("div",{className:"space-y-3",children:n.length>0?n.sort((x,y)=>x.date.localeCompare(y.date)).slice(0,5).map(x=>{var y;return t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10",children:[t.jsxs("div",{className:"w-10 h-10 bg-purple-500/20 rounded-lg flex flex-col items-center justify-center text-purple-200 border border-purple-500/30",children:[t.jsx("span",{className:"text-[9px] opacity-70",children:x.date.split("-")[1]}),t.jsx("span",{className:"text-sm font-bold leading-none",children:x.date.split("-")[2]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-sm font-bold",style:{color:e},children:x.title}),t.jsx("div",{className:"text-[10px] opacity-50",style:{color:e},children:((y=r.find(C=>C.id===x.charId))==null?void 0:y.name)||"Unknown"})]})]},x.id)}):t.jsx("div",{className:"text-center opacity-30 text-xs py-8",style:{color:e},children:"No upcoming events"})})]})]})}),Ap=()=>{const{openApp:e,characters:s,activeCharacterId:n,theme:r,lastMsgTimestamp:a,isDataLoaded:l,unreadMessages:o}=xt(),[i,c]=u.useState(null),[d,f]=u.useState(""),[h,p]=u.useState([]),[m,x]=u.useState(0),y=u.useRef(null),C=u.useRef(!1),g=u.useRef(0),b=u.useRef(0),v=u.useRef(0),w=u.useMemo(()=>Yi.filter(P=>!du.includes(P.id)),[]),z=u.useMemo(()=>du.map(P=>Yi.find(Z=>Z.id===P)).filter(Boolean),[]),k=8,M=u.useMemo(()=>{const P=[];for(let Z=0;Z<w.length;Z+=k)P.push(w.slice(Z,Z+k));return P.length===0&&P.push([]),P},[w]),j=M.length+1;u.useEffect(()=>{l&&(async()=>{if(!s||s.length===0){c(null),f("No Character Connected"),p([]);return}const Z=s.find(X=>X.id===n)||s[0];c(Z);try{const[X,pe]=await Promise.all([R.getMessagesByCharId(Z.id),R.getAllAnniversaries()]);if(X.length>0){const Ce=X.filter(je=>je.role!=="system");if(Ce.length>0){const je=Ce[Ce.length-1],Pe=je.content.replace(/\[.*?\]/g,"").trim();f(Pe||(je.type==="image"?"[]":"[]"))}else f(Z.description||"System Ready.")}else f(Z.description||"System Ready.");p(pe)}catch(X){console.error(X)}})()},[n,a,l,s]);const H=()=>{if(y.current){const P=y.current.clientWidth,Z=y.current.scrollLeft,X=Math.round(Z/P);x(X)}},te=P=>{y.current&&(C.current=!0,v.current=0,g.current=P.pageX-y.current.offsetLeft,b.current=y.current.scrollLeft,y.current.style.scrollBehavior="auto",y.current.style.scrollSnapType="none",y.current.style.cursor="grabbing")},Ne=P=>{if(!C.current||!y.current)return;P.preventDefault();const Z=P.pageX-y.current.offsetLeft,X=Z-g.current;y.current.scrollLeft=b.current-X,v.current=Math.abs(Z-(g.current+y.current.offsetLeft))},Me=()=>{!C.current||!y.current||(C.current=!1,y.current.style.scrollBehavior="smooth",y.current.style.scrollSnapType="x mandatory",y.current.style.cursor="grab")},me=()=>{C.current&&Me()},F=P=>{v.current>5&&(P.stopPropagation(),P.preventDefault())},se=r.contentColor||"#ffffff",G=Object.values(o).reduce((P,Z)=>P+Z,0),Ee=i&&o[i.id]?o[i.id]:0;return t.jsxs("div",{className:"h-full w-full flex flex-col relative z-10 overflow-hidden font-sans select-none",children:[t.jsxs("div",{className:"absolute inset-0 pointer-events-none",style:{willChange:"transform"},children:[t.jsx("div",{className:"absolute -top-20 -right-20 w-80 h-80 bg-white/5 rounded-full blur-3xl"}),t.jsx("div",{className:"absolute -bottom-20 -left-20 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl"})]}),t.jsxs("div",{ref:y,onScroll:H,onMouseDown:te,onMouseMove:Ne,onMouseUp:Me,onMouseLeave:me,onClickCapture:F,className:"flex-1 flex overflow-x-auto snap-x snap-mandatory no-scrollbar cursor-grab active:cursor-grabbing",style:{scrollBehavior:"smooth",overscrollBehaviorX:"contain"},children:[M.map((P,Z)=>t.jsx("div",{className:"w-full flex-shrink-0 snap-center snap-always flex flex-col px-6 pt-12 pb-8 h-full",children:Z===0?t.jsxs(t.Fragment,{children:[t.jsx(Ep,{}),t.jsx(Lp,{char:i,unreadCount:Ee,lastMessage:d,onClick:()=>e(Ve.Chat),contentColor:se}),t.jsx("div",{className:"flex-1",children:t.jsx(uu,{apps:P,openApp:e})})]}):t.jsxs("div",{className:"pt-12 flex-1 flex flex-col",children:[Z===1&&r.launcherWidgetImage?t.jsxs("div",{className:"w-full h-48 mb-8 rounded-[1.5rem] overflow-hidden shadow-lg border border-white/20 relative group",children:[t.jsx("img",{src:r.launcherWidgetImage,className:"w-full h-full object-cover",alt:"Custom Widget"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"})]}):t.jsx("div",{className:"h-20"}),t.jsx(uu,{apps:P,openApp:e}),t.jsx("div",{className:"flex-1"})]})},Z)),t.jsx(Tp,{contentColor:se,openApp:e,anniversaries:h,characters:s})]}),t.jsx("div",{className:"absolute bottom-24 left-0 w-full flex justify-center gap-2 pointer-events-none z-20",children:Array.from({length:j}).map((P,Z)=>t.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${m===Z?"w-4 opacity-100":"w-1.5 opacity-40"}`,style:{backgroundColor:se}},Z))}),t.jsx("div",{className:"mt-auto flex justify-center w-full px-4 mb-2 pb-[env(safe-area-inset-bottom)] relative z-30",children:t.jsx("div",{className:"bg-white/20 backdrop-blur-2xl rounded-3xl border border-white/20 shadow-[0_10px_30px_rgba(0,0,0,0.2)] px-4 py-3 flex gap-3 sm:gap-6 items-center mx-auto max-w-full justify-between overflow-x-auto no-scrollbar transform-gpu",children:z.map(P=>t.jsxs("div",{className:"relative",children:[t.jsx(Gm,{app:P,onClick:()=>e(P.id),variant:"dock",size:"md"}),P.id==="chat"&&G>0&&t.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-[9px] flex items-center justify-center border-2 border-white/20 shadow-sm font-bold pointer-events-none animate-bounce",children:G>9?"9+":G})]},P.id))})})]})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const Pp=e=>{const s=new Map;s.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:s},r=(l,o)=>{n.platforms.set(l,o)},a=l=>{n.platforms.has(l)&&(n.currentPlatform=n.platforms.get(l))};return n.addPlatform=r,n.setPlatform=a,n},Rp=e=>e.CapacitorPlatforms=Pp(e),Vm=Rp(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});Vm.addPlatform;Vm.setPlatform;var Jr;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(Jr||(Jr={}));class Vo extends Error{constructor(s,n,r){super(s),this.message=s,this.code=n,this.data=r}}const Dp=e=>{var s,n;return e!=null&&e.androidBridge?"android":!((n=(s=e==null?void 0:e.webkit)===null||s===void 0?void 0:s.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},Op=e=>{var s,n,r,a,l;const o=e.CapacitorCustomPlatform||null,i=e.Capacitor||{},c=i.Plugins=i.Plugins||{},d=e.CapacitorPlatforms,f=()=>o!==null?o.name:Dp(e),h=((s=d==null?void 0:d.currentPlatform)===null||s===void 0?void 0:s.getPlatform)||f,p=()=>h()!=="web",m=((n=d==null?void 0:d.currentPlatform)===null||n===void 0?void 0:n.isNativePlatform)||p,x=M=>{const j=w.get(M);return!!(j!=null&&j.platforms.has(h())||g(M))},y=((r=d==null?void 0:d.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||x,C=M=>{var j;return(j=i.PluginHeaders)===null||j===void 0?void 0:j.find(H=>H.name===M)},g=((a=d==null?void 0:d.currentPlatform)===null||a===void 0?void 0:a.getPluginHeader)||C,b=M=>e.console.error(M),v=(M,j,H)=>Promise.reject(`${H} does not have an implementation of "${j}".`),w=new Map,z=(M,j={})=>{const H=w.get(M);if(H)return console.warn(`Capacitor plugin "${M}" already registered. Cannot register plugins twice.`),H.proxy;const te=h(),Ne=g(M);let Me;const me=async()=>(!Me&&te in j?Me=typeof j[te]=="function"?Me=await j[te]():Me=j[te]:o!==null&&!Me&&"web"in j&&(Me=typeof j.web=="function"?Me=await j.web():Me=j.web),Me),F=(X,pe)=>{var Ce,je;if(Ne){const Pe=Ne==null?void 0:Ne.methods.find(ge=>pe===ge.name);if(Pe)return Pe.rtype==="promise"?ge=>i.nativePromise(M,pe.toString(),ge):(ge,ce)=>i.nativeCallback(M,pe.toString(),ge,ce);if(X)return(Ce=X[pe])===null||Ce===void 0?void 0:Ce.bind(X)}else{if(X)return(je=X[pe])===null||je===void 0?void 0:je.bind(X);throw new Vo(`"${M}" plugin is not implemented on ${te}`,Jr.Unimplemented)}},se=X=>{let pe;const Ce=(...je)=>{const Pe=me().then(ge=>{const ce=F(ge,X);if(ce){const N=ce(...je);return pe=N==null?void 0:N.remove,N}else throw new Vo(`"${M}.${X}()" is not implemented on ${te}`,Jr.Unimplemented)});return X==="addListener"&&(Pe.remove=async()=>pe()),Pe};return Ce.toString=()=>`${X.toString()}() { [capacitor code] }`,Object.defineProperty(Ce,"name",{value:X,writable:!1,configurable:!1}),Ce},G=se("addListener"),Ee=se("removeListener"),P=(X,pe)=>{const Ce=G({eventName:X},pe),je=async()=>{const ge=await Ce;Ee({eventName:X,callbackId:ge},pe)},Pe=new Promise(ge=>Ce.then(()=>ge({remove:je})));return Pe.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await je()},Pe},Z=new Proxy({},{get(X,pe){switch(pe){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return Ne?P:G;case"removeListener":return Ee;default:return se(pe)}}});return c[M]=Z,w.set(M,{name:M,proxy:Z,platforms:new Set([...Object.keys(j),...Ne?[te]:[]])}),Z},k=((l=d==null?void 0:d.currentPlatform)===null||l===void 0?void 0:l.registerPlugin)||z;return i.convertFileSrc||(i.convertFileSrc=M=>M),i.getPlatform=h,i.handleError=b,i.isNativePlatform=m,i.isPluginAvailable=y,i.pluginMethodNoop=v,i.registerPlugin=k,i.Exception=Vo,i.DEBUG=!!i.DEBUG,i.isLoggingEnabled=!!i.isLoggingEnabled,i.platform=i.getPlatform(),i.isNative=i.isNativePlatform(),i},zp=e=>e.Capacitor=Op(e),tn=zp(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),xr=tn.registerPlugin;tn.Plugins;class Zm{constructor(s){this.listeners={},this.retainedEventArguments={},this.windowListeners={},s&&(console.warn(`Capacitor WebPlugin "${s.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=s)}addListener(s,n){let r=!1;this.listeners[s]||(this.listeners[s]=[],r=!0),this.listeners[s].push(n);const l=this.windowListeners[s];l&&!l.registered&&this.addWindowListener(l),r&&this.sendRetainedArgumentsForEvent(s);const o=async()=>this.removeListener(s,n);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const s in this.windowListeners)this.removeWindowListener(this.windowListeners[s]);this.windowListeners={}}notifyListeners(s,n,r){const a=this.listeners[s];if(!a){if(r){let l=this.retainedEventArguments[s];l||(l=[]),l.push(n),this.retainedEventArguments[s]=l}return}a.forEach(l=>l(n))}hasListeners(s){return!!this.listeners[s].length}registerWindowListener(s,n){this.windowListeners[n]={registered:!1,windowEventName:s,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(s="not implemented"){return new tn.Exception(s,Jr.Unimplemented)}unavailable(s="not available"){return new tn.Exception(s,Jr.Unavailable)}async removeListener(s,n){const r=this.listeners[s];if(!r)return;const a=r.indexOf(n);this.listeners[s].splice(a,1),this.listeners[s].length||this.removeWindowListener(this.windowListeners[s])}addWindowListener(s){window.addEventListener(s.windowEventName,s.handler),s.registered=!0}removeWindowListener(s){s&&(window.removeEventListener(s.windowEventName,s.handler),s.registered=!1)}sendRetainedArgumentsForEvent(s){const n=this.retainedEventArguments[s];n&&(delete this.retainedEventArguments[s],n.forEach(r=>{this.notifyListeners(s,r)}))}}const mu=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),fu=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Bp extends Zm{async getCookies(){const s=document.cookie,n={};return s.split(";").forEach(r=>{if(r.length<=0)return;let[a,l]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=fu(a).trim(),l=fu(l).trim(),n[a]=l}),n}async setCookie(s){try{const n=mu(s.key),r=mu(s.value),a=`; expires=${(s.expires||"").replace("expires=","")}`,l=(s.path||"/").replace("path=",""),o=s.url!=null&&s.url.length>0?`domain=${s.url}`:"";document.cookie=`${n}=${r||""}${a}; path=${l}; ${o};`}catch(n){return Promise.reject(n)}}async deleteCookie(s){try{document.cookie=`${s.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const s=document.cookie.split(";")||[];for(const n of s)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(s){return Promise.reject(s)}}async clearAllCookies(){try{await this.clearCookies()}catch(s){return Promise.reject(s)}}}xr("CapacitorCookies",{web:()=>new Bp});const Wp=async e=>new Promise((s,n)=>{const r=new FileReader;r.onload=()=>{const a=r.result;s(a.indexOf(",")>=0?a.split(",")[1]:a)},r.onerror=a=>n(a),r.readAsDataURL(e)}),Up=(e={})=>{const s=Object.keys(e);return Object.keys(e).map(a=>a.toLocaleLowerCase()).reduce((a,l,o)=>(a[l]=e[s[o]],a),{})},Fp=(e,s=!0)=>e?Object.entries(e).reduce((r,a)=>{const[l,o]=a;let i,c;return Array.isArray(o)?(c="",o.forEach(d=>{i=s?encodeURIComponent(d):d,c+=`${l}=${i}&`}),c.slice(0,-1)):(i=s?encodeURIComponent(o):o,c=`${l}=${i}`),`${r}&${c}`},"").substr(1):null,Hp=(e,s={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},s),a=Up(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const l=new URLSearchParams;for(const[o,i]of Object.entries(e.data||{}))l.set(o,i);n.body=l.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const l=new FormData;if(e.data instanceof FormData)e.data.forEach((i,c)=>{l.append(c,i)});else for(const i of Object.keys(e.data))l.append(i,e.data[i]);n.body=l;const o=new Headers(n.headers);o.delete("content-type"),n.headers=o}else(a.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class Gp extends Zm{async request(s){const n=Hp(s,s.webFetchExtra),r=Fp(s.params,s.shouldEncodeUrlParams),a=r?`${s.url}?${r}`:s.url,l=await fetch(a,n),o=l.headers.get("content-type")||"";let{responseType:i="text"}=l.ok?s:{};o.includes("application/json")&&(i="json");let c,d;switch(i){case"arraybuffer":case"blob":d=await l.blob(),c=await Wp(d);break;case"json":c=await l.json();break;case"document":case"text":default:c=await l.text()}const f={};return l.headers.forEach((h,p)=>{f[p]=h}),{data:c,headers:f,status:l.status,url:l.url}}async get(s){return this.request(Object.assign(Object.assign({},s),{method:"GET"}))}async post(s){return this.request(Object.assign(Object.assign({},s),{method:"POST"}))}async put(s){return this.request(Object.assign(Object.assign({},s),{method:"PUT"}))}async patch(s){return this.request(Object.assign(Object.assign({},s),{method:"PATCH"}))}async delete(s){return this.request(Object.assign(Object.assign({},s),{method:"DELETE"}))}}xr("CapacitorHttp",{web:()=>new Gp});const Vp="modulepreload",Zp=function(e,s){return new URL(e,s).href},hu={},ho=function(s,n,r){let a=Promise.resolve();if(n&&n.length>0){const o=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(n.map(d=>{if(d=Zp(d,r),d in hu)return;hu[d]=!0;const f=d.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(!!r)for(let x=o.length-1;x>=0;x--){const y=o[x];if(y.href===d&&(!f||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${h}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":Vp,f||(m.as="script"),m.crossOrigin="",m.href=d,c&&m.setAttribute("nonce",c),document.head.appendChild(m),f)return new Promise((x,y)=>{m.addEventListener("load",x),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function l(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return a.then(o=>{for(const i of o||[])i.status==="rejected"&&l(i.reason);return s().catch(l)})};var On;(function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE"})(On||(On={}));var Kl;(function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"})(Kl||(Kl={}));const Tr=xr("Filesystem",{web:()=>ho(()=>import("./web-DVrVHYKE.js"),[],import.meta.url).then(e=>new e.FilesystemWeb)}),Qi=xr("Share",{web:()=>ho(()=>import("./web-Bp_ANAw_.js"),[],import.meta.url).then(e=>new e.ShareWeb)}),Jp=()=>{const{apiConfig:e,updateApiConfig:s,closeApp:n,availableModels:r,setAvailableModels:a,exportSystem:l,importSystem:o,addToast:i,resetSystem:c,apiPresets:d,addApiPreset:f,removeApiPreset:h,sysOperation:p}=xt(),[m,x]=u.useState(e.apiKey),[y,C]=u.useState(e.baseUrl),[g,b]=u.useState(e.model),[v,w]=u.useState(!1),[z,k]=u.useState(""),[M,j]=u.useState(!1),[H,te]=u.useState(!1),[Ne,Me]=u.useState(!1),[me,F]=u.useState(!1),[se,G]=u.useState(""),[Ee,P]=u.useState(""),Z=u.useRef(null);u.useEffect(()=>{C(e.baseUrl),x(e.apiKey),b(e.model)},[e]);const X=N=>{C(N.config.baseUrl),x(N.config.apiKey),b(N.config.model),i(`: ${N.name}`,"info")},pe=()=>{if(!z.trim()){i("","error");return}f(z,{baseUrl:y,apiKey:m,model:g}),k(""),F(!1),i("","success")},Ce=()=>{s({apiKey:m,baseUrl:y,model:g}),P(""),setTimeout(()=>P(""),2e3)},je=async()=>{if(!y){P(" URL");return}w(!0),P("...");try{const N=y.replace(/\/+$/,""),ne=await fetch(`${N}/models`,{method:"GET",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"}});if(!ne.ok)throw new Error(`Status ${ne.status}`);const we=await ne.json(),D=we.data||we.models||[];if(Array.isArray(D)){const xe=D.map(A=>A.id||A);a(xe),xe.length>0&&!xe.includes(g)&&b(xe[0]),P(` ${xe.length} `),j(!0)}else P("")}catch(N){console.error(N),P("")}finally{w(!1)}},Pe=async N=>{try{const ne=await l(N);if(tn.isNativePlatform()){const we=new FileReader;we.readAsDataURL(ne),we.onloadend=async()=>{const D=String(we.result),xe=`Sully_Backup_${N}_${Date.now()}.zip`;try{await Tr.writeFile({path:xe,data:D,directory:On.Cache});const A=await Tr.getUri({directory:On.Cache,path:xe});await Qi.share({title:"Sully Backup",files:[A.uri]})}catch(A){console.error("Native write failed",A),i("","error")}}}else{const we=URL.createObjectURL(ne);G(we),te(!0);const D=document.createElement("a");D.href=we,D.download=`Sully_Backup_${N}_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(D),D.click(),document.body.removeChild(D)}}catch(ne){i(ne.message,"error")}},ge=N=>{var we;const ne=(we=N.target.files)==null?void 0:we[0];ne&&(o(ne).catch(D=>{console.error(D),i(D.message||"","error")}),Z.current&&(Z.current.value=""))},ce=()=>{c(),Me(!1)};return t.jsxs("div",{className:"h-full w-full bg-slate-50/50 flex flex-col font-light relative",children:[p.status==="processing"&&t.jsx("div",{className:"absolute inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center animate-fade-in",children:t.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-2xl flex flex-col items-center gap-4 w-64",children:[t.jsx("div",{className:"w-12 h-12 border-4 border-slate-200 border-t-primary rounded-full animate-spin"}),t.jsx("div",{className:"text-sm font-bold text-slate-700",children:p.message}),p.progress>0&&t.jsx("div",{className:"w-full h-2 bg-slate-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${p.progress}%`}})})]})}),t.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:t.jsxs("div",{className:"flex items-center gap-2 w-full",children:[t.jsx("button",{onClick:n,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 no-scrollbar pb-20",children:[t.jsxs("section",{className:"bg-white/60 backdrop-blur-sm rounded-3xl p-5 shadow-sm border border-white/50",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-xl text-blue-600",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"})})}),t.jsx("h2",{className:"text-sm font-semibold text-slate-600 tracking-wider",children:" (ZIP)"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[t.jsxs("button",{onClick:()=>Pe("text_only"),className:"py-4 bg-white border border-slate-200 rounded-xl text-xs font-bold text-slate-600 shadow-sm active:scale-95 transition-all flex flex-col items-center gap-2 relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 px-1.5 py-0.5 bg-blue-100 text-[9px] text-blue-600 rounded-bl-lg font-bold",children:""}),t.jsx("div",{className:"p-2 bg-blue-50 rounded-full text-blue-500",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}),t.jsx("span",{children:""})]}),t.jsxs("button",{onClick:()=>Pe("media_only"),className:"py-4 bg-white border border-slate-200 rounded-xl text-xs font-bold text-slate-600 shadow-sm active:scale-95 transition-all flex flex-col items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-pink-50 rounded-full text-pink-500",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})})}),t.jsx("span",{children:""})]}),t.jsxs("button",{onClick:()=>Pe("theme_only"),className:"py-4 bg-white border border-slate-200 rounded-xl text-xs font-bold text-slate-600 shadow-sm active:scale-95 transition-all flex flex-col items-center gap-2 col-span-2",children:[t.jsx("div",{className:"p-2 bg-purple-50 rounded-full text-purple-500",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.435-.435 1.133-.435 1.567 0l3.712 3.712c.435.435.435 1.133 0 1.567l-2.88 2.88M10.5 8.197V15.75"})})}),t.jsx("span",{children:"/"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3 mb-4",children:[t.jsxs("div",{onClick:()=>{var N;return(N=Z.current)==null?void 0:N.click()},className:"py-4 bg-white border border-slate-200 rounded-xl text-xs font-bold text-slate-600 shadow-sm active:scale-95 transition-all flex flex-col items-center gap-2 cursor-pointer hover:bg-emerald-50 hover:border-emerald-200",children:[t.jsx("div",{className:"p-2 bg-emerald-100 rounded-full text-emerald-600",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),t.jsx("span",{children:" (.zip / .json)"})]}),t.jsx("input",{type:"file",ref:Z,className:"hidden",accept:".json,.zip",onChange:ge})]}),t.jsxs("p",{className:"text-[10px] text-slate-400 px-1 mb-4 leading-relaxed",children:[" ",t.jsx("b",{children:""}),": ",t.jsx("br",{})," ",t.jsx("b",{children:""}),": ",t.jsx("br",{})," ",t.jsx("b",{children:""}),": ",t.jsx("br",{}),"  JSON "]}),t.jsx("button",{onClick:()=>Me(!0),className:"w-full py-3 bg-red-50 border border-red-100 text-red-500 rounded-xl text-xs font-bold flex items-center justify-center gap-2",children:" ()"})]}),t.jsxs("section",{className:"bg-white/60 backdrop-blur-sm rounded-3xl p-5 shadow-sm border border-white/50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"p-2 bg-emerald-100/50 rounded-xl text-emerald-600",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})})}),t.jsx("h2",{className:"text-sm font-semibold text-slate-600 tracking-wider",children:"API "})]}),t.jsx("button",{onClick:()=>F(!0),className:"text-[10px] bg-slate-100 text-slate-600 px-3 py-1.5 rounded-full font-bold shadow-sm active:scale-95 transition-transform",children:""})]}),d.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block pl-1",children:" (Presets)"}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:d.map(N=>t.jsxs("div",{className:"flex items-center bg-white border border-slate-200 rounded-lg pl-3 pr-1 py-1 shadow-sm",children:[t.jsx("span",{onClick:()=>X(N),className:"text-xs font-medium text-slate-600 cursor-pointer hover:text-primary mr-2",children:N.name}),t.jsx("button",{onClick:()=>h(N.id),className:"p-1 rounded-full text-slate-300 hover:bg-red-50 hover:text-red-400 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:t.jsx("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})})})]},N.id))})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"group",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block pl-1",children:"URL"}),t.jsx("input",{type:"text",value:y,onChange:N=>C(N.target.value),placeholder:"https://...",className:"w-full bg-white/50 border border-slate-200/60 rounded-xl px-4 py-2.5 text-sm font-mono focus:bg-white transition-all"})]}),t.jsxs("div",{className:"group",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block pl-1",children:"Key"}),t.jsx("input",{type:"password",value:m,onChange:N=>x(N.target.value),placeholder:"sk-...",className:"w-full bg-white/50 border border-slate-200/60 rounded-xl px-4 py-2.5 text-sm font-mono focus:bg-white transition-all"})]}),t.jsxs("div",{className:"pt-2",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1.5 pl-1",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Model"}),t.jsx("button",{onClick:je,disabled:v,className:"text-[10px] text-primary font-bold",children:v?"Fetching...":""})]}),t.jsxs("button",{onClick:()=>j(!0),className:"w-full bg-white/50 border border-slate-200/60 rounded-xl px-4 py-3 text-sm text-slate-700 flex justify-between items-center active:bg-white transition-all shadow-sm",children:[t.jsx("span",{className:"truncate font-mono",children:g||"Select Model..."}),t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4 text-slate-400",children:t.jsx("path",{fillRule:"evenodd",d:"M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})})]})]}),t.jsx("button",{onClick:Ce,className:"w-full py-3 rounded-2xl font-bold text-white shadow-lg shadow-primary/20 bg-primary active:scale-95 transition-all mt-2",children:Ee||""})]})]}),t.jsx("div",{className:"text-center text-[10px] text-slate-300 pb-8 font-mono tracking-widest uppercase",children:"v2.1 (Multi-Mode Backup)"})]}),t.jsx(Ze,{isOpen:M,title:"",onClose:()=>j(!1),children:t.jsx("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-2 p-1",children:r.length>0?r.map(N=>t.jsxs("button",{onClick:()=>{b(N),j(!1)},className:`w-full text-left px-4 py-3 rounded-xl text-sm font-mono flex justify-between items-center ${N===g?"bg-primary/10 text-primary font-bold ring-1 ring-primary/20":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[t.jsx("span",{className:"truncate",children:N}),N===g&&t.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]},N)):t.jsx("div",{className:"text-center text-slate-400 py-8 text-xs",children:""})})}),t.jsx(Ze,{isOpen:me,title:"",onClose:()=>F(!1),footer:t.jsx("button",{onClick:pe,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:" (: DeepSeek)"}),t.jsx("input",{value:z,onChange:N=>k(N.target.value),className:"w-full bg-slate-100 rounded-xl px-4 py-3 text-sm focus:outline-primary",autoFocus:!0,placeholder:"Name..."})]})}),t.jsx(Ze,{isOpen:H,title:"",onClose:()=>te(!1),footer:t.jsx("div",{className:"flex gap-2 w-full",children:t.jsx("button",{onClick:()=>te(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""})}),children:t.jsxs("div",{className:"space-y-4 text-center py-4",children:[t.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-2",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-8 h-8",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),t.jsx("p",{className:"text-sm font-bold text-slate-700",children:""}),t.jsx("p",{className:"text-xs text-slate-500",children:""}),se&&t.jsx("a",{href:se,download:"Sully_Backup.zip",className:"text-primary text-sm underline block py-2",children:" .zip"})]})}),t.jsx(Ze,{isOpen:Ne,title:"",onClose:()=>Me(!1),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>Me(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),t.jsx("button",{onClick:ce,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:t.jsxs("div",{className:"flex flex-col items-center gap-3 py-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 text-red-500",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})}),t.jsxs("p",{className:"text-center text-sm text-slate-600 font-medium",children:["",t.jsx("span",{className:"text-red-500 font-bold",children:""}),""]})]})})]})},ls=(e,s)=>new Promise((n,r)=>{if(!e.type.startsWith("image/")){r(new Error(""));return}if(s!=null&&s.skipCompression){const l=new FileReader;l.readAsDataURL(e),l.onload=o=>{var i;return n((i=o.target)==null?void 0:i.result)},l.onerror=o=>r(new Error(""));return}if(e.type==="image/gif"){if(e.size>50*1024*1024){r(new Error("GIF (>50MB)"));return}const l=new FileReader;l.readAsDataURL(e),l.onload=o=>{var i;return n((i=o.target)==null?void 0:i.result)},l.onerror=o=>r(o);return}const a=new FileReader;a.readAsDataURL(e),a.onload=l=>{var i;const o=new Image;o.src=(i=l.target)==null?void 0:i.result,o.onload=()=>{const c=(s==null?void 0:s.maxWidth)||1200,d=c;let f=o.width,h=o.height;f>h?f>c&&(h*=c/f,f=c):h>d&&(f*=d/h,h=d);const p=document.createElement("canvas");p.width=f,p.height=h;const m=p.getContext("2d");if(!m){r(new Error("Canvas context error"));return}m.clearRect(0,0,f,h),m.drawImage(o,0,0,f,h);let x="image/jpeg";!(s!=null&&s.forceJpeg)&&(e.type==="image/png"||e.type==="image/webp")&&(x=e.type);const y=(s==null?void 0:s.quality)||.85,C=p.toDataURL(x,y);n(C)},o.onerror=c=>r(new Error(""))},a.onerror=l=>r(new Error(""))}),Et={buildCoreContext:(e,s,n=!0)=>{let r=`[System: Roleplay Configuration]

`;if(r+=`###  (Character)
`,r+=`- : ${e.name}
`,r+=`- / (User Note/Nickname): ${e.description||""}
`,r+=`  (: )
`,r+=`- /:
${e.systemPrompt||"AI"}

`,e.worldview&&e.worldview.trim()&&(r+=`###  (World Settings)
${e.worldview}

`),e.mountedWorldbooks&&e.mountedWorldbooks.length>0){r+=`###  (Worldbooks)
`;const l={};e.mountedWorldbooks.forEach(o=>{const i=o.category||" (General)";l[i]||(l[i]=[]),l[i].push(o)}),Object.entries(l).forEach(([o,i])=>{r+=`#### [${o}]
`,i.forEach(c=>{r+=`**Title: ${c.title}**
${c.content}
---
`}),r+=`
`})}if(r+=`###  (User)
`,r+=`- : ${s.name}
`,r+=`- /: ${s.bio||""}

`,e.impression){const l=e.impression;r+=`### [: ${s.name}] (Private Impression)
`,r+=`(TA)
`,r+=`- : ${l.personality_core.summary}
`,r+=`- : ${l.personality_core.interaction_style}
`,r+=`- : ${l.personality_core.observed_traits.join(", ")}
`,r+=`- TA: ${l.value_map.likes.join(", ")}
`,r+=`- : ${l.emotion_schema.triggers.negative.join(", ")}
`,r+=`- : ${l.emotion_schema.comfort_zone}
`,r+=`- : ${l.observed_changes?l.observed_changes.join("; "):""}

`}r+=`###  (Memory Bank)
`;let a="";if(e.refinedMemories&&Object.keys(e.refinedMemories).length>0&&(a+=`** (Key Memories)**:
`,Object.entries(e.refinedMemories).sort().forEach(([l,o])=>{a+=`- [${l}]: ${o}
`})),n&&e.activeMemoryMonths&&e.activeMemoryMonths.length>0&&e.memories){let l="";e.activeMemoryMonths.forEach(o=>{const i=e.memories.filter(c=>{let d=c.date.replace(/[\/]/g,"-").replace("","");const f=d.split("-");if(f.length>=2){const h=f[0],p=f[1].padStart(2,"0");d=`${h}-${p}`}return d.startsWith(o)});i.length>0&&(l+=`
>  [${o}]:
`,i.forEach(c=>{l+=`  - ${c.date} (${c.mood||"rec"}): ${c.summary}
`}))}),l&&(a+=`
** (Active Recall)**:${l}`)}return a||(a="()"),r+=`${a}

`,r}},Zo=({title:e,tags:s,color:n,onRemove:r})=>t.jsxs("div",{className:"mb-4",children:[t.jsxs("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[t.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${n}`})," ",e]}),t.jsx("div",{className:"flex flex-wrap gap-2",children:s.length>0?s.map((a,l)=>t.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-white border border-slate-100 text-xs text-slate-600 shadow-sm",children:[a,r&&t.jsx("button",{onClick:()=>r(a),className:"ml-1.5 text-slate-300 hover:text-red-400",children:""})]},l)):t.jsx("span",{className:"text-xs text-slate-300 italic",children:""})})]}),Kp=({title:e,content:s,icon:n})=>t.jsxs("div",{className:"bg-white/60 p-4 rounded-2xl border border-white/60 shadow-sm relative overflow-hidden group",children:[t.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110 duration-500 text-slate-800",children:n}),t.jsx("h4",{className:"text-xs font-bold text-slate-500 mb-2 flex items-center gap-2 relative z-10",children:e}),t.jsx("p",{className:"text-sm text-slate-700 leading-relaxed text-justify relative z-10 whitespace-pre-wrap",children:s||"..."})]}),dl=({labelLeft:e,labelRight:s,value:n,color:r})=>t.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-slate-500 w-full",children:[t.jsx("span",{className:`w-4 text-center ${n<50?r:"opacity-50"}`,children:e}),t.jsx("div",{className:"flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden relative",children:t.jsx("div",{className:`absolute top-0 bottom-0 w-1.5 rounded-full ${r} transition-all duration-1000`,style:{left:`${n}%`,transform:"translateX(-50%)"}})}),t.jsx("span",{className:`w-4 text-center ${n>50?r:"opacity-50"}`,children:s})]}),Yp=({impression:e,isGenerating:s,onGenerate:n,onUpdateImpression:r})=>{const a=(l,o)=>{if(!e)return;const i=JSON.parse(JSON.stringify(e));let c=i;for(let f=0;f<l.length-1;f++)c=c[l[f]];const d=l[l.length-1];Array.isArray(c[d])&&(c[d]=c[d].filter(f=>f!==o),r(i))};return!e&&!s?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 space-y-6",children:[t.jsx("div",{className:"w-24 h-24 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-200",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",className:"w-12 h-12",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"})})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-slate-700",children:""}),t.jsx("p",{className:"text-sm text-slate-400 mt-2 max-w-xs mx-auto",children:" AI  TA "})]}),t.jsx("button",{onClick:()=>n("initial"),className:"px-8 py-3 bg-indigo-600 text-white rounded-full font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 active:scale-95 transition-all",children:""})]}):s?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full space-y-4",children:[t.jsxs("div",{className:"relative w-20 h-20",children:[t.jsx("div",{className:"absolute inset-0 border-4 border-slate-100 rounded-full"}),t.jsx("div",{className:"absolute inset-0 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})]}),t.jsx("p",{className:"text-sm text-slate-500 font-medium animate-pulse",children:"..."}),t.jsx("p",{className:"text-xs text-slate-400",children:" / "})]}):t.jsxs("div",{className:"space-y-6 animate-fade-in pb-10",children:[t.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-2xl border border-slate-100 shadow-sm",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"text-[10px] text-slate-400 uppercase tracking-widest font-bold",children:["Version ",e==null?void 0:e.version.toFixed(1)]}),t.jsxs("div",{className:"text-xs text-slate-600",children:[": ",new Date((e==null?void 0:e.lastUpdated)||Date.now()).toLocaleDateString()]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>n("initial"),className:"px-3 py-1.5 text-xs font-bold text-slate-400 bg-slate-50 rounded-lg hover:bg-slate-100",children:""}),t.jsx("button",{onClick:()=>n("update"),className:"px-4 py-1.5 text-xs font-bold text-white bg-indigo-500 rounded-lg shadow-md shadow-indigo-200 hover:bg-indigo-600 active:scale-95 transition-all",children:"/"})]})]}),t.jsxs("div",{className:"relative bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl p-6 text-white shadow-lg overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/10 rounded-full blur-2xl"}),t.jsx("h3",{className:"text-xs font-bold text-white/60 uppercase tracking-widest mb-3",children:" (Core Summary)"}),t.jsxs("p",{className:"text-lg font-light leading-relaxed italic opacity-95",children:['"',e==null?void 0:e.personality_core.summary,'"']}),t.jsxs("div",{className:"mt-6 pt-4 border-t border-white/20 grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-white/60 uppercase mb-1",children:""}),t.jsx("div",{className:"text-sm font-medium",children:e==null?void 0:e.personality_core.interaction_style})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] text-white/60 uppercase mb-1",children:""}),t.jsx("div",{className:"text-sm font-medium",children:e==null?void 0:e.behavior_profile.tone_style})]})]})]}),(e==null?void 0:e.mbti_analysis)&&t.jsxs("div",{className:"bg-white rounded-3xl p-6 border border-slate-100 shadow-sm relative overflow-hidden",children:[t.jsx("div",{className:"absolute -right-6 -top-6 w-24 h-24 bg-teal-50 rounded-full blur-xl pointer-events-none"}),t.jsxs("div",{className:"flex justify-between items-start mb-4 relative z-10",children:[t.jsxs("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[t.jsx("span",{className:"text-teal-500 text-lg",children:""})," MBTI "]}),t.jsx("span",{className:"text-2xl font-black text-slate-800 tracking-tighter bg-teal-100/50 px-2 rounded-lg text-teal-700",children:e.mbti_analysis.type})]}),t.jsxs("div",{className:"space-y-3 mb-5",children:[t.jsx(dl,{labelLeft:"E",labelRight:"I",value:e.mbti_analysis.dimensions.e_i,color:"text-teal-500 bg-teal-500"}),t.jsx(dl,{labelLeft:"S",labelRight:"N",value:e.mbti_analysis.dimensions.s_n,color:"text-teal-500 bg-teal-500"}),t.jsx(dl,{labelLeft:"T",labelRight:"F",value:e.mbti_analysis.dimensions.t_f,color:"text-teal-500 bg-teal-500"}),t.jsx(dl,{labelLeft:"J",labelRight:"P",value:e.mbti_analysis.dimensions.j_p,color:"text-teal-500 bg-teal-500"})]}),t.jsx("div",{className:"bg-slate-50 p-3 rounded-xl",children:t.jsxs("p",{className:"text-xs text-slate-600 leading-relaxed italic",children:['"',e.mbti_analysis.reasoning,'"']})})]}),t.jsxs("div",{className:"bg-white rounded-3xl p-6 border border-slate-100 shadow-sm",children:[t.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-6 flex items-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4a1 1 0 001.414 0l4-4a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})," (Value Map)"]}),t.jsx(Zo,{title:" (Traits)",tags:(e==null?void 0:e.personality_core.observed_traits)||[],color:"bg-blue-400",onRemove:l=>a(["personality_core","observed_traits"],l)}),t.jsx(Zo,{title:"TA  (Likes)",tags:(e==null?void 0:e.value_map.likes)||[],color:"bg-pink-400",onRemove:l=>a(["value_map","likes"],l)}),t.jsx(Zo,{title:"TA  (Dislikes)",tags:(e==null?void 0:e.value_map.dislikes)||[],color:"bg-slate-400",onRemove:l=>a(["value_map","dislikes"],l)}),t.jsxs("div",{className:"mt-4 p-4 bg-slate-50 rounded-xl",children:[t.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:""}),t.jsx("p",{className:"text-sm text-slate-600",children:e==null?void 0:e.value_map.core_values})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[t.jsx(Kp,{title:" (Emotion)",content:(e==null?void 0:e.behavior_profile.emotion_summary)||"",icon:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsx("div",{className:"bg-white rounded-2xl p-5 border border-slate-100 shadow-sm",children:t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] font-bold text-green-500 uppercase tracking-widest mb-2",children:" "}),t.jsx("ul",{className:"list-disc list-inside text-xs text-slate-600 space-y-1",children:e==null?void 0:e.emotion_schema.triggers.positive.map((l,o)=>t.jsx("li",{children:l},o))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[10px] font-bold text-red-400 uppercase tracking-widest mb-2",children:" /"}),t.jsx("ul",{className:"list-disc list-inside text-xs text-slate-600 space-y-1",children:e==null?void 0:e.emotion_schema.triggers.negative.map((l,o)=>t.jsx("li",{children:l},o))})]})]})}),t.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-100 shadow-sm",children:[t.jsx("div",{className:"text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-2",children:" (Comfort Zone)"}),t.jsx("p",{className:"text-sm text-slate-600",children:e==null?void 0:e.emotion_schema.comfort_zone})]})]}),(e==null?void 0:e.observed_changes)&&e.observed_changes.length>0&&t.jsxs("div",{className:"bg-amber-50 p-4 rounded-2xl border border-amber-100",children:[t.jsx("h4",{className:"text-[10px] font-bold text-amber-500 uppercase tracking-widest mb-2",children:""}),t.jsx("ul",{className:"space-y-2",children:e.observed_changes.map((l,o)=>t.jsxs("li",{className:"text-xs text-amber-900 flex items-start gap-2",children:[t.jsx("span",{className:"mt-1 w-1.5 h-1.5 rounded-full bg-amber-400 shrink-0"}),t.jsx("span",{className:"opacity-90",children:l})]},o))})]})]})},Qp=({memories:e,refinedMemories:s,activeMemoryMonths:n,onRefine:r,onDeleteMemories:a,onUpdateMemory:l,onToggleActiveMonth:o,onUpdateRefinedMemory:i,onDeleteRefinedMemory:c})=>{const[d,f]=u.useState({level:"root",selectedYear:null,selectedMonth:null}),[h,p]=u.useState(!1),[m,x]=u.useState(!1),[y,C]=u.useState(new Set),[g,b]=u.useState(null),[v,w]=u.useState(!1),[z,k]=u.useState(null),[M,j]=u.useState(!1),H=u.useRef(null),{tree:te,stats:Ne}=u.useMemo(()=>{const ce={};let N=0;const ne=Array.isArray(e)?e:[];ne.forEach(D=>{N+=D.summary.length;let xe="",A="";const le=D.date.match(/(\d{4})[-/](\d{1,2})/);le?(xe=le[1],A=le[2].padStart(2,"0")):D.date.includes("unknown")&&(xe=""),ce[xe]||(ce[xe]={}),ce[xe][A]||(ce[xe][A]=[]),ce[xe][A].push(D)});const we={};return Object.keys(ce).sort((D,xe)=>xe.localeCompare(D)).forEach(D=>{we[D]={},Object.keys(ce[D]).sort((xe,A)=>A.localeCompare(xe)).forEach(xe=>{we[D][xe]=ce[D][xe].sort((A,le)=>le.date.localeCompare(A.date))})}),{tree:we,stats:{totalChars:N,count:ne.length}}},[e]),Me=ce=>f({level:"year",selectedYear:ce,selectedMonth:null}),me=ce=>f(N=>({...N,level:"month",selectedMonth:ce})),F=()=>{d.level==="month"?f(ce=>({...ce,level:"year",selectedMonth:null})):d.level==="year"&&f({level:"root",selectedYear:null,selectedMonth:null})},se=async()=>{if(!d.selectedYear||!d.selectedMonth)return;p(!0);const N=te[d.selectedYear][d.selectedMonth].map(ne=>`${ne.date}: ${ne.summary} (${ne.mood||""})`).join(`
`);try{await r(d.selectedYear,d.selectedMonth,N)}finally{p(!1)}},G=ce=>{const N=new Set(y);N.has(ce)?N.delete(ce):N.add(ce),C(N)},Ee=()=>{y.size>0&&w(!0)},P=()=>{a(Array.from(y)),C(new Set),x(!1),w(!1)},Z=ce=>{if(!d.selectedYear||!d.selectedMonth)return;const N=d.selectedYear,ne=d.selectedMonth;H.current=setTimeout(()=>{k({year:N,month:ne,content:ce})},600)},X=()=>{H.current&&(clearTimeout(H.current),H.current=null)},pe=()=>{z&&(i(z.year,z.month,z.content),k(null))},Ce=()=>{z&&(c(z.year,z.month),k(null),j(!1))};if(!e||e.length===0)return t.jsx("div",{className:"flex flex-col items-center justify-center h-48 text-slate-400",children:t.jsx("p",{className:"text-xs",children:""})});const je=()=>t.jsx("div",{className:"grid grid-cols-2 gap-3 animate-fade-in",children:Object.keys(te).map(ce=>t.jsxs("div",{onClick:()=>Me(ce),className:"bg-white/60 backdrop-blur-sm p-4 rounded-2xl border border-white/50 shadow-sm active:scale-95 transition-all flex flex-col justify-between h-28 group cursor-pointer hover:bg-white/80",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx("div",{className:"p-2 bg-amber-100/50 rounded-lg text-amber-600",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})})}),t.jsxs("span",{className:"text-[10px] bg-slate-100 px-2 py-1 rounded-full text-slate-500 font-mono",children:[Object.values(te[ce]).reduce((N,ne)=>N+ne.length,0),""]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-light text-slate-800 tracking-tight",children:ce}),t.jsx("p",{className:"text-[10px] text-slate-400",children:""})]})]},ce))}),Pe=()=>d.selectedYear&&te[d.selectedYear]&&t.jsx("div",{className:"grid grid-cols-3 gap-3 animate-fade-in",children:Object.keys(te[d.selectedYear]).map(ce=>{const N=`${d.selectedYear}-${ce}`,ne=n.includes(N);return t.jsxs("div",{className:"relative group",children:[t.jsxs("div",{onClick:()=>me(ce),className:"bg-white/50 backdrop-blur-sm p-3 rounded-2xl border border-white/40 shadow-sm active:scale-95 transition-all flex flex-col justify-center items-center gap-2 aspect-square cursor-pointer hover:bg-white/70 relative overflow-hidden",children:[(s==null?void 0:s[N])&&t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 bg-indigo-500 rounded-bl-lg shadow-sm"}),t.jsxs("span",{className:"text-2xl font-light text-slate-700",children:[parseInt(ce),t.jsx("span",{className:"text-xs ml-0.5 text-slate-400",children:""})]}),t.jsx("div",{className:"h-0.5 w-4 bg-primary/30 rounded-full"}),t.jsxs("span",{className:"text-[10px] text-slate-400",children:[te[d.selectedYear][ce].length," "]})]}),t.jsx("button",{onClick:we=>{we.stopPropagation(),o(d.selectedYear,ce)},className:`absolute -top-2 -right-2 p-1.5 rounded-full shadow-md z-10 transition-colors ${ne?"bg-primary text-white":"bg-white text-slate-300 border border-slate-100"}`,children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:[t.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),t.jsx("path",{fillRule:"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z",clipRule:"evenodd"})]})})]},ce)})}),ge=()=>{var xe;if(!d.selectedYear||!d.selectedMonth)return null;const ce=`${d.selectedYear}-${d.selectedMonth}`,N=s==null?void 0:s[ce],ne=((xe=te[d.selectedYear])==null?void 0:xe[d.selectedMonth])||[],we=n.includes(ce),D={};return ne.forEach(A=>{D[A.date]||(D[A.date]=[]),D[A.date].push(A)}),ne.length===0?t.jsx("div",{className:"flex flex-col items-center justify-center h-32 text-slate-300",children:t.jsx("p",{className:"text-xs",children:""})}):t.jsxs("div",{className:"space-y-6 animate-fade-in pb-8",children:[t.jsxs("div",{className:"bg-indigo-50/50 rounded-2xl p-4 border border-indigo-100 relative group",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-indigo-700",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:t.jsx("path",{fillRule:"evenodd",d:"M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .914-.143Z",clipRule:"evenodd"})}),t.jsx("h4",{className:"text-xs font-bold tracking-wide uppercase",children:" (AI Context)"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>o(d.selectedYear,d.selectedMonth),className:`text-[10px] px-3 py-1 rounded-full border shadow-sm transition-colors flex items-center gap-1 ${we?"bg-primary text-white border-primary":"bg-white text-slate-500 border-slate-200"}`,children:we?" (Active)":" (Default)"}),t.jsx("button",{onClick:se,disabled:h,className:"text-[10px] bg-white text-indigo-600 px-3 py-1 rounded-full border border-indigo-200 shadow-sm hover:bg-indigo-500 hover:text-white transition-colors flex items-center gap-1",children:h?"...":N?"":""})]})]}),N&&t.jsx("div",{className:"text-sm text-indigo-900 leading-relaxed bg-white/60 p-3 rounded-xl border border-indigo-50 cursor-pointer active:scale-[0.99] transition-transform select-none",onTouchStart:()=>Z(N),onTouchEnd:X,onMouseDown:()=>Z(N),onMouseUp:X,onMouseLeave:X,onContextMenu:A=>{A.preventDefault(),k({year:d.selectedYear,month:d.selectedMonth,content:N})},title:"/",children:N})]}),t.jsxs("div",{className:"flex items-center justify-between px-1",children:[t.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Time Logs"}),t.jsxs("div",{className:"flex gap-2",children:[m&&y.size>0&&t.jsxs("button",{onClick:A=>{A.stopPropagation(),Ee()},className:"text-[10px] bg-red-500 text-white px-3 py-1 rounded-full font-bold shadow-sm active:scale-95 transition-transform",children:[" (",y.size,")"]}),t.jsx("button",{onClick:()=>{x(!m),C(new Set)},className:`text-[10px] px-3 py-1 rounded-full border transition-colors ${m?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:m?"":""})]})]}),t.jsx("div",{className:"mt-2 pl-2",children:Object.entries(D).map(([A,le])=>t.jsxs("div",{className:"relative pl-8 pb-8 last:pb-0 border-l-[2px] border-slate-100 last:border-l-0 last:border-image-source-none",children:[t.jsx("div",{className:"absolute left-[-2px] top-0 bottom-0 w-[2px] bg-slate-100"}),t.jsx("div",{className:"absolute left-[-7px] top-0 w-3.5 h-3.5 bg-slate-300 rounded-full border-4 border-slate-50 z-10"}),t.jsxs("div",{className:"mb-3 -mt-1.5 flex items-center gap-2",children:[t.jsx("span",{className:"text-xs font-bold text-slate-500 font-mono tracking-tight",children:A}),le.length>1&&t.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 bg-slate-100 rounded-md text-slate-400 font-normal",children:[le.length," "]})]}),t.jsx("div",{className:"space-y-3",children:le.map(re=>t.jsxs("div",{className:`relative group transition-all duration-300 ${m?"cursor-pointer":""}`,onClick:()=>{m&&G(re.id)},children:[m&&t.jsx("div",{className:`absolute -left-[38px] top-1/2 -translate-y-1/2 w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors z-20 ${y.has(re.id)?"bg-primary border-primary":"bg-white border-slate-300"}`,children:y.has(re.id)&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),t.jsxs("div",{className:`bg-white p-4 rounded-xl rounded-tl-none border border-slate-100 shadow-sm hover:shadow-md hover:border-primary/20 transition-all relative ${m&&y.has(re.id)?"ring-2 ring-primary ring-offset-2":""}`,children:[!m&&t.jsx("button",{onClick:$e=>{$e.stopPropagation(),b(re)},className:"absolute top-2 right-2 p-1.5 text-slate-300 hover:text-primary bg-transparent hover:bg-slate-50 rounded-full transition-colors z-10",title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})}),re.mood&&t.jsx("div",{className:"mb-1 pr-6",children:t.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-primary/5 text-primary rounded-md font-medium",children:["#",re.mood]})}),t.jsx("p",{className:"text-sm text-slate-700 leading-relaxed text-justify whitespace-pre-wrap",children:re.summary})]})]},re.id))})]},A))})]})};return t.jsxs("div",{className:"flex flex-col h-full relative",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6 px-1",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{children:[t.jsx("span",{className:"block text-[10px] text-slate-400 uppercase tracking-widest",children:""}),t.jsx("span",{className:"text-lg font-medium text-slate-700 font-mono",children:Ne.totalChars.toLocaleString()})]}),t.jsxs("div",{children:[t.jsx("span",{className:"block text-[10px] text-slate-400 uppercase tracking-widest",children:""}),t.jsx("span",{className:"text-lg font-medium text-slate-700 font-mono",children:Ne.count})]})]}),t.jsx("div",{className:"flex items-center gap-1 text-xs font-medium text-slate-500 bg-white/50 px-3 py-1.5 rounded-full border border-white/50 shadow-sm",children:d.level==="root"?t.jsx("span",{children:""}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>f({level:"root",selectedYear:null,selectedMonth:null}),className:"hover:text-primary",children:""}),t.jsx("span",{className:"text-slate-300",children:"/"}),d.level==="year"?t.jsx("span",{className:"text-slate-800",children:d.selectedYear}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>f(ce=>({...ce,level:"year",selectedMonth:null})),className:"hover:text-primary",children:d.selectedYear}),t.jsx("span",{className:"text-slate-300",children:"/"}),t.jsxs("span",{className:"text-slate-800",children:[parseInt(d.selectedMonth),""]})]})]})})]}),d.level==="root"&&je(),d.level==="year"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[t.jsx("button",{onClick:F,className:"p-1.5 bg-white rounded-full text-slate-400 hover:text-slate-600 shadow-sm",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:t.jsx("path",{fillRule:"evenodd",d:"M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z",clipRule:"evenodd"})})}),t.jsx("h3",{className:"text-sm font-medium text-slate-600",children:""})]}),Pe()]}),d.level==="month"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[t.jsx("button",{onClick:F,className:"p-1.5 bg-white rounded-full text-slate-400 hover:text-slate-600 shadow-sm",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:t.jsx("path",{fillRule:"evenodd",d:"M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z",clipRule:"evenodd"})})}),t.jsx("h3",{className:"text-sm font-medium text-slate-600",children:" (  )"})]}),ge()]}),t.jsx(Ze,{isOpen:!!g,title:"",onClose:()=>b(null),footer:t.jsx("button",{onClick:()=>{g&&l(g.id,g.summary),b(null)},className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:g&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"text-xs text-slate-400",children:[": ",g.date]}),t.jsx("textarea",{value:g.summary,onChange:ce=>b({...g,summary:ce.target.value}),className:"w-full h-40 bg-slate-100 rounded-xl p-3 text-sm resize-none focus:outline-primary"})]})}),t.jsx(Ze,{isOpen:v,title:"",onClose:()=>w(!1),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>w(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),t.jsx("button",{onClick:P,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:t.jsxs("p",{className:"text-sm text-slate-600 text-center py-4",children:[" ",y.size," ",t.jsx("br",{}),t.jsx("span",{className:"text-xs text-red-400 mt-1 block",children:""})]})}),t.jsx(Ze,{isOpen:!!z,title:"",onClose:()=>k(null),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>j(!0),className:"flex-1 py-3 bg-red-50 text-red-500 font-bold rounded-2xl",children:""}),t.jsx("button",{onClick:pe,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl shadow-lg",children:""})]}),children:z&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"text-xs text-slate-400",children:[z.year,"",z.month,""]}),t.jsx("textarea",{value:z.content,onChange:ce=>k({...z,content:ce.target.value}),className:"w-full h-48 bg-slate-100 rounded-xl p-3 text-sm resize-none focus:outline-primary leading-relaxed"})]})}),t.jsx(Ze,{isOpen:M,title:"",onClose:()=>j(!1),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-3 bg-slate-100 font-bold rounded-2xl",children:""}),t.jsx("button",{onClick:Ce,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:""})]}),children:t.jsxs("p",{className:"text-center text-sm text-slate-600 py-4",children:["",t.jsx("br",{}),t.jsx("span",{className:"text-xs text-red-400",children:" AI "})]})})]})},qp=({char:e,onClick:s,onDelete:n})=>t.jsxs("div",{onClick:s,className:"relative p-4 rounded-3xl border bg-white/40 border-white/40 hover:bg-white/60 hover:scale-[1.01] transition-all duration-300 cursor-pointer group shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"w-14 h-14 rounded-full bg-slate-100 border border-white/50 overflow-hidden relative shadow-inner",children:[t.jsx("div",{className:"absolute inset-0 bg-slate-100/50"}),t.jsx("img",{src:e.avatar,className:"w-full h-full object-cover relative z-10",alt:e.name})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-medium truncate text-slate-700",children:e.name}),t.jsx("p",{className:"text-xs text-slate-400 truncate mt-0.5 font-light",children:e.description||""})]})]}),t.jsx("button",{onClick:n,className:"absolute top-3 right-3 p-2 rounded-full text-slate-300 hover:bg-red-50 hover:text-red-400 active:bg-red-100 active:text-red-500 transition-all z-10",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]}),Xp=()=>{const{closeApp:e,openApp:s,characters:n,activeCharacterId:r,setActiveCharacterId:a,addCharacter:l,updateCharacter:o,deleteCharacter:i,apiConfig:c,addToast:d,userProfile:f,customThemes:h,addCustomTheme:p,worldbooks:m}=xt(),[x,y]=u.useState("list"),[C,g]=u.useState("identity"),[b,v]=u.useState(null),[w,z]=u.useState(null),[k,M]=u.useState(!1),j=u.useRef(null),H=u.useRef(null),[te,Ne]=u.useState(!1),[Me,me]=u.useState(!1),[F,se]=u.useState(!1),[G,Ee]=u.useState(null),[P,Z]=u.useState(!1),[X,pe]=u.useState(""),[Ce,je]=u.useState(""),[Pe,ge]=u.useState(!1),[ce,N]=u.useState(""),[ne,we]=u.useState({start:"",end:""}),[D,xe]=u.useState(!1),[A,le]=u.useState(""),[re,$e]=u.useState(!1);u.useEffect(()=>{if(b&&x==="detail"&&(!w||w.id!==b)){const I=n.find(oe=>oe.id===b);I&&z(I)}},[b,x]),u.useEffect(()=>{w&&b&&o(b,w)},[w]);const Re=()=>{x==="detail"?(y("list"),v(null)):e()},De=(I,oe)=>{w&&z({...w,[I]:oe})},Ke=I=>{if(!w)return;const oe=m.find(Te=>Te.id===I);if(!oe)return;const Ie=w.mountedWorldbooks||[];if(Ie.some(Te=>Te.id===oe.id)){d("","info");return}const Le={id:oe.id,title:oe.title,content:oe.content,category:oe.category};De("mountedWorldbooks",[...Ie,Le]),Z(!1),d(`: ${oe.title}`,"success")},_=I=>{if(!w)return;const oe=m.filter(O=>(O.category||" (General)")===I);if(oe.length===0)return;const Ie=w.mountedWorldbooks||[],Le=[];let Te=0;for(const O of oe)Ie.some(W=>W.id===O.id)||(Le.push({id:O.id,title:O.title,content:O.content,category:O.category}),Te++);Te>0?(De("mountedWorldbooks",[...Ie,...Le]),d(` ${Te} `,"success")):d("","info"),Z(!1)},ee=I=>{if(!w)return;const oe=w.mountedWorldbooks||[];De("mountedWorldbooks",oe.filter(Ie=>Ie.id!==I))},E=(I,oe)=>{if(!w)return;const Ie=`${I}-${oe}`,Le=w.activeMemoryMonths||[],Te=Le.includes(Ie)?Le.filter(O=>O!==Ie):[...Le,Ie];De("activeMemoryMonths",Te)},K=async I=>{var Ie;const oe=(Ie=I.target.files)==null?void 0:Ie[0];if(oe)try{M(!0);const Le=await ls(oe);De("avatar",Le),d("","success")}catch(Le){d(Le.message||"","error")}finally{M(!1),j.current&&(j.current.value="")}},ke=async(I,oe,Ie)=>{if(!c.apiKey){d(" API Key","error");return}const Le=`Task: Summarize the following logs (${I}-${oe}) into a concise memory. Language: Same as logs (Chinese). ${Ie.substring(0,5e3)}`;try{const Te=await fetch(`${c.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify({model:c.model,messages:[{role:"user",content:Le}],temperature:.3})});if(!Te.ok)throw new Error("API Request failed");const W=(await Te.json()).choices[0].message.content.trim(),q=`${I}-${oe}`;De("refinedMemories",{...(w==null?void 0:w.refinedMemories)||{},[q]:W}),d(`${I}${oe}`,"success")}catch(Te){d(`: ${Te.message}`,"error")}},J=I=>{w&&(De("memories",(w.memories||[]).filter(oe=>!I.includes(oe.id))),d(` ${I.length} `,"success"))},ae=(I,oe)=>{w&&(De("memories",(w.memories||[]).map(Ie=>Ie.id===I?{...Ie,summary:oe}:Ie)),d("","success"))},V=(I,oe,Ie)=>{if(!w)return;const Le=`${I}-${oe}`;De("refinedMemories",{...w.refinedMemories||{},[Le]:Ie}),d("","success")},Q=(I,oe)=>{if(!w||!w.refinedMemories)return;const Ie=`${I}-${oe}`,Le={...w.refinedMemories};delete Le[Ie],De("refinedMemories",Le),d("","success")},ye=()=>{if(!w)return;const I=w.memories;if(!I||I.length===0){d("","info");return}const oe=[...I].sort((O,W)=>O.date.localeCompare(W.date));let Ie=`
Name: ${w.name}
Exported: ${new Date().toLocaleString()}

`;w.refinedMemories&&(Ie+=`===  ===
`,Object.entries(w.refinedMemories).sort().forEach(([O,W])=>{Ie+=`[${O}]: ${W}
`}),Ie+=`
===  ===
`);let Le="",Te="";oe.forEach(O=>{const W=O.date.match(/(\d{4})[-/](\d{1,2})/);if(W){const q=W[1],Y=W[2];q!==Le&&(Ie+=`
[ ${q} ]
`,Le=q,Te=""),Y!==Te&&(Ie+=`
-- ${parseInt(Y)} --

`,Te=Y)}Ie+=` ${O.date} ${O.mood?`(#${O.mood})`:""}
${O.summary}

--------------------------

`}),je(Ie),me(!0),navigator.clipboard.writeText(Ie).then(()=>d("","info")).catch(()=>{})},be=async()=>{if(Ce&&tn.isNativePlatform())try{const I=`${(w==null?void 0:w.name)||"character"}_memories.txt`;await Tr.writeFile({path:I,data:Ce,directory:On.Cache,encoding:Kl.UTF8});const oe=await Tr.getUri({directory:On.Cache,path:I});await Qi.share({title:"",files:[oe.uri]})}catch(I){console.error("Native share failed",I),d("","error")}},B=()=>{const I=`${(w==null?void 0:w.name)||"character"}_memories.txt`,oe=new Blob([Ce],{type:"text/plain"}),Ie=URL.createObjectURL(oe),Le=document.createElement("a");Le.href=Ie,Le.download=I,document.body.appendChild(Le),Le.click(),document.body.removeChild(Le),URL.revokeObjectURL(Ie),d("","success")},$=async()=>{var I,oe,Ie;if(!X.trim()||!c.apiKey){d(" API ","error");return}ge(!0),N("...");try{const Le=`Task: Convert this text log into a JSON array. Format: [{ "date": "YYYY-MM-DD", "summary": "...", "mood": "..." }] Text: ${X.substring(0,8e3)}`,Te=await fetch(`${c.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify({model:c.model,messages:[{role:"user",content:Le}],temperature:.1})});if(!Te.ok)throw new Error(`HTTP Error: ${Te.status}`);let W=((Ie=(oe=(I=(await Te.json()).choices)==null?void 0:I[0])==null?void 0:oe.message)==null?void 0:Ie.content)||"";W=W.replace(/```json/g,"").replace(/```/g,"").trim();const q=W.indexOf("["),Y=W.lastIndexOf("]");q!==-1&&Y!==-1&&(W=W.substring(q,Y+1));let ie;try{ie=JSON.parse(W)}catch{throw new Error("")}let fe=Array.isArray(ie)?ie:ie.memories||ie.data;if(Array.isArray(fe)){const ue=fe.map(ze=>({id:`mem-${Date.now()}-${Math.random()}`,date:ze.date||"",summary:ze.summary||"",mood:ze.mood||""}));De("memories",[...(w==null?void 0:w.memories)||[],...ue]),d(` ${ue.length} `,"success"),Ne(!1)}else throw new Error("")}catch(Le){N(`: ${Le.message||""}`),d("","error")}finally{ge(!1)}},U=async()=>{var I,oe,Ie;if(!(!c.apiKey||!w)){xe(!0),le("Initializing...");try{const Le=await R.getMessagesByCharId(w.id),Te=Le.filter(ie=>!w.hideBeforeMessageId||ie.id>=w.hideBeforeMessageId),O={};Le.forEach(ie=>{const fe=new Date(ie.timestamp),ue=fe.getFullYear(),ze=String(fe.getMonth()+1).padStart(2,"0"),Ge=String(fe.getDate()).padStart(2,"0"),Ye=`${ue}-${ze}-${Ge}`;ne.start&&Ye<ne.start||ne.end&&Ye>ne.end||(O[Ye]||(O[Ye]=[]),O[Ye].push(ie))});const W=Object.keys(O).sort(),q=[],Y=Et.buildCoreContext(w,f);for(let ie=0;ie<W.length;ie++){const fe=W[ie];le(`Processing ${fe} (${ie+1}/${W.length})`);const ze=O[fe].map(Be=>{const it=new Date(Be.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});let Je=Be.content;return Be.type==="image"&&(Je="[/Image]"),Be.type==="emoji"&&(Je=`[: ${Be.content.split("/").pop()||"sticker"}]`),`[${it}] ${Be.role==="user"?f.name:w.name}: ${Je}`}).join(`
`),Ge=`${Y}

### [System Instruction: Memory Archival]
: ${fe}
: 

###  (Strict Protocols)
1.  ** (Coverage)**:
    - ****
    - ****
    - 

2.  ** (Perspective)**:
    - "${w.name}"
    - ${f.name}

3.  ** (Format)**:
    - 
    - **** Markdown  ( - ... )
    - 

4.  ** (Conciseness)**:
    - xx...
    - : "- ${f.name}"

###  (Chat Logs)
${ze.substring(0,2e5)}
`,Ye=await fetch(`${c.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify({model:c.model,messages:[{role:"user",content:Ge}],max_tokens:8e3,temperature:.5})});if(Ye.ok){let it=((Ie=(oe=(I=(await Ye.json()).choices)==null?void 0:I[0])==null?void 0:oe.message)==null?void 0:Ie.content)||"";it=it.replace(/^["']|["']$/g,"").trim(),it&&q.push({id:`mem-${Date.now()}-${Math.random()}`,date:fe,summary:it,mood:"auto"})}await new Promise(Be=>setTimeout(Be,500))}De("memories",[...w.memories||[],...q]),le("Done!"),setTimeout(()=>{xe(!1),se(!1),d(`Processed ${q.length} days`,"success")},1e3)}catch(Le){le(`Error: ${Le.message}`),xe(!1)}}},S=async I=>{if(!w||!c.apiKey){d(" API Key","error");return}$e(!0);try{const oe=w.name,Ie=f;let Le="";const W=(await R.getMessagesByCharId(w.id)).slice(-50).map(et=>{let Fe=et.content;return et.type==="image"&&(Fe="[]"),`${et.role==="user"?Ie.name:oe}: ${Fe}`}).join(`
`);W&&(Le+=`
 (Recent Chats):
${W}
`);const q=w.memories||[];let Y="";q.length>0&&(Y=[...q].sort((Fe,cs)=>cs.date.localeCompare(Fe.date)).slice(0,100).map(Fe=>`[${Fe.date}] ${Fe.summary}`).join(`
`),Le+=`
 (Long-Term Memories):
${Y}
`);const ie=w.impression?JSON.stringify(w.impression,null,2):"null",fe=I==="initial"||!w.impression,ue=fe?"100TATATA":"TATA",ze=fe?'"1", "2"':'"", ""',Ge=fe?"":'"1", "2"',Ye=`

\`\`\`json
${ie}
\`\`\`
${Le}


"${oe}"
 \`core_values\`, \`summary\`, \`emotion_summary\` ""


1. ** (Long-Term Memories)**: TA
2. ** (Recent Chats)**: TATA [behavior_profile.emotion_summary]  [observed_changes]

 ()
${fe?"":""}JSON

JSONv3.0, markdownJSON
{
  "version": 3.0,
  "lastUpdated": ${Date.now()},
  "value_map": {
    "likes": [${ze}],
    "dislikes": [${ze}],
    "core_values": "..."
  },
  "behavior_profile": {
    "tone_style": "...",
    "emotion_summary": "...",
    "response_patterns": "..."
  },
  "emotion_schema": {
    "triggers": { 
        "positive": [${ze}],
        "negative": [${ze}]
    },
    "comfort_zone": "...",
    "stress_signals": [${ze}]
  },
  "personality_core": {
    "observed_traits": [${ze}],
    "interaction_style": "...",
    "summary": "..."
  },
  "mbti_analysis": {
    "type": "XXXX",
    "reasoning": "...",
    "dimensions": {
        "e_i": 50,
        "s_n": 50,
        "t_f": 50,
        "j_p": 50
    }
  },
  "observed_changes": [
    ${Ge}
  ]
}`,Be=await fetch(`${c.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.apiKey}`},body:JSON.stringify({model:c.model,messages:[{role:"user",content:Ye}],max_tokens:8e3,temperature:.5})});if(!Be.ok)throw new Error("API Request Failed");let Je=(await Be.json()).choices[0].message.content;Je=Je.replace(/```json/g,"").replace(/```/g,"").trim();const Qe=JSON.parse(Je);De("impression",Qe),d(fe?"":"","success")}catch(oe){console.error(oe),d(`: ${oe.message}`,"error")}finally{$e(!1)}},T=()=>{G&&(i(G),Ee(null),d("","success"))},ve=async()=>{if(!w)return;const{id:I,memories:oe,refinedMemories:Ie,activeMemoryMonths:Le,impression:Te,...O}=w,W={...O,version:1,type:"sully_character_card"};if(w.bubbleStyle){const Y=h.find(ie=>ie.id===w.bubbleStyle);Y&&(W.embeddedTheme=Y)}const q=JSON.stringify(W,null,2);if(tn.isNativePlatform())try{const Y=`${w.name||"Character"}_Card.json`;await Tr.writeFile({path:Y,data:q,directory:On.Cache,encoding:Kl.UTF8});const ie=await Tr.getUri({directory:On.Cache,path:Y});await Qi.share({title:"",files:[ie.uri]}),d("","success")}catch(Y){console.error("Native Export Error",Y),d("","error")}else{const Y=new Blob([q],{type:"application/json"}),ie=URL.createObjectURL(Y),fe=document.createElement("a");fe.href=ie,fe.download=`${w.name}_Card.json`,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),URL.revokeObjectURL(ie),d("","success")}},de=I=>{var Le;const oe=(Le=I.target.files)==null?void 0:Le[0];if(!oe)return;const Ie=new FileReader;Ie.onload=async Te=>{var O;try{const W=(O=Te.target)==null?void 0:O.result,q=JSON.parse(W);if(q.type!=="sully_character_card")throw new Error("");q.embeddedTheme&&(h.some(fe=>fe.id===q.embeddedTheme.id)||p(q.embeddedTheme));const Y={...q,id:`char-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,memories:[],refinedMemories:{},activeMemoryMonths:[],embeddedTheme:void 0};await R.saveCharacter(Y),l(),setTimeout(()=>window.location.reload(),500),d(` ${Y.name} `,"success")}catch(W){console.error(W),d(W.message||"","error")}finally{H.current&&(H.current.value="")}},Ie.readAsText(oe)};return t.jsxs("div",{className:"h-full w-full bg-slate-50/30 font-light relative",children:[x==="list"?t.jsxs("div",{className:"flex flex-col h-full animate-fade-in",children:[t.jsxs("div",{className:"px-6 pt-16 pb-4 shrink-0 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-light text-slate-800 tracking-tight",children:""}),t.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[" ",n.length," "]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{var I;return(I=H.current)==null?void 0:I.click()},className:"p-2 rounded-full bg-white/40 hover:bg-white/80 transition-colors text-slate-600",title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})})}),t.jsx("input",{type:"file",ref:H,className:"hidden",accept:".json",onChange:de}),t.jsx("button",{onClick:e,className:"p-2 rounded-full bg-white/40 hover:bg-white/80 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-5 pb-20 no-scrollbar space-y-3",children:[n.map(I=>t.jsx(qp,{char:I,onClick:()=>{v(I.id),y("detail")},onDelete:oe=>{oe.stopPropagation(),Ee(I.id)}},I.id)),t.jsxs("button",{onClick:l,className:"w-full py-4 rounded-3xl border border-dashed border-slate-300 text-slate-400 text-sm hover:bg-white/30 transition-all flex items-center justify-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),""]})]})]}):w&&t.jsxs("div",{className:"flex flex-col h-full animate-fade-in bg-slate-50/50 relative",children:[t.jsxs("div",{className:"h-32 bg-gradient-to-b from-white/90 to-transparent backdrop-blur-sm flex flex-col justify-end px-5 pb-2 shrink-0 z-40 sticky top-0",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsxs("button",{onClick:Re,className:"p-2 -ml-2 rounded-full hover:bg-white/60 flex items-center gap-1 text-slate-600",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})}),t.jsx("span",{className:"text-sm font-medium",children:""})]}),t.jsxs("button",{onClick:()=>{a(w.id),s(Ve.Chat)},className:"text-xs px-3 py-1.5 bg-primary text-white rounded-full font-bold shadow-sm shadow-primary/30 flex items-center gap-1 active:scale-95 transition-transform",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:t.jsx("path",{d:"M3.105 2.288a.75.75 0 0 0-.826.95l1.414 4.926H16.5a.75.75 0 0 1 0 1.5H3.693l-1.414 4.926a.75.75 0 0 0 .826.95 28.897 28.897 0 0 0 15.293-7.155.75.75 0 0 0 0-1.114A28.897 28.897 0 0 0 3.105 2.288Z"})}),""]})]}),t.jsxs("div",{className:"flex gap-6 text-sm font-medium text-slate-400 pl-1",children:[t.jsxs("button",{onClick:()=>g("identity"),className:`pb-2 transition-colors relative ${C==="identity"?"text-slate-800":""}`,children:["",C==="identity"&&t.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary rounded-full"})]}),t.jsxs("button",{onClick:()=>g("memory"),className:`pb-2 transition-colors relative ${C==="memory"?"text-slate-800":""}`,children:[" (",(w.memories||[]).length,")",C==="memory"&&t.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary rounded-full"})]}),t.jsxs("button",{onClick:()=>g("impression"),className:`pb-2 transition-colors relative ${C==="impression"?"text-slate-800":""}`,children:["",C==="impression"&&t.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary rounded-full"})]})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-5 no-scrollbar pb-10",children:[C==="identity"&&t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{className:"flex items-center gap-5",children:[t.jsxs("div",{className:"relative group cursor-pointer w-24 h-24 shrink-0",onClick:()=>{var I;return(I=j.current)==null?void 0:I.click()},children:[t.jsx("div",{className:"w-full h-full rounded-[2rem] shadow-md bg-white border-4 border-white overflow-hidden relative",children:t.jsx("img",{src:w.avatar,className:`w-full h-full object-cover ${k?"opacity-50 blur-sm":""}`,alt:"A"})}),t.jsx("input",{type:"file",ref:j,className:"hidden",accept:"image/*",onChange:K})]}),t.jsxs("div",{className:"flex-1 space-y-3",children:[t.jsx("input",{value:w.name,onChange:I=>De("name",I.target.value),className:"w-full bg-transparent py-1 text-xl font-medium text-slate-800 border-b border-slate-200",placeholder:""}),t.jsx("input",{value:w.description,onChange:I=>De("description",I.target.value),className:"w-full bg-transparent py-1 text-sm text-slate-500 border-b border-slate-200",placeholder:""})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block",children:" (System Prompt)"}),t.jsx("textarea",{value:w.systemPrompt,onChange:I=>De("systemPrompt",I.target.value),className:"w-full h-40 bg-white rounded-3xl p-5 text-sm shadow-sm resize-none focus:ring-1 focus:ring-primary/20 transition-all",placeholder:"..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block",children:" /  (Worldview & Lore)"}),t.jsx("textarea",{value:w.worldview||"",onChange:I=>De("worldview",I.target.value),className:"w-full h-24 bg-white rounded-3xl p-5 text-sm shadow-sm resize-none focus:ring-1 focus:ring-primary/20 transition-all",placeholder:"..."})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[t.jsx("label",{className:"text-[10px] font-bold text-indigo-500 uppercase tracking-widest block",children:"  (Worldbooks)"}),t.jsx("button",{onClick:()=>Z(!0),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded font-bold hover:bg-indigo-100",children:"+ "})]}),t.jsx("div",{className:"space-y-2",children:w.mountedWorldbooks&&w.mountedWorldbooks.length>0?w.mountedWorldbooks.map(I=>t.jsxs("div",{className:"flex items-center justify-between bg-white px-4 py-3 rounded-2xl border border-indigo-50 shadow-sm group",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx("span",{className:"text-lg shrink-0",children:""}),t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"text-sm font-bold text-slate-700 truncate",children:I.title}),I.category&&t.jsx("span",{className:"text-[9px] text-slate-400",children:I.category})]})]}),t.jsx("button",{onClick:()=>ee(I.id),className:"text-slate-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 ml-2",children:""})]},I.id)):t.jsx("div",{className:"text-center py-4 bg-slate-50 rounded-2xl border border-dashed border-slate-200 text-slate-400 text-xs",children:""})})]}),t.jsxs("div",{className:"pt-4",children:[t.jsxs("button",{onClick:ve,className:"w-full py-4 bg-slate-800 text-white rounded-2xl text-xs font-bold shadow-lg flex items-center justify-center gap-2 hover:bg-slate-700 active:scale-95 transition-all",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})})," / "]}),t.jsx("p",{className:"text-[10px] text-slate-400 text-center mt-2",children:""})]})]}),C==="memory"&&t.jsxs("div",{className:"space-y-4 animate-fade-in",children:[t.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[t.jsx("button",{onClick:()=>se(!0),className:"px-4 py-2 bg-white rounded-full text-xs font-semibold text-slate-500 shadow-sm border border-slate-100",children:""}),t.jsx("button",{onClick:()=>Ne(!0),className:"px-4 py-2 bg-white rounded-full text-xs font-semibold text-slate-500 shadow-sm border border-slate-100",children:"/"}),t.jsx("button",{onClick:ye,className:"px-4 py-2 bg-white rounded-full text-xs font-semibold text-slate-500 shadow-sm border border-slate-100",children:""})]}),t.jsx(Qp,{memories:w.memories||[],refinedMemories:w.refinedMemories||{},activeMemoryMonths:w.activeMemoryMonths||[],onRefine:ke,onDeleteMemories:J,onUpdateMemory:ae,onToggleActiveMonth:E,onUpdateRefinedMemory:V,onDeleteRefinedMemory:Q})]}),C==="impression"&&t.jsx(Yp,{impression:w.impression,isGenerating:re,onGenerate:S,onUpdateImpression:I=>De("impression",I)})]})]}),t.jsx(Ze,{isOpen:te,title:"/",onClose:()=>Ne(!1),footer:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>Ne(!1),className:"flex-1 py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl",children:""}),t.jsxs("button",{onClick:$,disabled:Pe,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl shadow-lg shadow-primary/30 flex items-center justify-center gap-2",children:[Pe&&t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),Pe?"...":""]})]}),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-xs text-slate-400 leading-relaxed bg-slate-50 p-3 rounded-xl border border-slate-100",children:"AI "}),ce&&t.jsx("div",{className:"text-xs text-primary font-medium",children:ce}),t.jsx("textarea",{value:X,onChange:I=>pe(I.target.value),placeholder:"...",className:"w-full h-32 bg-slate-100 border-none rounded-2xl px-4 py-3 text-sm text-slate-700 resize-none focus:ring-2 focus:ring-primary/20 transition-all"})]})}),t.jsx(Ze,{isOpen:F,title:"",onClose:()=>se(!1),footer:D?t.jsxs("div",{className:"w-full py-3 bg-slate-100 text-primary font-bold rounded-2xl text-center flex items-center justify-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),A]}):t.jsx("button",{onClick:U,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-xs text-slate-400",children:""}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-[10px] uppercase text-slate-400 font-bold",children:" ()"}),t.jsx("input",{type:"date",value:ne.start,onChange:I=>we({...ne,start:I.target.value}),className:"w-full bg-slate-100 rounded-xl px-3 py-2 text-xs"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-[10px] uppercase text-slate-400 font-bold",children:" ()"}),t.jsx("input",{type:"date",value:ne.end,onChange:I=>we({...ne,end:I.target.value}),className:"w-full bg-slate-100 rounded-xl px-3 py-2 text-xs"})]})]})]})}),t.jsx(Ze,{isOpen:Me,title:"",onClose:()=>me(!1),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>{navigator.clipboard.writeText(Ce),d("","success")},className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),tn.isNativePlatform()?t.jsxs("button",{onClick:be,className:"flex-1 py-3 bg-slate-800 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})}),""]}):t.jsxs("button",{onClick:B,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})}),""]})]}),children:t.jsxs("div",{className:"bg-slate-50 rounded-2xl p-3 border border-slate-100 space-y-2",children:[t.jsx("div",{className:"text-[10px] text-slate-400",children:""}),t.jsx("textarea",{value:Ce,readOnly:!0,className:"w-full h-40 bg-transparent border-none text-[10px] font-mono text-slate-600 resize-none focus:ring-0 leading-relaxed select-all",onClick:I=>I.currentTarget.select()})]})}),t.jsx(Ze,{isOpen:P,title:"",onClose:()=>Z(!1),children:t.jsx("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-4 p-1",children:m.length===0?t.jsx("div",{className:"text-center text-slate-400 text-xs py-8",children:"App "}):Object.entries(m.reduce((I,oe)=>{const Ie=oe.category||" (General)";return I[Ie]||(I[Ie]=[]),I[Ie].push(oe),I},{})).map(([I,oe])=>t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center px-1",children:[t.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:I}),t.jsx("button",{onClick:()=>_(I),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded font-bold hover:bg-indigo-100",children:""})]}),oe.map(Ie=>{var Te;const Le=(Te=w==null?void 0:w.mountedWorldbooks)==null?void 0:Te.some(O=>O.id===Ie.id);return t.jsx("button",{onClick:()=>!Le&&Ke(Ie.id),disabled:Le,className:`w-full p-4 rounded-xl border text-left transition-all ${Le?"bg-slate-50 border-slate-200 opacity-50 cursor-not-allowed":"bg-white border-indigo-100 hover:border-indigo-300 shadow-sm active:scale-95"}`,children:t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsx("span",{className:"font-bold text-slate-700 text-sm truncate",children:Ie.title}),Le&&t.jsx("span",{className:"text-[10px] text-slate-400",children:""})]})},Ie.id)})]},I))})}),t.jsx(Ze,{isOpen:!!G,title:"",onClose:()=>Ee(null),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>Ee(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),t.jsx("button",{onClick:T,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:t.jsxs("div",{className:"flex flex-col items-center gap-3 py-4",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 text-slate-300",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),t.jsxs("p",{className:"text-sm text-slate-600 text-center leading-relaxed",children:["",t.jsx("br",{}),t.jsx("span",{className:"text-xs text-red-400 font-bold",children:""})]})]})})]})};var pu;(function(e){e[e.Sunday=1]="Sunday",e[e.Monday=2]="Monday",e[e.Tuesday=3]="Tuesday",e[e.Wednesday=4]="Wednesday",e[e.Thursday=5]="Thursday",e[e.Friday=6]="Friday",e[e.Saturday=7]="Saturday"})(pu||(pu={}));const Yl=xr("LocalNotifications",{web:()=>ho(()=>import("./web-DDKjvxPC.js"),[],import.meta.url).then(e=>new e.LocalNotificationsWeb)}),ex=$n.memo(({msg:e,isFirstInGroup:s,isLastInGroup:n,activeTheme:r,charAvatar:a,charName:l,userAvatar:o,onLongPress:i,selectionMode:c,isSelected:d,onToggleSelect:f})=>{var me,F,se;const h=e.role==="user",p=e.role==="system",m=n?"mb-6":"mb-1.5",x=u.useRef(null),y=u.useRef({x:0,y:0}),C=h?r.user:r.ai,g=G=>{"touches"in G?y.current={x:G.touches[0].clientX,y:G.touches[0].clientY}:y.current={x:G.clientX,y:G.clientY},x.current=setTimeout(()=>{c||i(e)},600)},b=()=>{x.current&&(clearTimeout(x.current),x.current=null)},v=G=>{if(!x.current)return;let Ee,P;"touches"in G?(Ee=G.touches[0].clientX,P=G.touches[0].clientY):(Ee=G.clientX,P=G.clientY);const Z=Math.abs(Ee-y.current.x),X=Math.abs(P-y.current.y);(Z>10||X>10)&&(clearTimeout(x.current),x.current=null)},z={onMouseDown:g,onMouseUp:b,onMouseLeave:b,onMouseMove:v,onTouchStart:g,onTouchEnd:b,onTouchMove:v,onTouchCancel:b,onContextMenu:G=>{G.preventDefault(),c||i(e)},onClick:G=>{c&&(G.stopPropagation(),G.preventDefault(),f(e.id))}},k=G=>new Date(G).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),M=G=>t.jsx("div",{className:"relative w-9 h-9 z-0",children:n&&t.jsxs(t.Fragment,{children:[t.jsx("img",{src:G,className:"w-full h-full rounded-full object-cover shadow-sm ring-1 ring-black/5 relative z-0",alt:"avatar",loading:"lazy",decoding:"async"}),C.avatarDecoration&&t.jsx("img",{src:C.avatarDecoration,className:"absolute pointer-events-none z-10 max-w-none",style:{left:`${C.avatarDecorationX??50}%`,top:`${C.avatarDecorationY??50}%`,width:`${36*(C.avatarDecorationScale??1)}px`,height:"auto",transform:`translate(-50%, -50%) rotate(${C.avatarDecorationRotate??0}deg)`}})]})});if(p){const G=e.content.replace(/^\[(System||System Log|)\s*[:]?\s*/i,"").replace(/\]$/,"").trim();return t.jsxs("div",{className:`flex items-center w-full ${c?"pl-8":""} animate-fade-in relative transition-all duration-300`,children:[c&&t.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 cursor-pointer z-20",onClick:()=>f(e.id),children:t.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${d?"bg-primary border-primary":"border-slate-300 bg-white/80"}`,children:d&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),t.jsx("div",{className:"flex justify-center my-6 px-10 w-full",...z,children:t.jsxs("div",{className:"flex items-center gap-1.5 bg-slate-200/40 backdrop-blur-md text-slate-500 px-3 py-1 rounded-full shadow-sm border border-white/20 select-none cursor-pointer active:scale-95 transition-transform",children:[G.includes("")?"":G.includes("")||G.includes("Event")?"":G.includes("")?"":"",t.jsx("span",{className:"text-[10px] font-medium tracking-wide",children:G})]})})]})}if(e.type==="interaction")return t.jsxs("div",{className:`flex flex-col items-center ${m} w-full animate-fade-in relative transition-all duration-300 ${c?"pl-8":""}`,children:[c&&t.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 cursor-pointer z-20",onClick:()=>f(e.id),children:t.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${d?"bg-primary border-primary":"border-slate-300 bg-white/80"}`,children:d&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),t.jsx("div",{className:"text-[10px] text-slate-400 mb-1 opacity-70",children:k(e.timestamp)}),t.jsx("div",{className:"group relative cursor-pointer active:scale-95 transition-transform",...z,children:t.jsxs("div",{className:"text-[11px] text-slate-500 bg-slate-200/50 backdrop-blur-sm px-4 py-1.5 rounded-full flex items-center gap-1.5 border border-white/40 shadow-sm select-none",children:[t.jsx("span",{className:"group-hover:animate-bounce",children:""}),t.jsx("span",{className:"font-medium opacity-80",children:h?"":l}),t.jsx("span",{className:"opacity-60",children:""}),t.jsx("span",{className:"font-medium opacity-80",children:h?l:""})]})})]});const j=G=>t.jsxs("div",{className:`flex items-end ${h?"justify-end":"justify-start"} ${m} px-3 group select-none relative transition-all duration-300 ${c?"pl-12":""}`,children:[c&&t.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer z-20",onClick:()=>f(e.id),children:t.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${d?"bg-primary border-primary":"border-slate-300 bg-white/80"}`,children:d&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),!h&&t.jsx("div",{className:`absolute bottom-[1.25rem] z-0 ${c?"left-14":"left-3"} transition-all duration-300`,children:M(a)}),t.jsxs("div",{className:`flex flex-col ${h?"items-end":"items-start"} max-w-[72%] min-w-0 ${h?"mr-12":"ml-12"}`,...z,children:[t.jsx("div",{className:c?"pointer-events-none":"",children:G}),n&&t.jsx("div",{className:"text-[9px] text-slate-400/80 px-1 mt-1 font-medium",children:k(e.timestamp)})]}),h&&t.jsx("div",{className:"absolute right-3 bottom-[1.25rem] z-0",children:M(o)})]});if(e.type==="social_card"&&((me=e.metadata)!=null&&me.post)){const G=e.metadata.post;return j(t.jsxs("div",{className:"w-64 bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100 cursor-pointer active:opacity-90 transition-opacity",children:[t.jsxs("div",{className:"h-32 w-full flex items-center justify-center text-6xl relative overflow-hidden",style:{background:G.bgStyle||"#fce7f3"},children:[((F=G.images)==null?void 0:F[0])||"",t.jsx("div",{className:"absolute bottom-0 left-0 w-full p-2 bg-gradient-to-t from-black/30 to-transparent",children:t.jsx("div",{className:"text-white text-xs font-bold line-clamp-1",children:G.title})})]}),t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("img",{src:G.authorAvatar,className:"w-4 h-4 rounded-full"}),t.jsx("span",{className:"text-[10px] text-slate-500",children:G.authorName})]}),t.jsx("p",{className:"text-xs text-slate-600 line-clamp-2 leading-relaxed",children:G.content}),t.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-50 flex items-center gap-1 text-[10px] text-slate-400",children:[t.jsx("span",{className:"text-red-400",children:"Spark"}),"  "]})]})]}))}if(e.type==="transfer")return j(t.jsxs("div",{className:"w-64 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl p-4 text-white shadow-lg relative overflow-hidden group active:scale-[0.98] transition-transform",children:[t.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-20",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-12 h-12",children:[t.jsx("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.324.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),t.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z",clipRule:"evenodd"}),t.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"p-2 bg-white/20 rounded-full",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:[t.jsx("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),t.jsx("path",{fillRule:"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75-.75H5.25a.75.75 0 0 1-.75-.75V9.75Z",clipRule:"evenodd"}),t.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),t.jsx("span",{className:"font-medium text-white/90",children:"Sully Pay"})]}),t.jsxs("div",{className:"text-2xl font-bold tracking-tight mb-1",children:[" ",(se=e.metadata)==null?void 0:se.amount]}),t.jsxs("div",{className:"text-[10px] text-white/70",children:["",h?l:""]})]}));if(e.type==="emoji")return j(t.jsx("img",{src:e.content,className:"max-w-[160px] max-h-[160px] rounded-2xl hover:scale-105 transition-transform shadow-md active:scale-95",loading:"lazy",decoding:"async"}));if(e.type==="image")return j(t.jsx("div",{className:"relative group",children:t.jsx("img",{src:e.content,className:"max-w-[200px] max-h-[300px] rounded-2xl shadow-sm border border-black/5",alt:"Uploaded",loading:"lazy",decoding:"async"})}));const H=C.borderRadius;let te={};!s&&!n?te=h?{borderRadius:`${H}px`,borderTopRightRadius:"4px",borderBottomRightRadius:"4px"}:{borderRadius:`${H}px`,borderTopLeftRadius:"4px",borderBottomLeftRadius:"4px"}:s&&!n?te=h?{borderRadius:`${H}px`,borderBottomRightRadius:"4px"}:{borderRadius:`${H}px`,borderBottomLeftRadius:"4px"}:!s&&n?te=h?{borderRadius:`${H}px`,borderTopRightRadius:"4px"}:{borderRadius:`${H}px`,borderTopLeftRadius:"4px"}:te=h?{borderRadius:`${H}px`,borderBottomRightRadius:"2px"}:{borderRadius:`${H}px`,borderBottomLeftRadius:"2px"};const Ne={backgroundColor:C.backgroundColor,opacity:C.opacity,...te},Me=G=>G.split(/(```[\s\S]*?```)/g).map((P,Z)=>{if(P.startsWith("```")&&P.endsWith("```")){const X=P.replace(/^```\w*\n?/,"").replace(/```$/,"");return t.jsx("pre",{className:"bg-black/80 text-gray-100 p-3 rounded-lg text-xs font-mono overflow-x-auto my-2 whitespace-pre shadow-inner border border-white/10",children:X},Z)}return P.split(`
`).map((X,pe)=>{const Ce=`${Z}-${pe}`;if(X.trim().startsWith(">")){const ge=X.trim().substring(1).trim();return ge?t.jsx("div",{className:"my-1 pl-2.5 border-l-[3px] border-current opacity-70 italic text-[13px]",children:ge},Ce):null}const Pe=X.split(/(\*\*.*?\*\*)/g).map((ge,ce)=>ge.startsWith("**")&&ge.endsWith("**")?t.jsx("strong",{className:"font-bold",children:ge.slice(2,-2)},ce):ge);return t.jsx("div",{className:"min-h-[1.2em]",children:Pe},Ce)})});return j(t.jsxs("div",{className:`relative shadow-sm px-5 py-3 animate-fade-in border border-black/5 active:scale-[0.98] transition-transform overflow-hidden ${h?"sully-bubble-user":"sully-bubble-ai"}`,style:Ne,children:[C.backgroundImage&&t.jsx("div",{className:"absolute inset-0 bg-cover bg-center pointer-events-none z-0",style:{backgroundImage:`url(${C.backgroundImage})`,opacity:C.backgroundImageOpacity??.5}}),C.decoration&&t.jsx("img",{src:C.decoration,className:"absolute z-10 w-8 h-8 object-contain drop-shadow-sm pointer-events-none",style:{left:`${C.decorationX??(h?90:10)}%`,top:`${C.decorationY??-10}%`,transform:`translate(-50%, -50%) scale(${C.decorationScale??1}) rotate(${C.decorationRotate??0}deg)`},alt:""}),e.replyTo&&t.jsxs("div",{className:"relative z-10 mb-1 text-[10px] bg-black/5 p-1.5 rounded-md border-l-2 border-current opacity-60 flex flex-col gap-0.5 max-w-full overflow-hidden",children:[t.jsx("span",{className:"font-bold opacity-90 truncate",children:e.replyTo.name}),t.jsxs("span",{className:"truncate italic",children:['"',e.replyTo.content,'"']})]}),t.jsx("div",{className:"relative z-10 text-[15px] leading-relaxed whitespace-pre-wrap break-all",style:{color:C.textColor},children:Me(e.content)})]}))},(e,s)=>e.msg.id===s.msg.id&&e.msg.content===s.msg.content&&e.isFirstInGroup===s.isFirstInGroup&&e.isLastInGroup===s.isLastInGroup&&e.activeTheme===s.activeTheme&&e.selectionMode===s.selectionMode&&e.isSelected===s.isSelected),qi={default:{id:"default",name:"Indigo",type:"preset",user:{textColor:"#ffffff",backgroundColor:"#6366f1",borderRadius:20,opacity:1,backgroundImageOpacity:.5},ai:{textColor:"#1e293b",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5}},dream:{id:"dream",name:"Dream",type:"preset",user:{textColor:"#ffffff",backgroundColor:"#f472b6",borderRadius:20,opacity:1,backgroundImageOpacity:.5},ai:{textColor:"#1e293b",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5}},forest:{id:"forest",name:"Forest",type:"preset",user:{textColor:"#ffffff",backgroundColor:"#10b981",borderRadius:20,opacity:1,backgroundImageOpacity:.5},ai:{textColor:"#1e293b",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5}}},ul=[{id:"preset_rational",name:" (Rational)",content:`### [System Instruction: Memory Archival]
: \${dateStr}
: 

###  (Strict Protocols)
1.  ** (Coverage)**:
    - ****
    - ****
    - 

2.  ** (Perspective)**:
    - "\${char.name}"
    - \${userProfile.name}
    - 

3.  ** (Format)**:
    - 
    - **** Markdown  ( - ... )
    - 

4.  ** (Conciseness)**:
    - xx...
    - : "- \${userProfile.name}"

###  (Chat Logs)
\${rawLog}`},{id:"preset_diary",name:" (Diary)",content:`: \${dateStr}
: ****

###  (Review Protocols)
1.  ****: 
    - "\${char.name}"
    - \${userProfile.name}
    - ****\${char.name}
    - ****AI

2.  ****: 
    - 
    - 

3.  ****:
    - ****: 
    - 

4.  ****:
    - yaml JSON
    - 

###  (Chat Logs)
\${rawLog}`}],tx=({selectionMode:e,selectedCount:s,onCancelSelection:n,activeCharacter:r,isTyping:a,isSummarizing:l,lastTokenUsage:o,onClose:i,onTriggerAI:c,onShowCharsPanel:d})=>t.jsxs("div",{className:"h-24 bg-white/80 backdrop-blur-xl px-5 flex items-end pb-4 border-b border-slate-200/60 shrink-0 z-30 sticky top-0 shadow-sm relative",children:[e?t.jsxs("div",{className:"flex items-center justify-between w-full",children:[t.jsx("button",{onClick:n,className:"text-sm font-bold text-slate-500 px-2 py-1",children:""}),t.jsxs("span",{className:"text-sm font-bold text-slate-800",children:[" ",s," "]}),t.jsx("div",{className:"w-10"})]}):t.jsxs("div",{className:"flex items-center gap-3 w-full",children:[t.jsx("button",{onClick:i,className:"p-2 -ml-2 text-slate-500 hover:bg-slate-100 rounded-full",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{onClick:d,className:"flex-1 min-w-0 flex items-center gap-3 cursor-pointer",children:[t.jsx("img",{src:r.avatar,className:"w-10 h-10 rounded-xl object-cover shadow-sm",alt:"avatar"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-bold text-slate-800",children:r.name}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"text-[10px] text-slate-400 uppercase",children:"Online"}),o&&t.jsxs("div",{className:"text-[9px] px-1.5 py-0.5 bg-slate-100 text-slate-400 rounded-md font-mono border border-slate-200",children:[" ",o]})]})]})]}),t.jsx("button",{onClick:c,disabled:a,className:`p-2 rounded-full ${a?"bg-slate-100":"bg-primary/10 text-primary"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"})})})]}),l&&t.jsxs("div",{className:"absolute top-full left-0 w-full bg-indigo-50 border-b border-indigo-100 p-2 flex items-center justify-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 border-2 border-indigo-200 border-t-indigo-500 rounded-full animate-spin"}),t.jsx("span",{className:"text-xs text-indigo-600 font-medium",children:"..."})]})]}),sx=({input:e,setInput:s,isTyping:n,selectionMode:r,showPanel:a,setShowPanel:l,onSend:o,onDeleteSelected:i,selectedCount:c,emojis:d,characters:f,activeCharacterId:h,onCharSelect:p,customThemes:m,onUpdateTheme:x,onRemoveTheme:y,activeThemeId:C,onPanelAction:g,onImageSelect:b,isSummarizing:v,categories:w=[],activeCategory:z="default",onReroll:k,canReroll:M})=>{const j=u.useRef(null),H=u.useRef(null),te=F=>{F.key==="Enter"&&!F.shiftKey&&(F.preventDefault(),o())},Ne=(F,se)=>{var Ee;const G=(Ee=F.target.files)==null?void 0:Ee[0];G&&b(G),F.target&&(F.target.value="")},Me=F=>{F.isSystem||F.id==="default"||(H.current=setTimeout(()=>{g("delete-category-req",F)},600))},me=()=>{H.current&&(clearTimeout(H.current),H.current=null)};return t.jsxs("div",{className:"bg-white/90 backdrop-blur-2xl border-t border-slate-200/50 pb-safe shrink-0 z-40 shadow-[0_-5px_15px_rgba(0,0,0,0.02)] relative",children:[r?t.jsx("div",{className:"p-3 flex justify-center bg-white/50 backdrop-blur-md",children:t.jsxs("button",{onClick:i,className:"w-full py-3 bg-red-500 text-white font-bold rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})," (",c,")"]})}):t.jsxs("div",{className:"p-3 px-4 flex gap-3 items-end",children:[t.jsx("button",{onClick:()=>l(a==="actions"?"none":"actions"),className:"w-11 h-11 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-slate-200 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),t.jsxs("div",{className:"flex-1 bg-slate-100 rounded-[24px] flex items-center px-1 border border-transparent focus-within:bg-white focus-within:border-primary/30 transition-all",children:[t.jsx("textarea",{rows:1,value:e,onChange:F=>s(F.target.value),onKeyDown:te,className:"flex-1 bg-transparent px-4 py-3 text-[15px] resize-none max-h-24 no-scrollbar",placeholder:"Message...",style:{height:"auto"}}),t.jsx("button",{onClick:()=>l(a==="emojis"?"none":"emojis"),className:"p-2 text-slate-400 hover:text-primary",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})})})]}),t.jsx("button",{onClick:o,disabled:!e.trim(),className:`w-11 h-11 rounded-full flex items-center justify-center transition-all ${e.trim()?"bg-primary text-white shadow-lg":"bg-slate-200 text-slate-400"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:t.jsx("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]}),a!=="none"&&!r&&t.jsxs("div",{className:"bg-slate-50 h-72 border-t border-slate-200/60 overflow-hidden relative z-0 flex flex-col",children:[a==="emojis"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"h-10 bg-white border-b border-slate-100 flex items-center px-2 gap-2 overflow-x-auto no-scrollbar shrink-0",children:[w.map(F=>t.jsx("button",{onClick:()=>g("select-category",F.id),onTouchStart:()=>Me(F),onTouchEnd:me,onMouseDown:()=>Me(F),onMouseUp:me,onMouseLeave:me,onContextMenu:se=>{se.preventDefault(),!F.isSystem&&F.id!=="default"&&g("delete-category-req",F)},className:`px-3 py-1 text-xs rounded-full whitespace-nowrap transition-all select-none ${z===F.id?"bg-primary text-white font-bold shadow-sm":"bg-slate-100 text-slate-500"}`,children:F.name},F.id)),t.jsx("button",{onClick:()=>g("add-category"),className:"w-6 h-6 rounded-full bg-slate-100 text-slate-400 flex items-center justify-center shrink-0 hover:bg-slate-200",children:"+"})]}),t.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-4",children:t.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[t.jsx("button",{onClick:()=>g("emoji-import"),className:"aspect-square bg-slate-100 rounded-2xl border-2 border-dashed border-slate-300 flex items-center justify-center text-2xl text-slate-400",children:"+"}),d.map((F,se)=>t.jsx("button",{onClick:()=>g("send-emoji",F),onContextMenu:G=>{G.preventDefault(),g("delete-emoji-req",F)},className:"aspect-square bg-white rounded-2xl p-2 shadow-sm relative active:scale-95 transition-transform",children:t.jsx("img",{src:F.url,className:"w-full h-full object-contain pointer-events-none"})},se))]})})]}),a==="actions"&&t.jsxs("div",{className:"p-6 grid grid-cols-4 gap-8 overflow-y-auto",children:[t.jsxs("button",{onClick:()=>g("transfer"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[t.jsx("div",{className:"w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center shadow-sm text-orange-400 border border-orange-100",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:[t.jsx("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),t.jsx("path",{fillRule:"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75-.75H5.25a.75.75 0 0 1-.75-.75V9.75Z",clipRule:"evenodd"}),t.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),t.jsx("span",{className:"text-xs font-bold",children:""})]}),t.jsxs("button",{onClick:()=>g("poke"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[t.jsx("div",{className:"w-14 h-14 bg-sky-50 rounded-2xl flex items-center justify-center shadow-sm text-2xl border border-sky-100",children:""}),t.jsx("span",{className:"text-xs font-bold",children:""})]}),t.jsxs("button",{onClick:()=>g("archive"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[t.jsx("div",{className:"w-14 h-14 bg-indigo-50 rounded-2xl flex items-center justify-center shadow-sm text-indigo-400 border border-indigo-100",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),t.jsx("span",{className:"text-xs font-bold",children:v?"...":""})]}),t.jsxs("button",{onClick:()=>g("settings"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[t.jsx("div",{className:"w-14 h-14 bg-slate-50 rounded-2xl flex items-center justify-center shadow-sm text-slate-500 border border-slate-100",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 0 1 0 2.555c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.212 1.281c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-2.555c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]})}),t.jsx("span",{className:"text-xs font-bold",children:""})]}),t.jsxs("button",{onClick:()=>{var F;return(F=j.current)==null?void 0:F.click()},className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[t.jsx("div",{className:"w-14 h-14 bg-pink-50 rounded-2xl flex items-center justify-center shadow-sm text-pink-400 border border-pink-100",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:t.jsx("path",{fillRule:"evenodd",d:"M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z",clipRule:"evenodd"})})}),t.jsx("span",{className:"text-xs font-bold",children:""})]}),t.jsx("input",{type:"file",ref:j,className:"hidden",accept:"image/*",onChange:F=>Ne(F)}),t.jsxs("button",{onClick:k,disabled:!M,className:`flex flex-col items-center gap-2 active:scale-95 transition-transform ${M?"text-slate-600":"text-slate-300 opacity-50"}`,children:[t.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center shadow-sm border ${M?"bg-emerald-50 text-emerald-400 border-emerald-100":"bg-slate-50 text-slate-300 border-slate-100"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("span",{className:"text-xs font-bold",children:""})]})]}),a==="chars"&&t.jsxs("div",{className:"p-5 space-y-6 overflow-y-auto no-scrollbar",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xs font-bold text-slate-400 px-1 tracking-wider uppercase mb-3",children:""}),t.jsxs("div",{className:"flex gap-3 px-1 overflow-x-auto no-scrollbar pb-2",children:[Object.values(qi).map(F=>t.jsx("button",{onClick:()=>x(F.id),className:`px-6 py-3 rounded-2xl text-xs font-bold border shrink-0 transition-all ${C===F.id?"bg-primary text-white border-primary":"bg-white border-slate-200 text-slate-600"}`,children:F.name},F.id)),m.map(F=>t.jsxs("div",{className:"relative group shrink-0",children:[t.jsxs("button",{onClick:()=>x(F.id),className:`px-6 py-3 rounded-2xl text-xs font-bold border transition-all ${C===F.id?"bg-indigo-500 text-white border-indigo-500":"bg-indigo-50 border-indigo-100 text-indigo-600"}`,children:[F.name," (DIY)"]}),t.jsx("button",{onClick:se=>{se.stopPropagation(),y(F.id)},className:"absolute -top-2 -right-2 bg-red-400 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs shadow-md opacity-0 group-hover:opacity-100 transition-opacity",children:""})]},F.id))]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xs font-bold text-slate-400 px-1 tracking-wider uppercase mb-3",children:""}),t.jsx("div",{className:"space-y-3",children:f.map(F=>t.jsxs("div",{onClick:()=>p(F.id),className:`flex items-center gap-4 p-3 rounded-[20px] border cursor-pointer ${F.id===h?"bg-white border-primary/30 shadow-md":"bg-white/50 border-transparent"}`,children:[t.jsx("img",{src:F.avatar,className:"w-12 h-12 rounded-2xl object-cover"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-bold text-sm text-slate-700",children:F.name}),t.jsx("div",{className:"text-xs text-slate-400 truncate",children:F.description})]})]},F.id))})]})]})]})]})},nx=({modalType:e,setModalType:s,transferAmt:n,setTransferAmt:r,emojiImportText:a,setEmojiImportText:l,settingsContextLimit:o,setSettingsContextLimit:i,settingsHideSysLogs:c,setSettingsHideSysLogs:d,preserveContext:f,setPreserveContext:h,editContent:p,setEditContent:m,newCategoryName:x,setNewCategoryName:y,onAddCategory:C,archivePrompts:g,selectedPromptId:b,setSelectedPromptId:v,editingPrompt:w,setEditingPrompt:z,isSummarizing:k,selectedMessage:M,selectedEmoji:j,activeCharacter:H,messages:te,onTransfer:Ne,onImportEmoji:Me,onSaveSettings:me,onBgUpload:F,onRemoveBg:se,onClearHistory:G,onArchive:Ee,onCreatePrompt:P,onEditPrompt:Z,onSavePrompt:X,onDeletePrompt:pe,onSetHistoryStart:Ce,onEnterSelectionMode:je,onReplyMessage:Pe,onEditMessageStart:ge,onConfirmEditMessage:ce,onDeleteMessage:N,onDeleteEmoji:ne})=>{const we=u.useRef(null);return t.jsxs(t.Fragment,{children:[t.jsx(Ze,{isOpen:e==="transfer",title:"Credits ",onClose:()=>s("none"),footer:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),t.jsx("button",{onClick:Ne,className:"flex-1 py-3 bg-orange-500 text-white rounded-2xl",children:""})]}),children:t.jsx("input",{type:"number",value:n,onChange:D=>r(D.target.value),className:"w-full bg-slate-100 rounded-2xl px-5 py-4 text-lg font-bold",autoFocus:!0})}),t.jsx(Ze,{isOpen:e==="add-category",title:"",onClose:()=>s("none"),footer:t.jsx("button",{onClick:C,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:t.jsx("input",{value:x,onChange:D=>y(D.target.value),placeholder:"...",className:"w-full bg-slate-100 rounded-2xl px-5 py-4 text-base font-bold focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all text-slate-700",autoFocus:!0})}),t.jsx(Ze,{isOpen:e==="emoji-import",title:"",onClose:()=>s("none"),footer:t.jsx("button",{onClick:Me,className:"w-full py-4 bg-primary text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-xs text-slate-400",children:""}),t.jsx("textarea",{value:a,onChange:D=>l(D.target.value),placeholder:"Name--URL ()",className:"w-full h-40 bg-slate-100 rounded-2xl p-4 resize-none"})]})}),t.jsx(Ze,{isOpen:e==="chat-settings",title:"",onClose:()=>s("none"),footer:t.jsx("button",{onClick:me,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:""}),t.jsxs("div",{onClick:()=>{var D;return(D=we.current)==null?void 0:D.click()},className:"h-24 bg-slate-100 rounded-xl border-2 border-dashed border-slate-200 flex items-center justify-center cursor-pointer hover:border-primary/50 overflow-hidden relative",children:[H.chatBackground?t.jsx("img",{src:H.chatBackground,className:"w-full h-full object-cover opacity-60"}):t.jsx("span",{className:"text-xs text-slate-400",children:" ()"}),H.chatBackground&&t.jsx("span",{className:"absolute z-10 text-xs bg-white/80 px-2 py-1 rounded",children:""})]}),t.jsx("input",{type:"file",ref:we,className:"hidden",accept:"image/*",onChange:D=>{var xe;return((xe=D.target.files)==null?void 0:xe[0])&&F(D.target.files[0])}}),H.chatBackground&&t.jsx("button",{onClick:se,className:"text-[10px] text-red-400 mt-1",children:""})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:[" (",o,")"]}),t.jsx("input",{type:"range",min:"20",max:"5000",step:"10",value:o,onChange:D=>i(parseInt(D.target.value)),className:"w-full h-2 bg-slate-200 rounded-full appearance-none accent-primary"}),t.jsxs("div",{className:"flex justify-between text-[10px] text-slate-400 mt-1",children:[t.jsx("span",{children:"20 ()"}),t.jsx("span",{children:"5000 ()"})]})]}),t.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[t.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>d(!c),children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase pointer-events-none",children:""}),t.jsx("div",{className:`w-10 h-6 rounded-full p-1 transition-colors flex items-center ${c?"bg-primary":"bg-slate-200"}`,children:t.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-sm transition-transform ${c?"translate-x-4":""}`})})]}),t.jsx("p",{className:"text-[10px] text-slate-400 mt-2 leading-relaxed",children:" Date/App "})]}),t.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[t.jsx("button",{onClick:()=>s("history-manager"),className:"w-full py-3 bg-slate-50 text-slate-600 font-bold rounded-2xl border border-slate-200 active:scale-95 transition-transform flex items-center justify-center gap-2",children:" / "}),t.jsx("p",{className:"text-[10px] text-slate-400 mt-2 text-center",children:" AI "})]}),t.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[t.jsx("label",{className:"text-xs font-bold text-red-400 uppercase mb-3 block",children:" (Danger Zone)"}),t.jsxs("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>h(!f),children:[t.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${f?"bg-primary border-primary":"bg-slate-100 border-slate-300"}`,children:f&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),t.jsx("span",{className:"text-sm text-slate-600",children:"10 ()"})]}),t.jsx("button",{onClick:G,className:"w-full py-3 bg-red-50 text-red-500 font-bold rounded-2xl border border-red-100 active:scale-95 transition-transform flex items-center justify-center gap-2",children:""})]})]})}),t.jsx(Ze,{isOpen:e==="archive-settings",title:"",onClose:()=>s("none"),footer:t.jsx("button",{onClick:Ee,disabled:k,className:"w-full py-3 bg-indigo-500 text-white font-bold rounded-2xl shadow-lg shadow-indigo-200",children:""}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[t.jsx("label",{className:"text-[10px] font-bold text-indigo-400 uppercase mb-2 block",children:""}),t.jsx("div",{className:"flex flex-col gap-2",children:g.map(D=>t.jsxs("div",{onClick:()=>v(D.id),className:`p-3 rounded-lg border cursor-pointer flex items-center justify-between ${b===D.id?"bg-white border-indigo-500 shadow-sm ring-1 ring-indigo-500":"bg-white/50 border-indigo-200 hover:bg-white"}`,children:[t.jsx("span",{className:`text-xs font-bold ${b===D.id?"text-indigo-700":"text-slate-600"}`,children:D.name}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:xe=>{xe.stopPropagation(),v(D.id),Z()},className:"text-[10px] text-slate-400 hover:text-indigo-500 px-2 py-1 rounded bg-slate-100 hover:bg-indigo-50",children:"/"}),!D.id.startsWith("preset_")&&t.jsx("button",{onClick:xe=>{xe.stopPropagation(),pe(D.id)},className:"text-[10px] text-red-300 hover:text-red-500 px-2 py-1 rounded hover:bg-red-50",children:""})]})]},D.id))}),t.jsx("button",{onClick:P,className:"mt-3 w-full py-2 text-xs font-bold text-indigo-500 border border-dashed border-indigo-300 rounded-lg hover:bg-indigo-100",children:"+ "})]}),t.jsxs("div",{className:"text-[10px] text-slate-400 bg-slate-50 p-3 rounded-xl leading-relaxed",children:[" ",t.jsx("b",{children:""}),":  AI ",t.jsx("br",{})," ",t.jsx("b",{children:""}),": ",t.jsx("br",{})," : ",t.jsx("code",{children:"${dateStr}"}),", ",t.jsx("code",{children:"${char.name}"}),", ",t.jsx("code",{children:"${userProfile.name}"}),", ",t.jsx("code",{children:"${rawLog}"})]})]})}),t.jsx(Ze,{isOpen:e==="prompt-editor",title:"",onClose:()=>s("archive-settings"),footer:t.jsx("button",{onClick:X,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("input",{value:(w==null?void 0:w.name)||"",onChange:D=>z(xe=>xe?{...xe,name:D.target.value}:null),placeholder:"",className:"w-full px-4 py-2 bg-slate-100 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-primary/20"}),t.jsx("textarea",{value:(w==null?void 0:w.content)||"",onChange:D=>z(xe=>xe?{...xe,content:D.target.value}:null),className:"w-full h-64 bg-slate-100 rounded-xl p-3 text-xs font-mono resize-none focus:outline-none focus:ring-2 focus:ring-primary/20 leading-relaxed",placeholder:"..."})]})}),t.jsx(Ze,{isOpen:e==="history-manager",title:"",onClose:()=>s("none"),footer:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>Ce(void 0),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),t.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl",children:""})]}),children:t.jsxs("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto no-scrollbar p-1",children:[t.jsx("p",{className:"text-xs text-slate-400 text-center mb-2",children:" AI"}),te.slice().reverse().map(D=>t.jsxs("div",{onClick:()=>Ce(D.id),className:`p-3 rounded-xl border cursor-pointer text-xs flex gap-2 items-start ${H.hideBeforeMessageId===D.id?"bg-primary/10 border-primary ring-1 ring-primary":"bg-white border-slate-100 hover:bg-slate-50"}`,children:[t.jsxs("span",{className:"text-slate-400 font-mono whitespace-nowrap pt-0.5",children:["[",new Date(D.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"]"]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-slate-600 mb-0.5",children:D.role==="user"?"":H.name}),t.jsx("div",{className:"text-slate-500 truncate",children:D.content})]}),H.hideBeforeMessageId===D.id&&t.jsx("span",{className:"text-primary font-bold text-[10px] bg-white px-2 rounded-full border border-primary/20",children:""})]},D.id))]})}),t.jsx(Ze,{isOpen:e==="message-options",title:"",onClose:()=>s("none"),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:je,className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl active:bg-slate-100 transition-colors flex items-center justify-center gap-2",children:" / "}),t.jsx("button",{onClick:Pe,className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl active:bg-slate-100 transition-colors flex items-center justify-center gap-2",children:" / "}),(M==null?void 0:M.type)==="text"&&t.jsx("button",{onClick:ge,className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl active:bg-slate-100 transition-colors flex items-center justify-center gap-2",children:""}),t.jsx("button",{onClick:N,className:"w-full py-3 bg-red-50 text-red-500 font-medium rounded-2xl active:bg-red-100 transition-colors flex items-center justify-center gap-2",children:""})]})}),t.jsx(Ze,{isOpen:e==="delete-emoji",title:"",onClose:()=>s("none"),footer:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),t.jsx("button",{onClick:ne,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:""})]}),children:t.jsxs("div",{className:"flex flex-col items-center gap-4 py-2",children:[j&&t.jsx("img",{src:j.url,className:"w-24 h-24 object-contain rounded-xl border"}),t.jsx("p",{className:"text-center text-sm text-slate-500",children:""})]})}),t.jsx(Ze,{isOpen:e==="edit-message",title:"",onClose:()=>s("none"),footer:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),t.jsx("button",{onClick:ce,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl",children:""})]}),children:t.jsx("textarea",{value:p,onChange:D=>m(D.target.value),className:"w-full h-32 bg-slate-100 rounded-2xl p-4 resize-none focus:ring-1 focus:ring-primary/20 transition-all text-sm leading-relaxed"})})]})},rx=()=>{const{characters:e,activeCharacterId:s,setActiveCharacterId:n,updateCharacter:r,apiConfig:a,closeApp:l,customThemes:o,removeCustomTheme:i,addToast:c,userProfile:d,lastMsgTimestamp:f,groups:h,clearUnread:p}=xt(),[m,x]=u.useState([]),[y,C]=u.useState(30),[g,b]=u.useState(""),[v,w]=u.useState(!1),[z,k]=u.useState(""),[M,j]=u.useState("none"),[H,te]=u.useState([]),[Ne,Me]=u.useState([]),[me,F]=u.useState("default"),[se,G]=u.useState(""),Ee=u.useRef(null),[P,Z]=u.useState(null),[X,pe]=u.useState(null),[Ce,je]=u.useState("none"),[Pe,ge]=u.useState(""),[ce,N]=u.useState(""),[ne,we]=u.useState(500),[D,xe]=u.useState(!1),[A,le]=u.useState(!0),[re,$e]=u.useState(null),[Re,De]=u.useState(null),[Ke,_]=u.useState(null),[ee,E]=u.useState(""),[K,ke]=u.useState(!1),[J,ae]=u.useState(ul),[V,Q]=u.useState("preset_rational"),[ye,be]=u.useState(null),[B,$]=u.useState(!1),[U,S]=u.useState(new Set),T=e.find(he=>he.id===s)||e[0],ve=(T==null?void 0:T.bubbleStyle)||"default",de=u.useMemo(()=>o.find(he=>he.id===ve)||qi[ve]||qi.default,[ve,o]),I=`chat_draft_${s}`,oe=!v&&m.length>0&&m[m.length-1].role==="assistant",Ie=async()=>{await R.initializeEmojiData();const[he,Oe]=await Promise.all([R.getEmojis(),R.getEmojiCategories()]);te(he),Me(Oe),me!=="default"&&!Oe.some(qe=>qe.id===me)&&F("default")};u.useEffect(()=>{if(s){R.getMessagesByCharId(s).then(x),Ie();const he=localStorage.getItem(I);b(he||""),T&&(we(T.contextLimit||500),xe(T.hideSystemLogs||!1),p(T.id)),C(30),pe(null),Z(null),$(!1),S(new Set)}},[s]),u.useEffect(()=>{const he=localStorage.getItem("chat_archive_prompts");if(he)try{const qe=JSON.parse(he),rt=[...ul,...qe.filter(dt=>!dt.id.startsWith("preset_"))];ae(rt)}catch{}const Oe=localStorage.getItem("chat_active_archive_prompt_id");Oe&&J.some(qe=>qe.id===Oe)&&Q(Oe)},[]),u.useEffect(()=>{s&&f>0&&(R.getMessagesByCharId(s).then(x),p(s))},[f]);const Le=he=>{b(he),he.trim()?localStorage.setItem(I,he):localStorage.removeItem(I)};u.useLayoutEffect(()=>{Ee.current&&!B&&(Ee.current.scrollTop=Ee.current.scrollHeight)},[m.length,s,B]),u.useEffect(()=>{v&&Ee.current&&!B&&Ee.current.scrollTo({top:Ee.current.scrollHeight,behavior:"smooth"})},[m,v,z,B]);const Te=he=>new Date(he).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),O=he=>{const Oe=new Date(he);return`${Oe.getFullYear()}-${(Oe.getMonth()+1).toString().padStart(2,"0")}-${Oe.getDate().toString().padStart(2,"0")} ${Oe.getHours().toString().padStart(2,"0")}:${Oe.getMinutes().toString().padStart(2,"0")}`},W=(he,Oe)=>{if(!T.memories)return null;const qe=`${he}-${Oe.padStart(2,"0")}`,rt=T.memories.filter(dt=>dt.date.includes(qe)||dt.date.includes(`${he}${parseInt(Oe)}`));return rt.length===0?null:rt.map(dt=>`[${dt.date}] (${dt.mood||"normal"}): ${dt.summary}`).join(`
`)},q=(he,Oe)=>{if(!he)return"";const qe=Oe-he.timestamp,rt=Math.floor(qe/(1e3*60)),dt=Math.floor(qe/(1e3*60*60)),yt=new Date(Oe).getHours(),Ft=yt>=23||yt<=6;return rt<10?"":rt<60?`[: : ${rt} ]`:dt<6?Ft?`[: : ${dt} /]`:`[: : ${dt} ]`:dt<24?`[: : ${dt} ]`:`[: : ${Math.floor(dt/24)} ]`},Y=async(he,Oe,qe)=>{if(!T||!g.trim()&&!he)return;const rt=he||g.trim(),dt=Oe||"text";he||(b(""),localStorage.removeItem(I)),dt==="image"&&(await R.saveGalleryImage({id:`img-${Date.now()}-${Math.random()}`,charId:T.id,url:rt,timestamp:Date.now()}),c("","info"));const yt={charId:T.id,role:"user",type:dt,content:rt,metadata:qe};P&&(yt.replyTo={id:P.id,content:P.content,name:P.role==="user"?"":T.name},Z(null)),await R.saveMessage(yt);const Ft=await R.getMessagesByCharId(T.id);x(Ft),j("none")},ie=async()=>{if(v||m.length===0||m[m.length-1].role!=="assistant")return;const Oe=[];let qe=m.length-1;for(;qe>=0&&m[qe].role==="assistant";)Oe.push(m[qe].id),qe--;if(Oe.length===0)return;await R.deleteMessages(Oe);const rt=m.slice(0,qe+1);x(rt),c("...","info"),rn(rt)},fe=async he=>{try{const Oe=await ls(he,{maxWidth:600,quality:.6,forceJpeg:!0});j("none"),await Y(Oe,"image")}catch(Oe){c(Oe.message||"","error")}},ue=(he,Oe)=>{switch(he){case"transfer":je("transfer");break;case"poke":Y("[]","interaction");break;case"archive":je("archive-settings");break;case"settings":je("chat-settings");break;case"emoji-import":je("emoji-import");break;case"send-emoji":Oe&&Y(Oe.url,"emoji");break;case"delete-emoji-req":De(Oe),je("delete-emoji");break;case"add-category":je("add-category");break;case"select-category":F(Oe);break;case"delete-category-req":_(Oe),je("delete-category");break}},ze=async()=>{if(!se.trim()){c("","error");return}const he={id:`cat-${Date.now()}`,name:se.trim()};await R.saveEmojiCategory(he),await Ie(),F(he.id),je("none"),G(""),c("","success")},Ge=async()=>{if(!ce.trim())return;const he=ce.split(`
`),Oe=me==="default"?void 0:me;for(const qe of he){const rt=qe.split("--");if(rt.length>=2){const dt=rt[0].trim(),yt=rt.slice(1).join("--").trim();dt&&yt&&await R.saveEmoji(dt,yt,Oe)}}await Ie(),je("none"),N(""),c("","success")},Ye=async()=>{Ke&&(await R.deleteEmojiCategory(Ke.id),await Ie(),F("default"),je("none"),_(null),c("","success"))},Be=()=>{if(!ye||!ye.name.trim()||!ye.content.trim()){c("","error");return}ae(he=>{let Oe;he.some(rt=>rt.id===ye.id)?Oe=he.map(rt=>rt.id===ye.id?ye:rt):Oe=[...he,ye];const qe=Oe.filter(rt=>!rt.id.startsWith("preset_"));return localStorage.setItem("chat_archive_prompts",JSON.stringify(qe)),Oe}),Q(ye.id),je("archive-settings"),be(null)},it=he=>{if(he.startsWith("preset_")){c("","error");return}ae(Oe=>{const qe=Oe.filter(dt=>dt.id!==he),rt=qe.filter(dt=>!dt.id.startsWith("preset_"));return localStorage.setItem("chat_archive_prompts",JSON.stringify(rt)),qe}),V===he&&Q("preset_rational"),c("","success")},Je=()=>{be({id:`custom_${Date.now()}`,name:"",content:ul[0].content}),je("prompt-editor")},Qe=()=>{const he=J.find(Oe=>Oe.id===V);he&&(he.id.startsWith("preset_")?be({id:`custom_${Date.now()}`,name:`${he.name} (Copy)`,content:he.content}):be({...he}),je("prompt-editor"))},et=async he=>{try{const Oe=await ls(he,{skipCompression:!0});r(T.id,{chatBackground:Oe}),c("","success")}catch(Oe){c(Oe.message,"error")}},Fe=()=>{r(T.id,{contextLimit:ne,hideSystemLogs:D}),je("none"),c("","success")},cs=async()=>{if(T){if(A){const he=m.slice(0,-10);if(he.length===0){c("","info");return}await R.deleteMessages(he.map(Oe=>Oe.id)),x(m.slice(-10)),c(` ${he.length} 10`,"success")}else await R.clearMessages(T.id),x([]),c("","success");je("none")}},ht=he=>{r(T.id,{hideBeforeMessageId:he}),je("none"),c(he?"":"","success")},Cs=async()=>{var qe,rt,dt;if(!a.apiKey||!T){c(" API Key","error");return}const he={};m.filter(yt=>!T.hideBeforeMessageId||yt.id>=T.hideBeforeMessageId).forEach(yt=>{const Ft=new Date(yt.timestamp),Ds=`${Ft.getFullYear()}-${String(Ft.getMonth()+1).padStart(2,"0")}-${String(Ft.getDate()).padStart(2,"0")}`;he[Ds]||(he[Ds]=[]),he[Ds].push(yt)});const Oe=Object.keys(he).sort();if(Oe.length===0){c("","info");return}ke(!0),j("none"),je("none");try{let yt=0;const Ft=[],Xn=(J.find($s=>$s.id===V)||ul[0]).content;for(const $s of Oe){const gr=he[$s].map(Xt=>`[${Te(Xt.timestamp)}] ${Xt.role==="user"?d.name:T.name}: ${Xt.type==="image"?"[Image]":Xt.content}`).join(`
`);let qt=Xn;qt=qt.replace(/\$\{dateStr\}/g,$s),qt=qt.replace(/\$\{char\.name\}/g,T.name),qt=qt.replace(/\$\{userProfile\.name\}/g,d.name),qt=qt.replace(/\$\{rawLog.*?\}/g,gr.substring(0,2e5));const er=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:qt}],temperature:.5,max_tokens:8e3})});if(!er.ok)throw new Error(`API Error on ${$s}`);let Ht=((dt=(rt=(qe=(await er.json()).choices)==null?void 0:qe[0])==null?void 0:rt.message)==null?void 0:dt.content)||"";Ht=Ht.trim().replace(/^["']|["']$/g,""),Ht&&(Ft.push({id:`mem-${Date.now()}`,date:$s,summary:Ht,mood:"archive"}),yt++),await new Promise(Xt=>setTimeout(Xt,500))}const pn=[...T.memories||[],...Ft];r(T.id,{memories:pn}),c(` ${yt} `,"success")}catch(yt){c(`: ${yt.message}`,"error")}finally{ke(!1)}},tt=async()=>{re&&(await R.deleteMessage(re.id),x(he=>he.filter(Oe=>Oe.id!==re.id)),je("none"),$e(null),c("","success"))},Ct=async()=>{re&&(await R.updateMessage(re.id,ee),x(he=>he.map(Oe=>Oe.id===re.id?{...Oe,content:ee}:Oe)),je("none"),$e(null),c("","success"))},ct=()=>{re&&(Z({...re,metadata:{...re.metadata,senderName:re.role==="user"?"":T.name}}),je("none"))},Lt=async()=>{Re&&(await R.deleteEmoji(Re.name),await Ie(),je("none"),De(null),c("","success"))},Pt=()=>{re&&(S(new Set([re.id])),$(!0),je("none"),$e(null))},qn=u.useCallback(he=>{S(Oe=>{const qe=new Set(Oe);return qe.has(he)?qe.delete(he):qe.add(he),qe})},[]),nn=async()=>{U.size!==0&&(await R.deleteMessages(Array.from(U)),x(he=>he.filter(Oe=>!U.has(Oe.id))),c(` ${U.size} `,"success"),$(!1),S(new Set))},rn=async he=>{var Oe,qe,rt,dt,yt,Ft,Ds,Xn;if(!(v||!T)){if(!a.baseUrl){alert(" API URL");return}w(!0),k("");try{const pn=a.baseUrl.replace(/\/+$/,""),$s={"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey||"sk-none"}`};let In=Et.buildCoreContext(T,d);try{const st=h.filter(He=>He.members.includes(T.id));if(st.length>0){let He=[];for(const lt of st){const Vt=(await R.getGroupMessages(lt.id)).map(ds=>({...ds,groupName:lt.name}));He=[...He,...Vt]}He.sort((lt,mt)=>mt.timestamp-lt.timestamp);const nt=He.slice(0,200).reverse();if(nt.length>0){const lt=nt.map(mt=>{var Zt;const Vt=new Date(mt.timestamp).toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),ds=mt.role==="user"?d.name:((Zt=e.find(pt=>pt.id===mt.charId))==null?void 0:Zt.name)||"Unknown";return`[${Vt}] [Group: ${mt.groupName}] ${ds}: ${mt.content}`}).join(`
`);In+=`
### [Background Context: Recent Group Activities]
(...)
${lt}
`}}}catch(st){console.error("Failed to load group context",st)}const gr=(()=>{if(H.length===0)return"";const st={},He={default:""};return Ne.forEach(nt=>He[nt.id]=nt.name),H.forEach(nt=>{const lt=nt.categoryId||"default";st[lt]||(st[lt]=[]),st[lt].push(nt.name)}),Object.entries(st).map(([nt,lt])=>`${He[nt]||""}: [${lt.join(", ")}]`).join("; ")})();In+=`###  App  (Chat App Rules)
            ****
1. ****: (IM)
2. ****: 
3. ****:
   - ""
   - "[]:"
   - **"[ ...]"**
   - ****: : \`[[SEND_EMOJI: ]]\`
   - ** ()**: 
     ${gr}
4. ** (Quote/Reply)**:
   - : \`[[QUOTE: ]]\`UI
5. ****:
   -  [] 
   - 
6. ****:
   - : \`[[ACTION:POKE]]\`
   - : \`[[ACTION:TRANSFER:100]]\`
   - : \`[[RECALL: YYYY-MM]]\`
   - ****: ****: \`[[ACTION:ADD_EVENT | (Title) | YYYY-MM-DD]]\`
   - ****: : \`[schedule_message | YYYY-MM-DD HH:MM:SS | fixed | ]\`****
       -# 
       - ****
       - ****
         - / 
         -   
         -   
         -   
         - 
         - ****/
         #  (AI)
[
  TaTa101111
  \`[schedule_message | 2025-10-18 11:30:00 | fixed | ]\`
  \`[schedule_message | 2025-10-18 11:30:03 | fixed | ]\`
  
]

[
  11Ta
  \`[schedule_message | 2025-10-18 08:30:00 | fixed | ~]\`
  \`[schedule_message | 2025-10-18 08:30:03 | fixed | ]\`
  ~
]
         `;const qt=he.length>1?he[he.length-2]:null;qt&&((Oe=qt.metadata)==null?void 0:Oe.source)==="date"&&(In+=`

[System Note: You just finished a face-to-face meeting. You are now back on the phone. Switch back to texting style.]`);const er=T.contextLimit||500,Ht=he.filter(st=>!T.hideBeforeMessageId||st.id>=T.hideBeforeMessageId).slice(-er);let Xt="";if(Ht.length>=2){const st=Ht[Ht.length-2],He=Ht[Ht.length-1];st&&He&&(Xt=q(st,He.timestamp))}let tr=[{role:"system",content:In},...(st=>st.map((He,nt)=>{var Vt,ds,Zt;let lt=He.content;const mt=`[${O(He.timestamp)}]`;if(He.replyTo&&(lt=`[ "${He.replyTo.content.substring(0,50)}..."]: ${lt}`),He.type==="image"){let pt=`${mt} [User sent an image]`;return nt===st.length-1&&Xt&&He.role==="user"&&(pt+=`

${Xt}`),{role:He.role,content:[{type:"text",text:pt},{type:"image_url",image_url:{url:He.content}}]}}if(nt===st.length-1&&Xt&&He.role==="user"&&(lt=`${lt}

${Xt}`),He.type==="interaction")lt=`${mt} [: ]`;else if(He.type==="transfer")lt=`${mt} [:  ${(Vt=He.metadata)==null?void 0:Vt.amount}]`;else if(He.type==="social_card"){const pt=((ds=He.metadata)==null?void 0:ds.post)||{},bs=(pt.comments||[]).map(br=>`${br.authorName}: ${br.content}`).join(" | ");lt=`${mt} [ Spark ]
: ${pt.title}
: ${pt.content}
: ${bs}
()`}else if(He.type==="emoji"){const pt=((Zt=H.find(bs=>bs.url===He.content))==null?void 0:Zt.name)||"Image/Sticker";lt=`${mt} [${He.role==="user"?"":""} : ${pt}]`}else lt=`${mt} ${lt}`;return{role:He.role,content:lt}}))(Ht)],L=await fetch(`${pn}/chat/completions`,{method:"POST",headers:$s,body:JSON.stringify({model:a.model,messages:tr,temperature:.85,stream:!1})});if(!L.ok)throw new Error(`API Error ${L.status}`);let Ae=await L.json();(qe=Ae.usage)!=null&&qe.total_tokens&&pe(Ae.usage.total_tokens);let Se=((yt=(dt=(rt=Ae.choices)==null?void 0:rt[0])==null?void 0:dt.message)==null?void 0:yt.content)||"";Se=Se.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),Se=Se.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),Se=Se.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]");const Xe=Se.match(/\[\[RECALL:\s*(\d{4})[-/](\d{1,2})\]\]/);if(Xe){const st=Xe[1],He=Xe[2];k(` ${st}${He} ...`);const nt=W(st,He);nt&&(tr=[...tr,{role:"system",content:`[:  ${st}-${He} ]
${nt}
[: ]`}],L=await fetch(`${pn}/chat/completions`,{method:"POST",headers:$s,body:JSON.stringify({model:a.model,messages:tr,temperature:.8,stream:!1})}),L.ok&&(Ae=await L.json(),Se=((Xn=(Ds=(Ft=Ae.choices)==null?void 0:Ft[0])==null?void 0:Ds.message)==null?void 0:Xn.content)||"",Se=Se.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),Se=Se.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),Se=Se.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]"),c(` ${st}-${He} `,"info")))}k(""),Se.includes("[[ACTION:POKE]]")&&(await R.saveMessage({charId:T.id,role:"assistant",type:"interaction",content:"[]"}),Se=Se.replace("[[ACTION:POKE]]","").trim());const at=Se.match(/\[\[ACTION:TRANSFER:(\d+)\]\]/);at&&(await R.saveMessage({charId:T.id,role:"assistant",type:"transfer",content:"[]",metadata:{amount:at[1]}}),Se=Se.replace(at[0],"").trim());const gt=Se.match(/\[\[ACTION:ADD_EVENT\s*\|\s*(.*?)\s*\|\s*(.*?)\]\]/);if(gt){const st=gt[1].trim(),He=gt[2].trim();if(st&&He){const nt={id:`anni-${Date.now()}`,title:st,date:He,charId:T.id};await R.saveAnniversary(nt),c(`${T.name} : ${st}`,"success"),await R.saveMessage({charId:T.id,role:"system",type:"text",content:`[: ${T.name}  "${st}" (${He})]`})}Se=Se.replace(gt[0],"").trim()}const Rt=/\[schedule_message \| (.*?) \| fixed \| (.*?)\]/g;let Gt;for(;(Gt=Rt.exec(Se))!==null;){const st=Gt[1].trim(),He=Gt[2].trim(),nt=new Date(st).getTime();if(!isNaN(nt)&&nt>Date.now()){await R.saveScheduledMessage({id:`sched-${Date.now()}-${Math.random()}`,charId:T.id,content:He,dueAt:nt,createdAt:Date.now()});try{(await Yl.checkPermissions()).display==="granted"&&await Yl.schedule({notifications:[{title:T.name,body:He,id:Math.floor(Math.random()*1e5),schedule:{at:new Date(nt)},smallIcon:"ic_stat_icon_config_sample"}]})}catch{console.log("Notification schedule skipped (web mode)")}c(`${T.name} ...`,"info")}}Se=Se.replace(Rt,"").trim();let gs;const es=Se.match(/\[\[QUOTE:\s*(.*?)\]\]/);if(es){const st=es[1],He=Ht.slice().reverse().find(nt=>nt.role==="user"&&nt.content.includes(st));He&&(gs={id:He.id,content:He.content,name:d.name})}if(Se=Se.replace(/\[\[RECALL:.*?\]\]/g,"").trim(),Se){const st=/\[\[SEND_EMOJI:\s*(.*?)\]\]/g,He=[];let nt=0,lt;for(;(lt=st.exec(Se))!==null;){if(lt.index>nt){const mt=Se.slice(nt,lt.index).trim();mt&&He.push({type:"text",content:mt})}He.push({type:"emoji",content:lt[1].trim()}),nt=lt.index+lt[0].length}if(nt<Se.length){const mt=Se.slice(nt).trim();mt&&He.push({type:"text",content:mt})}He.length===0&&Se.trim()&&He.push({type:"text",content:Se.trim()});for(let mt=0;mt<He.length;mt++){const Vt=He[mt];if(Vt.type==="emoji"){const ds=H.find(Zt=>Zt.name===Vt.content);if(ds){const Zt=Math.random()*500+300;await new Promise(pt=>setTimeout(pt,Zt)),await R.saveMessage({charId:T.id,role:"assistant",type:"emoji",content:ds.url}),x(await R.getMessagesByCharId(T.id))}}else{const Zt=Vt.content.replace(/\.\.\./g,"{{ELLIPSIS_ENG}}").replace(//g,"{{ELLIPSIS_CN}}").replace(/([])(?![\)\]"'])/g,"{{SPLIT}}").replace(/\.($|\s+)/g,"{{SPLIT}}").replace(/([!?~]+)(?![\)\]"'])/g,"$1{{SPLIT}}").replace(/\n+/g,"{{SPLIT}}").replace(/([\u4e00-\u9fa5])[ ]+([\u4e00-\u9fa5])/g,"$1{{SPLIT}}$2").split("{{SPLIT}}").map(pt=>pt.trim()).filter(pt=>pt.length>0).map(pt=>pt.replace(/{{ELLIPSIS_ENG}}/g,"...").replace(/{{ELLIPSIS_CN}}/g,""));Zt.length===0&&Vt.content.trim()&&Zt.push(Vt.content.trim());for(let pt=0;pt<Zt.length;pt++){let bs=Zt[pt];const br=Math.min(Math.max(bs.length*50,500),2e3);await new Promise(ts=>setTimeout(ts,br));let Va;const vr=bs.match(/\[\[QUOTE:\s*(.*?)\]\]/);if(vr){const ts=vr[1],ss=Ht.slice().reverse().find(Xr=>Xr.role==="user"&&Xr.content.includes(ts));ss&&(Va={id:ss.id,content:ss.content,name:d.name}),bs=bs.replace(vr[0],"").trim()}const qr=Va||(mt===0&&pt===0?gs:void 0);bs&&(await R.saveMessage({charId:T.id,role:"assistant",type:"text",content:bs,replyTo:qr}),x(await R.getMessagesByCharId(T.id)))}}}}else x(await R.getMessagesByCharId(T.id))}catch(pn){await R.saveMessage({charId:T.id,role:"system",type:"text",content:`[: ${pn.message}]`}),x(await R.getMessagesByCharId(T.id))}finally{w(!1),k("")}}},hn=m.filter(he=>{var Oe;return((Oe=he.metadata)==null?void 0:Oe.source)!=="date"}).filter(he=>!T.hideBeforeMessageId||he.id>=T.hideBeforeMessageId).filter(he=>!(T.hideSystemLogs&&he.role==="system")).slice(-y);return t.jsxs("div",{className:"flex flex-col h-full bg-[#f1f5f9] overflow-hidden relative font-sans transition-all duration-500",style:{backgroundImage:T.chatBackground?`url(${T.chatBackground})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[de.customCss&&t.jsx("style",{children:de.customCss}),t.jsx(nx,{modalType:Ce,setModalType:je,transferAmt:Pe,setTransferAmt:ge,emojiImportText:ce,setEmojiImportText:N,settingsContextLimit:ne,setSettingsContextLimit:we,settingsHideSysLogs:D,setSettingsHideSysLogs:xe,preserveContext:A,setPreserveContext:le,editContent:ee,setEditContent:E,archivePrompts:J,selectedPromptId:V,setSelectedPromptId:Q,editingPrompt:ye,setEditingPrompt:be,isSummarizing:K,selectedMessage:re,selectedEmoji:Re,activeCharacter:T,messages:m,newCategoryName:se,setNewCategoryName:G,onAddCategory:ze,onTransfer:()=>{Pe&&Y("[]","transfer",{amount:Pe}),je("none")},onImportEmoji:Ge,onSaveSettings:Fe,onBgUpload:et,onRemoveBg:()=>r(T.id,{chatBackground:void 0}),onClearHistory:cs,onArchive:Cs,onCreatePrompt:Je,onEditPrompt:Qe,onSavePrompt:Be,onDeletePrompt:it,onSetHistoryStart:ht,onEnterSelectionMode:Pt,onReplyMessage:ct,onEditMessageStart:()=>{re&&(E(re.content),je("edit-message"))},onConfirmEditMessage:Ct,onDeleteMessage:tt,onDeleteEmoji:Lt}),t.jsx(Ze,{isOpen:Ce==="delete-category",title:"",onClose:()=>je("none"),footer:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>je("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),t.jsx("button",{onClick:Ye,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:""})]}),children:t.jsxs("div",{className:"py-4 text-center",children:[t.jsxs("p",{className:"text-sm text-slate-600",children:[" ",t.jsx("br",{}),t.jsxs("span",{className:"font-bold",children:['"',Ke==null?void 0:Ke.name,'"']})," "]}),t.jsx("p",{className:"text-[10px] text-red-400 mt-2",children:""})]})}),t.jsx(tx,{selectionMode:B,selectedCount:U.size,onCancelSelection:()=>{$(!1),S(new Set)},activeCharacter:T,isTyping:v,isSummarizing:K,lastTokenUsage:X,onClose:l,onTriggerAI:()=>rn(m),onShowCharsPanel:()=>j("chars")}),t.jsxs("div",{ref:Ee,className:"flex-1 overflow-y-auto pt-6 pb-6 no-scrollbar",style:{backgroundImage:de.type==="custom"&&de.user.backgroundImage?"none":void 0},children:[m.length>y&&t.jsx("div",{className:"flex justify-center mb-6",children:t.jsxs("button",{onClick:()=>C(he=>he+30),className:"px-4 py-2 bg-white/50 backdrop-blur-sm rounded-full text-xs text-slate-500 shadow-sm border border-white hover:bg-white transition-colors",children:[" (",m.length-y,")"]})}),hn.map((he,Oe)=>{const qe=Oe>0?hn[Oe-1].role:null,rt=Oe<hn.length-1?hn[Oe+1].role:null;return t.jsx(ex,{msg:he,isFirstInGroup:qe!==he.role,isLastInGroup:rt!==he.role,activeTheme:de,charAvatar:T.avatar,charName:T.name,userAvatar:d.avatar,onLongPress:dt=>{$e(dt),je("message-options")},selectionMode:B,isSelected:U.has(he.id),onToggleSelect:qn},he.id||Oe)}),(v||z)&&!B&&t.jsxs("div",{className:"flex items-end gap-3 px-3 mb-6 animate-fade-in",children:[t.jsx("img",{src:T.avatar,className:"w-9 h-9 rounded-[10px] object-cover"}),t.jsx("div",{className:"bg-white px-4 py-3 rounded-2xl shadow-sm",children:z?t.jsxs("div",{className:"flex items-center gap-2 text-xs text-indigo-500 font-medium",children:[t.jsxs("svg",{className:"animate-spin h-3 w-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),z]}):t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-75"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-150"})]})})]})]}),t.jsxs("div",{className:"relative z-40",children:[P&&t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-slate-50 border-b border-slate-200 text-xs text-slate-500",children:[t.jsxs("div",{className:"flex items-center gap-2 truncate",children:[t.jsx("span",{className:"font-bold text-slate-700",children:":"}),t.jsx("span",{className:"truncate max-w-[200px]",children:P.content})]}),t.jsx("button",{onClick:()=>Z(null),className:"p-1 text-slate-400 hover:text-slate-600",children:""})]}),t.jsx(sx,{input:g,setInput:Le,isTyping:v,selectionMode:B,showPanel:M,setShowPanel:j,onSend:()=>Y(),onDeleteSelected:nn,selectedCount:U.size,emojis:H.filter(he=>me==="default"?!he.categoryId||he.categoryId==="default":he.categoryId===me),characters:e,activeCharacterId:s,onCharSelect:he=>{n(he),j("none")},customThemes:o,onUpdateTheme:he=>r(T.id,{bubbleStyle:he}),onRemoveTheme:i,activeThemeId:ve,onPanelAction:ue,onImageSelect:fe,isSummarizing:K,categories:Ne,activeCategory:me,onReroll:ie,canReroll:oe})]})]})},ax=$n.memo(({msg:e,isUser:s,char:n,userAvatar:r,onImageClick:a,selectionMode:l,isSelected:o,onToggleSelect:i,onLongPress:c})=>{const d=s?r:n==null?void 0:n.avatar,f=s?"":(n==null?void 0:n.name)||"",h=u.useRef(null),p=u.useRef({x:0,y:0}),m=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),x=v=>{"touches"in v?p.current={x:v.touches[0].clientX,y:v.touches[0].clientY}:p.current={x:v.clientX,y:v.clientY},h.current=setTimeout(()=>{l||c(e.id)},500)},y=()=>{h.current&&(clearTimeout(h.current),h.current=null)},C=v=>{if(!h.current)return;let w,z;"touches"in v?(w=v.touches[0].clientX,z=v.touches[0].clientY):(w=v.clientX,z=v.clientY);const k=Math.abs(w-p.current.x),M=Math.abs(z-p.current.y);(k>10||M>10)&&(clearTimeout(h.current),h.current=null)},g=v=>{l&&(v.stopPropagation(),i(e.id))},b=()=>{switch(e.type){case"image":return t.jsx("div",{className:"relative group cursor-pointer",onClick:v=>{l?g(v):a(e.content)},children:t.jsx("img",{src:e.content,className:"max-w-[200px] max-h-[200px] rounded-xl shadow-sm border border-black/5",loading:"lazy"})});case"emoji":return t.jsx("img",{src:e.content,className:"w-24 h-24 object-contain drop-shadow-sm hover:scale-110 transition-transform"});case"transfer":return t.jsxs("div",{className:"w-60 bg-[#fb923c] text-white p-3 rounded-xl flex items-center gap-3 shadow-md relative overflow-hidden active:scale-95 transition-transform",children:[t.jsx("div",{className:"absolute -right-2 -top-2 text-white/20",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-16 h-16",children:[t.jsx("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.324.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),t.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z",clipRule:"evenodd"}),t.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),t.jsx("div",{className:"bg-white/20 p-2 rounded-full shrink-0",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:[t.jsx("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),t.jsx("path",{fillRule:"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75-.75H5.25a.75.75 0 0 1-.75-.75V9.75Z",clipRule:"evenodd"}),t.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),t.jsxs("div",{className:"z-10",children:[t.jsx("div",{className:"font-bold text-sm tracking-wide",children:" / "}),t.jsx("div",{className:"text-[10px] opacity-90",children:"Sully Pay"})]})]});default:return t.jsx("div",{className:`px-3.5 py-2 rounded-[18px] text-[15px] leading-relaxed shadow-sm whitespace-pre-wrap break-all ${s?"bg-violet-500 text-white rounded-tr-sm":"bg-white text-slate-700 rounded-tl-sm border border-slate-100"}`,children:e.content})}};return t.jsxs("div",{className:`flex gap-3 mb-4 w-full animate-fade-in relative ${s?"justify-end":"justify-start"} ${l?"pl-8":""}`,onTouchStart:x,onTouchEnd:y,onTouchMove:C,onMouseDown:x,onMouseUp:y,onMouseMove:C,onClick:g,children:[l&&t.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 cursor-pointer z-10",children:t.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${o?"bg-violet-500 border-violet-500":"border-slate-300 bg-white"}`,children:o&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),!s&&t.jsx("div",{className:"flex flex-col items-center gap-1 shrink-0",children:t.jsx("img",{src:d,className:"w-9 h-9 rounded-full object-cover shadow-sm border border-white",loading:"lazy"})}),t.jsxs("div",{className:`flex flex-col ${s?"items-end":"items-start"} max-w-[80%] ${l?"pointer-events-none":""}`,children:[!s&&t.jsx("span",{className:"text-[10px] text-slate-400 ml-1 mb-1",children:f}),b(),t.jsx("span",{className:"text-[9px] text-slate-300 mt-1 px-1",children:m})]}),s&&t.jsx("div",{className:"flex flex-col items-center gap-1 shrink-0",children:t.jsx("img",{src:d,className:"w-9 h-9 rounded-full object-cover shadow-sm border border-white",loading:"lazy"})})]})}),lx=()=>{const{closeApp:e,groups:s,createGroup:n,deleteGroup:r,characters:a,updateCharacter:l,apiConfig:o,addToast:i,userProfile:c,virtualTime:d}=xt(),[f,h]=u.useState("list"),[p,m]=u.useState(null),[x,y]=u.useState([]),[C,g]=u.useState(""),[b,v]=u.useState(!1),[w,z]=u.useState(!1),[k,M]=u.useState(!1),[j,H]=u.useState("none"),[te,Ne]=u.useState(!0),[Me,me]=u.useState(!1),[F,se]=u.useState(""),[G,Ee]=u.useState(!1),[P,Z]=u.useState(new Set),[X,pe]=u.useState([]),[Ce,je]=u.useState([]),[Pe,ge]=u.useState(""),[ce,N]=u.useState(new Set),[ne,we]=u.useState(""),D=u.useRef(null),xe=u.useRef(null),A=u.useRef(null);u.useEffect(()=>{p&&(R.getGroupMessages(p.id).then(B=>{y(B.sort(($,U)=>$.timestamp-U.timestamp))}),Promise.all([R.getEmojis(),R.getEmojiCategories()]).then(([B,$])=>{pe(B),je($)}))},[p]),u.useLayoutEffect(()=>{D.current&&!G&&(D.current.scrollTop=D.current.scrollHeight)},[x.length,p,w,k,b,G]);const le=u.useMemo(()=>b||x.length===0?!1:x[x.length-1].role==="assistant",[b,x]),re=B=>{const $=Date.now(),U=Math.floor(($-B)/(1e3*60*60)),S=Math.floor(($-B)/(1e3*60)),T=new Date().getHours(),ve=T>=23||T<=6;return S<10?"":S<60?` ${S} `:U<12?` ${U} ${ve?"":""}`:` ${U} `},$e=async B=>{const U=(await R.getMessagesByCharId(B)).filter(oe=>!oe.groupId);if(U.length===0)return"";const S=U[U.length-1],T=Date.now(),ve=Math.floor((T-S.timestamp)/(1e3*60)),de=Math.floor(ve/60),I=Math.floor(de/24);return ve<60?"":de<24?`${de}`:`${I}`},Re=B=>{Ee(!0),Z(new Set([B])),z(!1),M(!1)},De=B=>{const $=new Set(P);$.has(B)?$.delete(B):$.add(B),Z($)},Ke=async()=>{P.size!==0&&(await R.deleteMessages(Array.from(P)),y(B=>B.filter($=>!P.has($.id))),Ee(!1),Z(new Set),i(` ${P.size} `,"success"))},_=async()=>{if(!le||x[x.length-1].role!=="assistant")return;const $=[];let U=x.length-1;for(;U>=0&&x[U].role==="assistant";)$.push(x[U].id),U--;if($.length===0)return;await R.deleteMessages($);const S=x.slice(0,U+1);y(S),i("...","info"),be(S)},ee=()=>{if(!Pe.trim()||ce.size<2){i("2","error");return}n(Pe,Array.from(ce)),H("none"),ge(""),N(new Set),i("","success")},E=async()=>{if(!p)return;const B={...p,name:Pe||p.name};await R.saveGroup(B),m(B),H("none"),i("","success")},K=async B=>{var U;const $=(U=B.target.files)==null?void 0:U[0];if(!(!$||!p))try{const S=await ls($),T={...p,avatar:S};await R.saveGroup(T),m(T),i("","success")}catch{i("","error")}},ke=B=>{const $=new Set(ce);$.has(B)?$.delete(B):$.add(B),N($)},J=async B=>{await r(B),(p==null?void 0:p.id)===B&&h("list"),i("","success")},ae=async()=>{if(!p)return;let B=x;if(te&&(B=x.slice(0,-10),Math.min(x.length,10)),B.length===0){i("","info");return}await R.deleteMessages(B.map(U=>U.id));const $=te?x.slice(-10):[];y($),i(` ${B.length} ${te?" (10)":""}`,"success"),H("none")},V=async()=>{if(!p||!o.apiKey){i("","error");return}if(x.length===0){i("","info");return}me(!0),se("...");try{const B={};x.forEach(U=>{const S=new Date(U.timestamp).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-");B[S]||(B[S]=[]),B[S].push(U)});const $=Object.keys(B).sort();for(let U=0;U<$.length;U++){const S=$[U];se(` ${S} (${U+1}/${$.length})`);const ve=B[S].map(oe=>{var Le;return`${oe.role==="user"?c.name:((Le=a.find(Te=>Te.id===oe.charId))==null?void 0:Le.name)||""}: ${oe.content}`}).join(`
`),de=`
### Task: Group Chat Summary
Group: "${p.name}"
Date: ${S}

### Instructions
Summarize the following chat log into a **concise, 3rd-person, YAML format**.
- Focus on interactions, conflicts, and key topics.
- Be objective (like a narrator).
- **Strictly output valid YAML only.**

### Example Output
summary: "In [Group Name], [Char A] shared a photo of a cat. [Char B] made a joke about it, which caused a brief playful argument about pets."

### Logs
${ve.substring(0,1e4)}
`,I=await fetch(`${o.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:o.model,messages:[{role:"user",content:de}],temperature:.3})});if(I.ok){let Ie=(await I.json()).choices[0].message.content.trim();const Le=Ie.match(/summary:\s*["']?([\s\S]*?)["']?$/);let Te=Le?Le[1]:Ie.replace(/^summary:\s*/i,"");if(Te=Te.replace(/^["']|["']$/g,"").trim(),Te){const O={id:`mem-${Date.now()}-${Math.random()}`,date:S,summary:`[: ${p.name}] ${Te}`,mood:"group"};for(const W of p.members){const q=a.find(Y=>Y.id===W);if(q){const Y=[...q.memories||[],O];l(q.id,{memories:Y})}}}}await new Promise(oe=>setTimeout(oe,500))}i("","success"),H("none")}catch(B){console.error(B),i(`: ${B.message}`,"error")}finally{me(!1),se("")}},Q=async(B,$="text",U)=>{if(!p)return;const S={charId:"user",groupId:p.id,role:"user",type:$,content:B,metadata:U};await R.saveMessage(S);const T=await R.getGroupMessages(p.id);y(T),$!=="text"&&(z(!1),M(!1)),g("")},ye=async B=>{var U;const $=(U=B.target.files)==null?void 0:U[0];if($)try{const S=await ls($,{maxWidth:600,quality:.7,forceJpeg:!0});Q(S,"image")}catch{i("","error")}},be=async B=>{var $;if(!(!p||!o.apiKey)){v(!0);try{const U=a.filter(ie=>p.members.includes(ie.id)),S=B[B.length-1],T=S?re(S.timestamp):"",ve=`${d.hours.toString().padStart(2,"0")}:${d.minutes.toString().padStart(2,"0")}`;let de=`
: "${p.name}"
: ${ve}
: ${T}
 (User): ${c.name} ()
`;for(const ie of U){const fe=Et.buildCoreContext(ie,c,!0),ue=await R.getMessagesByCharId(ie.id),ze=await $e(ie.id),Ge=ue.slice(-10).map(Ye=>`[${Ye.role==="user"?"":""}]: ${Ye.content.substring(0,50)}`).join(`
`);de+=`
<<<  START: ${ie.name} (ID: ${ie.id}) >>>
${fe}

[ (Private Context)]: 
- ****: ${ze}
- ****:  []  ""  "" "" 
- :
${Ge||"()"}
<<<  END >>>
`}const I=B.slice(-30).map(ie=>{var ze,Ge;let fe="";ie.role==="assistant"&&(fe=((ze=a.find(Ye=>Ye.id===ie.charId))==null?void 0:ze.name)||"");const ue=ie.type==="image"?"[]":ie.type==="emoji"?`[: ${ie.content}]`:ie.type==="transfer"?`[: ${(Ge=ie.metadata)==null?void 0:Ge.amount}]`:ie.content;return`${fe}: ${ue}`}).join(`
`),oe=(()=>{if(X.length===0)return"";const ie={},fe={default:""};return Ce.forEach(ue=>fe[ue.id]=ue.name),X.forEach(ue=>{const ze=ue.categoryId||"default";ie[ze]||(ie[ze]=[]),ie[ze].push(ue.name)}),Object.entries(ie).map(([ue,ze])=>`${fe[ue]||""}: [${ze.join(", ")}]`).join("; ")})(),Ie=`${de}

### AI  (Director Mode)


${I}

###  (Conversation Flow)
****

###  (Strict Rules)
1. ****: A,BAB
2. ****:  **1  6 ** 
3. ****:
   - 
   - : \`[[SEND_EMOJI: ]]\`
   - ** ()**: ${oe}
4. ** (Bubble Splitting)**:
   - 
   -  "" 
5. ** ()**:
   -  []
   - TA ""
6. ** (Private Messaging)**:
   - 
   - : \`[[PRIVATE: ]]\`
   - ****
   - 

###  (JSON Array)
[
  {
    "charId": "ID",
    "content": "... ([[SEND_EMOJI: name]]  [[PRIVATE: content]])"
  },
  ...
]
`,Le=await fetch(`${o.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:o.model,messages:[{role:"user",content:Ie}],temperature:.9,max_tokens:8e3})});if(!Le.ok)throw new Error("Director Failed");let O=(await Le.json()).choices[0].message.content;O=O.replace(/```json/g,"").replace(/```/g,"").trim();const W=O.indexOf("["),q=O.lastIndexOf("]");W!==-1&&q!==-1&&(O=O.substring(W,q+1));let Y=[];try{Y=JSON.parse(O),Array.isArray(Y)||(Y=[])}catch{console.error("Director Parse Error",O)}for(const ie of Y){const fe=p.members.find(Je=>Je===ie.charId);if(!fe)continue;const ue=(($=a.find(Je=>Je.id===fe))==null?void 0:$.name)||"",ze=[],Ge=/\[\[PRIVATE\s*[:]\s*([\s\S]*?)\]\]/g;let Ye;for(;(Ye=Ge.exec(ie.content))!==null;)ze.push(Ye);if(ze.length>0){for(const Je of ze){const Qe=Je[1].trim();Qe&&(await R.saveMessage({charId:fe,role:"assistant",type:"text",content:Qe}),i(`${ue} : ${Qe.substring(0,15)}...`,"info")),ie.content=ie.content.replace(Je[0],"")}if(ie.content=ie.content.trim(),!ie.content)continue}const Be=ie.content.match(/\[\[SEND_EMOJI:\s*(.*?)\]\]/);if(Be){const Je=Be[1].trim(),Qe=X.find(et=>et.name===Je);if(Qe){await R.saveMessage({charId:fe,groupId:p.id,role:"assistant",type:"emoji",content:Qe.url}),y(await R.getGroupMessages(p.id)),await new Promise(et=>setTimeout(et,800));continue}}let it=ie.content.replace(/\[\[SEND_EMOJI:.*?\]\]/g,"").trim();if(it){const Qe=it.replace(/\.\.\./g,"{{ELLIPSIS_ENG}}").replace(//g,"{{ELLIPSIS_CN}}").replace(/([])(?![\)\]"'])/g,"{{SPLIT}}").replace(/\.($|\s+)/g,"{{SPLIT}}").replace(/([!?~]+)(?![\)\]"'])/g,"$1{{SPLIT}}").replace(/\n+/g,"{{SPLIT}}").split("{{SPLIT}}").map(et=>et.trim()).filter(et=>et.length>0).map(et=>et.replace(/{{ELLIPSIS_ENG}}/g,"...").replace(/{{ELLIPSIS_CN}}/g,""));Qe.length===0&&Qe.push(it);for(const et of Qe){const Fe=Math.max(500,et.length*50+Math.random()*200);await new Promise(cs=>setTimeout(cs,Fe)),await R.saveMessage({charId:fe,groupId:p.id,role:"assistant",type:"text",content:et}),y(await R.getGroupMessages(p.id))}}}}catch(U){console.error(U)}finally{v(!1)}}};return f==="list"?t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[t.jsxs("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-medium text-slate-700 text-lg tracking-wide pl-2",children:""}),t.jsx("div",{className:"flex-1"}),t.jsx("button",{onClick:()=>{H("create"),N(new Set),ge("")},className:"p-2 -mr-2 text-violet-500 bg-violet-50 hover:bg-violet-100 rounded-full transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),t.jsxs("div",{className:"p-4 space-y-3 overflow-y-auto",children:[s.map(B=>t.jsxs("div",{onClick:()=>{m(B),h("chat")},className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4 active:scale-[0.98] transition-all cursor-pointer group hover:bg-violet-50/30",children:[t.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 overflow-hidden border border-slate-200 relative shadow-sm",children:B.avatar?t.jsx("img",{src:B.avatar,className:"w-full h-full object-cover"}):t.jsx("div",{className:"grid grid-cols-2 gap-0.5 p-0.5 w-full h-full bg-slate-200",children:B.members.slice(0,4).map($=>{const U=a.find(S=>S.id===$);return t.jsx("img",{src:U==null?void 0:U.avatar,className:"w-full h-full object-cover rounded-sm bg-white"},$)})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-slate-700 truncate text-base",children:B.name}),t.jsxs("div",{className:"text-xs text-slate-400 mt-1 flex items-center gap-1",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:t.jsx("path",{d:"M7 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM14.5 9a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5ZM1.615 16.428a1.224 1.224 0 0 1-.569-1.175 6.002 6.002 0 0 1 11.908 0c.058.467-.172.92-.57 1.174A9.953 9.953 0 0 1 7 18a9.953 9.953 0 0 1-5.385-1.572ZM14.5 16h-.106c.07-.297.088-.611.048-.933a7.47 7.47 0 0 0-1.588-3.755 4.502 4.502 0 0 1 5.874 2.636.818.818 0 0 1-.36.98A7.465 7.465 0 0 1 14.5 16Z"})}),B.members.length," "]})]}),t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-slate-300",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})})]},B.id)),s.length===0&&t.jsxs("div",{className:"text-center text-slate-400 text-xs py-10 flex flex-col items-center gap-2",children:[t.jsx("span",{className:"text-3xl opacity-50",children:""}),""]})]}),t.jsx(Ze,{isOpen:j==="create",title:"",onClose:()=>H("none"),footer:t.jsx("button",{onClick:ee,className:"w-full py-3 bg-violet-500 text-white font-bold rounded-2xl shadow-lg shadow-violet-200",children:""}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("input",{value:Pe,onChange:B=>ge(B.target.value),placeholder:"",className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-violet-500/20 transition-all"}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:""}),t.jsx("div",{className:"grid grid-cols-4 gap-2 max-h-48 overflow-y-auto pr-1",children:a.map(B=>t.jsxs("div",{onClick:()=>ke(B.id),className:`flex flex-col items-center gap-1 p-2 rounded-xl border transition-all cursor-pointer ${ce.has(B.id)?"border-violet-500 bg-violet-50 ring-1 ring-violet-500":"border-slate-100 bg-white hover:border-slate-300"}`,children:[t.jsx("img",{src:B.avatar,className:"w-10 h-10 rounded-full object-cover"}),t.jsx("span",{className:"text-[9px] text-slate-600 truncate w-full text-center font-medium",children:B.name})]},B.id))})]})]})})]}):t.jsxs("div",{className:"h-full w-full bg-[#f0f4f8] flex flex-col font-sans relative",children:[t.jsx("div",{className:"h-24 bg-white/80 backdrop-blur-xl px-5 flex items-end pb-4 border-b border-slate-200/60 shrink-0 z-30 sticky top-0 shadow-sm transition-all",children:G?t.jsxs("div",{className:"flex items-center justify-between w-full",children:[t.jsx("button",{onClick:()=>{Ee(!1),Z(new Set)},className:"text-sm font-bold text-slate-500 px-2 py-1",children:""}),t.jsxs("span",{className:"text-sm font-bold text-slate-800",children:[" ",P.size," "]}),t.jsx("div",{className:"w-10"})]}):t.jsxs("div",{className:"flex items-center gap-3 w-full",children:[t.jsx("button",{onClick:()=>h("list"),className:"p-2 -ml-2 rounded-full hover:bg-slate-100 active:bg-slate-200 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>{ge((p==null?void 0:p.name)||""),H("settings")},children:[t.jsxs("h1",{className:"text-base font-bold text-slate-800 truncate flex items-center gap-1",children:[p==null?void 0:p.name,t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3 text-slate-400",children:t.jsx("path",{fillRule:"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z",clipRule:"evenodd"})})]}),t.jsxs("p",{className:"text-[10px] text-slate-500 font-medium",children:[p==null?void 0:p.members.length," "]})]}),le&&!b&&t.jsx("button",{onClick:_,className:"p-2 rounded-full bg-slate-100 text-slate-500 hover:text-violet-600 transition-colors",title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("button",{onClick:()=>be(x),disabled:b,className:`p-2 rounded-full transition-all active:scale-90 ${b?"bg-slate-100 text-slate-300":"bg-violet-100 text-violet-600 shadow-sm"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:t.jsx("path",{fillRule:"evenodd",d:"M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .914-.143Z",clipRule:"evenodd"})})})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 no-scrollbar space-y-2 bg-[#f0f4f8]",ref:D,children:[x.map((B,$)=>{const U=B.role==="user",S=a.find(T=>T.id===B.charId);return t.jsx(ax,{msg:B,isUser:U,char:S,userAvatar:c.avatar,onImageClick:T=>window.open(T,"_blank"),selectionMode:G,isSelected:P.has(B.id),onToggleSelect:De,onLongPress:Re},$)}),b&&t.jsxs("div",{className:"flex items-center gap-2 pl-4 py-2 animate-pulse opacity-70",children:[t.jsxs("div",{className:"flex -space-x-1",children:[t.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-300 border-2 border-white"}),t.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-200 border-2 border-white"})]}),t.jsx("span",{className:"text-xs text-slate-400 font-medium",children:"..."})]})]}),t.jsxs("div",{className:"bg-[#f0f2f5] border-t border-slate-200 pb-safe shrink-0 z-40 relative",children:[G?t.jsx("div",{className:"p-3 flex justify-center bg-white",children:t.jsxs("button",{onClick:Ke,className:"w-full py-3 bg-red-500 text-white font-bold rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})," (",P.size,")"]})}):t.jsxs("div",{className:"p-2 flex items-end gap-2",children:[t.jsx("button",{onClick:()=>{z(!w),M(!1)},className:`w-9 h-9 rounded-full flex items-center justify-center shrink-0 transition-transform ${w?"bg-slate-300 rotate-45":"bg-transparent hover:bg-slate-200"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-7 h-7 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),t.jsxs("div",{className:"flex-1 bg-white rounded-xl flex items-end px-3 py-2 border border-slate-200 focus-within:border-violet-400 focus-within:ring-2 focus-within:ring-violet-100 transition-all",children:[t.jsx("textarea",{rows:1,value:C,onChange:B=>g(B.target.value),onKeyDown:B=>{B.key==="Enter"&&!B.shiftKey&&(B.preventDefault(),Q(C))},className:"flex-1 bg-transparent text-[16px] outline-none resize-none max-h-28 text-slate-800 placeholder:text-slate-400 py-1",placeholder:"Message...",style:{height:"auto",minHeight:"24px"}}),t.jsx("button",{onClick:()=>{M(!k),z(!1)},className:"p-1 -mr-1 ml-1 text-slate-400 hover:text-yellow-500 transition-colors shrink-0",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})})})]}),C.trim()?t.jsx("button",{onClick:()=>Q(C),className:"h-9 px-4 bg-violet-500 text-white rounded-xl font-bold text-sm shadow-md active:scale-95 transition-all",children:""}):t.jsx("div",{className:"w-2"})]}),w&&t.jsx("div",{className:"h-64 bg-[#f0f2f5] border-t border-slate-200 p-6 animate-slide-up",children:t.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[t.jsxs("button",{onClick:()=>{var B;return(B=xe.current)==null?void 0:B.click()},className:"flex flex-col items-center gap-2 group",children:[t.jsx("div",{className:"w-14 h-14 bg-white rounded-2xl flex items-center justify-center shadow-sm border border-slate-200 group-active:scale-95 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})})}),t.jsx("span",{className:"text-xs text-slate-500",children:""})]}),t.jsx("input",{type:"file",ref:xe,className:"hidden",accept:"image/*",onChange:ye}),t.jsxs("button",{onClick:()=>H("transfer"),className:"flex flex-col items-center gap-2 group",children:[t.jsx("div",{className:"w-14 h-14 bg-white rounded-2xl flex items-center justify-center shadow-sm border border-slate-200 group-active:scale-95 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-orange-500",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),t.jsx("span",{className:"text-xs text-slate-500",children:""})]})]})}),k&&t.jsx("div",{className:"h-64 bg-[#f0f2f5] border-t border-slate-200 p-4 animate-slide-up overflow-y-auto no-scrollbar",children:t.jsx("div",{className:"grid grid-cols-5 gap-3",children:X.map((B,$)=>t.jsx("button",{onClick:()=>Q(B.url,"emoji"),className:"aspect-square bg-white rounded-xl p-2 border border-slate-200 shadow-sm active:scale-95 flex items-center justify-center",children:t.jsx("img",{src:B.url,className:"w-full h-full object-contain pointer-events-none"})},$))})})]}),t.jsx(Ze,{isOpen:j==="settings",title:"",onClose:()=>H("none"),footer:t.jsx("button",{onClick:E,className:"w-full py-3 bg-violet-500 text-white font-bold rounded-2xl shadow-lg shadow-violet-200",children:""}),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-center",children:[t.jsxs("div",{onClick:()=>{var B;return(B=A.current)==null?void 0:B.click()},className:"w-24 h-24 rounded-3xl bg-slate-100 border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer overflow-hidden relative group hover:border-violet-400",children:[p!=null&&p.avatar?t.jsx("img",{src:p.avatar,className:"w-full h-full object-cover opacity-90 group-hover:opacity-100"}):t.jsx("span",{className:"text-xs text-slate-400 font-bold",children:""}),t.jsx("div",{className:"absolute inset-0 bg-black/20 hidden group-hover:flex items-center justify-center text-white",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"})]})})]}),t.jsx("input",{type:"file",ref:A,className:"hidden",accept:"image/*",onChange:K})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:""}),t.jsx("input",{value:Pe,onChange:B=>ge(B.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:bg-white focus:border-violet-300 transition-all"})]}),t.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 block",children:" (Neural Link)"}),t.jsx("button",{onClick:V,disabled:Me,className:"w-full py-3 bg-indigo-50 text-indigo-600 font-bold rounded-2xl border border-indigo-100 active:scale-95 transition-transform flex items-center justify-center gap-2 mb-2",children:Me?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-indigo-200 border-t-indigo-500 rounded-full animate-spin"}),t.jsx("span",{className:"text-xs",children:F||"..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})," "]})}),t.jsx("p",{className:"text-[9px] text-slate-400 leading-tight px-1",children:'""'})]}),t.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[t.jsx("label",{className:"text-[10px] font-bold text-red-400 uppercase tracking-widest mb-3 block",children:""}),t.jsxs("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>Ne(!te),children:[t.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${te?"bg-violet-500 border-violet-500":"bg-slate-100 border-slate-300"}`,children:te&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),t.jsx("span",{className:"text-xs text-slate-600",children:"10 ()"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:ae,className:"flex-1 py-3 bg-red-50 text-red-500 font-bold rounded-2xl border border-red-100 active:scale-95 transition-transform flex items-center justify-center gap-2 text-xs",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),""]}),t.jsx("button",{onClick:()=>{p&&J(p.id)},className:"flex-1 py-3 text-white bg-red-500 hover:bg-red-600 rounded-2xl text-xs font-bold transition-colors shadow-lg shadow-red-200",children:""})]})]})]})}),t.jsx(Ze,{isOpen:j==="transfer",title:"",onClose:()=>H("none"),footer:t.jsx("button",{onClick:()=>{Q(`[] ${ne} Credits`,"transfer",{amount:ne}),H("none")},className:"w-full py-3 bg-orange-500 text-white font-bold rounded-2xl shadow-lg shadow-orange-200",children:""}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-center text-5xl py-4 animate-bounce",children:""}),t.jsx("input",{type:"number",value:ne,onChange:B=>we(B.target.value),placeholder:"",className:"w-full px-4 py-4 bg-slate-100 rounded-2xl text-center text-2xl font-bold outline-none text-slate-800 placeholder:text-slate-300",autoFocus:!0})]})})]})},xu={textColor:"#334155",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5,decorationX:90,decorationY:-10,decorationScale:1,decorationRotate:0,avatarDecorationX:50,avatarDecorationY:50,avatarDecorationScale:1,avatarDecorationRotate:0},ox={id:"",name:"New Theme",type:"custom",user:{...xu,textColor:"#ffffff",backgroundColor:"#6366f1"},ai:{...xu},customCss:""},ix=[{name:" (Glass)",code:`/* Glassmorphism for bubbles */
.sully-bubble-user, .sully-bubble-ai {
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.4);
  box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}
.sully-bubble-user { background: rgba(99, 102, 241, 0.7) !important; }
.sully-bubble-ai { background: rgba(255, 255, 255, 0.7) !important; }`},{name:" (Neon)",code:`/* Glowing Neon Borders */
.sully-bubble-user {
  border: 2px solid #a855f7;
  box-shadow: 0 0 10px #a855f7;
  background: #2e1065 !important;
  color: #fff !important;
}
.sully-bubble-ai {
  border: 2px solid #3b82f6;
  box-shadow: 0 0 10px #3b82f6;
  background: #172554 !important;
  color: #fff !important;
}`},{name:" (Pixel)",code:`/* Pixel Art Style */
.sully-bubble-user, .sully-bubble-ai {
  border-radius: 0px !important;
  border: 2px solid #000;
  box-shadow: 4px 4px 0px #000;
  font-family: monospace;
}`}],cx=e=>{let s="#ffffff",n=1;if(!e)return{hex:s,alpha:n};if(e.startsWith("#"))return s=e.substring(0,7),{hex:s,alpha:1};if(e.startsWith("rgba")){const r=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(r){const a=parseInt(r[1]),l=parseInt(r[2]),o=parseInt(r[3]),i=r[4]?parseFloat(r[4]):1,c=d=>d.toString(16).padStart(2,"0");s=`#${c(a)}${c(l)}${c(o)}`,n=i}}return{hex:s,alpha:n}},dx=(e,s)=>{const n=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16);return`rgba(${n}, ${r}, ${a}, ${s})`},gu="/* PADDING_AUTO_START */",bu="/* PADDING_AUTO_END */",ux=(e,s)=>{const n=Math.round(s*1.6),r=`
${gu}
.sully-bubble-user, .sully-bubble-ai {
  padding: ${s}px ${n}px !important;
}
${bu}`,a=new RegExp(`${gu.replace(/\*/g,"\\*")}[\\s\\S]*?${bu.replace(/\*/g,"\\*")}`);return e&&e.match(a)?e.replace(a,r):(e||"")+r},mx=e=>{const s=e==null?void 0:e.match(/padding:\s*(\d+)px/);return s?parseInt(s[1]):12},fx=()=>{const{closeApp:e,addCustomTheme:s,addToast:n}=xt(),[r,a]=u.useState({...ox,id:`theme-${Date.now()}`}),[l,o]=u.useState("user"),[i,c]=u.useState("base"),[d,f]=u.useState(12),h=u.useRef(null),p=u.useRef(null),m=u.useRef(null),x=r[l==="css"?"user":l];u.useEffect(()=>{r.customCss&&f(mx(r.customCss))},[]);const y=(k,M)=>{l!=="css"&&a(j=>({...j,[l]:{...j[l],[k]:M}}))},C=(k,M)=>{const j=M===1?k:dx(k,M);y("backgroundColor",j)},g=k=>{f(k);const M=ux(r.customCss||"",k);a(j=>({...j,customCss:M}))},b=async(k,M)=>{try{const j=await ls(k);M==="bg"?y("backgroundImage",j):M==="deco"?y("decoration",j):M==="avatarDeco"&&y("avatarDecoration",j),n("","success")}catch(j){n(j.message,"error")}},v=()=>{r.name.trim()&&(s(r),e())},w=k=>{const M=k==="user"?r.user:r.ai,j=k==="user",H=l===k||l==="css",te={backgroundColor:M.backgroundColor,borderRadius:`${M.borderRadius}px`,opacity:M.opacity,borderBottomLeftRadius:j?`${M.borderRadius}px`:"4px",borderBottomRightRadius:j?"4px":`${M.borderRadius}px`,borderTopLeftRadius:`${M.borderRadius}px`,borderTopRightRadius:`${M.borderRadius}px`};return t.jsxs("div",{className:`relative w-full flex items-end transition-all duration-300 cursor-pointer ${H?"opacity-100 scale-100":"opacity-60 scale-95 grayscale-[0.5] hover:opacity-80"} ${j?"justify-end":"justify-start"}`,onClick:()=>o(k),title:`${j?"":""}`,children:[t.jsxs("div",{className:`absolute bottom-0 ${j?"right-0":"left-0"} w-10 h-10 pb-1 z-10`,children:[t.jsx("div",{className:"w-full h-full rounded-full bg-slate-300 overflow-hidden relative z-0 shadow-sm border border-white/50",children:t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white/50 font-bold text-[10px]",children:j?"ME":"AI"})}),M.avatarDecoration&&t.jsx("img",{src:M.avatarDecoration,className:"absolute pointer-events-none z-10 max-w-none",style:{left:`${M.avatarDecorationX??50}%`,top:`${M.avatarDecorationY??50}%`,width:`${40*(M.avatarDecorationScale??1)}px`,height:"auto",transform:`translate(-50%, -50%) rotate(${M.avatarDecorationRotate??0}deg)`}})]}),t.jsxs("div",{className:`relative group max-w-[75%] ${j?"mr-14":"ml-14"}`,children:[M.decoration&&t.jsx("img",{src:M.decoration,className:"absolute z-20 w-8 h-8 object-contain drop-shadow-sm pointer-events-none",style:{left:`${M.decorationX??(j?90:10)}%`,top:`${M.decorationY??-10}%`,transform:`translate(-50%, -50%) scale(${M.decorationScale??1}) rotate(${M.decorationRotate??0}deg)`}}),t.jsxs("div",{className:`relative px-5 py-3 shadow-sm text-sm overflow-hidden ${j?"sully-bubble-user":"sully-bubble-ai"}`,style:te,children:[M.backgroundImage&&t.jsx("div",{className:"absolute inset-0 bg-cover bg-center pointer-events-none z-0",style:{backgroundImage:`url(${M.backgroundImage})`,opacity:M.backgroundImageOpacity??.5}}),t.jsx("span",{className:"relative z-10 leading-relaxed",style:{color:M.textColor},children:j?"":""})]})]})]})},z=cx(x.backgroundColor);return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light relative",children:[t.jsxs("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-20 justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("h1",{className:"text-xl font-medium text-slate-700",children:""})]}),t.jsx("button",{onClick:v,className:"px-4 py-1.5 bg-primary text-white rounded-full text-xs font-bold shadow-lg shadow-primary/30 active:scale-95 transition-all",children:""})]}),t.jsxs("div",{className:"flex-1 bg-slate-100 relative overflow-hidden flex flex-col p-6 justify-center items-center gap-6",children:[t.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(#cbd5e1 1px, transparent 1px)",backgroundSize:"20px 20px"}}),r.customCss&&t.jsx("style",{children:r.customCss}),t.jsxs("div",{className:"w-full max-w-sm space-y-6",children:[w("ai"),w("user")]}),t.jsx("div",{className:"text-[10px] text-slate-400 absolute bottom-2",children:""})]}),t.jsxs("div",{className:"bg-white rounded-t-[2.5rem] shadow-[0_-5px_30px_rgba(0,0,0,0.08)] z-30 flex flex-col h-[55%] ring-1 ring-slate-100",children:[t.jsxs("div",{className:"flex px-8 pt-6 pb-2 gap-6 overflow-x-auto no-scrollbar",children:[t.jsx("button",{onClick:()=>o("user"),className:`text-sm font-bold transition-colors whitespace-nowrap ${l==="user"?"text-slate-800":"text-slate-300"}`,children:""}),t.jsx("button",{onClick:()=>o("ai"),className:`text-sm font-bold transition-colors whitespace-nowrap ${l==="ai"?"text-slate-800":"text-slate-300"}`,children:""}),t.jsxs("button",{onClick:()=>o("css"),className:`text-sm font-bold transition-colors whitespace-nowrap flex items-center gap-1 ${l==="css"?"text-indigo-600":"text-slate-300"}`,children:[t.jsx("span",{children:""})," CSS"]})]}),l!=="css"&&t.jsxs("div",{className:"flex px-6 border-b border-slate-100 mb-2 overflow-x-auto no-scrollbar",children:[t.jsx("button",{onClick:()=>c("base"),className:`px-4 py-3 text-xs font-bold uppercase tracking-wider border-b-2 transition-all shrink-0 ${i==="base"?"border-primary text-primary":"border-transparent text-slate-400"}`,children:""}),t.jsx("button",{onClick:()=>c("sticker"),className:`px-4 py-3 text-xs font-bold uppercase tracking-wider border-b-2 transition-all shrink-0 ${i==="sticker"?"border-primary text-primary":"border-transparent text-slate-400"}`,children:""}),t.jsx("button",{onClick:()=>c("avatar"),className:`px-4 py-3 text-xs font-bold uppercase tracking-wider border-b-2 transition-all shrink-0 ${i==="avatar"?"border-primary text-primary":"border-transparent text-slate-400"}`,children:""})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 no-scrollbar pb-20",children:[l==="css"&&t.jsxs("div",{className:"space-y-6 animate-fade-in h-full flex flex-col",children:[t.jsxs("div",{className:"text-[10px] text-slate-400 bg-slate-50 p-3 rounded-xl border border-slate-100 leading-relaxed",children:[t.jsx("span",{className:"font-bold block mb-1 text-slate-500",children:"CSS "}),"CSS ",t.jsx("code",{className:"bg-slate-200 px-1 rounded",children:".sully-bubble-user"}),"  ",t.jsx("code",{className:"bg-slate-200 px-1 rounded",children:".sully-bubble-ai"})," ",t.jsx("br",{})," ",t.jsx("code",{className:"text-red-400",children:"!important"})," "]}),t.jsx("textarea",{value:r.customCss||"",onChange:k=>a(M=>({...M,customCss:k.target.value})),placeholder:"/*  CSS  */",className:"flex-1 w-full bg-slate-800 text-slate-300 font-mono text-xs p-4 rounded-xl resize-none shadow-inner focus:ring-2 focus:ring-indigo-500 outline-none leading-relaxed",spellCheck:!1}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:" (Templates)"}),t.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-2",children:ix.map((k,M)=>t.jsx("button",{onClick:()=>a(j=>({...j,customCss:k.code})),className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-xs font-mono text-slate-600 border border-slate-200 whitespace-nowrap transition-colors",children:k.name},M))})]})]}),l!=="css"&&i==="base"&&t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:" (Theme Name)"}),t.jsx("input",{value:r.name,onChange:k=>a(M=>({...M,name:k.target.value})),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm focus:border-primary/50 transition-all outline-none",placeholder:""})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:""}),t.jsx("div",{className:"flex items-center gap-2 bg-slate-50 p-2 rounded-xl border border-slate-100",children:t.jsx("input",{type:"color",value:x.textColor,onChange:k=>y("textColor",k.target.value),className:"w-8 h-8 rounded-lg border-none cursor-pointer bg-transparent"})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:" (Base)"}),t.jsx("div",{className:"flex items-center gap-2 bg-slate-50 p-2 rounded-xl border border-slate-100",children:t.jsx("input",{type:"color",value:z.hex,onChange:k=>C(k.target.value,z.alpha),className:"w-8 h-8 rounded-lg border-none cursor-pointer bg-transparent"})})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between mb-2",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:" (Background Alpha)"}),t.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:[Math.round(z.alpha*100),"%"]})]}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:z.alpha,onChange:k=>C(z.hex,parseFloat(k.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between mb-2",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"/ (Size/Padding)"}),t.jsx("span",{className:"text-[10px] text-slate-500 font-mono",children:d<=6?"Compact":d>=16?"Loose":"Normal"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-[10px] text-slate-400",children:""}),t.jsx("input",{type:"range",min:"4",max:"24",step:"1",value:d,onChange:k=>g(parseInt(k.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"}),t.jsx("span",{className:"text-[10px] text-slate-400",children:""})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between mb-2",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:""}),t.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:[x.borderRadius,"px"]})]}),t.jsx("input",{type:"range",min:"0",max:"30",value:x.borderRadius,onChange:k=>y("borderRadius",parseInt(k.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),t.jsxs("div",{onClick:()=>{var k;return(k=h.current)==null?void 0:k.click()},className:"cursor-pointer group relative h-24 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 flex flex-col items-center justify-center text-slate-400 overflow-hidden hover:border-primary/50 hover:text-primary transition-all",children:[x.backgroundImage?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:x.backgroundImage,className:"absolute inset-0 w-full h-full object-cover opacity-50"}),t.jsx("span",{className:"relative z-10 text-[10px] bg-white/80 px-2 py-1 rounded shadow-sm font-bold",children:""})]}):t.jsx("span",{className:"text-xs font-bold",children:"+  (Texture)"}),t.jsx("input",{type:"file",ref:h,className:"hidden",accept:"image/*",onChange:k=>{var M;return((M=k.target.files)==null?void 0:M[0])&&b(k.target.files[0],"bg")}}),x.backgroundImage&&t.jsx("button",{onClick:k=>{k.stopPropagation(),y("backgroundImage",void 0)},className:"absolute top-2 right-2 text-[10px] bg-red-100 text-red-500 px-2 py-0.5 rounded-full z-20",children:""})]}),x.backgroundImage&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between mb-2",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:""}),t.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:[Math.round((x.backgroundImageOpacity??.5)*100),"%"]})]}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:x.backgroundImageOpacity??.5,onChange:k=>y("backgroundImageOpacity",parseFloat(k.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]})]}),l!=="css"&&i==="sticker"&&t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{onClick:()=>{var k;return(k=p.current)==null?void 0:k.click()},className:"cursor-pointer group relative h-20 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 flex items-center justify-center text-slate-400 hover:border-primary/50 hover:text-primary transition-all",children:[x.decoration?t.jsx("img",{src:x.decoration,className:"h-10 w-10 object-contain"}):t.jsx("span",{className:"text-xs font-bold",children:"+ /"}),t.jsx("input",{type:"file",ref:p,className:"hidden",accept:"image/*",onChange:k=>{var M;return((M=k.target.files)==null?void 0:M[0])&&b(k.target.files[0],"deco")}}),x.decoration&&t.jsx("button",{onClick:k=>{k.stopPropagation(),y("decoration",void 0)},className:"absolute top-2 right-2 text-[10px] bg-red-100 text-red-500 px-2 py-0.5 rounded-full",children:""})]}),x.decoration&&t.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-6 p-2",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:" (X / Y)"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("input",{type:"range",min:"-50",max:"150",value:x.decorationX??90,onChange:k=>y("decorationX",parseInt(k.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"}),t.jsx("input",{type:"range",min:"-50",max:"150",value:x.decorationY??-10,onChange:k=>y("decorationY",parseInt(k.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.decorationScale??1,"x)"]}),t.jsx("input",{type:"range",min:"0.2",max:"3",step:"0.1",value:x.decorationScale??1,onChange:k=>y("decorationScale",parseFloat(k.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.decorationRotate??0,")"]}),t.jsx("input",{type:"range",min:"-180",max:"180",value:x.decorationRotate??0,onChange:k=>y("decorationRotate",parseInt(k.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]})]})]}),l!=="css"&&i==="avatar"&&t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{onClick:()=>{var k;return(k=m.current)==null?void 0:k.click()},className:"cursor-pointer group relative h-20 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 flex items-center justify-center text-slate-400 hover:border-primary/50 hover:text-primary transition-all",children:[x.avatarDecoration?t.jsx("img",{src:x.avatarDecoration,className:"h-10 w-10 object-contain"}):t.jsx("span",{className:"text-xs font-bold",children:"+ /"}),t.jsx("input",{type:"file",ref:m,className:"hidden",accept:"image/*",onChange:k=>{var M;return((M=k.target.files)==null?void 0:M[0])&&b(k.target.files[0],"avatarDeco")}}),x.avatarDecoration&&t.jsx("button",{onClick:k=>{k.stopPropagation(),y("avatarDecoration",void 0)},className:"absolute top-2 right-2 text-[10px] bg-red-100 text-red-500 px-2 py-0.5 rounded-full",children:""})]}),x.avatarDecoration&&t.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-6 p-2",children:[t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:" (Offset X / Y)"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("input",{type:"range",min:"-50",max:"150",value:x.avatarDecorationX??50,onChange:k=>y("avatarDecorationX",parseInt(k.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"}),t.jsx("input",{type:"range",min:"-50",max:"150",value:x.avatarDecorationY??50,onChange:k=>y("avatarDecorationY",parseInt(k.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.avatarDecorationScale??1,"x)"]}),t.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:x.avatarDecorationScale??1,onChange:k=>y("avatarDecorationScale",parseFloat(k.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.avatarDecorationRotate??0,")"]}),t.jsx("input",{type:"range",min:"-180",max:"180",value:x.avatarDecorationRotate??0,onChange:k=>y("avatarDecorationRotate",parseInt(k.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]})]})]})]})]})]})},hx=()=>{const{theme:e,updateTheme:s,closeApp:n,setCustomIcon:r,customIcons:a,addToast:l}=xt(),[o,i]=u.useState("theme"),c=u.useRef(null),d=u.useRef(null),f=u.useRef(null),h=u.useRef(null),[p,m]=u.useState(null),[x,y]=u.useState("local"),[C,g]=u.useState(""),b=[{name:"Indigo",config:{hue:245,saturation:25,lightness:65,contentColor:"#ffffff"},color:"hsl(245, 25%, 65%)"},{name:"Sakura",config:{hue:350,saturation:70,lightness:80,contentColor:"#334155"},color:"hsl(350, 70%, 80%)"},{name:"Cyber",config:{hue:170,saturation:100,lightness:45,contentColor:"#ffffff"},color:"hsl(170, 100%, 45%)"},{name:"Noir",config:{hue:0,saturation:0,lightness:20,contentColor:"#ffffff"},color:"hsl(0, 0%, 20%)"},{name:"Sunset",config:{hue:20,saturation:90,lightness:60,contentColor:"#ffffff"},color:"hsl(20, 90%, 60%)"}],v=async j=>{try{l(" ()...","info");const H=await ls(j,{skipCompression:!0});s({wallpaper:H}),l("","success")}catch(H){l(H.message,"error")}},w=async j=>{try{const H=await ls(j,{maxWidth:800,quality:.9});s({launcherWidgetImage:H}),l("","success")}catch(H){l(H.message,"error")}},z=async j=>{var me;const H=(me=j.target.files)==null?void 0:me[0];if(!H)return;const te=[".ttf",".otf",".woff",".woff2"],Ne=H.name.substring(H.name.lastIndexOf(".")).toLowerCase();if(!te.includes(Ne)){l(" ttf/otf/woff/woff2 ","error");return}l("...","info");const Me=new FileReader;Me.onload=async F=>{var se;try{const G=(se=F.target)==null?void 0:se.result;s({customFont:G}),l("","success")}catch{l("","error")}},Me.onerror=()=>l("","error"),Me.readAsDataURL(H),h.current&&(h.current.value="")},k=()=>{C.trim()&&(s({customFont:C.trim()}),g(""),l("","success"))},M=async j=>{if(p)try{const H=await ls(j);r(p,H),l("","success")}catch(H){l(H.message,"error")}};return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[t.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:t.jsxs("div",{className:"flex items-center gap-2 w-full",children:[t.jsx("button",{onClick:n,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),t.jsxs("div",{className:"flex border-b border-slate-200 bg-white sticky top-0 z-20",children:[t.jsx("button",{onClick:()=>i("theme"),className:`flex-1 py-3 text-sm font-medium transition-colors ${o==="theme"?"text-primary border-b-2 border-primary":"text-slate-400"}`,children:""}),t.jsx("button",{onClick:()=>i("icons"),className:`flex-1 py-3 text-sm font-medium transition-colors ${o==="icons"?"text-primary border-b-2 border-primary":"text-slate-400"}`,children:""})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 no-scrollbar",children:o==="theme"?t.jsxs(t.Fragment,{children:[t.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[t.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Preset Themes"}),t.jsx("div",{className:"flex gap-3 mb-6 overflow-x-auto no-scrollbar pb-1",children:b.map(j=>t.jsxs("button",{onClick:()=>s(j.config),className:"flex flex-col items-center gap-1.5 shrink-0 group",children:[t.jsx("div",{className:"w-10 h-10 rounded-full shadow-sm border-2 border-white ring-1 ring-black/5 transition-transform group-active:scale-95",style:{backgroundColor:j.color}}),t.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:j.name})]},j.name))}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:[t.jsx("span",{children:"Hue"}),t.jsxs("span",{children:[e.hue,""]})]}),t.jsx("input",{type:"range",min:"0",max:"360",value:e.hue,onChange:j=>s({hue:parseInt(j.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"}),t.jsx("div",{className:"h-2 w-full rounded-full mt-3 opacity-50",style:{background:"linear-gradient(to right, hsl(0, 50%, 80%), hsl(60, 50%, 80%), hsl(120, 50%, 80%), hsl(180, 50%, 80%), hsl(240, 50%, 80%), hsl(300, 50%, 80%), hsl(360, 50%, 80%))"}})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:[t.jsx("span",{children:"Saturation"}),t.jsxs("span",{children:[e.saturation,"%"]})]}),t.jsx("input",{type:"range",min:"0",max:"100",value:e.saturation,onChange:j=>s({saturation:parseInt(j.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:[t.jsx("span",{children:"Lightness"}),t.jsxs("span",{children:[e.lightness,"%"]})]}),t.jsx("input",{type:"range",min:"10",max:"95",value:e.lightness,onChange:j=>s({lightness:parseInt(j.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),t.jsxs("div",{children:[t.jsx("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:t.jsx("span",{children:"Text/Widget Color"})}),t.jsxs("div",{className:"flex gap-4 items-center bg-slate-50 p-2 rounded-xl border border-slate-100",children:[t.jsx("div",{onClick:()=>s({contentColor:"#ffffff"}),className:`w-8 h-8 rounded-full border-2 cursor-pointer shadow-sm ${e.contentColor==="#ffffff"?"border-primary ring-2 ring-primary/20":"border-slate-200"}`,style:{backgroundColor:"#ffffff"}}),t.jsx("div",{onClick:()=>s({contentColor:"#334155"}),className:`w-8 h-8 rounded-full border-2 cursor-pointer shadow-sm ${e.contentColor==="#334155"?"border-primary ring-2 ring-primary/20":"border-slate-200"}`,style:{backgroundColor:"#334155"}}),t.jsx("div",{className:"h-6 w-px bg-slate-200 mx-1"}),t.jsx("input",{type:"color",value:e.contentColor||"#ffffff",onChange:j=>s({contentColor:j.target.value}),className:"w-8 h-8 rounded-lg border-none cursor-pointer bg-transparent p-0"}),t.jsx("span",{className:"text-xs text-slate-400 font-mono",children:e.contentColor})]})]})]})]}),t.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[t.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:" (Global Font)"}),t.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl mb-4",children:[t.jsx("button",{onClick:()=>y("local"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${x==="local"?"bg-white text-primary shadow-sm":"text-slate-400"}`,children:""}),t.jsx("button",{onClick:()=>y("web"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${x==="web"?"bg-white text-primary shadow-sm":"text-slate-400"}`,children:" URL"})]}),x==="local"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full h-24 bg-slate-100 rounded-2xl overflow-hidden relative shadow-inner mb-2 group cursor-pointer border-2 border-dashed border-slate-200 hover:border-primary/50 flex items-center justify-center flex-col gap-2",onClick:()=>{var j;return(j=h.current)==null?void 0:j.click()},children:[e.customFont&&e.customFont.startsWith("data:")?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-lg font-bold text-slate-700",children:"Abc "}),t.jsx("span",{className:"text-[10px] text-slate-400",children:""})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-2xl text-slate-400",children:"Aa"}),t.jsx("span",{className:"text-xs text-slate-400",children:" (.ttf / .otf)"})]}),t.jsx("div",{className:"absolute inset-0 bg-black/5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-white text-xs font-bold bg-black/40 px-3 py-1 rounded-full backdrop-blur-md",children:""})})]}),t.jsx("input",{type:"file",ref:h,className:"hidden",accept:".ttf,.otf,.woff,.woff2",onChange:z})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsx("input",{value:C,onChange:j=>g(j.target.value),placeholder:" URL (https://...)",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-xs outline-none focus:border-primary transition-all"}),t.jsx("button",{onClick:k,className:"w-full py-2 bg-primary text-white font-bold text-xs rounded-xl shadow-md active:scale-95 transition-transform",children:""}),t.jsx("div",{className:"text-[10px] text-slate-400 px-1",children:e.customFont&&e.customFont.startsWith("http")?t.jsxs("span",{className:"text-green-500",children:[": ",e.customFont]}):":  (.ttf/.woff)"})]}),e.customFont&&t.jsx("button",{onClick:()=>s({customFont:void 0}),className:"w-full py-2 text-xs font-bold text-red-400 bg-red-50 rounded-lg hover:bg-red-100 mt-2",children:""})]}),t.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[t.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Wallpaper"}),t.jsxs("div",{className:"aspect-[9/16] w-1/2 mx-auto bg-slate-100 rounded-2xl overflow-hidden relative shadow-inner mb-4 group cursor-pointer",onClick:()=>{var j;return(j=c.current)==null?void 0:j.click()},children:[t.jsx("img",{src:e.wallpaper,className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-white text-xs font-bold bg-black/20 px-3 py-1 rounded-full backdrop-blur-md",children:""})})]}),t.jsx("input",{type:"file",ref:c,className:"hidden",accept:"image/*",onChange:j=>{var H;return((H=j.target.files)==null?void 0:H[0])&&v(j.target.files[0])}}),t.jsx("p",{className:"text-center text-[10px] text-slate-400",children:" ()"})]}),t.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[t.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:""}),t.jsxs("div",{className:"w-full h-32 bg-slate-100 rounded-2xl overflow-hidden relative shadow-inner mb-4 group cursor-pointer border-2 border-dashed border-slate-200 hover:border-primary/50 flex items-center justify-center",onClick:()=>{var j;return(j=d.current)==null?void 0:j.click()},children:[e.launcherWidgetImage?t.jsx("img",{src:e.launcherWidgetImage,className:"w-full h-full object-cover"}):t.jsxs("div",{className:"text-center text-slate-400",children:[t.jsx("span",{className:"text-2xl block mb-1",children:""}),t.jsx("span",{className:"text-xs",children:""})]}),t.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-white text-xs font-bold bg-black/20 px-3 py-1 rounded-full backdrop-blur-md",children:""})})]}),t.jsx("input",{type:"file",ref:d,className:"hidden",accept:"image/*",onChange:j=>{var H;return((H=j.target.files)==null?void 0:H[0])&&w(j.target.files[0])}}),e.launcherWidgetImage&&t.jsx("button",{onClick:()=>s({launcherWidgetImage:void 0}),className:"w-full py-2 text-xs font-bold text-red-400 bg-red-50 rounded-lg hover:bg-red-100",children:""})]})]}):t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[Yi.map(j=>{const H=Ki[j.icon],te=a[j.id];return t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsxs("div",{className:"w-16 h-16 rounded-2xl shadow-sm bg-slate-200 overflow-hidden relative group cursor-pointer",onClick:()=>{var Ne;m(j.id),(Ne=f.current)==null||Ne.click()},children:[te?t.jsx("img",{src:te,className:"w-full h-full object-cover"}):t.jsx("div",{className:`w-full h-full ${j.color} flex items-center justify-center text-white`,children:t.jsx(H,{className:"w-8 h-8"})}),t.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-white",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})})]}),t.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:j.name}),te&&t.jsx("button",{onClick:()=>r(j.id,void 0),className:"text-[10px] text-red-400",children:""})]},j.id)}),t.jsx("input",{type:"file",ref:f,className:"hidden",accept:"image/*",onChange:j=>{var H;return((H=j.target.files)==null?void 0:H[0])&&M(j.target.files[0])}})]})})]})},px=()=>{var z;const{closeApp:e,characters:s,apiConfig:n,addToast:r}=xt(),[a,l]=u.useState("albums"),[o,i]=u.useState(null),[c,d]=u.useState([]),[f,h]=u.useState(null),[p,m]=u.useState(!1);u.useEffect(()=>{o&&R.getGalleryImages(o).then(k=>{d(k.sort((M,j)=>j.timestamp-M.timestamp))})},[o]);const x=k=>{i(k),l("grid")},y=k=>{h(k),l("detail")},C=()=>{a==="detail"?l("grid"):a==="grid"?(l("albums"),i(null)):e()},g=async()=>{var M,j,H,te,Ne;if(!f||!o||!n.apiKey){r("","error");return}const k=s.find(Me=>Me.id===o);if(k){m(!0);try{const Me=`You are ${k.name}. ${k.systemPrompt||"You are a helpful assistant."}
Task: The user sent you a photo. Comment on it briefly (1-3 sentences) based on your personality.
Style: Casual, conversational, strictly NO AI-assistant tone. React as if you received this on a chat app.`,me={model:n.model,messages:[{role:"system",content:Me},{role:"user",content:[{type:"text",text:"Look at this photo I sent you."},{type:"image_url",image_url:{url:f.url}}]}],max_tokens:8e3,temperature:.7,stream:!1},F=await fetch(`${n.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify(me)});if(!F.ok){let Z=`HTTP Error ${F.status}`;try{const X=await F.json();Z=((M=X.error)==null?void 0:M.message)||JSON.stringify(X.error)||Z,(Z.includes("vision")||Z.includes("image"))&&(Z="(Vision)")}catch{const pe=await F.text();pe&&(Z=pe.slice(0,100))}throw new Error(Z)}const se=await F.json();console.log("Gallery Review Response:",se);const G=(j=se.choices)==null?void 0:j[0];if((G==null?void 0:G.finish_reason)==="content_filter")throw new Error("AI  ()");let Ee=(H=G==null?void 0:G.message)==null?void 0:H.content;if(!Ee&&((te=G==null?void 0:G.message)!=null&&te.reasoning_content)&&(Ee=G.message.reasoning_content),!Ee&&(G!=null&&G.text)&&(Ee=G.text),!Ee&&((Ne=G==null?void 0:G.delta)!=null&&Ne.content)&&(Ee=G.delta.content),!Ee){const Z=JSON.stringify(G||se);throw console.warn("AI Empty Response Structure:",se),new Error(`AI . Raw: ${Z.substring(0,100)}...`)}await R.updateGalleryImageReview(f.id,Ee);const P={...f,review:Ee,reviewTimestamp:Date.now()};h(P),d(Z=>Z.map(X=>X.id===f.id?P:X)),r("","success")}catch(Me){console.error("Review Error:",Me),r(`: ${Me.message}`,"error")}finally{m(!1)}}},b=()=>t.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 animate-fade-in",children:[s.map(k=>t.jsxs("button",{onClick:()=>x(k.id),className:"flex flex-col gap-2 group active:scale-95 transition-transform",children:[t.jsxs("div",{className:"aspect-square bg-slate-200 rounded-2xl shadow-sm overflow-hidden relative border border-white",children:[t.jsx("div",{className:"absolute top-2 left-2 w-full h-full bg-white opacity-50 rounded-xl"}),t.jsx("img",{src:k.avatar,className:"absolute inset-0 w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"}),t.jsx("div",{className:"absolute inset-0 bg-black/10 group-hover:bg-transparent transition-colors"})]}),t.jsx("span",{className:"text-sm font-medium text-slate-700 text-center",children:k.name})]},k.id)),s.length===0&&t.jsx("div",{className:"col-span-2 text-center text-slate-400 py-10 text-xs",children:""})]}),v=()=>t.jsx("div",{className:"flex-1 overflow-y-auto p-1 animate-fade-in",children:c.length===0?t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 gap-2",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-10 h-10 opacity-50",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),t.jsx("span",{className:"text-xs",children:""})]}):t.jsx("div",{className:"grid grid-cols-3 gap-0.5",children:c.map(k=>t.jsxs("div",{onClick:()=>y(k),className:"aspect-square bg-slate-100 relative cursor-pointer overflow-hidden",children:[t.jsx("img",{src:k.url,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"}),k.review&&t.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-primary rounded-full ring-1 ring-white"})]},k.id))})}),w=()=>{var k,M;return f&&t.jsxs("div",{className:"flex flex-col h-full bg-black relative animate-fade-in",children:[t.jsx("div",{className:"absolute top-0 left-0 w-full p-4 flex justify-between items-start z-50 pointer-events-none",children:t.jsx("button",{onClick:()=>l("grid"),className:"text-white bg-black/40 backdrop-blur-md p-2 rounded-full pointer-events-auto active:scale-95 transition-transform hover:bg-black/60 border border-white/10",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})})}),t.jsx("div",{className:"flex-1 min-h-0 w-full flex items-center justify-center bg-black relative overflow-hidden",children:t.jsx("img",{src:f.url,className:"max-w-full max-h-full object-contain",alt:"Detail"})}),t.jsx("div",{className:"shrink-0 w-full bg-[#161616] border-t border-white/10 z-40 pb-safe",children:f.review?t.jsxs("div",{className:"p-5 animate-slide-up",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[t.jsx("img",{src:(k=s.find(j=>j.id===o))==null?void 0:k.avatar,className:"w-9 h-9 rounded-full border border-white/20 object-cover shadow-sm"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"text-xs font-bold text-white/50 mb-1.5 uppercase tracking-wide",children:[(M=s.find(j=>j.id===o))==null?void 0:M.name," "]}),t.jsxs("p",{className:"text-[15px] text-white/90 leading-relaxed font-light select-text",children:['"',f.review,'"']})]})]}),t.jsx("div",{className:"flex justify-end border-t border-white/5 pt-2 mt-2",children:t.jsxs("button",{onClick:g,disabled:p,className:"text-[10px] text-white/40 hover:text-primary transition-colors flex items-center gap-1 px-2 py-1",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-3 h-3",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),p?"Thinking...":""]})})]}):t.jsx("div",{className:"p-6 flex justify-center items-center",children:t.jsx("button",{onClick:g,disabled:p,className:"bg-white text-black px-6 py-3 rounded-full text-sm font-bold shadow-[0_0_20px_rgba(255,255,255,0.15)] active:scale-95 transition-transform flex items-center gap-2 hover:bg-slate-200",children:p?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-slate-300 border-t-black rounded-full animate-spin"})," ..."]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-lg",children:""}),"  TA "]})})})})]})};return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light relative",children:[a!=="detail"&&t.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:t.jsxs("div",{className:"flex items-center gap-2 w-full",children:[t.jsx("button",{onClick:C,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:a==="albums"?t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}):t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:a==="albums"?"":((z=s.find(k=>k.id===o))==null?void 0:z.name)||""})]})}),a==="albums"&&b(),a==="grid"&&v(),a==="detail"&&w()]})},xx=e=>{const s=e.trim().toLowerCase();return!!(s.startsWith("(")&&s.endsWith(")")&&(s.includes("in person")||s.includes("face-to-face")||s.includes("location")||s.includes("time"))||s.startsWith("[system")||s.startsWith("(system"))},Jo=e=>e.replace(/\[.*?\]/g,"").trim(),Ko=(e,s="normal")=>{if(!e)return[];const n=e.split(`
`).map(l=>l.trim()).filter(l=>l.length>0),r=[];let a=s;for(const l of n){if(xx(l))continue;const o=l.match(/^\[([a-zA-Z0-9_\-]+)\]\s*(.*)/);let i=l;if(o)a=o[1].toLowerCase(),i=o[2];else{const c=l.match(/^\[([a-zA-Z0-9_\-]+)\]$/);if(c){a=c[1].toLowerCase();continue}}i&&r.push({text:i,emotion:a})}return r},gx=({char:e,userProfile:s,messages:n,peekStatus:r,initialState:a,onSendMessage:l,onReroll:o,onExit:i,onEditMessage:c,onDeleteMessage:d,onSettings:f})=>{const{addToast:h}=xt(),[p,m]=u.useState(!1),[x,y]=u.useState(e.dateBackground||""),[C,g]=u.useState(""),[b,v]=u.useState(e.spriteConfig||{scale:1,x:0,y:0}),[w,z]=u.useState([]),[k,M]=u.useState([]),[j,H]=u.useState(""),[te,Ne]=u.useState(""),[Me,me]=u.useState(!1),[F,se]=u.useState(""),[G,Ee]=u.useState(!1),[P,Z]=u.useState(!1),[X,pe]=u.useState(!1),[Ce,je]=u.useState("none"),[Pe,ge]=u.useState(null),ce=u.useRef(null),N=u.useRef(null),ne=u.useRef(null),we=$n.useMemo(()=>{const _=n.map(ee=>{var E;return(E=ee.metadata)==null?void 0:E.isOpening}).lastIndexOf(!0);return _!==-1?n.slice(_):n},[n]);u.useEffect(()=>{if(a)y(a.bgImage),g(a.currentSprite),H(a.currentText),Ne(a.currentText),z(a.dialogueQueue),M(a.dialogueBatch),m(a.isNovelMode);else{const _=e.sprites,ee=(_==null?void 0:_.normal)||(_==null?void 0:_.default)||_&&Object.values(_)[0]||e.avatar;g(ee);const K=Ko(r||"Waiting for connection...","normal");if(M(K),z(K),K.length>0){const ke=K[0];H(ke.text),z(K.slice(1))}}},[]),u.useEffect(()=>{e.spriteConfig&&v(e.spriteConfig),e.dateBackground&&y(e.dateBackground)},[e]),u.useEffect(()=>{p&&ne.current&&(ne.current.scrollTop=ne.current.scrollHeight)},[we.length,p,G]),u.useEffect(()=>{if(!j||p){p&&Ne(j);return}me(!0),Ne("");let _=0;const ee=setInterval(()=>{Ne(j.substring(0,_+1)),_++,_>=j.length&&(clearInterval(ee),me(!1))},20);return()=>clearInterval(ee)},[j,p]);const D=(_,ee)=>{if(H(_.text),_.emotion&&e.sprites){let E=e.sprites[_.emotion];if(!E){const ke=Object.keys(e.sprites).find(J=>_.emotion.includes(J));E=ke?e.sprites[ke]:C}E&&g(E)}z(ee)},xe=_=>{if(!_.target.closest("button, input, textarea, .control-panel")&&!p){if(Me){Ne(j),me(!1);return}if(w.length>0){D(w[0],w.slice(1));return}if(k.length>0){h(" ","info"),D(k[0],k.slice(1));return}}},A=async()=>{if(!F.trim()||P)return;const _=F.trim();se(""),Ee(!1),Z(!0);try{const ee=await l(_),E=Ko(ee,"normal");M(E),z(E),E.length>0&&D(E[0],E.slice(1))}catch{H("()"),Ee(!0)}finally{Z(!1)}},le=async()=>{if(!P){Z(!0);try{const _=await o(),ee=Ko(_,"normal");M(ee),z(ee),ee.length>0&&D(ee[0],ee.slice(1))}catch{}finally{Z(!1)}}},re=()=>{const _={dialogueQueue:w,dialogueBatch:k,currentText:j,bgImage:x,currentSprite:C,isNovelMode:p,timestamp:Date.now(),peekStatus:r};i(_)},$e=(_,ee)=>{"touches"in _?N.current={x:_.touches[0].clientX,y:_.touches[0].clientY}:N.current={x:_.clientX,y:_.clientY},ce.current=setTimeout(()=>{ge(ee),je("options")},600)},Re=_=>{if(!ce.current||!N.current)return;let ee,E;"touches"in _?(ee=_.touches[0].clientX,E=_.touches[0].clientY):(ee=_.clientX,E=_.clientY);const K=Math.abs(ee-N.current.x),ke=Math.abs(E-N.current.y);(K>10||ke>10)&&(ce.current&&clearTimeout(ce.current),ce.current=null)},De=()=>{ce.current&&clearTimeout(ce.current),ce.current=null},Ke=n.length>0&&n[n.length-1].role==="assistant";return t.jsxs("div",{className:"h-full w-full relative bg-black overflow-hidden font-sans select-none",onClick:xe,children:[t.jsx("div",{className:`absolute inset-0 bg-cover bg-center transition-all duration-1000 ${p?"blur-xl opacity-30":"opacity-80"}`,style:{backgroundImage:x?`url(${x})`:"none"}}),t.jsxs("div",{className:"absolute top-0 right-0 p-4 pt-12 z-[100] flex justify-end gap-3 pointer-events-auto",children:[!P&&Ke&&!p&&t.jsx("button",{onClick:_=>{_.stopPropagation(),le()},className:"bg-black/30 backdrop-blur-md text-white w-10 h-10 rounded-full flex items-center justify-center border border-white/20 hover:bg-white/20 transition-all shadow-lg active:scale-95",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("button",{onClick:_=>{_.stopPropagation(),Ee(!G)},className:`w-10 h-10 rounded-full flex items-center justify-center border transition-all shadow-lg active:scale-95 ${G?"bg-primary border-primary text-white":"bg-black/30 backdrop-blur-md border-white/20 text-white hover:bg-white/20"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})})}),t.jsx("button",{onClick:_=>{_.stopPropagation(),f()},className:"bg-black/30 backdrop-blur-md text-white w-10 h-10 rounded-full flex items-center justify-center border border-white/20 hover:bg-white/20 transition-all shadow-lg active:scale-95",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 0 1 0 2.555c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.212 1.281c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-2.555c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]})}),t.jsx("button",{onClick:_=>{_.stopPropagation(),m(!p)},className:"bg-black/30 backdrop-blur-md text-white w-10 h-10 rounded-full flex items-center justify-center border border-white/20 hover:bg-white/20 transition-all shadow-lg active:scale-95",children:p?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),t.jsxs("button",{onClick:()=>pe(!0),className:"bg-red-500/80 backdrop-blur-md text-white px-4 h-10 rounded-full flex items-center justify-center gap-1 border border-white/20 hover:bg-red-600 transition-colors shadow-lg active:scale-95",children:[t.jsx("span",{className:"text-xs font-bold mr-1",children:""}),t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})})]})]}),p&&t.jsx("div",{ref:ne,className:"absolute inset-0 z-20 overflow-y-auto no-scrollbar pt-24 pb-32 px-8 mask-image-gradient bg-black/90 backdrop-blur-sm overscroll-contain",onClick:_=>{_.stopPropagation(),Ee(!0)},children:t.jsx("div",{className:"min-h-full flex flex-col justify-end",children:t.jsxs("div",{className:"max-w-2xl mx-auto animate-fade-in space-y-6",children:[we.length===0&&r&&t.jsx("div",{className:"text-slate-200/50 italic text-center text-sm mb-8 px-4",children:Jo(r).split(`
`).map((_,ee)=>_.trim()&&t.jsx("p",{className:"whitespace-pre-wrap leading-relaxed tracking-wide my-2",children:_},ee))}),we.map(_=>t.jsx("div",{className:"group relative rounded-xl transition-colors -mx-4 px-4 py-2 active:bg-white/5",onTouchStart:ee=>$e(ee,_),onTouchEnd:De,onTouchMove:Re,onMouseDown:ee=>$e(ee,_),onMouseUp:De,onMouseMove:Re,onMouseLeave:De,onContextMenu:ee=>{ee.preventDefault(),ge(_),je("options")},children:_.role==="user"?t.jsxs("p",{className:"whitespace-pre-wrap font-serif text-[16px] text-slate-400 text-right leading-loose tracking-wide italic border-r-2 border-slate-600/50 pr-4",children:[Jo(_.content)," ",t.jsx("span",{className:"text-[10px] uppercase font-sans not-italic ml-2 opacity-50",children:s.name})]}):t.jsx("div",{children:(_.content||"").split(`
`).map((ee,E)=>{const K=Jo(ee);return K?t.jsx("p",{className:"whitespace-pre-wrap font-serif text-[18px] text-slate-200 text-justify leading-loose tracking-wide drop-shadow-md border-l-2 border-white/10 pl-4 mb-4 last:mb-0",children:K},E):null})})},_.id))]})})}),!p&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute inset-x-0 bottom-0 h-[90%] flex items-end justify-center pointer-events-none z-10 overflow-hidden",children:C&&t.jsx("img",{src:C,className:"max-h-full max-w-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] transition-all duration-300 origin-bottom",style:{filter:G?"brightness(1)":Me?"brightness(1.05)":"brightness(1)",transform:`translate(${b.x}%, ${b.y}%) scale(${Me?b.scale*1.02:b.scale})`}})}),!P&&t.jsx("div",{className:"absolute inset-x-0 bottom-8 z-30 flex justify-center",children:t.jsxs("div",{className:"w-[90%] max-w-lg bg-black/60 backdrop-blur-xl rounded-2xl border border-white/10 p-6 min-h-[140px] shadow-2xl animate-slide-up hover:bg-black/70 cursor-pointer",children:[t.jsx("div",{className:"absolute -top-3 left-6",children:t.jsx("div",{className:"bg-white/90 text-black px-4 py-1 rounded-sm text-xs font-bold tracking-widest uppercase shadow-[0_4px_10px_rgba(0,0,0,0.3)] transform -skew-x-12",children:e.name})}),t.jsxs("p",{className:"text-white/90 text-[16px] leading-relaxed font-light tracking-wide drop-shadow-md mt-2",children:[te,Me&&t.jsx("span",{className:"inline-block w-2 h-4 bg-white/70 ml-1 animate-pulse align-middle"})]}),!Me&&w.length>0&&t.jsx("div",{className:"absolute bottom-3 right-4 animate-bounce opacity-70",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 text-white",children:t.jsx("path",{fillRule:"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z",clipRule:"evenodd"})})}),!Me&&w.length===0&&k.length>0&&t.jsxs("div",{className:"absolute bottom-3 right-4 opacity-50 text-[10px] text-white flex items-center gap-1 animate-pulse",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3 h-3",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"Loop"]})]})})]}),t.jsxs("div",{className:`absolute inset-x-0 bottom-0 z-40 flex justify-center pointer-events-none transition-all duration-300 ${P||G?"opacity-100":"opacity-0"}`,children:[P&&t.jsx("div",{className:"absolute bottom-1/2 left-1/2 -translate-x-1/2 z-50 flex flex-col items-center gap-2 pointer-events-auto",children:t.jsxs("div",{className:"bg-black/80 backdrop-blur-md px-6 py-3 rounded-full border border-white/20 shadow-2xl animate-pulse flex items-center gap-3",children:[t.jsxs("div",{className:"flex gap-1.5",children:[t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce delay-75"}),t.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce delay-150"})]}),t.jsx("span",{className:"text-xs text-white font-bold tracking-widest uppercase",children:"Typing..."})]})}),G&&t.jsxs("div",{className:"w-[90%] max-w-lg bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 p-2 flex gap-2 shadow-2xl animate-fade-in mb-8 pointer-events-auto",onClick:_=>_.stopPropagation(),children:[t.jsx("textarea",{value:F,onChange:_=>se(_.target.value),placeholder:P?"...":"...",disabled:P,className:"flex-1 bg-transparent px-4 py-3 text-white placeholder:text-white/30 outline-none font-light resize-none h-14 no-scrollbar leading-tight",autoFocus:!0}),t.jsx("button",{onClick:A,disabled:!F.trim()||P,className:"px-6 bg-white text-black rounded-xl font-bold text-sm hover:bg-slate-200 disabled:opacity-50 transition-colors h-14 flex items-center justify-center",children:"SEND"})]})]}),t.jsx(Ze,{isOpen:X,title:"?",onClose:()=>pe(!1),footer:t.jsxs("div",{className:"flex gap-3 w-full",children:[t.jsx("button",{onClick:()=>pe(!1),className:"flex-1 py-3 bg-slate-100 rounded-2xl text-slate-600 font-bold",children:""}),t.jsx("button",{onClick:re,className:"flex-1 py-3 bg-slate-800 text-white rounded-2xl font-bold",children:""})]}),children:t.jsxs("div",{className:"text-center text-slate-500 text-sm py-2 leading-relaxed",children:["",t.jsx("br",{}),""]})}),t.jsx(Ze,{isOpen:Ce==="options",title:"",onClose:()=>je("none"),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:()=>{c(Pe),je("none")},className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl",children:""}),t.jsx("button",{onClick:()=>{d(Pe),je("none")},className:"w-full py-3 bg-red-50 text-red-500 font-medium rounded-2xl",children:""})]})})]})},bx=["normal","happy","angry","sad","shy"],vx={scale:1,x:0,y:0},wx=({char:e,onBack:s})=>{const{updateCharacter:n,addToast:r}=xt(),a=u.useRef(null),[l,o]=u.useState("bg"),[i,c]=u.useState(""),[d,f]=u.useState(vx);u.useEffect(()=>{e.spriteConfig&&f(e.spriteConfig)},[e.id]);const h=e.sprites||{},p=h.normal||h.default||Object.values(h)[0]||e.avatar,m=(C,g)=>{var b;o(C),g&&c(g),(b=a.current)==null||b.click()},x=async C=>{var b;const g=(b=C.target.files)==null?void 0:b[0];if(g)try{const v=await ls(g);if(l==="bg")n(e.id,{dateBackground:v}),r("","success");else{const w=i.trim().toLowerCase();if(!w){r("Key","error");return}const z={...e.sprites||{},[w]:v};n(e.id,{sprites:z}),r(` [${w}] `,"success"),c("")}}catch(v){r(v.message,"error")}finally{a.current&&(a.current.value="")}},y=()=>{n(e.id,{spriteConfig:d}),r("","success"),s()};return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col",children:[t.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-slate-200 bg-white shrink-0 z-20",children:[t.jsx("button",{onClick:s,className:"p-2 -ml-2 text-slate-600 active:scale-95 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-slate-700",children:""}),t.jsx("div",{className:"w-8"})]}),t.jsxs("div",{className:"h-64 bg-black relative overflow-hidden shrink-0 border-b border-slate-200",children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-60",style:{backgroundImage:e.dateBackground?`url(${e.dateBackground})`:"none"}}),t.jsx("div",{className:"absolute inset-0 flex items-end justify-center pointer-events-none",children:t.jsx("img",{src:p,className:"max-h-[90%] object-contain transition-transform",style:{transform:`translate(${d.x}%, ${d.y}%) scale(${d.scale})`}})}),t.jsx("div",{className:"absolute top-2 left-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded backdrop-blur-sm",children:" (Preview)"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-8 pb-20",children:[t.jsxs("section",{className:"bg-white p-4 rounded-2xl border border-slate-100 shadow-sm",children:[t.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-4",children:""}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-2",children:[t.jsx("span",{children:" (Scale)"}),t.jsxs("span",{children:[d.scale.toFixed(1),"x"]})]}),t.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:d.scale,onChange:C=>f({...d,scale:parseFloat(C.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-2",children:[t.jsx("span",{children:" (X)"}),t.jsxs("span",{children:[d.x,"%"]})]}),t.jsx("input",{type:"range",min:"-100",max:"100",step:"5",value:d.x,onChange:C=>f({...d,x:parseInt(C.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-2",children:[t.jsx("span",{children:" (Y)"}),t.jsxs("span",{children:[d.y,"%"]})]}),t.jsx("input",{type:"range",min:"-50",max:"50",step:"5",value:d.y,onChange:C=>f({...d,y:parseInt(C.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary"})]})]})]}),t.jsxs("section",{children:[t.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:" (Background)"}),t.jsx("div",{onClick:()=>m("bg"),className:"aspect-video bg-slate-200 rounded-xl overflow-hidden relative border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer hover:border-primary group",children:e.dateBackground?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:e.dateBackground,className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-white text-xs font-bold",children:""})})]}):t.jsx("span",{className:"text-slate-400 text-xs",children:"+ "})})]}),t.jsxs("section",{children:[t.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:""}),t.jsx("div",{className:"grid grid-cols-3 gap-3",children:bx.map(C=>t.jsxs("div",{onClick:()=>m("sprite",C),className:"flex flex-col gap-2 group cursor-pointer",children:[t.jsx("div",{className:`aspect-[3/4] rounded-xl overflow-hidden relative border ${h[C]?"border-slate-200 bg-white":"border-dashed border-slate-300 bg-slate-100"} shadow-sm flex items-center justify-center transition-all group-hover:border-primary`,children:h[C]?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:h[C],className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-white text-[10px]",children:""})})]}):t.jsx("span",{className:"text-slate-300 text-2xl",children:"+"})}),t.jsx("div",{className:"text-center",children:t.jsx("div",{className:"text-xs font-bold text-slate-600 capitalize",children:C})})]},C))})]}),t.jsx("input",{type:"file",ref:a,className:"hidden",accept:"image/*",onChange:x})]}),t.jsx("div",{className:"p-4 border-t border-slate-200 bg-white/90 backdrop-blur-sm sticky bottom-0 z-20",children:t.jsx("button",{onClick:y,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl shadow-lg active:scale-95 transition-transform",children:""})})]})},yx=()=>{var we;const{closeApp:e,characters:s,activeCharacterId:n,setActiveCharacterId:r,apiConfig:a,addToast:l,updateCharacter:o,virtualTime:i,userProfile:c}=xt(),[d,f]=u.useState("select"),[h,p]=u.useState(""),[m,x]=u.useState(!1),[y,C]=u.useState([]),[g,b]=u.useState(null),[v,w]=u.useState([]),[z,k]=u.useState(!1),[M,j]=u.useState(!1),[H,te]=u.useState(null),[Ne,Me]=u.useState(""),me=s.find(D=>D.id===n),F=async()=>{if(me){const xe=(await R.getMessagesByCharId(me.id)).filter(A=>{var le;return((le=A.metadata)==null?void 0:le.source)==="date"}).sort((A,le)=>A.timestamp-le.timestamp);w(xe),h&&xe.some(A=>A.content===h&&A.role==="assistant")&&k(!0)}};u.useEffect(()=>{me&&d==="session"&&F()},[me,d]);const se=()=>{d==="peek"?(f("select"),p("")):d==="history"?f("select"):e()},G=()=>`${i.hours.toString().padStart(2,"0")}:${i.minutes.toString().padStart(2,"0")}`,Ee=D=>{if(!D)return"";const A=Date.now()-D,le=Math.floor(A/(1e3*60)),re=Math.floor(A/(1e3*60*60)),$e=new Date().getHours(),Re=$e>=23||$e<=6;return le<5?"":le<60?`[: : ${le} ]`:re<6?Re?`[: : ${re} /]`:`[: : ${re} ]`:re<24?`[: : ${re} ]`:`[: : ${Math.floor(re/24)} ]`},P=D=>{D.savedDateState?b(D):Ce(D)},Z=()=>{g&&(r(g.id),f("session"),b(null),l("","success"))},X=()=>{g&&(o(g.id,{savedDateState:void 0}),Ce(g),b(null))},pe=async()=>{if(me){if(h&&!z)try{await R.saveMessage({charId:me.id,role:"assistant",type:"text",content:h,metadata:{source:"date",isOpening:!0}}),k(!0)}catch(D){console.error("Failed to save opening",D)}f("session"),await F()}},Ce=async D=>{r(D.id),f("peek"),x(!0),p(""),k(!1);try{const xe=await R.getMessagesByCharId(D.id),A=D.contextLimit||500,le=Math.min(A,50),re=xe[xe.length-1],$e=Ee(re==null?void 0:re.timestamp),Re=xe.slice(-le).map(J=>{const ae=J.type==="image"?"[User sent an image]":J.content;return`${J.role}: ${ae}`}).join(`
`),De=`${i.day} ${G()}`,Ke=Et.buildCoreContext(D,c,!1),_=$e?`

--- [TIME SKIP: ${$e}] ---

`:`

--- [NEW SCENE START] ---

`,ee=`
###  (Sense Presence)
: ${De}
: ${$e}

### 

****
${D.name} 

### 
1. ****:  []**** [TIME SKIP]
2. ****: ${$e.includes("")?"":""}
3. ****: `,E=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"system",content:Ke},{role:"user",content:`[ (Previous Context)]:${Re}${_}${ee}

(Start sensing...)`}],temperature:.85})});if(!E.ok)throw new Error("Failed to sense presence");const ke=(await E.json()).choices[0].message.content;p(ke)}catch(xe){p(`(: ${xe.message})`)}finally{x(!1)}},je=async D=>{if(!me)throw new Error("No char");await R.saveMessage({charId:me.id,role:"user",type:"text",content:D,metadata:{source:"date"}});const xe=await R.getMessagesByCharId(me.id),A=xe.filter(E=>{var K;return((K=E.metadata)==null?void 0:K.source)==="date"}).sort((E,K)=>E.timestamp-K.timestamp);w(A);const le=me.contextLimit||500,re=xe.slice(-le,-1).map(E=>({role:E.role,content:E.type==="image"?"[User sent an image]":E.content}));let $e=Et.buildCoreContext(me,c);const Re=Object.keys(me.sprites||{});$e+=`### [Visual Novel Mode: ]
****

###  (One Line per Beat)
****
1. ****: 
2. ****: \`[emotion]\` (): ${Re.join(", ")||"normal, happy, angry, sad, shy"}
3. ****:  **...**

### 
1. **Location**: ****
2. **Context**: Opening
`;const De=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"system",content:$e},...re,{role:"user",content:`${D}

(System Note:  VN )`}],temperature:.85})});if(!De.ok)throw new Error("API Error");const _=(await De.json()).choices[0].message.content;await R.saveMessage({charId:me.id,role:"assistant",type:"text",content:_,metadata:{source:"date"}});const ee=await R.getMessagesByCharId(me.id);return w(ee.filter(E=>{var K;return((K=E.metadata)==null?void 0:K.source)==="date"}).sort((E,K)=>E.timestamp-K.timestamp)),_},Pe=async()=>{if(!me||v.length===0)throw new Error("No context");const D=v[v.length-1];if(D.role!=="assistant")throw new Error("Cannot reroll user message");await R.deleteMessage(D.id);const A=(await R.getMessagesByCharId(me.id)).filter(K=>K.id!==D.id),le=A[A.length-1];if(!le||le.role!=="user")throw new Error("Context lost");const re=me.contextLimit||500,$e=A.slice(-re,-1).map(K=>({role:K.role,content:K.type==="image"?"[User sent an image]":K.content}));let Re=Et.buildCoreContext(me,c);const De=Object.keys(me.sprites||{});Re+=`### [Visual Novel Mode: ]
(Same rules apply... Emotion tags: ${De.join(", ")})`;const Ke=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"system",content:Re},...$e,{role:"user",content:`${le.content}

(System Note: Reroll requested. Please generate a different response.)`}],temperature:.9})});if(!Ke.ok)throw new Error("API Error");const ee=(await Ke.json()).choices[0].message.content;await R.saveMessage({charId:me.id,role:"assistant",type:"text",content:ee,metadata:{source:"date"}});const E=await R.getMessagesByCharId(me.id);return w(E.filter(K=>{var ke;return((ke=K.metadata)==null?void 0:ke.source)==="date"}).sort((K,ke)=>K.timestamp-ke.timestamp)),ee},ge=async D=>{await R.deleteMessage(D.id),w(xe=>xe.filter(A=>A.id!==D.id))},ce=async()=>{H&&(await R.updateMessage(H.id,Ne),w(D=>D.map(xe=>xe.id===H.id?{...xe,content:Ne}:xe)),j(!1),te(null),l("","success"))},N=D=>{me&&(o(me.id,{savedDateState:D}),l("","success")),f("select"),p(""),k(!1)},ne=async D=>{var re;r(D.id);const A=(await R.getMessagesByCharId(D.id)).filter($e=>{var Re;return((Re=$e.metadata)==null?void 0:Re.source)==="date"}).sort(($e,Re)=>Re.timestamp-$e.timestamp),le=[];if(A.length>0){let $e=[A[0]];for(let De=1;De<A.length;De++){const Ke=A[De-1],_=A[De],ee=Math.abs(Ke.timestamp-_.timestamp)>30*60*1e3,E=((re=Ke.metadata)==null?void 0:re.isOpening)===!0;if(ee||E){const K=$e[$e.length-1];le.push({date:new Date(K.timestamp).toLocaleString(),msgs:$e.reverse()}),$e=[_]}else $e.push(_)}const Re=$e[$e.length-1];le.push({date:new Date(Re.timestamp).toLocaleString(),msgs:$e.reverse()})}C(le),f("history")};return d==="select"||!me?t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[t.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-slate-200 bg-white sticky top-0 z-10",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-slate-100",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-slate-700",children:""}),t.jsx("div",{className:"w-8"})]}),t.jsx("div",{className:"p-4 grid grid-cols-2 gap-4 overflow-y-auto",children:s.map(D=>t.jsxs("div",{onClick:()=>P(D),className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 active:scale-95 transition-transform flex flex-col items-center gap-3 relative group",children:[t.jsx("button",{onClick:xe=>{xe.stopPropagation(),ne(D)},className:"absolute top-2 right-2 p-1.5 text-slate-300 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors z-20 active:scale-90",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),t.jsx("img",{src:D.avatar,className:"w-16 h-16 rounded-full object-cover"}),t.jsx("span",{className:"font-bold text-slate-700",children:D.name}),D.savedDateState&&t.jsx("div",{className:"absolute top-2 left-2 w-2 h-2 bg-green-500 rounded-full animate-pulse",title:""})]},D.id))}),t.jsx(Ze,{isOpen:!!g,title:"",onClose:()=>b(null),footer:t.jsxs("div",{className:"flex gap-3 w-full",children:[t.jsx("button",{onClick:X,className:"flex-1 py-3 bg-slate-100 rounded-2xl text-slate-600 font-bold",children:""}),t.jsx("button",{onClick:Z,className:"flex-1 py-3 bg-green-500 text-white rounded-2xl font-bold shadow-lg shadow-green-200",children:""})]}),children:t.jsxs("div",{className:"text-center text-slate-500 text-sm py-4",children:[" ",g==null?void 0:g.name," ",t.jsx("br",{}),t.jsxs("span",{className:"text-xs text-slate-400 mt-2 block",children:["(: ",(we=g==null?void 0:g.savedDateState)!=null&&we.timestamp?new Date(g.savedDateState.timestamp).toLocaleString():"Unknown",")"]})]})})]}):d==="history"?t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[t.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-slate-200 bg-white sticky top-0 z-10",children:[t.jsx("button",{onClick:se,className:"p-2 -ml-2 rounded-full hover:bg-slate-100",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-slate-700",children:""}),t.jsx("div",{className:"w-8"})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 pb-20",children:y.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-2",children:[t.jsx("span",{className:"text-4xl opacity-50",children:""}),t.jsx("span",{className:"text-xs",children:""})]}):y.map((D,xe)=>t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden",children:[t.jsxs("div",{className:"bg-slate-50 px-4 py-3 border-b border-slate-100 flex justify-between items-center",children:[t.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:D.date}),t.jsxs("span",{className:"text-[10px] bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full",children:[D.msgs.length," "]})]}),t.jsx("div",{className:"p-4 space-y-4",children:D.msgs.map(A=>{const le=(A.content||"").replace(/\[.*?\]/g,"").trim();return t.jsx("div",{className:`flex flex-col ${A.role==="user"?"items-end":"items-start"}`,children:t.jsx("div",{className:`max-w-[90%] text-sm leading-relaxed whitespace-pre-wrap ${A.role==="user"?"text-slate-500 text-right italic":"text-slate-800"}`,children:A.role==="user"?t.jsx("span",{className:"bg-slate-100 px-3 py-2 rounded-xl rounded-tr-none inline-block",children:le}):t.jsx("span",{children:le||"()"})})},A.id)})})]},xe))})]}):d==="peek"?t.jsxs("div",{className:"h-full w-full bg-black relative flex flex-col font-sans overflow-hidden",children:[t.jsxs("div",{className:"pt-24 flex flex-col items-center z-10 shrink-0",children:[t.jsxs("div",{className:"text-xs font-mono text-neutral-500 mb-2 tracking-[0.2em] font-medium",children:[i.day.toUpperCase()," ",G()]}),t.jsx("h2",{className:"text-4xl font-light text-white tracking-[0.3em] uppercase",children:me.name})]}),m&&t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center -mt-20 z-10",children:[t.jsx("div",{className:"w-12 h-[1px] bg-neutral-800 mb-12"}),t.jsx("div",{className:"w-[1px] h-12 bg-gradient-to-b from-transparent via-white to-transparent animate-pulse mb-6"}),t.jsx("p",{className:"text-sm font-light text-neutral-500 italic tracking-widest",children:"..."})]}),!m&&h&&t.jsxs("div",{className:"flex-1 min-h-0 flex flex-col px-8 pb-10 z-10 animate-fade-in",children:[t.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar mb-8 mask-image-gradient pt-8",children:t.jsx("div",{className:"min-h-full flex flex-col justify-center",children:t.jsx("p",{className:"text-neutral-300 text-[15px] leading-8 tracking-wide text-justify font-light select-none whitespace-pre-wrap",children:h})})}),t.jsxs("div",{className:"shrink-0 flex flex-col items-center gap-6",children:[t.jsxs("div",{className:"w-full flex gap-3",children:[t.jsx("button",{onClick:pe,className:"flex-1 h-14 bg-white text-black rounded-full font-bold tracking-[0.1em] text-sm shadow-[0_0_20px_rgba(255,255,255,0.1)] active:scale-95 transition-transform hover:bg-neutral-200",children:" (Approach)"}),t.jsx("button",{onClick:()=>Ce(me),className:"w-14 h-14 bg-neutral-800 text-white rounded-full flex items-center justify-center border border-neutral-700 shadow-lg active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})})]}),t.jsxs("div",{className:"flex flex-col items-center gap-3 text-[10px] text-neutral-600 font-medium tracking-wider",children:[t.jsx("button",{onClick:()=>f("settings"),className:"hover:text-neutral-400 transition-colors",children:" / "}),t.jsx("button",{onClick:se,className:"hover:text-neutral-400 transition-colors",children:""})]})]})]})]}):d==="settings"?t.jsx(wx,{char:me,onBack:()=>f("select")}):d==="session"?t.jsxs(t.Fragment,{children:[t.jsx(gx,{char:me,userProfile:c,messages:v,peekStatus:h,initialState:me.savedDateState,onSendMessage:je,onReroll:Pe,onExit:N,onEditMessage:D=>{te(D),Me(D.content),j(!0)},onDeleteMessage:ge,onSettings:()=>f("settings")}),t.jsx(Ze,{isOpen:M,title:"",onClose:()=>j(!1),footer:t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),t.jsx("button",{onClick:ce,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl",children:""})]}),children:t.jsx("textarea",{value:Ne,onChange:D=>Me(D.target.value),className:"w-full h-32 bg-slate-100 rounded-2xl p-4 resize-none focus:ring-1 focus:ring-primary/20 transition-all text-sm leading-relaxed"})})]}):null},jx=()=>{const{closeApp:e,userProfile:s,updateUserProfile:n,addToast:r}=xt(),a=u.useRef(null),l=async o=>{var c;const i=(c=o.target.files)==null?void 0:c[0];if(i)try{const d=await ls(i);n({avatar:d}),r("","success")}catch(d){r(d.message,"error")}};return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col animate-fade-in",children:[t.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 sticky top-0 z-10",children:t.jsxs("div",{className:"flex items-center gap-2 w-full",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsxs("div",{onClick:()=>{var o;return(o=a.current)==null?void 0:o.click()},className:"w-32 h-32 rounded-full bg-white shadow-lg p-1 cursor-pointer group relative",children:[t.jsx("img",{src:s.avatar,className:"w-full h-full rounded-full object-cover group-hover:opacity-80 transition-opacity"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("span",{className:"text-xs font-bold text-slate-600 bg-white/80 px-2 py-1 rounded-full",children:""})})]}),t.jsx("input",{type:"file",ref:a,className:"hidden",accept:"image/*",onChange:l})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:""}),t.jsx("input",{value:s.name,onChange:o=>n({name:o.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 text-lg font-bold text-slate-700 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none transition-all"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:" / "}),t.jsx("p",{className:"text-[10px] text-slate-400 mb-2",children:" AI ()"}),t.jsx("textarea",{value:s.bio,onChange:o=>n({bio:o.target.value}),className:"w-full h-48 bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm text-slate-700 leading-relaxed resize-none focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none transition-all",placeholder:"..."})]})]})]})]})},ca=[{id:"plain",name:"",css:"bg-white",text:"text-slate-700"},{id:"grid",name:"",css:"bg-white",text:"text-slate-700",style:{backgroundImage:"linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px)",backgroundSize:"20px 20px"}},{id:"dot",name:"",css:"bg-[#fffdf5]",text:"text-slate-700",style:{backgroundImage:"radial-gradient(#d1d5db 1px, transparent 1px)",backgroundSize:"20px 20px"}},{id:"lined",name:"",css:"bg-[#fefce8]",text:"text-slate-700",style:{backgroundImage:"repeating-linear-gradient(transparent, transparent 23px, #e5e7eb 23px, #e5e7eb 24px)"}},{id:"dark",name:"",css:"bg-slate-800",text:"text-white/90"},{id:"pink",name:"",css:"bg-pink-50",text:"text-slate-700",style:{backgroundImage:"radial-gradient(#fbcfe8 2px, transparent 2px)",backgroundSize:"30px 30px"}}],vu=["","","","","","","","","","","","","","","","","","","",""],wu=()=>{const e=new Date,s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${s}-${n}-${r}`},Nx=()=>{const{closeApp:e,characters:s,activeCharacterId:n,apiConfig:r,addToast:a,userProfile:l,updateCharacter:o}=xt(),[i,c]=u.useState("select"),[d,f]=u.useState(null),[h,p]=u.useState([]),[m,x]=u.useState(null),[y,C]=u.useState(wu()),[g,b]=u.useState(!1),[v,w]=u.useState(!1),[z,k]=u.useState(!1),[M,j]=u.useState("user"),[H,te]=u.useState(!1),[Ne,Me]=u.useState(null),[me,F]=u.useState(null),[se,G]=u.useState(null),Ee=u.useRef(null),[P,Z]=u.useState([]),[X,pe]=u.useState(!1),[Ce,je]=u.useState(""),[Pe,ge]=u.useState(null),ce=u.useRef(null);u.useEffect(()=>{if(s.length>0&&n){const V=s.find(Q=>Q.id===n);V&&(f(V),c("calendar"),N(V.id))}R.getJournalStickers().then(Z)},[n]);const N=async V=>{const Q=await R.getDiariesByCharId(V);p(Q.sort((ye,be)=>be.date.localeCompare(ye.date)))},ne=V=>{f(V),c("calendar"),N(V.id)},we=V=>{const Q=h.find(ye=>ye.date===V);Q?(x(Q),j(Q.charPage?"char":"user")):(x({id:`diary-${Date.now()}`,charId:d.id,date:V,userPage:{text:"",paperStyle:"grid",stickers:[]},timestamp:Date.now(),isArchived:!1}),j("user")),c("write"),C(V),F(null)},D=(V,Q="user")=>{if(!m)return;const ye=Q==="user"?"userPage":"charPage";let be=m[ye]||{text:"",paperStyle:"plain",stickers:[]};x(B=>B?{...B,[ye]:{...be,...V}}:null)},xe=V=>{const Q=M,ye=Q==="user"?m==null?void 0:m.userPage:m==null?void 0:m.charPage;if(!ye&&Q==="char")return;const be={id:`st-${Date.now()}-${Math.random()}`,url:V,x:50,y:50,rotation:(Math.random()-.5)*40,scale:1},B=(ye==null?void 0:ye.stickers)||[];D({stickers:[...B,be]},Q),k(!1)},A=async()=>{if(!Ce.trim())return;const V=Ce.split(`
`);let Q=0;for(const ye of V){const be=ye.split("--");if(be.length>=2){const B=be[0].trim(),$=be.slice(1).join("--").trim();B&&$&&(await R.saveJournalSticker(B,$),Q++)}}Z(await R.getJournalStickers()),je(""),pe(!1),a(` ${Q} `,"success")},le=async()=>{Pe&&(await R.deleteJournalSticker(Pe.name),Z(V=>V.filter(Q=>Q.name!==Pe.name)),ge(null),a("","success"))},re=async()=>{m&&(await R.saveDiary(m),await N(m.charId),a("","success"))},$e=(V,Q)=>{V.stopPropagation(),F(Q)},Re=V=>{const Q=M==="user"?m==null?void 0:m.userPage:m==null?void 0:m.charPage;if(!Q)return;const ye=Q.stickers.filter(be=>be.id!==V);D({stickers:ye},M),F(null)},De=(V,Q,ye)=>{V.preventDefault(),V.stopPropagation(),V.currentTarget.setPointerCapture(V.pointerId),ye==="move"?(Me(Q),F(Q)):G(Q)},Ke=V=>{if(!Ne&&!se||!Ee.current||!m)return;const Q=Ee.current.getBoundingClientRect(),ye=M==="user"?m.userPage:m.charPage;if(ye){if(Ne){const be=(V.clientX-Q.left)/Q.width*100,B=(V.clientY-Q.top)/Q.height*100,$=Math.max(0,Math.min(100,be)),U=Math.max(0,Math.min(100,B)),S=ye.stickers.map(T=>T.id===Ne?{...T,x:$,y:U}:T);D({stickers:S},M)}if(se){const be=ye.stickers.find(ve=>ve.id===se);if(!be)return;const B=V.clientX-Q.left-be.x/100*Q.width,$=V.clientY-Q.top-be.y/100*Q.height,U=Math.sqrt(B*B+$*$),S=Math.max(.2,Math.min(3,U/40)),T=ye.stickers.map(ve=>ve.id===se?{...ve,scale:S}:ve);D({stickers:T},M)}}},_=V=>{Me(null),G(null),V.currentTarget.releasePointerCapture(V.pointerId)},ee=()=>{F(null)},E=V=>{ce.current=setTimeout(()=>{ge(V)},600)},K=()=>{ce.current&&(clearTimeout(ce.current),ce.current=null)},ke=async()=>{var V;if(!m||!d||!r.apiKey){a("","error");return}if(!m.userPage.text.trim()){a("","info");return}b(!0),re();try{let Q=Et.buildCoreContext(d,l);const ye=ca.map(Te=>Te.id).join(", "),be=vu.join(" "),B=P.length>0?`Custom Stickers (Name: URL): 
${P.map(Te=>`- ${Te.name}: ${Te.url}`).join(`
`)}`:"",S=(await R.getMessagesByCharId(d.id)).slice(-30).map(Te=>{const O=Te.type==="image"?"[User sent an image]":Te.content;return`[${new Date(Te.timestamp).toLocaleTimeString()}] ${Te.role==="user"?"User":"You"}: ${O}`}).join(`
`);Q+=`### [Exchange Diary Mode Instructions]


###  (Recent Context)
****

[RECENT LOGS START]
${S}
[RECENT LOGS END]

### 
1.  (${m.date})
2. ****
   - 
   - ****
   - 
3. 

###  (Stickers)
 EmojiCustom Stickers
${B}
 Custom Sticker URL  stickers 

###  ( JSON)
Structure:
{
  "text": "...",
  "paperStyle": "one of: ${ye}",
  "stickers": ["sticker1", "http://custom-sticker-url..."] ( Custom Stickers 0-3)
}`;const T=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"system",content:Q},{role:"user",content:`Users Diary:
${m.userPage.text}`}],temperature:.85})});if(!T.ok)throw new Error("API Error");let de=(await T.json()).choices[0].message.content.trim();de=de.replace(/```json/g,"").replace(/```/g,"").trim();let I;try{I=JSON.parse(de)}catch{I={text:de,paperStyle:"plain",stickers:[]}}const oe=(I.stickers||[]).map(Te=>({id:`st-${Math.random()}`,url:Te,x:Math.random()*70+10,y:Math.random()*70+10,rotation:(Math.random()-.5)*40,scale:1})),Ie={text:I.text||"",paperStyle:((V=ca.find(Te=>Te.id===I.paperStyle))==null?void 0:V.id)||"plain",stickers:oe},Le={...m,charPage:Ie};x(Le),await R.saveDiary(Le),await N(d.id),j("char"),a("","success")}catch(Q){a(`: ${Q.message}`,"error")}finally{b(!1)}},J=async()=>{var V;if(!(!m||!d||m.isArchived)){w(!0);try{const ye=`${Et.buildCoreContext(d,l)}

### [System Instruction: Diary Archival]
: (${m.date}) 

###  (Input)
 (${l.name}) :
"${m.userPage.text}"

 (${d.name}) :
"${((V=m.charPage)==null?void 0:V.text)||"()"}"

###  (Output Requirements)
1. ****: ${l.name}
2. ****: 
3. ****:  (50)
`,be=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:ye}],temperature:.3})});if(be.ok){let $=(await be.json()).choices[0].message.content;$=$.replace(/^["']|["']$/g,"").trim();const U={id:`mem-${Date.now()}`,date:m.date,summary:$,mood:"diary"},S=[...d.memories||[],U];o(d.id,{memories:S});const T={...m,isArchived:!0};x(T),await R.saveDiary(T),await N(d.id),a("","success")}else throw new Error(`API Error ${be.status}`)}catch(Q){console.error(Q),a(`: ${Q.message}`,"error")}finally{w(!1)}}},ae=(V,Q)=>{const ye=ca.find(be=>be.id===V.paperStyle)||ca[0];return t.jsxs("div",{ref:Q===M?Ee:void 0,className:`relative w-full h-full shadow-md transition-all duration-300 overflow-hidden ${ye.css} flex flex-col rounded-3xl touch-none`,style:{...ye.style},onPointerMove:Q===M?Ke:void 0,onPointerUp:Q===M?_:void 0,onPointerLeave:Q===M?_:void 0,onClick:ee,children:[t.jsxs("div",{className:"flex-1 p-6 relative z-10 flex flex-col",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-black/5 shrink-0",children:[t.jsx("span",{className:`text-xs font-bold uppercase tracking-widest opacity-50 ${ye.text}`,children:Q==="user"?"MY DIARY":"REPLY"}),t.jsx("span",{className:`text-[10px] opacity-40 font-mono ${ye.text}`,children:m==null?void 0:m.date})]}),t.jsx("textarea",{value:V.text,onChange:be=>D({text:be.target.value},Q),placeholder:Q==="user"?"...":"...",className:`flex-1 w-full bg-transparent resize-none outline-none leading-loose text-[16px] font-normal ${ye.text} placeholder:opacity-30 no-scrollbar`,readOnly:g})]}),!(Q==="char"&&H)&&V.stickers.map(be=>{const B=me===be.id,$=be.scale||1;return t.jsxs("div",{onPointerDown:U=>De(U,be.id,"move"),onClick:U=>$e(U,be.id),className:`absolute text-6xl select-none drop-shadow-md z-20 cursor-move ${Ne===be.id?"opacity-90":""} transition-transform`,style:{left:`${be.x}%`,top:`${be.y}%`,transform:`translate(-50%, -50%) rotate(${be.rotation}deg) scale(${$})`,border:B?"2px dashed #3b82f6":"none",borderRadius:"8px",padding:"4px"},children:[be.url.startsWith("http")||be.url.startsWith("data")?t.jsx("img",{src:be.url,className:"w-20 h-20 object-contain pointer-events-none",draggable:!1}):be.url,B&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute -top-3 -right-3 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs shadow-md cursor-pointer pointer-events-auto",onClick:U=>{U.stopPropagation(),Re(be.id)},children:""}),t.jsx("div",{className:"absolute -bottom-2 -right-2 w-5 h-5 bg-blue-500 rounded-full border-2 border-white shadow-md cursor-nwse-resize pointer-events-auto",onPointerDown:U=>De(U,be.id,"resize")})]})]},be.id)}),t.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/paper-fibers.png')] opacity-10 pointer-events-none z-0 mix-blend-multiply"})]})};return i==="select"?t.jsxs("div",{className:"h-full w-full bg-amber-50 flex flex-col font-light",children:[t.jsxs("div",{className:"pt-12 pb-4 px-6 border-b border-amber-100 bg-amber-50/80 backdrop-blur-sm sticky top-0 z-20 flex items-center justify-between shrink-0 h-24 box-border",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-amber-100/50 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-amber-900",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-amber-900 text-lg tracking-wide",children:""}),t.jsx("div",{className:"w-8"})]}),t.jsx("div",{className:"p-6 grid grid-cols-2 gap-5 overflow-y-auto pb-20 no-scrollbar",children:s.map(V=>t.jsxs("div",{onClick:()=>ne(V),className:"aspect-[3/4] bg-white rounded-r-2xl rounded-l-md border-l-4 border-l-amber-800 shadow-[2px_4px_12px_rgba(0,0,0,0.08)] p-4 flex flex-col items-center justify-center gap-3 cursor-pointer active:scale-95 transition-all relative overflow-hidden group",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 w-2 bg-gradient-to-r from-black/10 to-transparent"}),t.jsx("div",{className:"w-16 h-16 rounded-full p-[2px] border border-amber-100 bg-amber-50",children:t.jsx("img",{src:V.avatar,className:"w-full h-full rounded-full object-cover"})}),t.jsx("span",{className:"font-bold text-amber-900 text-sm",children:V.name}),t.jsx("span",{className:"text-[9px] text-amber-600 bg-amber-50 px-2 py-1 rounded-full font-mono uppercase tracking-wide",children:"Journal"})]},V.id))})]}):i==="calendar"&&d?t.jsxs("div",{className:"h-full w-full bg-white flex flex-col font-light relative",children:[t.jsxs("div",{className:"pt-12 pb-6 px-6 bg-amber-500 shadow-lg shrink-0 rounded-b-[2rem] z-20",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("button",{onClick:()=>c("select"),className:"text-white/80 hover:text-white transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})})}),t.jsx("div",{className:"w-6"})]}),t.jsxs("div",{className:"text-white",children:[t.jsx("div",{className:"text-xs opacity-70 uppercase tracking-widest font-bold mb-1",children:"Exchange Diary"}),t.jsx("div",{className:"text-3xl font-bold tracking-tight",children:d.name})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-20 no-scrollbar",children:[t.jsxs("button",{onClick:()=>we(wu()),className:"w-full py-5 mb-8 border-2 border-dashed border-amber-200 rounded-2xl text-amber-500 font-bold flex items-center justify-center gap-2 hover:bg-amber-50 active:scale-95 transition-all",children:[t.jsx("span",{className:"text-xl",children:"+"})," "]}),t.jsx("div",{className:"space-y-4",children:h.map(V=>t.jsxs("div",{onClick:()=>we(V.date),className:"flex items-center gap-4 p-4 rounded-2xl bg-white border border-slate-100 shadow-sm active:scale-95 transition-all hover:shadow-md cursor-pointer relative overflow-hidden group",children:[t.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-amber-400"}),t.jsxs("div",{className:"w-14 h-14 bg-amber-50 rounded-xl flex flex-col items-center justify-center text-amber-800 shrink-0 border border-amber-100",children:[t.jsxs("span",{className:"text-[10px] font-bold opacity-60",children:[V.date.split("-")[1],""]}),t.jsx("span",{className:"text-xl font-bold leading-none",children:V.date.split("-")[2]})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm text-slate-700 truncate font-medium",children:V.userPage.text||"()"}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("p",{className:"text-xs text-slate-400 font-mono",children:V.date.split("-")[0]}),t.jsxs("div",{className:"flex gap-2",children:[V.charPage&&t.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-600 rounded-full text-[9px] font-bold",children:""}),V.isArchived&&t.jsx("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-500 rounded-full text-[9px] font-bold",children:""})]})]})]})]},V.id))})]})]}):t.jsxs("div",{className:"h-full w-full bg-[#1a1a1a] flex flex-col relative overflow-hidden",children:[t.jsxs("div",{className:"pt-12 pb-3 px-4 bg-[#1a1a1a]/90 backdrop-blur-md flex items-center justify-between text-white shrink-0 z-30 h-24 box-border",children:[t.jsx("button",{onClick:()=>c("calendar"),className:"p-2 -ml-2 text-white/60 hover:text-white rounded-full active:bg-white/10 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{className:"flex gap-3",children:[M==="char"&&t.jsx("button",{onClick:()=>te(!H),className:`p-2 rounded-full transition-colors ${H?"bg-red-500/20 text-red-400":"bg-white/10 text-white/60"}`,title:H?"":"",children:H?t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})}):t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]})}),(m==null?void 0:m.charPage)&&!m.isArchived&&t.jsxs("button",{onClick:J,disabled:v,className:`px-4 py-1.5 rounded-full text-xs font-bold shadow-lg transition-all flex items-center gap-2 ${v?"bg-emerald-800 text-emerald-200 cursor-not-allowed":"bg-emerald-600/90 text-white shadow-emerald-900/50 active:scale-95"}`,children:[v&&t.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),v?"...":""]}),t.jsx("button",{onClick:re,className:"px-4 py-1.5 bg-white/10 rounded-full text-xs font-bold hover:bg-white/20 active:scale-95 transition-transform",children:""})]})]}),t.jsx("div",{className:"flex-1 relative w-full overflow-hidden flex flex-col",children:t.jsx("div",{className:"flex-1 w-full max-w-xl mx-auto px-2 pb-4 pt-2 flex flex-col relative",children:t.jsxs("div",{className:"flex-1 relative rounded-3xl transition-all duration-500",children:[M==="user"&&m&&ae(m.userPage,"user"),M==="char"&&(m!=null&&m.charPage?ae(m.charPage,"char"):t.jsxs("div",{className:"w-full h-full bg-[#252525] rounded-3xl border border-white/5 flex flex-col items-center justify-center text-white/40 gap-4 p-8 text-center",children:[t.jsx("div",{className:"text-5xl opacity-20 animate-pulse",children:""}),g?t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm font-medium text-amber-500",children:"..."}),t.jsxs("div",{className:"flex justify-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-bounce"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-bounce delay-100"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-bounce delay-200"})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm",children:["",t.jsx("br",{})," ",d==null?void 0:d.name," "]}),t.jsx("button",{onClick:ke,className:"px-6 py-3 bg-amber-500 hover:bg-amber-400 text-white text-sm font-bold rounded-full shadow-[0_0_20px_rgba(245,158,11,0.3)] active:scale-95 transition-all mt-2",children:" TA "})]})]}))]})})}),t.jsxs("div",{className:"shrink-0 bg-[#222] border-t border-white/5 pb-safe pt-2 z-30",children:[t.jsxs("div",{className:"flex justify-center gap-4 mb-4 px-4",children:[t.jsx("button",{onClick:()=>{j("user"),F(null)},className:`flex-1 py-3 rounded-2xl text-xs font-bold uppercase tracking-wider transition-all duration-300 relative overflow-hidden ${M==="user"?"bg-white text-black shadow-lg":"bg-white/5 text-white/40 hover:bg-white/10"}`,children:"My Diary"}),t.jsxs("button",{onClick:()=>{j("char"),F(null)},className:`flex-1 py-3 rounded-2xl text-xs font-bold uppercase tracking-wider transition-all duration-300 relative overflow-hidden ${M==="char"?"bg-amber-500 text-white shadow-lg shadow-amber-900/50":"bg-white/5 text-white/40 hover:bg-white/10"}`,children:[(d==null?void 0:d.name)||"Partner",(m==null?void 0:m.charPage)&&M!=="char"&&t.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full shadow-sm animate-pulse"})]})]}),t.jsxs("div",{className:"flex items-center justify-between px-6 pb-4",children:[t.jsx("div",{className:"flex gap-3 bg-[#111] p-1.5 rounded-full border border-white/10",children:ca.slice(0,4).map(V=>t.jsx("button",{onClick:()=>D({paperStyle:V.id},M),className:`w-8 h-8 rounded-full border border-white/10 transition-transform active:scale-90 ${V.css}`,title:V.name},V.id))}),t.jsxs("div",{className:"flex gap-3",children:[M==="char"&&(m==null?void 0:m.charPage)&&!g&&t.jsx("button",{onClick:ke,className:"w-11 h-11 bg-white/10 text-white rounded-full flex items-center justify-center active:scale-90 transition-transform border border-white/5",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("button",{onClick:()=>k(!z),className:`w-11 h-11 rounded-full flex items-center justify-center text-xl shadow-lg active:scale-90 transition-transform ${z?"bg-white text-black":"bg-gradient-to-br from-amber-400 to-orange-500 text-white"}`,children:""})]})]}),z&&t.jsx("div",{className:"bg-[#1a1a1a] border-t border-white/10 p-4 animate-slide-up h-48 overflow-y-auto no-scrollbar",children:t.jsxs("div",{className:"grid grid-cols-6 gap-3",children:[t.jsx("button",{onClick:()=>pe(!0),className:"flex items-center justify-center bg-white/10 rounded-xl border-2 border-dashed border-white/20 text-white/50 text-xl font-bold hover:bg-white/20 hover:text-white transition-all aspect-square",children:"+"}),vu.map((V,Q)=>t.jsx("button",{onClick:()=>xe(V),className:"text-3xl hover:scale-110 transition-transform p-2 bg-white/5 rounded-xl border border-white/5 flex items-center justify-center",children:V},`def-${Q}`)),P.map((V,Q)=>t.jsx("button",{onClick:()=>xe(V.url),onTouchStart:()=>E(V),onTouchEnd:K,onMouseDown:()=>E(V),onMouseUp:K,onMouseLeave:K,onContextMenu:ye=>{ye.preventDefault(),ge(V)},className:"p-2 bg-white/5 rounded-xl border border-white/5 flex items-center justify-center relative active:scale-95 transition-transform",children:t.jsx("img",{src:V.url,className:"w-8 h-8 object-contain pointer-events-none"})},`cust-${Q}`))]})})]}),t.jsx(Ze,{isOpen:X,title:"",onClose:()=>pe(!1),footer:t.jsx("button",{onClick:A,className:"w-full py-3 bg-white/10 text-white font-bold rounded-2xl hover:bg-white/20 transition-all",children:""}),children:t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"--URL ()"}),t.jsx("textarea",{value:Ce,onChange:V=>je(V.target.value),placeholder:`CoolCat--https://...
Heart--https://...`,className:"w-full h-32 bg-slate-100 rounded-2xl p-4 text-sm resize-none focus:outline-none text-slate-700"})]})}),t.jsx(Ze,{isOpen:!!Pe,title:"",onClose:()=>ge(null),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>ge(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),t.jsx("button",{onClick:le,className:"flex-1 py-3 bg-red-500 text-white rounded-2xl font-bold",children:""})]}),children:t.jsxs("div",{className:"flex flex-col items-center gap-3 py-2",children:[Pe&&t.jsx("img",{src:Pe.url,className:"w-16 h-16 object-contain rounded-lg bg-slate-100 border"}),t.jsx("p",{className:"text-sm text-slate-600",children:"()"})]})})]})},yu={cyber:{id:"cyber",bg:"bg-[#0f172a]",text:"text-slate-200",textSub:"text-slate-500",accent:"text-cyan-400",border:"border-cyan-900/30",card:"bg-slate-900/50 backdrop-blur-md border border-slate-700/50",buttonPrimary:"bg-cyan-600 hover:bg-cyan-500 text-white rounded-none skew-x-[-10deg]",font:"font-mono",iconDone:"text-green-500",decoLine:"bg-slate-800",modalBg:"bg-[#0f172a] border border-cyan-500",input:"bg-slate-800 text-white border-none rounded-none",label:"QUEST LOG",eventLabel:"SERVER EVENTS"},soft:{id:"soft",bg:"bg-[#fff0f5]",text:"text-slate-700",textSub:"text-slate-400",accent:"text-pink-500",border:"border-pink-100",card:"bg-white/80 backdrop-blur-xl rounded-[2rem] shadow-sm border border-white",buttonPrimary:"bg-pink-400 hover:bg-pink-500 text-white rounded-2xl shadow-lg shadow-pink-200",font:"font-sans",iconDone:"text-pink-400",decoLine:"bg-pink-200",modalBg:"bg-white/90 rounded-[2.5rem]",input:"bg-pink-50 text-slate-700 border border-pink-100 rounded-xl",label:" ",eventLabel:" "},minimal:{id:"minimal",bg:"bg-[#eef2f6]",text:"text-slate-600",textSub:"text-slate-400",accent:"text-indigo-500",border:"border-transparent",card:"bg-[#eef2f6] rounded-2xl shadow-[6px_6px_12px_#d1d9e6,-6px_-6px_12px_#ffffff]",buttonPrimary:"bg-[#eef2f6] text-slate-600 font-bold rounded-xl shadow-[6px_6px_12px_#d1d9e6,-6px_-6px_12px_#ffffff] active:shadow-[inset_4px_4px_8px_#d1d9e6,inset_-4px_-4px_8px_#ffffff]",font:"font-sans",iconDone:"text-slate-400",decoLine:"bg-slate-300",modalBg:"bg-[#eef2f6] rounded-2xl shadow-2xl",input:"bg-[#eef2f6] text-slate-700 rounded-xl shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]",label:"Focus",eventLabel:"Timeline"}},kx=()=>{var ce;const{closeApp:e,characters:s,activeCharacterId:n,apiConfig:r,addToast:a,userProfile:l}=xt(),[o,i]=u.useState([]),[c,d]=u.useState([]),[f,h]=u.useState("quest"),[p,m]=u.useState(new Set),[x,y]=u.useState("cyber"),C=yu[x],[g,b]=u.useState(!1),[v,w]=u.useState(!1),[z,k]=u.useState(""),[M,j]=u.useState(n||""),[H,te]=u.useState(""),[Ne,Me]=u.useState(""),[me,F]=u.useState(n||"");u.useEffect(()=>{G();const N=localStorage.getItem("schedule_app_theme");N&&yu[N]&&y(N)},[]);const se=()=>{const N=["cyber","soft","minimal"],ne=(N.indexOf(x)+1)%N.length,we=N[ne];y(we),localStorage.setItem("schedule_app_theme",we)},G=async()=>{const[N,ne]=await Promise.all([R.getAllTasks(),R.getAllAnniversaries()]);i(N.sort((we,D)=>D.createdAt-we.createdAt)),d(ne.sort((we,D)=>we.date.localeCompare(D.date)))},Ee=async N=>{var we,D,xe,A,le,re,$e;const ne=s.find(Re=>Re.id===N.supervisorId);if(!ne||!r.apiKey){a("","success");return}a(`${ne.name} ...`,"info");try{const Re=Et.buildCoreContext(ne,l),De=`
###  (Task Completed)
 (${l.name}) / "${N.title}"


### 

- 
- 
- 
- ********

****:
- 
- ****
- `,Ke=[{role:"system",content:Re},{role:"user",content:De}],_=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:Ke,temperature:.9,max_tokens:8e3})});if(!_.ok){const K=await _.text();throw new Error(`API Error ${_.status}: ${K.slice(0,100)}`)}const ee=await _.json();let E=(A=(xe=(D=(we=ee.choices)==null?void 0:we[0])==null?void 0:D.message)==null?void 0:xe.content)==null?void 0:A.trim();!E&&(($e=(re=(le=ee.choices)==null?void 0:le[0])==null?void 0:re.message)!=null&&$e.reasoning_content)&&console.warn("AI returned empty content but has reasoning."),E?(E=E.replace(/^["']|["']$/g,""),a(`${ne.name}: ${E}`,"success"),await R.saveMessage({charId:ne.id,role:"system",type:"text",content:`[: ${l.name}  "${N.title}"${ne.name} : "${E}"]`})):(console.warn("AI returned empty content",ee),a(" (AI )","success"))}catch(Re){console.error("Task Reward Error:",Re),a(`: ${Re.message}`,"error")}},P=async N=>{var re,$e,Re,De;const ne=s.find(Ke=>Ke.id===N.charId);if(!ne||!r.apiKey||N.aiThought&&N.lastThoughtGeneratedAt&&Date.now()-N.lastThoughtGeneratedAt<24*60*60*1e3)return;Date.now()-(N.lastThoughtGeneratedAt||0)>1e4&&a(`${ne.name} ...`,"info");const we=Math.ceil((new Date(N.date).getTime()-new Date().getTime())/(1e3*60*60*24)),D=we>0?` ${we} `:we===0?"!":` ${Math.abs(we)} `,xe=Et.buildCoreContext(ne,l),A=`
### 
: "${N.title}"
: ${D}

### 

****:
- 
- ****`,le=[{role:"system",content:xe},{role:"user",content:A}];try{const Ke=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:le,temperature:.8,max_tokens:8e3})});if(!Ke.ok){const E=await Ke.text();throw new Error(`API Error ${Ke.status}: ${E.slice(0,50)}`)}const _=await Ke.json(),ee=(De=(Re=($e=(re=_.choices)==null?void 0:re[0])==null?void 0:$e.message)==null?void 0:Re.content)==null?void 0:De.trim().replace(/^["']|["']$/g,"");if(ee){const E={...N,aiThought:ee,lastThoughtGeneratedAt:Date.now()};await R.saveAnniversary(E),d(K=>K.map(ke=>ke.id===N.id?E:ke))}else console.warn("AI returned empty thought",_)}catch(Ke){console.error("Anniversary Thought Error:",Ke)}},Z=async()=>{var ne;if(!z.trim())return;const N={id:`task-${Date.now()}`,title:z,supervisorId:M||((ne=s[0])==null?void 0:ne.id),tone:"gentle",isCompleted:!1,createdAt:Date.now()};await R.saveTask(N),i(we=>[N,...we]),b(!1),k("")},X=async N=>{const ne={...N,isCompleted:!N.isCompleted,completedAt:N.isCompleted?void 0:Date.now()};if(await R.saveTask(ne),i(we=>we.map(D=>D.id===N.id?ne:D)),ne.isCompleted){m(we=>new Set(we).add(N.id));try{await Ee(ne)}finally{m(we=>{const D=new Set(we);return D.delete(N.id),D})}}},pe=async N=>{await R.deleteTask(N),i(ne=>ne.filter(we=>we.id!==N))},Ce=async()=>{var ne;if(!H.trim()||!Ne)return;const N={id:`anni-${Date.now()}`,title:H,date:Ne,charId:me||((ne=s[0])==null?void 0:ne.id)};await R.saveAnniversary(N),d(we=>[...we,N].sort((D,xe)=>D.date.localeCompare(xe.date))),w(!1),te(""),Me("")},je=async N=>{await R.deleteAnniversary(N),d(ne=>ne.filter(we=>we.id!==N))},Pe=N=>{const ne=new Date;ne.setHours(0,0,0,0);const we=new Date(N);we.setHours(0,0,0,0);const D=we.getTime()-ne.getTime();return Math.ceil(D/(1e3*60*60*24))},ge=u.useMemo(()=>c.filter(N=>Pe(N.date)>=0).sort((N,ne)=>N.date.localeCompare(ne.date))[0],[c]);return u.useEffect(()=>{ge&&P(ge)},[ge]),t.jsxs("div",{className:`h-full w-full flex flex-col ${C.font} ${C.bg} ${C.text} relative overflow-hidden transition-colors duration-500`,children:[x==="cyber"&&t.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",style:{backgroundImage:"linear-gradient(rgba(56, 189, 248, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(56, 189, 248, 0.1) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),x==="soft"&&t.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-30",style:{backgroundImage:"radial-gradient(#fbcfe8 2px, transparent 2px)",backgroundSize:"20px 20px"}}),t.jsxs("div",{className:`pt-12 pb-4 px-6 border-b ${C.border} backdrop-blur-sm sticky top-0 z-20 flex items-center justify-between shrink-0 h-24 box-border relative transition-colors duration-300`,children:[t.jsx("button",{onClick:e,className:`p-2 -ml-2 rounded-full active:scale-90 transition-transform ${x==="minimal"?"bg-[#eef2f6] shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff]":"hover:bg-black/5"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:`w-6 h-6 ${C.accent}`,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{className:`flex gap-1 p-1 rounded-lg ${x==="cyber"?"bg-black/40 border border-cyan-900/50":x==="minimal"?"bg-[#eef2f6] shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":"bg-white/50"}`,children:[t.jsx("button",{onClick:()=>h("quest"),className:`px-4 py-1.5 rounded text-xs font-bold transition-all ${f==="quest"?`${C.accent} ${x==="cyber"?"bg-cyan-900/50 shadow-sm":x==="minimal"?"shadow-[2px_2px_5px_#d1d9e6,-2px_-2px_5px_#ffffff] bg-[#eef2f6]":"bg-white shadow-sm"}`:`${C.textSub}`}`,children:C.label}),t.jsx("button",{onClick:()=>h("server_events"),className:`px-4 py-1.5 rounded text-xs font-bold transition-all ${f==="server_events"?`${C.accent} ${x==="cyber"?"bg-cyan-900/50 shadow-sm":x==="minimal"?"shadow-[2px_2px_5px_#d1d9e6,-2px_-2px_5px_#ffffff] bg-[#eef2f6]":"bg-white shadow-sm"}`:`${C.textSub}`}`,children:C.eventLabel})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:se,className:`p-2 rounded-full active:scale-90 transition-transform ${x==="minimal"?"shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff]":"bg-white/10 hover:bg-white/20"}`,children:[x==="cyber"&&"",x==="soft"&&"",x==="minimal"&&""]}),t.jsx("button",{onClick:()=>f==="quest"?b(!0):w(!0),className:`p-2 rounded-full active:scale-90 transition-transform ${C.accent} ${x==="minimal"?"shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff]":"hover:bg-white/10"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),x==="cyber"&&t.jsx("div",{className:"absolute bottom-0 left-0 h-[1px] w-full bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-6 space-y-8 z-10",children:[ge&&t.jsx("div",{className:`w-full rounded-2xl p-5 relative overflow-hidden group transition-all duration-300 ${x==="minimal"?"bg-[#eef2f6] shadow-[inset_5px_5px_10px_#d1d9e6,inset_-5px_-5px_10px_#ffffff]":x==="soft"?"bg-gradient-to-r from-pink-300 to-purple-300 text-white shadow-lg shadow-pink-200":"bg-gradient-to-r from-slate-900 to-slate-800 border border-purple-500/30"}`,children:t.jsxs("div",{className:"relative z-10",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("div",{className:`text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded ${x==="minimal"?"text-slate-400":"text-white/80 bg-white/20"}`,children:""}),t.jsxs("div",{className:"text-3xl font-bold tracking-tighter",children:[Pe(ge.date)," ",t.jsx("span",{className:"text-xs opacity-60 font-normal",children:""})]})]}),t.jsx("div",{className:"text-xl font-bold mb-4",children:ge.title}),t.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-xl ${x==="minimal"?"bg-[#eef2f6] shadow-[5px_5px_10px_#d1d9e6,-5px_-5px_10px_#ffffff]":"bg-white/20 backdrop-blur-md"}`,children:[t.jsx("img",{src:(ce=s.find(N=>N.id===ge.charId))==null?void 0:ce.avatar,className:"w-8 h-8 rounded-full object-cover"}),t.jsxs("div",{className:`text-xs font-medium leading-relaxed italic ${x==="minimal"?"text-slate-500":"text-white/90"}`,children:['"',ge.aiThought||"...",'"']})]})]})}),f==="quest"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[t.jsx("div",{className:`w-2 h-2 rounded-full animate-pulse ${x==="cyber"?"bg-cyan-500":x==="soft"?"bg-pink-400":"bg-slate-400"}`}),t.jsx("h3",{className:`text-xs font-bold uppercase tracking-[0.2em] ${C.accent}`,children:""})]}),o.filter(N=>!N.isCompleted).length===0&&t.jsx("div",{className:`text-center py-12 border-2 border-dashed rounded-xl ${x==="cyber"?"border-slate-800":"border-slate-200"}`,children:t.jsx("div",{className:C.textSub,children:""})}),o.filter(N=>!N.isCompleted).map(N=>{const ne=s.find(D=>D.id===N.supervisorId),we=p.has(N.id);return t.jsxs("div",{className:`${C.card} p-4 flex items-center gap-4 group relative overflow-hidden transition-all duration-300`,children:[t.jsxs("div",{className:"w-12 h-12 rounded-full overflow-hidden shrink-0 relative border border-white/10",children:[ne?t.jsx("img",{src:ne.avatar,className:"w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"}):t.jsx("span",{className:"text-xs",children:"?"}),t.jsx("div",{className:`absolute -bottom-0 -right-0 w-4 h-4 rounded-full flex items-center justify-center text-[10px] font-bold ${x==="soft"?"bg-white text-pink-500":"bg-black text-cyan-500"}`,children:"!"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:`${C.text} font-bold text-sm tracking-wide`,children:N.title}),t.jsxs("div",{className:`text-[10px] ${C.textSub} mt-1 font-mono uppercase`,children:[": ",(ne==null?void 0:ne.name)||"Unknown"]})]}),we?t.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[t.jsx("div",{className:`w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin ${C.accent}`}),t.jsx("span",{className:`text-[10px] font-bold animate-pulse ${C.accent}`,children:"..."})]}):t.jsx("button",{onClick:()=>X(N),className:`px-4 py-2 text-[10px] font-bold uppercase tracking-wider rounded transition-all active:scale-95 ${x==="minimal"?"shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff] text-slate-500 active:shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":x==="soft"?"bg-pink-100 text-pink-500":"bg-cyan-900/30 text-cyan-400 border border-cyan-800"}`,children:""}),t.jsx("button",{onClick:()=>pe(N.id),className:"absolute top-2 right-2 text-slate-400 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-1",children:""})]},N.id)}),o.filter(N=>N.isCompleted).length>0&&t.jsxs("div",{className:"pt-8 opacity-50",children:[t.jsx("h3",{className:`text-xs font-bold uppercase tracking-[0.2em] px-1 mb-4 ${C.textSub}`,children:""}),o.filter(N=>N.isCompleted).map(N=>t.jsxs("div",{className:`flex items-center gap-3 py-2 px-2 border-b ${x==="cyber"?"border-slate-800/50":"border-slate-100"}`,children:[t.jsx("div",{className:`${C.iconDone} text-xs font-mono`,children:"[DONE]"}),t.jsx("span",{className:`text-sm line-through ${C.textSub}`,children:N.title}),t.jsx("button",{onClick:()=>pe(N.id),className:"ml-auto text-slate-400 hover:text-red-500 text-xs",children:"DEL"})]},N.id))]})]}),f==="server_events"&&t.jsxs("div",{className:`relative pl-6 space-y-8 before:absolute before:left-2 before:top-2 before:bottom-0 before:w-[1px] ${C.decoLine}`,children:[t.jsxs("div",{children:[t.jsx("h3",{className:`text-xs font-bold uppercase tracking-widest mb-6 -ml-6 pl-6 ${C.textSub}`,children:""}),t.jsx("div",{className:"space-y-4",children:c.map(N=>{var ne;return t.jsxs("div",{className:"relative group",children:[t.jsx("div",{className:`absolute -left-[20px] top-4 w-2 h-2 rounded-full z-10 ${x==="cyber"?"bg-black border border-purple-500":"bg-pink-400"}`}),t.jsxs("div",{className:`${C.card} p-4 flex justify-between items-center transition-colors`,children:[t.jsxs("div",{children:[t.jsx("div",{className:`text-sm font-bold ${C.text}`,children:N.title}),t.jsxs("div",{className:`text-[10px] ${C.textSub} font-mono mt-1`,children:[N.date,"  ",(ne=s.find(we=>we.id===N.charId))==null?void 0:ne.name]})]}),t.jsx("button",{onClick:()=>je(N.id),className:"text-slate-400 hover:text-red-400 p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]})]},N.id)})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-xs font-bold uppercase tracking-widest mb-6 -ml-6 pl-6 pt-4 ${C.textSub}`,children:""}),t.jsx("div",{className:"space-y-4",children:o.filter(N=>N.isCompleted).sort((N,ne)=>(ne.completedAt||0)-(N.completedAt||0)).map(N=>t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:`absolute -left-[20px] top-2 w-2 h-2 rounded-full z-10 ${x==="cyber"?"bg-black border border-green-600":"bg-slate-300"}`}),t.jsxs("div",{className:`text-xs ${C.textSub} font-mono`,children:["[",new Date(N.completedAt||0).toLocaleDateString(),"] "]}),t.jsx("div",{className:`text-sm ${C.text} font-bold mt-1 pl-1 border-l-2 ${C.decoLine}`,children:N.title})]},N.id))})]})]})]}),t.jsx(Ze,{isOpen:g,title:x==="cyber"?"INITIALIZE QUEST":"",onClose:()=>b(!1),footer:t.jsx("button",{onClick:Z,className:`w-full py-3 font-bold transition-all ${C.buttonPrimary}`,children:""}),children:t.jsxs("div",{className:`space-y-6 ${x==="minimal"?"p-2":""}`,children:[t.jsx("input",{autoFocus:!0,value:z,onChange:N=>k(N.target.value),placeholder:" (: )",className:`w-full px-4 py-3 text-sm focus:outline-none ${C.input}`}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2 block tracking-widest",children:""}),t.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:s.map(N=>t.jsxs("button",{onClick:()=>j(N.id),className:`flex flex-col items-center gap-2 p-2 rounded-lg border transition-all min-w-[60px] ${M===N.id?`${x==="minimal"?"shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":"border-current"}`:"border-transparent opacity-50"}`,children:[t.jsx("img",{src:N.avatar,className:"w-10 h-10 rounded-md object-cover"}),t.jsx("span",{className:`text-[10px] font-bold whitespace-nowrap ${C.text}`,children:N.name})]},N.id))})]})]})}),t.jsx(Ze,{isOpen:v,title:x==="cyber"?"REGISTER EVENT":"",onClose:()=>w(!1),footer:t.jsx("button",{onClick:Ce,className:`w-full py-3 font-bold transition-all ${C.buttonPrimary}`,children:""}),children:t.jsxs("div",{className:`space-y-4 ${x==="minimal"?"p-2":""}`,children:[t.jsx("input",{value:H,onChange:N=>te(N.target.value),placeholder:" (: )",className:`w-full px-4 py-3 text-sm focus:outline-none ${C.input}`}),t.jsx("input",{type:"date",value:Ne,onChange:N=>Me(N.target.value),className:`w-full px-4 py-3 text-sm focus:outline-none ${C.input}`}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2 block tracking-widest",children:""}),t.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:s.map(N=>t.jsxs("button",{onClick:()=>F(N.id),className:`flex flex-col items-center gap-2 p-2 rounded-lg border transition-all min-w-[60px] ${me===N.id?`${x==="minimal"?"shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":"border-current"}`:"border-transparent opacity-50"}`,children:[t.jsx("img",{src:N.avatar,className:"w-10 h-10 rounded-md object-cover"}),t.jsx("span",{className:`text-[10px] font-bold whitespace-nowrap ${C.text}`,children:N.name})]},N.id))})]})]})})]})},Xi={sully_special:[{name:"Sully",image:"https://sharkpan.xyz/f/A3XeUZ/BED.png",defaultScale:2.4},{name:"Sully",image:"https://sharkpan.xyz/f/G5n3Ul/DNZ.png",defaultScale:2.4},{name:"Sully",image:"https://sharkpan.xyz/f/zlpWS5/SG.png",defaultScale:2},{name:"Sully",image:"https://sharkpan.xyz/f/85K5ij/DDB.png",defaultScale:2.6},{name:"Sully",image:"https://sharkpan.xyz/f/75Nvsj/LJT.png",defaultScale:.9}],furniture:[{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6cf.png",defaultScale:1.5},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6cb.png",defaultScale:1.4},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1fa91.png",defaultScale:1},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6bd.png",defaultScale:1},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6c1.png",defaultScale:1.5}],decor:[{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1fab4.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f5a5.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3ae.png",defaultScale:.6},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3b8.png",defaultScale:1},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f5bc.png",defaultScale:1.2},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f4da.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3db.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f5d1.png",defaultScale:.7}],food:[{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/2615.png",defaultScale:.5},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f370.png",defaultScale:.6},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f355.png",defaultScale:.8}]},ju=[{name:"",value:"radial-gradient(circle at 50% 50%, #fdfbf7 0%, #e2e8f0 100%)"},{name:"",value:"linear-gradient(to bottom, #1e293b 0%, #0f172a 100%)"},{name:"",value:"radial-gradient(circle at 50% 50%, #fff1f2 0%, #ffe4e6 100%)"},{name:"",value:"linear-gradient(135deg, #f3f4f6 0%, #d1d5db 100%)"},{name:"",value:"repeating-linear-gradient(45deg, #f7fee7 0px, #f7fee7 10px, #ecfccb 10px, #ecfccb 20px)"}],Nu=[{name:"",value:"repeating-linear-gradient(90deg, #e7e5e4 0px, #e7e5e4 20px, #d6d3d1 21px)"},{name:"",value:"repeating-linear-gradient(90deg, #78350f 0px, #78350f 20px, #451a03 21px)"},{name:"",value:"conic-gradient(from 90deg at 2px 2px, #0000 90deg, #cbd5e1 0) 0 0/30px 30px"},{name:"",value:"#d1d5db"}],Sx=[{id:"desk",name:"",type:"furniture",image:Xi.furniture[1].image,x:20,y:55,scale:1.2,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"plant",name:"",type:"decor",image:Xi.decor[0].image,x:85,y:40,scale:.8,rotation:0,isInteractive:!0,descriptionPrompt:""}],Yo=[{id:"item-1768927221380",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/A3XeUZ/BED.png",x:78.45852578067732,y:97.38889754570907,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927255102",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/G5n3Ul/DNZ.png",x:28.853756791175588,y:69.9444485439727,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927271632",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/75Nvsj/LJT.png",x:10.276680026943646,y:80.49999880981437,scale:.9,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927286526",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/85K5ij/DDB.png",x:32.608697687684455,y:48.72222587415929,scale:2.6,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927303472",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/zlpWS5/SG.png",x:79.84189945375853,y:68.94444543117953,scale:2,rotation:0,isInteractive:!0,descriptionPrompt:""}],ku=65,Qo=e=>e.split(/(\*\*.*?\*\*|~~.*?~~|\*.*?\*|`.*?`)/g).map((n,r)=>n.startsWith("**")&&n.endsWith("**")?t.jsx("strong",{className:"font-bold text-slate-800 bg-yellow-100/50 px-0.5 rounded",children:n.slice(2,-2)},r):n.startsWith("~~")&&n.endsWith("~~")?t.jsx("span",{className:"line-through text-slate-400 opacity-80",children:n.slice(2,-2)},r):n.startsWith("*")&&n.endsWith("*")&&n.length>2?t.jsx("em",{className:"italic text-slate-600",children:n.slice(1,-1)},r):n.startsWith("`")&&n.endsWith("`")?t.jsx("code",{className:"bg-slate-200 text-slate-600 px-1 rounded text-xs font-mono break-all",children:n.slice(1,-1)},r):n),Cx=e=>e.split(/(```[\s\S]*?```)/g).map((n,r)=>{if(n.startsWith("```")&&n.endsWith("```")){const a=n.indexOf(`
`);let l=n;return a>-1&&a<10?l=n.substring(a+1,n.length-3):l=n.substring(3,n.length-3),t.jsx("div",{className:"my-3 w-full max-w-full",children:t.jsx("pre",{className:"bg-slate-800 text-green-400 p-3 rounded-xl text-[10px] font-mono overflow-x-auto border-l-4 border-green-600 shadow-sm whitespace-pre",children:l})},r)}return t.jsx("div",{className:"w-full",children:n.split(`
`).map((a,l)=>{const o=`${r}-${l}`,i=a.trim();if(!i)return t.jsx("div",{className:"h-2"},o);if(i.startsWith("# "))return t.jsx("h3",{className:"text-lg font-bold text-slate-800 mt-4 mb-2 pb-1 border-b-2 border-slate-200 break-words",children:i.substring(2)},o);if(i.startsWith("## "))return t.jsx("h4",{className:"text-sm font-bold text-slate-700 mt-3 mb-1 border-l-4 border-slate-300 pl-2 break-words",children:i.substring(3)},o);if(i.startsWith("> "))return t.jsx("div",{className:"pl-3 border-l-4 border-slate-300 text-slate-500 italic my-2 py-1 bg-slate-100 rounded-r-lg text-xs break-words",children:i.substring(2)},o);if(i.startsWith("- ")||i.startsWith(" "))return t.jsxs("div",{className:"flex gap-2 my-1 pl-1 items-start",children:[t.jsx("span",{className:"text-slate-400 mt-1 shrink-0",children:""}),t.jsx("span",{className:"flex-1 break-words",children:Qo(i.substring(2))})]},o);if(i.match(/^\[[ x]\]/)){const c=i.includes("[x]");return t.jsxs("div",{className:"flex gap-2 my-1 pl-1 items-center",children:[t.jsx("div",{className:`w-3 h-3 border rounded-sm flex items-center justify-center shrink-0 ${c?"bg-slate-600 border-slate-600":"border-slate-400"}`,children:c&&t.jsx("svg",{className:"w-2 h-2 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M5 13l4 4L19 7"})})}),t.jsx("span",{className:`flex-1 break-words ${c?"line-through text-slate-400":"text-slate-700"}`,children:Qo(i.substring(3))})]},o)}return t.jsx("div",{className:"min-h-[1.5em] my-0.5 leading-relaxed break-words text-justify",children:Qo(a)},o)})},r)}),$x=()=>{var rt,dt,yt,Ft,Ds,Xn,pn,$s,In,gr,qt,er,Ga,Ht,Xt,xo,tr;const{closeApp:e,characters:s,activeCharacterId:n,setActiveCharacterId:r,updateCharacter:a,apiConfig:l,addToast:o,userProfile:i}=xt(),[c,d]=u.useState("select"),[f,h]=u.useState("view"),[p,m]=u.useState([]),[x,y]=u.useState(null),[C,g]=u.useState([]),[b,v]=u.useState(!1),[w,z]=u.useState("todo"),[k,M]=u.useState(0),[j,H]=u.useState(!1),[te,Ne]=u.useState("..."),[Me,me]=u.useState(!1),[F,se]=u.useState(!1),[G,Ee]=u.useState(!1),[P,Z]=u.useState(!1),[X,pe]=u.useState(""),[Ce,je]=u.useState({x:50,y:75,action:"idle"}),[Pe,ge]=u.useState({text:"",visible:!1}),[ce,N]=u.useState(""),[ne,we]=u.useState({}),[D,xe]=u.useState(null),A=u.useRef(null),[le,re]=u.useState(null),[$e,Re]=u.useState(!1),De=u.useRef(null),Ke=u.useRef(null),_=u.useRef(null),ee=u.useRef(null),E=u.useRef(null),[K,ke]=u.useState([]),[J,ae]=u.useState(!1),[V,Q]=u.useState(""),[ye,be]=u.useState(""),[B,$]=u.useState(""),[U,S]=u.useState(""),[T,ve]=u.useState(null),de=u.useRef(null),I=s.find(L=>L.id===n);u.useEffect(()=>{(async()=>{const Ae=await R.getAsset("room_custom_assets_list"),Se=localStorage.getItem("room_custom_assets");if(Ae)try{ke(JSON.parse(Ae))}catch{}else if(Se)try{const Xe=JSON.parse(Se);ke(Xe),await R.saveAsset("room_custom_assets_list",Se),localStorage.removeItem("room_custom_assets")}catch{}})()},[]);const oe=()=>{const L=new Date;return L.getHours()<6&&L.setDate(L.getDate()-1),L.toISOString().split("T")[0]},Ie=L=>{if(!L)return"";const Se=Date.now()-L,Xe=Math.floor(Se/(1e3*60)),at=Math.floor(Se/(1e3*60*60)),gt=Math.floor(at/24);return Xe<5?"":Xe<60?` ${Xe} `:at<24?` ${at} `:` ${gt} `},Le=async L=>{var at;r(L.id),d("room");let Ae=(at=L.roomConfig)==null?void 0:at.items;(!Ae||Ae.length===0)&&(L.id==="preset-sully-v2"||L.name==="Sully"?(Ae=Yo,a(L.id,{roomConfig:{...L.roomConfig,items:Yo}})):Ae=Sx),m(Ae||[]);const Se=oe();if(L.lastRoomDate===Se&&L.savedRoomState&&L.savedRoomState){we(L.savedRoomState.items||{}),ge({text:L.savedRoomState.welcomeMessage||"...",visible:!0});const gt=await R.getRoomTodo(L.id,Se),Rt=await R.getRoomNotes(L.id);y(gt),g(Rt.sort((Gt,gs)=>gs.timestamp-Gt.timestamp)),o("","info")}else W(L,Ae||[])},Te=()=>{se(!1),I&&W(I,p,!0)},O=async L=>{var Ae,Se,Xe;try{console.warn("Triggering Room Fallback Initialization");const gt=`${Et.buildCoreContext(L,i,!1)}

Task: User entered your room. Just say hello. JSON: { "welcomeMessage": "..." }`,Rt=await fetch(`${l.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.apiKey}`},body:JSON.stringify({model:l.model,messages:[{role:"user",content:gt}],temperature:.5,max_tokens:8e3})});if(Rt.ok){let gs=((Xe=(Se=(Ae=(await Rt.json()).choices)==null?void 0:Ae[0])==null?void 0:Se.message)==null?void 0:Xe.content)||'{"welcomeMessage": "..."}';gs=gs.replace(/```json/g,"").replace(/```/g,"").trim();try{const es=JSON.parse(gs),st=oe();ge({text:es.welcomeMessage||"...",visible:!0});const He={};p.forEach(nt=>{He[nt.id]={description:`This is a ${nt.name}.`,reaction:"..."}}),we(He),a(L.id,{lastRoomDate:st,savedRoomState:{actorStatus:"Idling...",welcomeMessage:es.welcomeMessage||"...",items:He,actorAction:"idle"}}),o(" (Safety Fallback)","info")}catch{throw new Error("Fallback Parse Error")}}}catch(at){console.error("Fallback Failed",at),ge({text:"(...)",visible:!0})}finally{H(!1)}},W=async(L,Ae,Se=!1)=>{var Rt,Gt,gs;if(!l.apiKey)return;H(!0);const Xe=[`${L.name}...`,"...","...","..."];let at=0;const gt=setInterval(()=>{Ne(Xe[at%Xe.length]),at++},1200);try{const es=oe(),st=new Date,He=st.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),nt=st.toLocaleDateString();let lt=await R.getRoomTodo(L.id,es);const mt=await R.getRoomNotes(L.id);g(mt.sort((ts,ss)=>ss.timestamp-ts.timestamp));const Vt=!lt;lt&&y(lt);const ds=await R.getMessagesByCharId(L.id),Zt=ds.slice(-50).map(ts=>`${ts.role==="user"?"":L.name}: ${ts.content.substring(0,50)}`).join(`
`),pt=ds[ds.length-1],bs=Ie(pt==null?void 0:pt.timestamp),br=Et.buildCoreContext(L,i,!0),Va=Ae.filter(ts=>ts.isInteractive).map(ts=>({id:ts.id,name:ts.name,context:(ts.descriptionPrompt||"").substring(0,200)}));let vr=`${br}

### [Environment Context - Critical]
****: ${nt} ${He}
****: ${bs}
** (Latest 50)**:
${Zt}

### [Room Initialization - Batch Generation]
****

### 1.  (Status)
- **ActorStatus**: (${He}${bs})
- **Welcome**: ()

### 2.  (Items)

${JSON.stringify(Va)}

****
- **Description**: /
- **Reaction**: ()

### 3. [OPTIONAL]  (Daily To-Do)
${Vt?"(:  3-5 )":"(: )"}

### 4.  (Notebook Entry)

****
1. ****
2. ********(Code Blocks)
3. **** **Markdown** 
4. ****

###  (Strict JSON)
{
  "actorStatus": "...",
  "welcomeMessage": "...",
  "items": {
    "item_id": { "description": "...", "reaction": "..." }
  },
  ${Vt?'"todoList": ["task 1", "task 2"],':""}
  "notebookEntry": { "content": "markdown string...", "type": "thought" }
}
`;pe(vr);const qr=await fetch(`${l.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.apiKey}`},body:JSON.stringify({model:l.model,messages:[{role:"user",content:vr}],temperature:.5,max_tokens:8e3,safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]})});if(qr.ok){let ss=((gs=(Gt=(Rt=(await qr.json()).choices)==null?void 0:Rt[0])==null?void 0:Gt.message)==null?void 0:gs.content)||"";if(!ss)throw new Error("AI returned empty response (Safety Block suspected).");ss=ss.replace(/```json/g,"").replace(/```/g,"").trim();const Xr=ss.indexOf("{"),Qc=ss.lastIndexOf("}");Xr!==-1&&Qc!==-1&&(ss=ss.substring(Xr,Qc+1));let ns;try{ns=JSON.parse(ss)}catch{throw new Error("JSON Parse Failed")}if(ge({text:ns.welcomeMessage||"Welcome!",visible:!0}),ns.items&&we(ns.items),a(L.id,{lastRoomDate:es,savedRoomState:{actorStatus:ns.actorStatus,welcomeMessage:ns.welcomeMessage,items:ns.items||{},actorAction:"idle"}}),Vt&&ns.todoList&&Array.isArray(ns.todoList)){const ea={id:`${L.id}_${es}`,charId:L.id,date:es,items:ns.todoList.map(go=>({text:go,done:!1})),generatedAt:Date.now()};await R.saveRoomTodo(ea),y(ea),await R.saveMessage({charId:L.id,role:"system",type:"text",content:`[: ${L.name} : ${ns.todoList.join(", ")}]`})}if(ns.notebookEntry){const ea=`[: ${L.name} : 
"${ns.notebookEntry.content}"]`,go=await R.saveMessage({charId:L.id,role:"system",type:"text",content:ea}),qc={id:`note-${Date.now()}`,charId:L.id,timestamp:Date.now(),content:ns.notebookEntry.content,type:ns.notebookEntry.type||"thought",relatedMessageId:go};await R.saveRoomNote(qc),g(Km=>[qc,...Km])}}else throw new Error(`API Error ${qr.status}`)}catch(es){console.error("Room Init Failed, switching to Fallback",es),await O(L)}finally{clearInterval(gt),H(!1)}},q=async(L,Ae)=>{if(Ae&&Ae.stopPropagation(),f==="edit"){re(L.id);return}if(!I)return;const Se=Math.max(ku,L.y+5);je({x:L.x,y:Se,action:"walk"}),setTimeout(()=>je(at=>({...at,action:"interact"})),600);const Xe=ne[L.id]||ne[L.name];if(Xe){N(Xe.description),ge({text:Xe.reaction,visible:!0});const at=`[${i.name}][${I.name}]${L.name}${Xe.description}[${I.name}]${Xe.reaction}`;if(!(await R.getMessagesByCharId(I.id)).slice(-50).some(Gt=>Gt.role==="system"&&Gt.content===at))try{await R.saveMessage({charId:I.id,role:"system",type:"text",content:at})}catch{}}else N(`${L.name}`),ge({text:"(...)",visible:!0})},Y=()=>{var Ae;if(f==="edit"){(Ae=ee.current)==null||Ae.click();return}je(Se=>({...Se,action:"bounce"})),setTimeout(()=>je(Se=>({...Se,action:"idle"})),500);const L=["","...","","...","()"];ge({text:L[Math.floor(Math.random()*L.length)],visible:!0})},ie=async L=>{if(!x)return;const Ae=[...x.items];Ae[L].done=!Ae[L].done;const Se={...x,items:Ae};y(Se),await R.saveRoomTodo(Se)},fe=async L=>{if(!x)return;const Ae=x.items.filter((Xe,at)=>at!==L),Se={...x,items:Ae};y(Se),await R.saveRoomTodo(Se),o("","success")},ue=async L=>{const Ae=C.find(Se=>Se.id===L);Ae&&Ae.relatedMessageId&&await R.deleteMessage(Ae.relatedMessageId),await R.deleteRoomNote(L),g(Se=>Se.filter(Xe=>Xe.id!==L)),o(" ()","success")},ze=L=>{if(f==="edit"){re(null);return}if(!De.current)return;const Ae=De.current.getBoundingClientRect(),Se=(L.clientX-Ae.left)/Ae.width*100,Xe=(L.clientY-Ae.top)/Ae.height*100,at=Math.max(ku-5,Xe);je({x:Se,y:at,action:"walk"}),setTimeout(()=>je(gt=>({...gt,action:"idle"})),600),ge({text:"",visible:!1}),N("")},Ge=L=>{m(L),I&&a(I.id,{roomConfig:{...I.roomConfig,items:L}})},Ye=(L,Ae)=>{const Se={id:`item-${Date.now()}`,name:L.name,type:Ae,image:L.image,x:50,y:50,scale:L.defaultScale,rotation:0,isInteractive:!0,descriptionPrompt:L.description};Ge([...p,Se]),me(!1),o(`: ${L.name}`,"success")},Be=L=>{if(!le)return;const Ae=p.map(Se=>Se.id===le?{...Se,...L}:Se);Ge(Ae)},it=()=>{le&&(Ge(p.filter(L=>L.id!==le)),re(null))},Je=L=>{I&&a(I.id,{roomConfig:{...I.roomConfig,items:p,wallImage:L}})},Qe=L=>{I&&a(I.id,{roomConfig:{...I.roomConfig,items:p,floorImage:L}})},et=async(L,Ae)=>{var Xe;const Se=(Xe=L.target.files)==null?void 0:Xe[0];if(Se)try{const gt=await ls(Se,Ae==="custom_item"?{quality:1,maxWidth:2048}:void 0);if(Ae==="wall"&&Je(gt),Ae==="floor"&&Qe(gt),Ae==="actor"&&I){const Rt={...I.sprites||{},chibi:gt};a(I.id,{sprites:Rt}),o("","success")}Ae==="custom_item"&&be(gt)}catch(at){o(at.message,"error")}},Fe=async()=>{const L=B||ye;if(!V.trim()||!L){o("","error");return}Ye({name:V,image:L,defaultScale:1,description:U||void 0},"furniture");const Ae={name:V,image:L,defaultScale:1,description:U||void 0},Se=[...K,Ae];ke(Se),await R.saveAsset("room_custom_assets_list",JSON.stringify(Se)),ae(!1),Q(""),be(""),$(""),S("")},cs=L=>{de.current=setTimeout(()=>{ve(L)},600)},ht=()=>{de.current&&(clearTimeout(de.current),de.current=null)},Cs=async()=>{if(!T)return;const L=K.filter(Ae=>Ae.name!==T.name||Ae.image!==T.image);ke(L),await R.saveAsset("room_custom_assets_list",JSON.stringify(L)),ve(null),o("","success")},tt=L=>{I&&a(I.id,{roomConfig:{...I.roomConfig,...L,items:p}})},Ct=()=>{I&&(Ge(Yo),Z(!1),o("Sully ","success"))},ct=(L,Ae)=>{if(f!=="edit")return;L.preventDefault(),L.stopPropagation(),L.currentTarget.setPointerCapture(L.pointerId);const Se=p.find(at=>at.id===Ae);if(!Se||!De.current)return;const Xe=De.current.getBoundingClientRect();A.current={startX:L.clientX,startY:L.clientY,initialItemX:Se.x,initialItemY:Se.y,width:Xe.width,height:Xe.height},xe(Ae),re(Ae)},Lt=L=>{if(!D||!A.current)return;const{startX:Ae,startY:Se,initialItemX:Xe,initialItemY:at,width:gt,height:Rt}=A.current,Gt=L.clientX-Ae,gs=L.clientY-Se,es=Xe+Gt/gt*100,st=at+gs/Rt*100;m(He=>He.map(nt=>nt.id===D?{...nt,x:Math.max(0,Math.min(100,es)),y:Math.max(0,Math.min(100,st))}:nt))},Pt=L=>{D&&(Ge(p),xe(null),A.current=null,L.currentTarget.releasePointerCapture(L.pointerId))};if(c==="select")return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[t.jsxs("div",{className:"pt-12 pb-4 px-6 border-b border-slate-200 bg-white sticky top-0 z-20 flex items-center justify-between shrink-0 h-24 box-border",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-slate-100 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-slate-700 text-lg tracking-wide",children:"?"}),t.jsx("div",{className:"w-8"})]}),t.jsx("div",{className:"p-6 grid grid-cols-2 gap-4 overflow-y-auto pb-20 no-scrollbar auto-rows-fr",children:s.map(L=>t.jsxs("div",{onClick:()=>Le(L),className:"min-h-[180px] bg-white rounded-2xl shadow-sm border border-slate-100 p-4 flex flex-col items-center justify-center gap-3 cursor-pointer active:scale-95 transition-all relative overflow-hidden group hover:shadow-md",children:[t.jsxs("div",{className:"w-20 h-20 rounded-full p-1 border-2 border-slate-100 relative",children:[t.jsx("img",{src:L.avatar,className:"w-full h-full rounded-full object-cover"}),t.jsx("div",{className:"absolute bottom-0 right-0 w-6 h-6 bg-green-400 rounded-full border-2 border-white flex items-center justify-center text-[10px] text-white",children:""})]}),t.jsx("span",{className:"font-bold text-slate-700 text-sm",children:L.name})]},L.id))})]});const qn=((rt=I==null?void 0:I.sprites)==null?void 0:rt.chibi)||(I==null?void 0:I.avatar),nn="filter drop-shadow-[0_0_1px_#fff] drop-shadow-[0_0_2px_#fff] drop-shadow-[0_4px_6px_rgba(0,0,0,0.2)]",rn=(L,Ae,Se)=>{if(!L)return"";const Xe=L.startsWith("http")||L.startsWith("data"),at=Xe?`url(${L})`:L;if(!Xe)return at;const gt=Ae&&Ae>0?`${Ae}%`:"cover";return`${at} center center / ${gt} ${Se?"repeat":"no-repeat"}`},hn=rn((dt=I==null?void 0:I.roomConfig)==null?void 0:dt.wallImage,(yt=I==null?void 0:I.roomConfig)==null?void 0:yt.wallScale,(Ft=I==null?void 0:I.roomConfig)==null?void 0:Ft.wallRepeat)||ju[0].value,he=rn((Ds=I==null?void 0:I.roomConfig)==null?void 0:Ds.floorImage,(Xn=I==null?void 0:I.roomConfig)==null?void 0:Xn.floorScale,(pn=I==null?void 0:I.roomConfig)==null?void 0:pn.floorRepeat)||Nu[0].value,Oe={...Xi,custom:K},qe=(I==null?void 0:I.id)==="preset-sully-v2"||(I==null?void 0:I.name)==="Sully";return t.jsxs("div",{className:"h-full w-full bg-[#f8fafc] flex flex-col relative overflow-hidden font-sans select-none",children:[j&&t.jsxs("div",{className:"absolute inset-0 z-[500] bg-white flex flex-col items-center justify-center animate-fade-in",children:[t.jsx("div",{className:"text-4xl mb-4 animate-bounce",children:""}),t.jsx("p",{className:"text-sm font-bold text-slate-500",children:te})]}),t.jsxs("div",{ref:De,className:"flex-1 relative overflow-hidden transition-all duration-500 touch-none",onPointerMove:Lt,onPointerUp:Pt,onClick:ze,children:[t.jsx("div",{className:"absolute top-0 left-0 w-full h-[65%] bg-center transition-all duration-500 z-0",style:{background:hn}}),t.jsx("div",{className:"absolute bottom-0 left-0 w-full h-[35%] bg-center transition-all duration-500 z-0",style:{background:he}}),t.jsx("div",{className:"absolute top-[65%] w-full h-8 bg-gradient-to-b from-black/10 to-transparent pointer-events-none z-0"}),p.map(L=>{const Ae=D===L.id;return t.jsxs("div",{onPointerDown:Se=>ct(Se,L.id),onClick:Se=>q(L,Se),className:`absolute origin-bottom-center ${nn} ${f==="edit"?Ae?"cursor-grabbing":"cursor-grab":L.isInteractive?"cursor-pointer hover:scale-105 active:scale-95":""} ${le===L.id?"ring-2 ring-blue-400 rounded-lg ring-offset-4":""} touch-none select-none`,style:{left:`${L.x}%`,top:`${L.y}%`,width:`${80*L.scale}px`,transform:`translate(-50%, -100%) rotate(${L.rotation}deg)`,zIndex:Ae?100:Math.floor(L.y),transition:Ae?"none":"transform 0.3s ease-out"},children:[t.jsx("img",{src:L.image,className:"w-full h-auto object-contain pointer-events-none select-none",draggable:!1}),f==="edit"&&le===L.id&&t.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 bg-blue-500 text-white text-[9px] px-2 py-0.5 rounded-full whitespace-nowrap",children:""})]},L.id)}),t.jsxs("div",{onClick:L=>{L.stopPropagation(),Y()},className:`absolute transition-all duration-[1000ms] ease-in-out origin-bottom-center ${nn} cursor-pointer active:scale-95 group`,style:{left:`${Ce.x}%`,top:`${Ce.y}%`,width:"120px",transform:`translate(-50%, -100%) scale(${Ce.action==="walk"?1.05:Ce.action==="bounce"?1.1:1})`,zIndex:Math.floor(Ce.y)+20},children:[t.jsx("img",{src:qn,className:`w-full h-full object-contain ${Ce.action==="walk"?"animate-bounce":""}`}),f==="edit"&&t.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 bg-black/60 text-white text-[9px] px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1",children:" "}),Pe.visible&&t.jsxs("div",{className:"absolute bottom-[105%] left-1/2 -translate-x-1/2 bg-white px-4 py-3 rounded-[20px] rounded-bl-none shadow-lg border-2 border-black/5 min-w-[120px] max-w-[300px] animate-pop-in z-50",children:[t.jsx("p",{className:"text-xs font-bold text-slate-700 leading-tight text-center break-words",children:Pe.text}),t.jsx("button",{onClick:L=>{L.stopPropagation(),ge({...Pe,visible:!1})},className:"absolute -top-2 -right-2 bg-slate-200 text-slate-500 rounded-full w-4 h-4 flex items-center justify-center text-[8px]",children:""})]})]})]}),t.jsx("button",{onClick:()=>v(!0),className:`absolute right-0 top-1/2 -translate-y-1/2 bg-white/80 backdrop-blur-sm p-3 rounded-l-2xl shadow-lg border border-r-0 border-white/20 transition-transform duration-300 z-[300] ${b?"translate-x-full":"translate-x-0"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-slate-500",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),b&&t.jsx("div",{className:"absolute inset-0 z-[290] bg-black/20 backdrop-blur-[1px]",onClick:()=>v(!1)}),t.jsxs("div",{className:`absolute right-0 top-0 bottom-0 w-3/4 max-w-sm bg-white shadow-2xl z-[300] transition-transform duration-300 ease-out flex flex-col ${b?"translate-x-0":"translate-x-full"}`,children:[t.jsxs("div",{className:"p-6 pb-2 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[t.jsx("h3",{className:"text-lg font-bold text-slate-700 tracking-tight",children:""}),t.jsx("button",{onClick:()=>v(!1),className:"p-2 -mr-2 text-slate-400 hover:text-slate-600",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"flex p-2 bg-slate-50 border-b border-slate-100",children:[t.jsx("button",{onClick:()=>z("todo"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-colors ${w==="todo"?"bg-white shadow text-primary":"text-slate-400 hover:bg-white/50"}`,children:""}),t.jsx("button",{onClick:()=>z("notebook"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-colors ${w==="notebook"?"bg-white shadow text-primary":"text-slate-400 hover:bg-white/50"}`,children:""})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-[#fcfcfc] no-scrollbar",children:[w==="todo"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:(x==null?void 0:x.date)||"Today"}),t.jsxs("span",{className:"text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-500",children:[": ",x?Math.round(x.items.filter(L=>L.done).length/x.items.length*100):0,"%"]})]}),x?t.jsx("ul",{className:"space-y-3",children:x.items.map((L,Ae)=>t.jsxs("li",{className:"flex items-start gap-3 group",children:[t.jsx("div",{onClick:()=>ie(Ae),className:`mt-0.5 w-5 h-5 rounded border-2 flex items-center justify-center transition-colors cursor-pointer ${L.done?"bg-green-400 border-green-400":"border-slate-300 group-hover:border-primary"}`,children:L.done&&t.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"})})}),t.jsx("span",{onClick:()=>ie(Ae),className:`text-sm leading-relaxed transition-all flex-1 cursor-pointer ${L.done?"text-slate-300 line-through decoration-slate-300":"text-slate-700 font-medium"}`,children:L.text}),t.jsx("button",{onClick:()=>fe(Ae),className:"text-slate-300 hover:text-red-400 px-1 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]},Ae))}):t.jsx("div",{className:"text-center py-10 text-slate-400 text-xs",children:"..."}),t.jsxs("div",{className:"mt-8 p-4 bg-yellow-50 rounded-xl border border-yellow-100 text-xs text-yellow-800 leading-relaxed italic relative",children:[t.jsx("span",{className:"absolute -top-3 left-4 text-2xl",children:""})," ",I==null?void 0:I.name," TATA"]})]}),w==="notebook"&&t.jsx("div",{className:"flex flex-col pb-4",children:C.length>0?t.jsxs("div",{className:"relative bg-white shadow-md border border-slate-200 p-6 min-h-[400px] flex flex-col rounded-xl",style:{backgroundImage:"radial-gradient(#e5e7eb 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[t.jsx("div",{className:"absolute left-4 top-4 bottom-4 w-px border-l-2 border-dotted border-slate-300 pointer-events-none"}),t.jsxs("div",{className:"mb-4 ml-6 flex justify-between items-center text-[10px] text-slate-400 font-mono border-b border-slate-100 pb-2",children:[t.jsxs("span",{children:["#",C.length-k]}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("span",{children:new Date(C[k].timestamp).toLocaleString()}),t.jsx("button",{onClick:()=>ue(C[k].id),className:"text-red-300 hover:text-red-500 font-bold px-1",title:"",children:""})]})]}),t.jsx("div",{className:"flex-1 ml-6 text-slate-700 text-sm whitespace-pre-wrap leading-relaxed",children:Cx(C[k].content)}),t.jsxs("div",{className:"mt-6 ml-6 flex justify-between items-center pt-4 border-t border-slate-100",children:[t.jsx("button",{disabled:k>=C.length-1,onClick:()=>M(L=>L+1),className:"text-slate-400 hover:text-primary disabled:opacity-30",children:" "}),t.jsxs("span",{className:"text-[10px] text-slate-300",children:[k+1," / ",C.length]}),t.jsx("button",{disabled:k<=0,onClick:()=>M(L=>L-1),className:"text-slate-400 hover:text-primary disabled:opacity-30",children:" "})]})]}):t.jsx("div",{className:"text-center py-10 text-slate-400 text-xs",children:"..."})})]})]}),t.jsxs("div",{className:"absolute top-0 w-full pt-12 px-4 pb-2 flex justify-between z-30 pointer-events-none",children:[t.jsx("button",{onClick:()=>d("select"),className:"bg-white/90 p-2 rounded-full shadow-md pointer-events-auto active:scale-90 transition-transform text-slate-600",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{className:"flex gap-2 pointer-events-auto",children:[f==="view"&&t.jsx("button",{onClick:()=>se(!0),className:"p-2 bg-white/90 rounded-full shadow-md text-slate-500 hover:text-primary active:scale-90 transition-transform",title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("button",{onClick:()=>{h(f==="view"?"edit":"view"),re(null)},className:`px-4 py-2 rounded-full font-bold text-xs shadow-md transition-all ${f==="edit"?"bg-blue-500 text-white":"bg-white text-slate-600"}`,children:f==="edit"?"":""})]})]}),ce&&f==="view"&&t.jsxs("div",{className:"absolute bottom-6 left-4 right-4 bg-white/95 backdrop-blur-xl p-5 rounded-2xl shadow-2xl border border-white/50 z-[150] animate-slide-up",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("span",{className:"text-xs font-bold text-blue-500 uppercase tracking-widest",children:"OBSERVATION"}),t.jsx("button",{onClick:()=>N(""),className:"text-slate-400 hover:text-slate-600",children:""})]}),t.jsx("p",{className:"text-sm text-slate-700 leading-relaxed font-medium text-justify",children:ce})]}),f==="edit"&&t.jsxs("div",{className:`absolute bottom-0 w-full bg-white border-t border-slate-200 z-[150] transition-transform duration-300 flex flex-col ${$e?"translate-y-[calc(100%-2.5rem)]":""}`,style:{maxHeight:$e?"auto":"45vh"},children:[t.jsx("div",{className:"h-10 w-full flex items-center justify-center cursor-pointer bg-white active:bg-slate-50 border-b border-slate-100",onClick:()=>Re(!$e),children:t.jsx("div",{className:"w-10 h-1 bg-slate-200 rounded-full"})}),t.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:le?t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-xs font-bold text-slate-500",children:""}),t.jsx("button",{onClick:it,className:"text-xs text-red-500 font-bold bg-red-50 px-3 py-1 rounded-full",children:""})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-[10px] text-slate-400 block mb-1",children:""}),t.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:(($s=p.find(L=>L.id===le))==null?void 0:$s.scale)||1,onChange:L=>Be({scale:parseFloat(L.target.value)}),className:"w-full h-1 bg-slate-200 rounded-full"})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-[10px] text-slate-400 block mb-1",children:""}),t.jsx("input",{type:"range",min:"-180",max:"180",step:"5",value:((In=p.find(L=>L.id===le))==null?void 0:In.rotation)||0,onChange:L=>Be({rotation:parseInt(L.target.value)}),className:"w-full h-1 bg-slate-200 rounded-full"})]})]})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:[t.jsxs("button",{onClick:()=>me(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[t.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white shadow-md text-xl",children:"+"}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),t.jsxs("button",{onClick:()=>ae(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[t.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center text-white shadow-md text-xl",children:""}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),t.jsxs("button",{onClick:()=>{var L;return(L=Ke.current)==null?void 0:L.click()},className:"flex flex-col items-center gap-1 shrink-0",children:[t.jsx("div",{className:"w-12 h-12 bg-slate-200 rounded-xl flex items-center justify-center text-slate-500 shadow-sm border border-slate-300",children:""}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),t.jsxs("button",{onClick:()=>{var L;return(L=_.current)==null?void 0:L.click()},className:"flex flex-col items-center gap-1 shrink-0",children:[t.jsx("div",{className:"w-12 h-12 bg-slate-200 rounded-xl flex items-center justify-center text-slate-500 shadow-sm border border-slate-300",children:""}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),t.jsxs("button",{onClick:()=>Z(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[t.jsx("div",{className:"w-12 h-12 bg-slate-200 rounded-xl flex items-center justify-center text-slate-600 shadow-sm border border-slate-300",children:""}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),t.jsxs("button",{onClick:()=>Ee(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[t.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-xl flex items-center justify-center text-white shadow-sm border border-slate-600",children:"{}"}),t.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:"Dev"})]}),t.jsx("input",{type:"file",ref:Ke,className:"hidden",accept:"image/*",onChange:L=>et(L,"wall")}),t.jsx("input",{type:"file",ref:_,className:"hidden",accept:"image/*",onChange:L=>et(L,"floor")}),t.jsx("input",{type:"file",ref:ee,className:"hidden",accept:"image/*",onChange:L=>et(L,"actor")})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-[10px] font-bold text-slate-400 mb-2 uppercase",children:""}),t.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar",children:ju.map((L,Ae)=>t.jsx("button",{onClick:()=>Je(L.value),className:"w-10 h-10 rounded-lg shadow-sm border border-slate-200 shrink-0",style:{background:L.value}},Ae))})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-[10px] font-bold text-slate-400 mb-2 uppercase",children:""}),t.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar",children:Nu.map((L,Ae)=>t.jsx("button",{onClick:()=>Qe(L.value),className:"w-10 h-10 rounded-lg shadow-sm border border-slate-200 shrink-0",style:{background:L.value}},Ae))})]})]})})]}),t.jsx(Ze,{isOpen:Me,title:"",onClose:()=>me(!1),children:t.jsx("div",{className:"h-96 overflow-y-auto no-scrollbar",children:Object.entries(Oe).map(([L,Ae])=>Ae&&Ae.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 sticky top-0 bg-white/95 backdrop-blur py-2 z-10 flex justify-between",children:[L==="sully_special"?"Sully  (Special)":L==="custom"?" (Custom)":L,t.jsx("span",{className:"text-[9px] bg-slate-100 px-2 rounded-full",children:Ae.length})]}),t.jsx("div",{className:"grid grid-cols-4 gap-4",children:Ae.map((Se,Xe)=>{const at=L==="custom",gt=at?{onTouchStart:()=>cs(Se),onTouchEnd:ht,onMouseDown:()=>cs(Se),onMouseUp:ht,onMouseLeave:ht,onContextMenu:Rt=>{Rt.preventDefault(),ve(Se)}}:{};return t.jsxs("button",{onClick:()=>Ye(Se,L==="custom"||L==="sully_special"?"furniture":L),className:"flex flex-col items-center gap-2 group relative active:scale-95 transition-transform",...gt,children:[t.jsxs("div",{className:"w-14 h-14 bg-slate-50 rounded-xl flex items-center justify-center border border-slate-100 group-hover:border-blue-300 transition-colors overflow-hidden relative",children:[t.jsx("img",{src:Se.image,className:"w-full h-full object-contain"}),at&&t.jsx("div",{className:"absolute inset-0 bg-red-500/10 opacity-0 group-active:opacity-100 transition-opacity"})]}),t.jsx("span",{className:"text-[10px] text-slate-500 truncate w-full text-center",children:Se.name})]},Xe)})})]},L))})}),t.jsx(Ze,{isOpen:!!T,title:"",onClose:()=>ve(null),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>ve(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),t.jsx("button",{onClick:Cs,className:"flex-1 py-3 bg-red-500 text-white rounded-2xl font-bold",children:""})]}),children:t.jsxs("div",{className:"flex flex-col items-center gap-3 py-2",children:[T&&t.jsx("img",{src:T.image,className:"w-16 h-16 object-contain rounded-lg bg-slate-100 border"}),t.jsxs("p",{className:"text-sm text-slate-600 text-center",children:[" ",t.jsx("br",{}),t.jsxs("span",{className:"font-bold",children:['"',T==null?void 0:T.name,'"']})," ",t.jsx("br",{}),t.jsx("span",{className:"text-[10px] text-slate-400",children:"()"})]})]})}),t.jsx(Ze,{isOpen:J,title:"",onClose:()=>ae(!1),footer:t.jsx("button",{onClick:Fe,className:"w-full py-3 bg-purple-500 text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{onClick:()=>{var L;return(L=E.current)==null?void 0:L.click()},className:"aspect-square w-24 bg-slate-100 rounded-2xl border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer hover:border-purple-400 relative overflow-hidden shrink-0",children:[ye?t.jsx("img",{src:ye,className:"w-full h-full object-contain"}):t.jsx("span",{className:"text-slate-400 text-xs",children:"+ "}),t.jsx("input",{type:"file",ref:E,className:"hidden",accept:"image/*",onChange:L=>et(L,"custom_item")})]}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" URL ()"}),t.jsx("input",{value:B,onChange:L=>$(L.target.value),placeholder:"https://...",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-xs focus:outline-purple-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:""}),t.jsx("input",{value:V,onChange:L=>Q(L.target.value),placeholder:": ",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm focus:outline-purple-500 font-bold"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" (Context)"}),t.jsx("input",{value:U,onChange:L=>S(L.target.value),placeholder:": ",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-xs focus:outline-purple-500"}),t.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:" AI "})]})]})}),t.jsx(Ze,{isOpen:P,title:"",onClose:()=>Z(!1),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest border-b border-slate-100 pb-2",children:""}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between mb-1",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-600",children:[" (",((gr=I==null?void 0:I.roomConfig)==null?void 0:gr.wallScale)||0,"%)"]}),t.jsx("span",{className:"text-[10px] text-slate-400",children:(qt=I==null?void 0:I.roomConfig)!=null&&qt.wallScale?`${I.roomConfig.wallScale}%`:"Cover (Default)"})]}),t.jsx("input",{type:"range",min:"0",max:"200",step:"10",value:((er=I==null?void 0:I.roomConfig)==null?void 0:er.wallScale)||0,onChange:L=>tt({wallScale:parseInt(L.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"}),t.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[t.jsx("input",{type:"checkbox",id:"wallRepeat",checked:((Ga=I==null?void 0:I.roomConfig)==null?void 0:Ga.wallRepeat)||!1,onChange:L=>tt({wallRepeat:L.target.checked}),className:"accent-blue-500"}),t.jsx("label",{htmlFor:"wallRepeat",className:"text-xs text-slate-600",children:" (Tile)"})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between mb-1",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-600",children:[" (",((Ht=I==null?void 0:I.roomConfig)==null?void 0:Ht.floorScale)||0,"%)"]}),t.jsx("span",{className:"text-[10px] text-slate-400",children:(Xt=I==null?void 0:I.roomConfig)!=null&&Xt.floorScale?`${I.roomConfig.floorScale}%`:"Cover (Default)"})]}),t.jsx("input",{type:"range",min:"0",max:"200",step:"10",value:((xo=I==null?void 0:I.roomConfig)==null?void 0:xo.floorScale)||0,onChange:L=>tt({floorScale:parseInt(L.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"}),t.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[t.jsx("input",{type:"checkbox",id:"floorRepeat",checked:((tr=I==null?void 0:I.roomConfig)==null?void 0:tr.floorRepeat)||!1,onChange:L=>tt({floorRepeat:L.target.checked}),className:"accent-blue-500"}),t.jsx("label",{htmlFor:"floorRepeat",className:"text-xs text-slate-600",children:" (Tile)"})]})]})]}),qe&&t.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[t.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:"Sully "}),t.jsxs("button",{onClick:Ct,className:"w-full py-3 bg-red-50 text-red-500 font-bold rounded-2xl border border-red-100 flex items-center justify-center gap-2 active:scale-95 transition-transform",children:[t.jsx("span",{className:"text-lg",children:""})," "]}),t.jsx("p",{className:"text-[9px] text-slate-400 mt-2 text-center",children:""})]})]})}),t.jsx(Ze,{isOpen:F,title:"?",onClose:()=>se(!1),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>se(!1),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),t.jsx("button",{onClick:Te,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:"!"})]}),children:t.jsxs("div",{className:"text-center py-4 space-y-2",children:[t.jsx("div",{className:"text-4xl",children:""}),t.jsx("p",{className:"text-sm text-slate-600 font-bold",children:" 6:00 "}),t.jsx("p",{className:"text-xs text-slate-400",children:""})]})}),t.jsx(Ze,{isOpen:G,title:" (Dev Tools)",onClose:()=>Ee(!1),footer:t.jsx("button",{onClick:()=>Ee(!1),className:"w-full py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2",children:" (Layout JSON)"}),t.jsx("div",{className:"bg-slate-100 rounded-xl p-3 border border-slate-200 mb-2",children:t.jsx("pre",{className:"text-[10px] text-slate-600 font-mono h-20 overflow-y-auto whitespace-pre-wrap select-all",children:JSON.stringify(p,null,2)})}),t.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(p,null,2)),o("Layout Copied","success")},className:"w-full py-2 bg-slate-800 text-white text-xs font-bold rounded-xl",children:" JSON"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-[10px] font-bold text-red-400 uppercase mb-2",children:"Prompt  (Debugger)"}),t.jsx("div",{className:"bg-slate-100 rounded-xl p-3 border border-slate-200 mb-2",children:t.jsx("pre",{className:"text-[10px] text-slate-600 font-mono h-20 overflow-y-auto whitespace-pre-wrap select-all",children:X||"()"})}),t.jsx("button",{onClick:()=>{X?(navigator.clipboard.writeText(X),o("Prompt Copied","success")):o("No prompt yet","error")},className:"w-full py-2 bg-red-500 text-white text-xs font-bold rounded-xl",children:" Prompt "}),t.jsx("p",{className:"text-[9px] text-slate-400 mt-2 text-center",children:" AI  Prompt /Base64 "})]})]})})]})},Mx=()=>{const[e,s]=u.useState({w:0,h:0,vh:0,top:0});return u.useEffect(()=>{var r,a;const n=()=>{var l,o;s({w:window.innerWidth,h:window.innerHeight,vh:((l=window.visualViewport)==null?void 0:l.height)||0,top:((o=window.visualViewport)==null?void 0:o.offsetTop)||0})};return window.addEventListener("resize",n),(r=window.visualViewport)==null||r.addEventListener("resize",n),(a=window.visualViewport)==null||a.addEventListener("scroll",n),n(),()=>{var l,o;window.removeEventListener("resize",n),(l=window.visualViewport)==null||l.removeEventListener("resize",n),(o=window.visualViewport)==null||o.removeEventListener("scroll",n)}},[]),t.jsxs("div",{className:"absolute top-0 right-0 z-[9999] bg-red-500/80 text-white text-[10px] font-mono p-1 pointer-events-none select-none",children:["Win: ",e.w,"x",e.h,t.jsx("br",{}),"VV: ",e.vh.toFixed(0)," (y:",e.top.toFixed(0),")"]})},Ix=()=>{var D,xe;const{closeApp:e,characters:s,activeCharacterId:n,updateCharacter:r,apiConfig:a,addToast:l,userProfile:o}=xt(),[i,c]=u.useState("select"),[d,f]=u.useState("home"),[h,p]=u.useState(null),[m,x]=u.useState(!1),[y,C]=u.useState(null),g=u.useRef(null),[b,v]=u.useState(!1),[w,z]=u.useState(""),[k,M]=u.useState(""),[j,H]=u.useState("#3b82f6"),[te,Ne]=u.useState(""),[Me,me]=u.useState(!1),F=((D=h==null?void 0:h.phoneState)==null?void 0:D.records)||[],se=((xe=h==null?void 0:h.phoneState)==null?void 0:xe.customApps)||[];u.useEffect(()=>{var A,le;if(h){const re=s.find($e=>$e.id===h.id);if(re&&(p(re),y)){const $e=(le=(A=re.phoneState)==null?void 0:A.records)==null?void 0:le.find(Re=>Re.id===y.id);$e&&C($e)}}},[s]),u.useEffect(()=>{d==="chat_detail"&&g.current&&g.current.scrollIntoView({behavior:"smooth"})},[y==null?void 0:y.detail,d]);const G=A=>{p(A),c("phone"),f("home")},Ee=()=>{c("select"),p(null),f("home")},P=async A=>{var re;if(!h)return;const le=(((re=h.phoneState)==null?void 0:re.records)||[]).filter($e=>$e.id!==A.id);r(h.id,{phoneState:{...h.phoneState,records:le}}),A.systemMessageId&&await R.deleteMessage(A.systemMessageId),(y==null?void 0:y.id)===A.id&&(f("chat"),C(null)),l("","success")},Z=A=>{var re;if(!h)return;const le=(((re=h.phoneState)==null?void 0:re.customApps)||[]).filter($e=>$e.id!==A);r(h.id,{phoneState:{...h.phoneState,customApps:le}}),l("App ","success")},X=()=>{var re;if(!h||!w||!te)return;const A={id:`app-${Date.now()}`,name:w,icon:k,color:j,prompt:te},le=((re=h.phoneState)==null?void 0:re.customApps)||[];r(h.id,{phoneState:{...h.phoneState,customApps:[...le,A]}}),v(!1),z(""),Ne(""),l(` ${w}`,"success")},pe=A=>{if(!A)return"";const re=Date.now()-A,$e=Math.floor(re/(1e3*60)),Re=Math.floor(re/(1e3*60*60)),De=Math.floor(Re/24);return $e<5?"":$e<60?` ${$e} `:Re<24?` ${Re} `:` ${De} `},Ce=async(A,le)=>{var re;if(!h||!a.apiKey){l("","error");return}x(!0);try{const $e=Et.buildCoreContext(h,o,!0),Re=await R.getMessagesByCharId(h.id),De=Re[Re.length-1],Ke=pe(De==null?void 0:De.timestamp),_=Re.slice(-50).map($=>{const U=$.role==="user"?o.name:h.name,S=$.type==="text"?$.content:`[${$.type}]`;return`${U}: ${S}`}).join(`
`);let ee="",E="";if(le){ee=` App: "${A}"
 App /: "${le}"
 2-4  App 

JSON: [{ "title": "/", "detail": "//", "value": "( +100)" }, ...]`;const $=se.find(U=>U.id===A);E=$?$.name:A}else A==="chat"?(ee=` 3 (Message/Line)****
    
    1. ****:  3 User
    2. ****: 3-4
    3. ****:  ":..." ()":..."  ":..." 
    JSON: [{ "title": " ()", "detail": ": \\n: \\n: " }, ...]`,E=""):A==="call"?(ee=` 3 ****
    JSON: [{ "title": "", "value": " (5) /  /  (30)", "detail": "..." }, ...]`,E=""):A==="order"?(ee=` 3 
    JSON: [{ "title": "", "detail": "" }, ...]`,E="APP"):A==="delivery"?(ee=` 3 
    JSON: [{ "title": "", "detail": "" }, ...]`,E="APP"):A==="social"&&(ee=` 2 /
    JSON: [{ "title": "/", "detail": "" }, ...]`,E="");const K=`${$e}

### [Current Status]
: ${Ke}

### [Recent Chat Context]
${_}

### [Task]
${ee}
[Current Status]`,ke=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:K}],temperature:.8})});if(!ke.ok)throw new Error("API Error");let ae=(await ke.json()).choices[0].message.content;ae=ae.replace(/```json/g,"").replace(/```/g,"").trim();const V=ae.indexOf("["),Q=ae.lastIndexOf("]");V>-1&&Q>-1&&(ae=ae.substring(V,Q+1));let ye=[];try{ye=JSON.parse(ae)}catch{ye=[]}const be=[];if(Array.isArray(ye))for(const $ of ye){const U=$.title||"Unknown",S=$.detail||"...";let T="";A==="chat"?T=`[: ${h.name}  "${U}" -: ${S.replace(/\n/g," ")}]`:T=`[: ${h.name}(${E}) : ${U} - ${S}]`,await R.saveMessage({charId:h.id,role:"system",type:"text",content:T});const ve=await R.getMessagesByCharId(h.id),de=ve[ve.length-1];be.push({id:`rec-${Date.now()}-${Math.random()}`,type:A,title:U,detail:S,value:$.value,timestamp:Date.now(),systemMessageId:de==null?void 0:de.id}),await new Promise(I=>setTimeout(I,50))}const B=((re=h.phoneState)==null?void 0:re.records)||[];r(h.id,{phoneState:{...h.phoneState,records:[...B,...be]}}),l(` ${be.length} `,"success")}catch($e){console.error($e),l("","error")}finally{x(!1)}},je=async()=>{var A;if(!(!y||!h||!a.apiKey)){x(!0);try{const re=`${Et.buildCoreContext(h,o,!0)}

### [Task: Continue Conversation]
Roleplay: You are "${h.name}". You are chatting on your phone with "${y.title}".
Current History:
"""
${y.detail}
"""

Task: Please continue this conversation for 3-5 more turns. 
Style: Casual, IM style.
Format: 
- Use ": ..." for yourself (${h.name}).
- Use ": ..." for the contact (${y.title}).
- Only output the new dialogue lines. Do NOT repeat history.
`,$e=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:re}],temperature:.85})});if($e.ok){let De=(await $e.json()).choices[0].message.content.trim();De=De.replace(/```/g,"");const Ke=`${y.detail}
${De}`,_={...y,detail:Ke};C(_);const E=(((A=h.phoneState)==null?void 0:A.records)||[]).map(K=>K.id===_.id?_:K);r(h.id,{phoneState:{...h.phoneState,records:E}})}}catch(le){console.error(le),l("","error")}finally{x(!1)}}},Pe=(A,le,re)=>t.jsxs("div",{className:"h-14 flex items-center justify-between px-4 bg-white/80 backdrop-blur-md text-slate-800 shrink-0 z-20 border-b border-slate-200",children:[t.jsx("button",{onClick:le,className:"p-2 -ml-2 rounded-full hover:bg-slate-100 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-base tracking-wide truncate max-w-[200px]",children:A}),t.jsx("div",{className:"w-8 flex justify-end",children:re})]}),ge=()=>{const A=F.filter(le=>le.type==="chat").sort((le,re)=>re.timestamp-le.timestamp);return t.jsxs("div",{className:"fixed inset-0 w-full h-full flex flex-col bg-slate-50 z-10",children:[Pe("Message",()=>f("home")),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar pb-24 overscroll-contain",children:[A.length===0&&t.jsx("div",{className:"text-center text-slate-400 mt-20 text-xs",children:""}),A.map(le=>t.jsxs("div",{onClick:()=>{C(le),f("chat_detail")},className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 relative group animate-slide-up active:scale-98 transition-transform cursor-pointer",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 flex items-center justify-center text-xl shadow-inner shrink-0",children:""}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[t.jsx("div",{className:"font-bold text-slate-700 text-sm truncate",children:le.title}),t.jsx("div",{className:"text-[10px] text-slate-400",children:new Date(le.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),t.jsx("div",{className:"text-xs text-slate-500 truncate",children:le.detail.split(`
`).pop()||"..."})]})]}),t.jsx("button",{onClick:re=>{re.stopPropagation(),P(le)},className:"absolute top-2 right-2 w-6 h-6 bg-red-100 text-red-500 rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity z-10",children:""})]},le.id))]}),t.jsx("div",{className:"absolute bottom-8 w-full flex justify-center pointer-events-none z-30",children:t.jsx("button",{disabled:m,onClick:()=>Ce("chat"),className:"pointer-events-auto bg-green-500 text-white px-6 py-2.5 rounded-full shadow-xl font-bold text-xs flex items-center gap-2 active:scale-95 transition-transform",children:m?"...":""})})]})},ce=()=>{if(!y||!h)return null;const le=y.detail.split(`
`).filter(re=>re.trim()).map(re=>{const $e=re.startsWith("")||re.startsWith("Me")||re.startsWith("Me:")||re.startsWith(":"),Re=re.replace(/^(|Me||Them|[\w\u4e00-\u9fa5]+)[:]\s*/,"");return{isMe:$e,content:Re}});return t.jsxs("div",{className:"fixed inset-0 w-full h-full flex flex-col bg-[#f2f2f2] z-50",children:[Pe(y.title,()=>f("chat")),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar overscroll-contain",children:[le.map((re,$e)=>t.jsxs("div",{className:`flex ${re.isMe?"justify-end":"justify-start"}`,children:[!re.isMe&&t.jsx("div",{className:"w-9 h-9 rounded-md bg-gray-300 flex items-center justify-center text-xs text-gray-500 mr-2 shrink-0",children:y.title[0]}),t.jsxs("div",{className:`px-3 py-2 rounded-lg max-w-[75%] text-sm leading-relaxed shadow-sm break-words relative ${re.isMe?"bg-[#95ec69] text-black":"bg-white text-black"}`,children:[re.isMe&&t.jsx("div",{className:"absolute top-2 -right-1.5 w-3 h-3 bg-[#95ec69] rotate-45"}),!re.isMe&&t.jsx("div",{className:"absolute top-3 -left-1 w-2.5 h-2.5 bg-white rotate-45"}),t.jsx("span",{className:"relative z-10",children:re.content})]}),re.isMe&&t.jsx("img",{src:h.avatar,className:"w-9 h-9 rounded-md object-cover ml-2 shrink-0 shadow-sm"})]},$e)),m&&t.jsx("div",{className:"flex justify-center py-4",children:t.jsxs("div",{className:"flex gap-1",children:[t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce delay-100"}),t.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce delay-200"})]})}),t.jsx("div",{ref:g})]}),t.jsx("div",{className:"shrink-0 w-full p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] bg-[#f7f7f7] border-t border-gray-200 z-30",children:t.jsx("button",{onClick:je,disabled:m,className:"w-full py-3 bg-white border border-gray-300 rounded-xl text-sm font-bold text-slate-600 shadow-sm active:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:m?"...":"  / "})})]})},N=(A,le,re)=>{const $e=F.filter(Re=>Re.type===A).sort((Re,De)=>De.timestamp-Re.timestamp);return t.jsxs("div",{className:"fixed inset-0 w-full h-full flex flex-col bg-slate-50 z-10",children:[Pe(le,()=>f("home")),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar pb-24 overscroll-contain",children:[$e.length===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-2",children:[t.jsx("span",{className:"text-4xl opacity-20",children:""}),t.jsx("span",{className:"text-xs",children:""})]}),$e.map(Re=>t.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-100 shadow-sm relative group animate-slide-up",children:[t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("span",{className:"font-bold text-slate-700 text-sm line-clamp-1",children:Re.title}),Re.value&&t.jsx("span",{className:"text-xs font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded",children:Re.value})]}),t.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:Re.detail}),t.jsx("div",{className:"text-[10px] text-slate-300 mt-2 text-right",children:new Date(Re.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.jsx("button",{onClick:()=>P(Re),className:"absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity shadow-md",children:""})]},Re.id))]}),t.jsx("div",{className:"absolute bottom-8 w-full flex justify-center pointer-events-none z-30",children:t.jsxs("button",{disabled:m,onClick:()=>Ce(A,re),className:"pointer-events-auto bg-slate-800 text-white px-6 py-2.5 rounded-full shadow-xl font-bold text-xs flex items-center gap-2 active:scale-95 transition-transform hover:bg-slate-700",children:[m?t.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),""]})})]})},ne=({icon:A,color:le,label:re,onClick:$e,onDelete:Re})=>t.jsxs("div",{className:"flex flex-col items-center gap-1.5 relative group",children:[t.jsxs("button",{onClick:$e,className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] flex items-center justify-center text-2xl shadow-lg border border-white/10 active:scale-95 transition-transform relative overflow-hidden",style:{background:le},children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-black/10 to-transparent"}),t.jsx("div",{className:"relative z-10 drop-shadow-md text-white",children:A})]}),t.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md tracking-wide px-1 py-0.5 rounded bg-black/10 backdrop-blur-[2px]",children:re}),Re&&t.jsx("button",{onClick:De=>{De.stopPropagation(),Re()},className:"absolute -top-1 -right-1 w-5 h-5 bg-slate-400 text-white rounded-full flex items-center justify-center text-[10px] shadow-sm opacity-0 group-hover:opacity-100 transition-opacity z-20 hover:bg-red-500",children:""})]}),we=()=>{const A=h!=null&&h.dateBackground?{backgroundImage:`url(${h.dateBackground})`}:{background:"linear-gradient(to bottom, #1e293b, #0f172a)"};return t.jsxs("div",{className:"absolute inset-0 flex flex-col z-0",style:{...A,backgroundSize:"cover",backgroundPosition:"center"},children:[t.jsx("div",{className:"absolute inset-0 bg-black/20 backdrop-blur-[2px]"}),t.jsxs("div",{className:"h-8 flex justify-between px-5 items-center text-white/80 text-[10px] font-bold z-20 relative",children:[t.jsx("span",{children:"12:00"}),t.jsxs("div",{className:"flex gap-1.5 items-center",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-3 h-3",children:t.jsx("path",{fillRule:"evenodd",d:"M1.371 8.143c5.858-5.857 15.356-5.857 21.213 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.06 0c-4.98-4.979-13.053-4.979-18.032 0a.75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182c4.1-4.1 10.749-4.1 14.85 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.062 0 8.25 8.25 0 0 0-11.667 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.204 3.182a6 6 0 0 1 8.486 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0 3.75 3.75 0 0 0-5.304 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182a1.5 1.5 0 0 1 2.122 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0l-.53-.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})}),t.jsx("div",{className:"w-4 h-2 border border-current rounded-[2px] relative",children:t.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-current w-3/4"})})]})]}),t.jsx("div",{className:"flex-1 p-5 z-10 overflow-y-auto no-scrollbar overscroll-none",children:t.jsxs("div",{className:"grid grid-cols-4 gap-y-6 gap-x-2 place-items-center content-start",children:[t.jsx(ne,{icon:"",color:"linear-gradient(135deg, #10b981, #059669)",label:"Message",onClick:()=>f("chat")}),t.jsx(ne,{icon:"",color:"linear-gradient(135deg, #f97316, #ea580c)",label:"Taobao",onClick:()=>f("taobao")}),t.jsx(ne,{icon:"",color:"linear-gradient(135deg, #eab308, #ca8a04)",label:"Food",onClick:()=>f("waimai")}),t.jsx(ne,{icon:"",color:"linear-gradient(135deg, #6366f1, #4f46e5)",label:"Moments",onClick:()=>f("social")}),se.map(le=>t.jsx(ne,{icon:le.icon,color:le.color,label:le.name,onClick:()=>f(le.id),onDelete:()=>Z(le.id)},le.id)),t.jsxs("button",{onClick:()=>v(!0),className:"flex flex-col items-center gap-1.5 group",children:[t.jsx("div",{className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] bg-white/20 backdrop-blur-md border border-white/30 flex items-center justify-center text-2xl text-white shadow-lg active:scale-95 transition-transform hover:bg-white/30",children:"+"}),t.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md",children:"Add App"})]}),t.jsxs("button",{onClick:Ee,className:"flex flex-col items-center gap-1.5 group",children:[t.jsx("div",{className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] bg-red-500/20 backdrop-blur-md border border-red-400/50 flex items-center justify-center shadow-lg active:scale-95 transition-transform hover:bg-red-500/40",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-8 h-8 text-white",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})})}),t.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md",children:""})]}),t.jsxs("button",{onClick:()=>me(!Me),className:"flex flex-col items-center gap-1.5 group opacity-50 hover:opacity-100 transition-opacity",children:[t.jsx("div",{className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] bg-black/20 backdrop-blur-md border border-white/10 flex items-center justify-center shadow-lg active:scale-95 transition-transform",children:t.jsx("span",{className:"text-xl",children:""})}),t.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md",children:"Debug UI"})]})]})}),t.jsx("div",{className:"p-4 z-20",children:t.jsxs("div",{className:"bg-white/20 backdrop-blur-xl rounded-[2rem] p-3 flex justify-around items-center border border-white/10 shadow-lg",children:[t.jsx("button",{onClick:()=>{},className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:t.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})}),t.jsx("button",{onClick:()=>f("chat"),className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:t.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})}),t.jsx("button",{onClick:()=>{},className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:t.jsx("div",{className:"w-12 h-12 bg-white rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})}),t.jsx("button",{onClick:()=>{},className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:t.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})})]})})]})};return i==="select"?t.jsxs("div",{className:"absolute inset-0 flex flex-col bg-slate-900 font-light overflow-hidden",children:[t.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-slate-800 bg-slate-900/80 sticky top-0 z-10",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-white/10 text-white",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-white tracking-widest uppercase text-sm",children:"Target Device"}),t.jsx("div",{className:"w-8"})]}),t.jsx("div",{className:"p-6 grid grid-cols-2 gap-5 overflow-y-auto pb-20 no-scrollbar overscroll-contain",children:s.map(A=>t.jsxs("div",{onClick:()=>G(A),className:"aspect-[3/4] bg-slate-800 rounded-xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-4 cursor-pointer active:scale-95 transition-all group hover:border-green-500 hover:shadow-[0_0_15px_rgba(34,197,94,0.3)]",children:[t.jsx("div",{className:"w-20 h-20 rounded-full p-[2px] border-2 border-slate-600 group-hover:border-green-500 transition-colors",children:t.jsx("img",{src:A.avatar,className:"w-full h-full rounded-full object-cover grayscale group-hover:grayscale-0 transition-all"})}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"font-bold text-slate-300 text-sm group-hover:text-green-400",children:A.name}),t.jsx("div",{className:"text-[10px] text-slate-500 font-mono mt-1",children:"CONNECT >"})]})]},A.id))})]}):t.jsxs("div",{className:"absolute inset-0 w-full h-full bg-slate-900 overflow-hidden font-sans overscroll-none",children:[Me&&t.jsx(Mx,{}),d==="home"?we():t.jsxs(t.Fragment,{children:[d==="chat"&&ge(),d==="chat_detail"&&ce(),d==="taobao"&&N("order","Taobao"),d==="waimai"&&N("delivery","Food Delivery"),d==="social"&&N("social","Moments"),se.find(A=>A.id===d)&&(()=>{const A=se.find(le=>le.id===d);return N(A.id,A.name,A.prompt)})()]}),t.jsx(Ze,{isOpen:b,title:" App",onClose:()=>v(!1),footer:t.jsx("button",{onClick:X,className:"w-full py-3 bg-blue-500 text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsx("div",{className:"w-16 h-16 rounded-xl flex items-center justify-center text-3xl shadow-md border-2 border-slate-100 shrink-0",style:{background:j},children:k}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("input",{value:w,onChange:A=>z(A.target.value),placeholder:"App  (: )",className:"w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{value:k,onChange:A=>M(A.target.value),placeholder:"Emoji",className:"w-16 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm text-center"}),t.jsx("input",{type:"color",value:j,onChange:A=>H(A.target.value),className:"h-9 flex-1 cursor-pointer rounded-lg bg-transparent"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" (AI Prompt)"}),t.jsx("textarea",{value:te,onChange:A=>Ne(A.target.value),placeholder:": ",className:"w-full h-24 bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs resize-none"}),t.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"AI  App "})]})]})})]})},Su="#ff2442",Cu=[{name:"Sunset",bg:"linear-gradient(135deg, #FF9A9E 0%, #FECFEF 99%, #FECFEF 100%)",text:"#fff"},{name:"Ocean",bg:"linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%)",text:"#fff"},{name:"Peach",bg:"linear-gradient(to top, #fff1eb 0%, #ace0f9 100%)",text:"#555"},{name:"Night",bg:"linear-gradient(to top, #30cfd0 0%, #330867 100%)",text:"#fff"},{name:"Love",bg:"linear-gradient(to top, #f43b47 0%, #453a94 100%)",text:"#fff"},{name:"Fresh",bg:"linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%)",text:"#444"},{name:"Lemon",bg:"linear-gradient(135deg, #f6d365 0%, #fda085 100%)",text:"#fff"},{name:"Plum",bg:"linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)",text:"#fff"}],$u=()=>Cu[Math.floor(Math.random()*Cu.length)],qo=e=>{const s=e.replace(/```json/g,"").replace(/```/g,"").trim();try{const n=JSON.parse(s);if(!Array.isArray(n)&&typeof n=="object"&&n!==null){const r=Object.keys(n);if(r.length===1&&Array.isArray(n[r[0]]))return n[r[0]]}return Array.isArray(n)?n:[]}catch{try{const r=s.indexOf("[");if(r===-1)return[];let a=s.lastIndexOf("}");for(;a>r;){const l=s.substring(r,a+1)+"]";try{const o=JSON.parse(l);if(Array.isArray(o))return o}catch{}a=s.lastIndexOf("}",a-1)}return[]}catch{return[]}}},xn={Heart:({filled:e,onClick:s,className:n})=>t.jsx("svg",{onClick:s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:e?Su:"none",stroke:e?Su:"currentColor",strokeWidth:2,className:`transition-transform active:scale-75 cursor-pointer ${n||"w-6 h-6"}`,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"})}),Star:({filled:e,onClick:s,className:n})=>t.jsx("svg",{onClick:s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:e?"#fbbf24":"none",stroke:e?"#fbbf24":"currentColor",strokeWidth:2,className:`transition-transform active:scale-75 cursor-pointer ${n||"w-6 h-6"}`,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.563.563 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.563.563 0 0 0-.182-.557l-4.204-3.602a.563.563 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})}),Share:({className:e,onClick:s})=>t.jsx("svg",{onClick:s,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:e||"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})}),Back:({onClick:e,className:s})=>t.jsx("svg",{onClick:e,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:s||"w-6 h-6 cursor-pointer text-slate-800",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})},_x=()=>{const{closeApp:e,characters:s,updateCharacter:n,apiConfig:r,addToast:a,userProfile:l,groups:o}=xt(),[i,c]=u.useState([]),[d,f]=u.useState("home"),[h,p]=u.useState(!1),[m,x]=u.useState(null),[y,C]=u.useState(!1),[g,b]=u.useState(!1),[v,w]=u.useState(""),[z,k]=u.useState(""),[M,j]=u.useState(""),[H,te]=u.useState(""),[Ne,Me]=u.useState(!1),[me,F]=u.useState(!1),[se,G]=u.useState({}),[Ee,P]=u.useState(!1),[Z,X]=u.useState("notes"),[pe,Ce]=u.useState({name:l.name,avatar:l.avatar,bio:""}),[je,Pe]=u.useState("95279527"),[ge,ce]=u.useState(""),[N,ne]=u.useState(!1),we=u.useRef(null),D=u.useRef(null),xe=u.useRef(null),A=u.useRef(0);u.useEffect(()=>{R.getSocialPosts().then(de=>{de.length>0&&c(de.sort((I,oe)=>oe.timestamp-I.timestamp))}),(async()=>{const de=localStorage.getItem("spark_user_id"),I=await R.getAsset("spark_user_bg"),oe=await R.getAsset("spark_social_profile"),Ie=localStorage.getItem("spark_user_bg"),Le=localStorage.getItem("spark_social_profile");de&&Pe(de),I?ce(I):Ie&&(ce(Ie),await R.saveAsset("spark_user_bg",Ie),localStorage.removeItem("spark_user_bg"));let Te=null;if(oe)try{Te=JSON.parse(oe)}catch{}else if(Le){try{Te=JSON.parse(Le)}catch{}Te&&(await R.saveAsset("spark_social_profile",Le),localStorage.removeItem("spark_social_profile"))}Ce(Te||{name:l.name,avatar:l.avatar,bio:l.bio||""})})();const T=localStorage.getItem("spark_char_handles");let ve={};if(T)try{ve=JSON.parse(T)}catch{}s.forEach(de=>{var I;(!ve[de.id]||ve[de.id].length===0)&&(ve[de.id]=[{id:"default",handle:((I=de.socialProfile)==null?void 0:I.handle)||de.name,note:""}])}),G(ve)},[s.length]),u.useEffect(()=>{Object.keys(se).length>0&&localStorage.setItem("spark_char_handles",JSON.stringify(se))},[se]),u.useEffect(()=>{var S;if(m){const T=m.comments.length;T>A.current&&((S=xe.current)==null||S.scrollIntoView({behavior:"smooth"})),A.current=T}else A.current=0},[m==null?void 0:m.comments.length]);const le=S=>{const T={id:`sub-${Date.now()}`,handle:"",note:""};G(ve=>({...ve,[S]:[...ve[S]||[],T]}))},re=(S,T,ve,de)=>{G(I=>({...I,[S]:I[S].map(oe=>oe.id===T?{...oe,[ve]:de}:oe)}))},$e=(S,T)=>{G(ve=>({...ve,[S]:ve[S].filter(de=>de.id!==T)}))},Re=async S=>{var ve;const T=(ve=S.target.files)==null?void 0:ve[0];if(T)try{const de=await ls(T,{skipCompression:!0});ce(de),await R.saveAsset("spark_user_bg",de),a("","success")}catch{a("","error")}},De=async S=>{var ve;const T=(ve=S.target.files)==null?void 0:ve[0];if(T)try{const de=await ls(T);Ce(I=>({...I,avatar:de}))}catch(de){a(de.message,"error")}},Ke=async()=>{localStorage.setItem("spark_user_id",je),await R.saveAsset("spark_social_profile",JSON.stringify(pe)),ne(!1),a(" ( Spark )","success")},_=S=>{c(S),Promise.all(S.map(T=>R.saveSocialPost(T))).catch(console.error)},ee=S=>{c(T=>{const ve=T.map(de=>de.id===S.id?S:de);return R.saveSocialPost(S),ve}),x(T=>(T==null?void 0:T.id)===S.id?S:T)},E=S=>{c(T=>{const ve=T.filter(de=>de.id!==S);return R.deleteSocialPost(S),ve}),x(T=>(T==null?void 0:T.id)===S?null:T)},K=async()=>{if(!r.apiKey){a(" API Key","error");return}C(!0);try{const T=[...s].sort(()=>.5-Math.random()).slice(0,Math.min(3,s.length));let ve="",de=`###  (Identities)
`;for(const W of T){const q=Et.buildCoreContext(W,l,!1),Y=await R.getMessagesByCharId(W.id),ie=Y.length>0?`(:  "${Y[Y.length-1].content.substring(0,20)}...")`:"()",ue=(se[W.id]||[]).map(ze=>`- : "${ze.handle}" (: ${ze.note})`).join(`
`);de+=`
 [${W.name}] :
${ue}
`,ve+=`
<<< : ${W.name} >>>
${q}
${ie}
<<<  >>>
`}const I=`### : APP "Spark" 
 6-8 

###   ()
1. ** (30%)**: 
   - : ${T.map(W=>W.name).join(", ")}
   - ****: ()
   -  **Configured Handle ()**
   - ****: 

2. **/ (70%)**: 
   - 

### 
${de}

###  
1. ****:  "${pe.name}" () 
2. ****

### 
${ve}

###  (JSON Array)
[
  {
    "isCharacter": true/false,
    "charId": "ID, null", 
    "authorName": "",
    "title": "",
    "content": "...",
    "emojis": ["", ""],
    "likes":  (0 - 10000)
  },
  ...
]`,oe=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:I}],temperature:.95,max_tokens:8e3})});if(!oe.ok)throw new Error("API Error");const Ie=await oe.json(),Le=qo(Ie.choices[0].message.content);if(!Array.isArray(Le))throw new Error("Parsed data is not an array");const O=[...Le.map(W=>{let q=`https://api.dicebear.com/7.x/notionists/svg?seed=${W.authorName}`;if(W.isCharacter){const Y=s.find(ie=>ie.id===W.charId)||s.find(ie=>(se[ie.id]||[]).some(ue=>ue.handle===W.authorName));Y&&(q=Y.avatar)}else{const Y=["micah","avataaars","bottts","notionists"];q=`https://api.dicebear.com/7.x/${Y[Math.floor(Math.random()*Y.length)]}/svg?seed=${W.authorName+Math.random()}`}return{id:`post-${Date.now()}-${Math.random()}`,authorName:W.authorName||"Unknown",authorAvatar:q,title:W.title||"",content:W.content||"...",images:W.emojis||[""],likes:W.likes||0,isCollected:!1,isLiked:!1,comments:[],timestamp:Date.now(),tags:["Life","Vlog"],bgStyle:$u().bg}}),...i];_(O),a(": ","success")}catch(S){a(": "+S.message,"error")}finally{C(!1)}},ke=async S=>{if(!(!S||S.comments.length>0||!r.apiKey)){b(!0);try{const ve=[...s].sort(()=>.5-Math.random()).slice(0,2);let de="";for(const Te of ve){const W=(se[Te.id]||[]).map(q=>`"${q.handle}" (${q.note})`).join(", ");de+=`-  ${Te.name} : ${W}
`}let I="";for(const Te of ve)I+=`
<<< : ${Te.name} >>>
${Et.buildCoreContext(Te,l,!1)}
`;let oe="Stranger";if(S.authorName===pe.name)oe="User";else{const Te=s.find(O=>(se[O.id]||[]).some(q=>q.handle===S.authorName));Te&&(oe=`Character "${Te.name}"`)}const Ie=`### : APP
****: "Spark" 
****: "${S.authorName}" (${oe})
****: "${S.title}"

 4-6  ****  ****


### 
${de}

### 
- ****  "${pe.name}" 

### 
${I}

###  (JSON Array)
[
  { "author": " (Handle)  ", "content": "..." }
]`,Le=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:Ie}],temperature:.8})});if(Le.ok){const Te=await Le.json(),O=qo(Te.choices[0].message.content);if(Array.isArray(O)){const W=O.map(q=>{const Y=q.author||q.authorName||"Unknown";let ie=`https://api.dicebear.com/7.x/notionists/svg?seed=${Y}`;const fe=s.find(ue=>(se[ue.id]||[]).some(Ge=>Ge.handle===Y));return fe&&(ie=fe.avatar),{id:`cmt-${Math.random()}`,authorName:Y,authorAvatar:ie,content:q.content||"...",likes:Math.floor(Math.random()*100),isCharacter:!!fe}});ee({...S,comments:W})}}}catch{a("","error")}finally{b(!1)}}},J=async(S,T)=>{if(r.apiKey){Me(!0);try{let ve="";s.forEach(oe=>{const Le=(se[oe.id]||[]).map(Te=>`"${Te.handle}"`).join(", ");ve+=`- ${oe.name}: ${Le}
`});const de=`### : 
****:  "${pe.name}" : "${T}"
****: "${S.title}"
 1-3 
${ve}

###  (JSON Array)
[
  { "author": " (Handle)", "content": "..." }
]`,I=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:de}],temperature:.9})});if(I.ok){const oe=await I.json(),Ie=qo(oe.choices[0].message.content);if(Array.isArray(Ie)){const Le=Ie.map(Te=>{const O=Te.author||Te.authorName||"Unknown";let W=`https://api.dicebear.com/7.x/notionists/svg?seed=${O}`;const q=s.find(Y=>(se[Y.id]||[]).some(fe=>fe.handle===O));return q&&(W=q.avatar),{id:`cmt-reply-${Date.now()}-${Math.random()}`,authorName:O,authorAvatar:W,content:` @${pe.name}: ${Te.content}`,likes:Math.floor(Math.random()*10)}});Le.length>0&&(ee({...S,comments:[...S.comments||[],...Le]}),a(` ${Le.length} `,"info"))}}}catch{}finally{Me(!1)}}},ae=async(S,T)=>{if(m)try{await R.saveMessage({charId:T?"user":S,groupId:T?S:void 0,role:"user",type:"social_card",content:"[]",metadata:{post:m}}),P(!1),a("","success")}catch{a("","error")}},V=()=>{if(!z.trim())return;const S={id:`user-post-${Date.now()}`,authorName:pe.name,authorAvatar:pe.avatar,title:v||"",content:z,images:[M],likes:0,isCollected:!1,isLiked:!1,comments:[],timestamp:Date.now(),tags:["User"],bgStyle:$u().bg};_([S,...i]),k(""),w(""),p(!1),f("home"),a("","success")},Q=S=>{E(S),a("","success")},ye=(S,T)=>{S.stopPropagation(),ee({...T,isLiked:!T.isLiked,likes:T.isLiked?T.likes-1:T.likes+1})},be=async()=>{if(!m||!H.trim())return;const S={...m,comments:[...m.comments||[],{id:`cmt-user-${Date.now()}`,authorName:pe.name,authorAvatar:pe.avatar,content:H.trim(),likes:0,isCharacter:!1}]};ee(S);const T=H;te(""),await J(S,T)},B=()=>{R.clearSocialPosts(),c([]),F(!1),a("","success")},$=S=>t.jsxs("div",{onClick:()=>{x(S),ke(S)},className:"break-inside-avoid mb-3 bg-white/70 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm hover:shadow-lg transition-all cursor-pointer active:scale-[0.98] border border-white/50 relative group",children:[t.jsxs("div",{className:"aspect-[4/5] w-full flex items-center justify-center relative overflow-hidden",style:{background:S.bgStyle},children:[t.jsx("div",{className:"absolute inset-0 bg-white/5 backdrop-blur-[1px]"}),t.jsx("div",{className:"relative z-10 text-6xl drop-shadow-xl filter saturate-150 transform transition-transform group-hover:scale-110 duration-500",children:S.images[0]}),S.title&&t.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/50 via-black/20 to-transparent",children:t.jsx("h3",{className:"text-white font-bold text-sm line-clamp-2 drop-shadow-md leading-tight",children:S.title})})]}),t.jsx("div",{className:"p-3",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx("img",{src:S.authorAvatar,className:"w-5 h-5 rounded-full object-cover shrink-0 ring-1 ring-white/50"}),t.jsx("span",{className:"text-[11px] text-slate-700 truncate font-medium",children:S.authorName})]}),t.jsxs("div",{className:"flex items-center gap-1 text-slate-400 group-hover:text-slate-600 transition-colors",children:[t.jsx(xn.Heart,{filled:S.isLiked,className:"w-4 h-4",onClick:T=>ye(T,S)}),t.jsx("span",{className:"text-[10px] font-medium",children:S.likes})]})]})}),t.jsx("button",{onClick:T=>{T.stopPropagation(),Q(S.id)},className:"absolute top-2 right-2 z-20 w-6 h-6 bg-black/20 text-white rounded-full flex items-center justify-center text-xs backdrop-blur-md opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500/80",children:""})]},S.id),U=()=>m?t.jsx("div",{className:"fixed inset-0 z-[60] h-full w-full bg-white/90 backdrop-blur-xl flex flex-col",children:t.jsxs("div",{className:"flex-1 w-full h-full flex flex-col animate-slide-up relative overflow-hidden",children:[t.jsxs("div",{className:"h-14 flex items-center justify-between px-4 bg-white/60 backdrop-blur-xl border-b border-white/20 shrink-0 z-20",children:[t.jsx(xn.Back,{onClick:()=>x(null)}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:m.authorAvatar,className:"w-8 h-8 rounded-full object-cover border border-white/50"}),t.jsx("span",{className:"text-sm font-bold text-slate-800",children:m.authorName})]}),t.jsx(xn.Share,{onClick:()=>P(!0),className:"w-6 h-6 text-slate-800 cursor-pointer hover:text-[#ff2442]"})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-24",children:[t.jsxs("div",{className:"w-full aspect-square flex items-center justify-center text-[8rem] relative overflow-hidden",style:{background:m.bgStyle},children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-black/10"}),t.jsx("div",{className:"relative z-10 drop-shadow-2xl filter saturate-125",children:m.images[0]})]}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsx("h1",{className:"text-2xl font-black text-slate-900 leading-snug tracking-tight",children:m.title}),t.jsx("p",{className:"text-[15px] text-slate-700 leading-relaxed whitespace-pre-wrap font-light",children:m.content}),t.jsx("div",{className:"flex gap-2 flex-wrap pt-2",children:m.tags.map(S=>t.jsxs("span",{className:"text-xs font-bold text-blue-600 bg-blue-50/50 backdrop-blur-sm border border-blue-100 px-2.5 py-1 rounded-full",children:["#",S]},S))}),t.jsx("div",{className:"text-xs text-slate-400 font-medium border-b border-slate-100/50 pb-6",children:new Date(m.timestamp).toLocaleDateString()})]}),t.jsxs("div",{className:"px-6 pb-6",children:[t.jsxs("div",{className:"text-sm font-bold text-slate-800 mb-6 flex items-center gap-2",children:[t.jsxs("span",{children:[" ",m.comments.length," "]}),(g||Ne)&&t.jsx("div",{className:"w-3 h-3 border-2 border-slate-300 border-t-[#ff2442] rounded-full animate-spin"})]}),t.jsxs("div",{className:"space-y-6",children:[m.comments.length===0&&!g&&t.jsx("div",{className:"text-center text-slate-300 text-xs py-10",children:"..."}),m.comments.map(S=>t.jsxs("div",{className:"flex gap-3 animate-fade-in group",children:[t.jsx("img",{src:S.authorAvatar,className:"w-9 h-9 rounded-full object-cover shrink-0 border border-slate-100"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx("span",{className:`text-xs font-bold ${S.isCharacter?"text-slate-800":"text-slate-500"}`,children:S.authorName}),t.jsxs("div",{className:"flex items-center gap-1 text-slate-400 cursor-pointer hover:text-[#ff2442]",children:[t.jsx(xn.Heart,{filled:!1,className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-[10px]",children:S.likes})]})]}),t.jsx("p",{className:"text-[13px] text-slate-700 mt-0.5 leading-normal font-light",children:S.content})]})]},S.id)),t.jsx("div",{ref:xe})]})]})]}),t.jsx("div",{className:"absolute bottom-0 w-full pb-[env(safe-area-inset-bottom)] z-30 pointer-events-none",children:t.jsxs("div",{className:"pointer-events-auto h-16 bg-white/80 backdrop-blur-xl border-t border-white/40 px-4 flex items-center justify-between gap-4 shadow-[0_-4px_20px_rgba(0,0,0,0.03)]",children:[t.jsxs("div",{className:"flex-1 bg-slate-100/50 rounded-full px-5 py-2.5 flex items-center gap-2 focus-within:bg-white focus-within:ring-1 focus-within:ring-slate-200 transition-all border border-transparent focus-within:border-slate-200",children:[t.jsx("input",{value:H,onChange:S=>te(S.target.value),onKeyDown:S=>S.key==="Enter"&&be(),placeholder:"...",className:"bg-transparent text-sm w-full outline-none text-slate-800 placeholder:text-slate-400"}),H.trim()&&t.jsx("button",{onClick:be,className:"text-[#ff2442] font-bold text-sm animate-fade-in",children:""})]}),t.jsxs("div",{className:"flex gap-5 text-slate-600 shrink-0 items-center",children:[t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsx(xn.Heart,{filled:m.isLiked,onClick:S=>ye(S,m),className:"w-6 h-6"}),t.jsx("span",{className:"text-[10px] font-medium",children:m.likes})]}),t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsx(xn.Star,{filled:m.isCollected,onClick:()=>ee({...m,isCollected:!m.isCollected}),className:"w-6 h-6"}),t.jsx("span",{className:"text-[10px] font-medium",children:m.isCollected?"":""})]})]})]})})]})}):null;return t.jsxs("div",{className:"h-full w-full bg-gradient-to-br from-rose-50 via-slate-50 to-teal-50 flex flex-col font-sans relative text-slate-900 overflow-hidden",children:[t.jsx(Ze,{isOpen:me,title:"",onClose:()=>F(!1),children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-6 px-1",children:[t.jsx("p",{className:"text-xs text-slate-400 bg-slate-50 p-2 rounded-lg",children:"(Sub-Accounts)AI "}),s.map(S=>{var T;return t.jsxs("div",{className:"space-y-3 pb-4 border-b border-slate-50",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:S.avatar,className:"w-6 h-6 rounded-full object-cover"}),t.jsx("span",{className:"text-sm font-bold text-slate-700",children:S.name}),t.jsx("button",{onClick:()=>le(S.id),className:"ml-auto text-[10px] bg-[#ff2442] text-white px-2 py-1 rounded-full shadow-sm active:scale-95 transition-transform",children:"+ "})]}),t.jsxs("div",{className:"space-y-2 pl-4 border-l-2 border-slate-100",children:[(se[S.id]||[]).map(ve=>t.jsxs("div",{className:"bg-white p-3 rounded-xl border border-slate-100 shadow-sm space-y-2 relative group",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"text-[9px] text-slate-400 uppercase font-bold",children:" (Handle)"}),t.jsx("input",{value:ve.handle,onChange:de=>re(S.id,ve.id,"handle",de.target.value),className:"w-full text-sm font-bold text-slate-800 border-b border-dashed border-slate-200 focus:border-[#ff2442] outline-none py-1"})]}),t.jsx("button",{onClick:()=>$e(S.id,ve.id),className:"text-slate-300 hover:text-red-400 p-1",title:"",children:""})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[9px] text-slate-400 uppercase font-bold",children:" (Context Note)"}),t.jsx("input",{value:ve.note,onChange:de=>re(S.id,ve.id,"note",de.target.value),placeholder:":  / ",className:"w-full text-xs text-slate-500 bg-slate-50 rounded px-2 py-1 focus:bg-white transition-colors outline-none"})]})]},ve.id)),(((T=se[S.id])==null?void 0:T.length)||0)===0&&t.jsx("div",{className:"text-[10px] text-red-400 italic",children:" "})]})]},S.id)})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsx("button",{onClick:B,className:"flex-1 py-3 bg-white border border-slate-200 text-slate-500 font-bold rounded-xl text-xs active:bg-slate-50",children:""}),t.jsx("button",{onClick:()=>F(!1),className:"flex-1 py-3 bg-[#ff2442] text-white font-bold rounded-xl text-xs shadow-lg shadow-red-200 active:scale-95 transition-transform",children:""})]})]})}),t.jsx(Ze,{isOpen:Ee,title:"",onClose:()=>P(!1),children:t.jsx("div",{className:"grid grid-cols-4 gap-4 p-2",children:s.slice(0,8).map(S=>t.jsxs("button",{onClick:()=>ae(S.id,!1),className:"flex flex-col items-center gap-2 group",children:[t.jsx("img",{src:S.avatar,className:"w-12 h-12 rounded-full object-cover border border-slate-100 group-active:scale-90 transition-transform"}),t.jsx("span",{className:"text-[10px] text-slate-600 truncate w-full text-center",children:S.name})]},S.id))})}),h&&t.jsxs("div",{className:"absolute inset-0 z-50 bg-white flex flex-col animate-slide-up",children:[t.jsxs("div",{className:"h-14 flex items-center justify-between px-4 bg-white sticky top-0 z-20 border-b border-slate-50",children:[t.jsx("button",{onClick:()=>p(!1),className:"text-slate-600 text-sm font-bold px-2 py-1",children:""}),t.jsx("span",{className:"text-sm font-bold text-slate-800",children:""}),t.jsx("button",{onClick:V,disabled:!z.trim(),className:`px-4 py-1.5 rounded-full text-xs font-bold text-white transition-all ${z.trim()?"bg-[#ff2442] shadow-md shadow-red-200":"bg-slate-200 text-slate-400"}`,children:""})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-6",children:[t.jsx("input",{value:v,onChange:S=>w(S.target.value),placeholder:"~",className:"text-xl font-black placeholder:text-slate-300 outline-none mb-4 w-full"}),t.jsx("textarea",{value:z,onChange:S=>k(S.target.value),placeholder:"...",className:"w-full h-auto min-h-[200px] resize-none outline-none text-base leading-relaxed placeholder:text-slate-300 font-medium"}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-50",children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2",children:" (Sticker)"}),t.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 no-scrollbar",children:["","","","","","","","","",""].map(S=>t.jsx("button",{onClick:()=>j(S),className:`w-12 h-12 rounded-xl border flex items-center justify-center text-2xl transition-all shrink-0 ${M===S?"border-[#ff2442] bg-red-50":"border-slate-100"}`,children:S},S))})]})]})]}),t.jsxs("div",{className:`flex-col h-full ${m||h?"hidden":"flex"}`,children:[t.jsxs("div",{className:"h-14 flex items-center justify-between px-4 sticky top-0 bg-white/60 backdrop-blur-xl z-30 border-b border-white/20",children:[t.jsx("button",{onClick:e,className:"p-1",children:t.jsx(xn.Back,{onClick:e})}),t.jsxs("div",{className:"flex gap-6 text-base font-bold text-slate-300",children:[t.jsx("button",{className:`${d==="home"?"text-slate-800 scale-110 border-b-2 border-[#ff2442] pb-1":"hover:text-slate-500"} transition-all`,onClick:()=>f("home"),children:""}),t.jsx("button",{className:`${d==="me"?"text-slate-800 scale-110 border-b-2 border-[#ff2442] pb-1":"hover:text-slate-500"} transition-all`,onClick:()=>f("me"),children:""})]}),t.jsx("button",{onClick:()=>F(!0),className:"text-slate-800 font-bold text-sm",children:""})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar",children:[d==="home"&&t.jsxs("div",{className:"p-2 min-h-full",children:[y&&t.jsxs("div",{className:"text-center py-4 text-xs text-[#ff2442] font-bold animate-pulse flex justify-center items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-[#ff2442] border-t-transparent rounded-full animate-spin"})," ..."]}),t.jsx("div",{className:"columns-2 gap-2 space-y-2 pb-24",children:i.map(S=>$(S))}),t.jsx("div",{className:"h-32 flex items-center justify-center pb-8",children:t.jsx("button",{onClick:K,className:"px-6 py-2 bg-white/80 backdrop-blur-md rounded-full text-xs font-bold text-slate-500 shadow-sm border border-white hover:text-[#ff2442] active:scale-95 transition-all",children:""})})]}),d==="me"&&t.jsxs("div",{className:"min-h-full bg-white/80 backdrop-blur-xl animate-fade-in",children:[t.jsxs("div",{className:"relative group",children:[t.jsxs("div",{className:"h-40 w-full overflow-hidden bg-slate-200 relative cursor-pointer",onClick:()=>{var S;return(S=we.current)==null?void 0:S.click()},children:[ge?t.jsx("img",{src:ge,className:"w-full h-full object-cover"}):t.jsx("img",{src:l.avatar,className:"w-full h-full object-cover blur-2xl opacity-60 scale-125"}),t.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity",children:t.jsx("span",{className:"text-white text-xs font-bold bg-black/30 px-3 py-1 rounded-full backdrop-blur-md",children:""})}),t.jsx("input",{type:"file",ref:we,className:"hidden",accept:"image/*",onChange:Re})]}),t.jsxs("div",{className:"px-6 relative -mt-12 flex justify-between items-end",children:[t.jsxs("div",{className:"w-24 h-24 rounded-full p-1 bg-white/90 backdrop-blur-md shadow-lg relative group cursor-pointer",onClick:()=>{var S;return(S=D.current)==null?void 0:S.click()},children:[t.jsx("img",{src:pe.avatar,className:"w-full h-full rounded-full object-cover"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20 rounded-full",children:t.jsx("span",{className:"text-white text-[10px] font-bold",children:""})}),t.jsx("input",{type:"file",ref:D,className:"hidden",accept:"image/*",onChange:De})]}),t.jsxs("div",{className:"flex gap-2 mb-2",children:[t.jsx("button",{onClick:()=>{ne(!N),N&&Ke()},className:"px-4 py-1.5 rounded-full border border-slate-200/60 bg-white/50 backdrop-blur-sm text-xs font-bold text-slate-600 hover:bg-white transition-colors",children:N?"":""}),t.jsx("button",{className:"p-1.5 rounded-full border border-slate-200/60 bg-white/50 backdrop-blur-sm text-slate-600 hover:bg-white transition-colors",children:t.jsx(xn.Share,{className:"w-4 h-4"})})]})]})]}),t.jsxs("div",{className:"px-6 pt-4 pb-6",children:[N?t.jsx("input",{value:pe.name,onChange:S=>Ce({...pe,name:S.target.value}),className:"text-2xl font-black text-slate-800 bg-slate-100/50 px-2 rounded outline-none border-b border-dashed border-slate-300 w-full mb-1"}):t.jsx("h2",{className:"text-2xl font-black text-slate-800",children:pe.name}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("span",{className:"text-xs text-slate-400 font-mono",children:"Spark ID: "}),N?t.jsx("input",{value:je,onChange:S=>Pe(S.target.value),className:"text-xs font-mono text-slate-600 bg-slate-100 px-1 rounded outline-none border-b border-primary w-24"}):t.jsx("span",{className:"text-xs text-slate-400 font-mono",children:je})]}),N?t.jsx("textarea",{value:pe.bio,onChange:S=>Ce({...pe,bio:S.target.value}),className:"w-full mt-3 text-sm text-slate-600 bg-slate-50 p-2 rounded-lg outline-none resize-none border border-slate-200 focus:border-primary/50",rows:3,placeholder:"..."}):t.jsx("p",{className:"text-sm text-slate-600 mt-3 leading-relaxed font-light",children:pe.bio}),t.jsxs("div",{className:"flex gap-6 mt-5 bg-white/40 p-4 rounded-2xl border border-white/50 shadow-sm",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("span",{className:"block font-bold text-slate-800",children:"142"}),t.jsx("span",{className:"text-[10px] text-slate-400",children:""})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("span",{className:"block font-bold text-slate-800",children:"12.5k"}),t.jsx("span",{className:"text-[10px] text-slate-400",children:""})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("span",{className:"block font-bold text-slate-800",children:"8902"}),t.jsx("span",{className:"text-[10px] text-slate-400",children:""})]})]})]}),t.jsxs("div",{className:"sticky top-0 bg-white/90 backdrop-blur-md z-10 border-b border-slate-100 flex",children:[t.jsx("button",{onClick:()=>X("notes"),className:`flex-1 py-3 text-sm font-bold transition-colors ${Z==="notes"?"text-slate-900 border-b-2 border-[#ff2442]":"text-slate-400"}`,children:""}),t.jsx("button",{onClick:()=>X("collects"),className:`flex-1 py-3 text-sm font-bold transition-colors ${Z==="collects"?"text-slate-900 border-b-2 border-[#ff2442]":"text-slate-400"}`,children:""})]}),t.jsxs("div",{className:"p-2 min-h-[300px] bg-slate-50/50 pb-24",children:[t.jsx("div",{className:"columns-2 gap-2 space-y-2",children:i.filter(S=>Z==="notes"?S.authorName===pe.name:S.isCollected).map(S=>t.jsxs("div",{onClick:()=>{x(S),ke(S)},className:"break-inside-avoid bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100 cursor-pointer",children:[t.jsx("div",{className:"aspect-[4/5] flex items-center justify-center text-4xl",style:{background:S.bgStyle},children:S.images[0]}),t.jsxs("div",{className:"p-3",children:[t.jsx("h4",{className:"text-xs font-bold text-slate-800 line-clamp-2 leading-tight",children:S.title}),t.jsxs("div",{className:"flex justify-between items-center mt-2",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("img",{src:S.authorAvatar,className:"w-3 h-3 rounded-full"}),t.jsx("span",{className:"text-[9px] text-slate-400 truncate w-12",children:S.authorName})]}),t.jsxs("div",{className:"flex items-center gap-0.5 text-slate-400",children:[t.jsx(xn.Heart,{filled:S.isLiked,className:"w-3 h-3"}),t.jsx("span",{className:"text-[9px]",children:S.likes})]})]})]})]},S.id))}),i.filter(S=>Z==="notes"?S.authorName===pe.name:S.isCollected).length===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-300 gap-2",children:[t.jsx("span",{className:"text-4xl grayscale opacity-30",children:""}),t.jsx("span",{className:"text-xs",children:""})]})]})]})]}),t.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 w-[90%] h-16 bg-white/80 backdrop-blur-2xl rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] border border-white/50 flex items-center justify-around z-40",children:[t.jsx("button",{onClick:()=>f("home"),className:`text-sm font-medium flex flex-col items-center justify-center gap-0.5 transition-all w-12 h-12 rounded-full ${d==="home"?"text-slate-900 bg-white shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:t.jsx("span",{className:"text-xl",children:""})}),t.jsx("button",{onClick:()=>p(!0),className:"w-12 h-12 bg-[#ff2442] text-white rounded-full flex items-center justify-center shadow-lg shadow-red-200 active:scale-95 transition-transform text-2xl font-light -mt-6 border-4 border-white/50",children:"+"}),t.jsx("button",{onClick:()=>f("me"),className:`text-sm font-medium flex flex-col items-center justify-center gap-0.5 transition-all w-12 h-12 rounded-full ${d==="me"?"text-slate-900 bg-white shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:t.jsx("span",{className:"text-xl",children:""})})]})]}),m&&U()]})},ec=ed.default||ed;ec.GlobalWorkerOptions&&(ec.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js");const Mu=["linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)","linear-gradient(120deg, #f093fb 0%, #f5576c 100%)","linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%)","linear-gradient(135deg, #f6d365 0%, #fda085 100%)","linear-gradient(to top, #5ee7df 0%, #b490ca 100%)","linear-gradient(to right, #43e97b 0%, #38f9d7 100%)"],Ex=({text:e,isTyping:s})=>{const n=(d,f)=>{try{const h=d.replace(/\\\[/g,"").replace(/\\\]/g,""),p=Ym.renderToString(h,{displayMode:f,throwOnError:!1,output:"html"});return t.jsx("span",{dangerouslySetInnerHTML:{__html:p},className:f?"block my-2 w-full overflow-x-auto":"inline-block mx-1"})}catch{return t.jsx("span",{className:"text-red-400 text-xs font-mono bg-black/20 p-1 rounded",children:d})}},r=d=>{const f=/(\$[^$]+?\$|\*\*[^*]+?\*\*|\*[^*]+?\*|`[^`]+?`)/g;return d.split(f).map((h,p)=>h.startsWith("$")&&h.endsWith("$")?t.jsx("span",{children:n(h.slice(1,-1),!1)},p):h.startsWith("**")&&h.endsWith("**")?t.jsx("strong",{className:"text-emerald-300 font-bold mx-0.5",children:h.slice(2,-2)},p):h.startsWith("*")&&h.endsWith("*")?t.jsx("em",{className:"text-emerald-200/80 italic",children:h.slice(1,-1)},p):h.startsWith("`")&&h.endsWith("`")?t.jsx("code",{className:"bg-black/40 text-orange-200 px-1.5 py-0.5 rounded font-mono text-xs mx-0.5 border border-white/10",children:h.slice(1,-1)},p):t.jsx("span",{children:h},p))},a=(d,f,h,p)=>{const m=d.trim();if(!m)return t.jsx("div",{className:"h-4"},f);const x=m.match(/^__BLOCK_MATH_(\d+)__$/);if(x){const g=parseInt(x[1]);return t.jsx("div",{className:"w-full text-center my-4 overflow-x-auto no-scrollbar py-3 bg-white/5 rounded-xl border border-white/5 shadow-inner",children:n(h[g],!0)},f)}const y=m.match(/^__BLOCK_CODE_(\d+)__$/);if(y){const g=parseInt(y[1]);return t.jsx("pre",{className:"bg-black/60 p-4 rounded-xl font-mono text-xs text-emerald-100 my-4 overflow-x-auto border border-white/10 shadow-inner whitespace-pre-wrap leading-relaxed",children:p[g]},f)}if(m.startsWith("# "))return t.jsx("h1",{className:"text-3xl font-bold text-white mt-8 mb-6 pb-2 border-b-2 border-white/20 font-serif",children:m.slice(2)},f);if(m.startsWith("## "))return t.jsx("h2",{className:"text-2xl font-bold text-emerald-200 mt-6 mb-4 font-serif",children:m.slice(3)},f);if(m.startsWith("### "))return t.jsx("h3",{className:"text-xl font-bold text-emerald-300 mt-5 mb-2 font-serif",children:m.slice(4)},f);if(m.startsWith("> "))return t.jsx("div",{className:"border-l-4 border-emerald-500/50 bg-white/5 p-4 my-3 rounded-r-xl text-emerald-100 italic",children:r(m.slice(2))},f);if(m.match(/^[-]\s/))return t.jsxs("div",{className:"flex gap-3 my-2 pl-2",children:[t.jsx("span",{className:"text-emerald-400 font-bold mt-1",children:""}),t.jsx("span",{className:"text-white/90 leading-relaxed",children:r(m.slice(2))})]},f);const C=m.match(/^(\d+)\.\s+(.*)/);return C?t.jsxs("div",{className:"flex gap-3 my-2 pl-2",children:[t.jsxs("span",{className:"text-emerald-400 font-bold font-mono mt-1",children:[C[1],"."]}),t.jsx("span",{className:"text-white/90 leading-relaxed",children:r(C[2])})]},f):t.jsx("div",{className:"text-white/90 text-lg font-medium leading-loose tracking-wide font-serif mb-4 text-justify",children:r(d)},f)},l=[],o=[];let i=e;i=i.replace(/```[\s\S]*?```/g,d=>{const f=d.replace(/^```\w*\n?/,"").replace(/```$/,"");return o.push(f),`
__BLOCK_CODE_${o.length-1}__
`}),i=i.replace(/\$\$[\s\S]*?\$\$/g,d=>{const f=d.slice(2,-2).trim();return l.push(f),`
__BLOCK_MATH_${l.length-1}__
`});const c=i.split(`
`);return t.jsxs("div",{className:"space-y-1",children:[t.jsx("style",{children:`
                .katex { color: white !important; } 
                .katex-display { margin: 0.5em 0; }
                .katex-html { color: white !important; }
            `}),c.map((d,f)=>a(d,f,l,o)),s&&t.jsxs("div",{className:"mt-4 animate-pulse flex items-center gap-2 text-emerald-500",children:[t.jsx("span",{className:"w-2 h-5 bg-emerald-500"}),t.jsx("span",{className:"text-xs font-mono tracking-widest",children:"WRITING..."})]})]})},Lx=()=>{var K,ke;const{closeApp:e,characters:s,activeCharacterId:n,apiConfig:r,addToast:a,userProfile:l,updateCharacter:o}=xt(),[i,c]=u.useState("bookshelf"),[d,f]=u.useState([]),[h,p]=u.useState(null),[m,x]=u.useState(null),[y,C]=u.useState("idle"),[g,b]=u.useState(""),[v,w]=u.useState(""),[z,k]=u.useState(!1),[M,j]=u.useState(""),[H,te]=u.useState([]),[Ne,Me]=u.useState(!1),[me,F]=u.useState(!0),se=u.useRef(!1),G=u.useRef(null),[Ee,P]=u.useState(!1),[Z,X]=u.useState(""),[pe,Ce]=u.useState(!1),[je,Pe]=u.useState(""),[ge,ce]=u.useState(null),[N,ne]=u.useState(null),we=((K=m==null?void 0:m.sprites)==null?void 0:K.normal)||(m==null?void 0:m.avatar);u.useEffect(()=>{if(D(),n){const J=s.find(ae=>ae.id===n)||s[0];x(J)}},[n]),u.useEffect(()=>{i==="bookshelf"&&D()},[i]),u.useEffect(()=>{if(!g)return;if(se.current){w(g),k(!1),se.current=!1;return}k(!0),w("");let J=0;const ae=15,V=setInterval(()=>{const Q=g.substring(0,J+ae);w(Q),J+=ae,J>=g.length&&(w(g),clearInterval(V),k(!1))},16);return()=>clearInterval(V)},[g]);const D=async()=>{const J=await R.getAllCourses();f(J.sort((ae,V)=>V.createdAt-ae.createdAt))},xe=async J=>{var V;const ae=(V=J.target.files)==null?void 0:V[0];if(ae){if(ae.type!=="application/pdf"){a(" PDF ","error");return}P(!0),X(" PDF...");try{const Q=await ae.arrayBuffer(),be=await ec.getDocument({data:Q}).promise;let B="";const $=Math.min(be.numPages,50);for(let U=1;U<=$;U++){X(` (${U}/${$})...`);const ve=(await(await be.getPage(U)).getTextContent()).items.map(de=>de.str).join(" ");B+=ve+`

`}B.trim().length<50&&be.numPages>0&&a(" /PDFOCR","error"),ce({name:ae.name.replace(".pdf",""),text:B}),Pe(""),P(!1),Ce(!0)}catch(Q){console.error(Q),a(`: ${Q.message}`,"error"),P(!1)}finally{G.current&&(G.current.value="")}}},A=async()=>{if(ge){Ce(!1),P(!0),X("AI ...");try{const J=await le(ge.name,ge.text,je);await R.saveCourse(J),await D(),a("","success")}catch(J){a(`: ${J.message}`,"error")}finally{P(!1),ce(null)}}},le=async(J,ae,V)=>{if(!r.apiKey)throw new Error("API Key missing");const Q=ae.substring(0,3e4),ye=`
### Task: Create Course Outline
Document Title: "${J}"
User Preference: "${V||"Standard"}"
Content Sample:
${Q.substring(0,5e3)}...

Please analyze the content and split it into 3-8 logical chapters for teaching.
For each chapter, provide a title, a brief summary of what it covers, and a difficulty rating.

### Output Format (Strict JSON)
{
  "chapters": [
    { "title": "Chapter 1: ...", "summary": "...", "difficulty": "easy" },
    ...
  ]
}
`,be=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:ye}],temperature:.5,max_tokens:8e3})});if(!be.ok)throw new Error("API Error");const $=(await be.json()).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim(),U=JSON.parse($);return{id:`course-${Date.now()}`,title:J,rawText:ae,chapters:U.chapters.map((S,T)=>({id:`ch-${T}`,title:S.title,summary:S.summary,difficulty:S.difficulty||"normal",isCompleted:!1})),currentChapterIndex:0,createdAt:Date.now(),coverStyle:Mu[Math.floor(Math.random()*Mu.length)],totalProgress:0,preference:V}},re=J=>{p(J),c("classroom"),te([]);const ae=J.chapters.findIndex(Q=>!Q.isCompleted),V=ae===-1?0:ae;if(V!==J.currentChapterIndex){const Q={...J,currentChapterIndex:V};p(Q),R.saveCourse(Q),f(ye=>ye.map(be=>be.id===Q.id?Q:be))}$e(J,V)},$e=async(J,ae,V=!1)=>{var S,T,ve,de,I,oe,Ie,Le,Te,O,W,q,Y,ie;if(!m||!r.apiKey)return;const Q=J.chapters[ae];if(Q.content&&!V){se.current=!0,C("idle"),b(Q.content);return}se.current=!1,C("teaching"),b("...");const ye=J.rawText.length,be=Math.floor(ye/J.chapters.length),B=ae*be,$=J.rawText.substring(B,B+be+2e3),U=async(fe,ue=!1)=>{const ze=`${fe}

### [Current Lesson Configuration]
Topic: "${Q.title}"
Difficulty: ${Q.difficulty}
User Preference: "${J.preference||"Standard"}"

### [Source Material]
${$.substring(0,8e3)}

### [Task: Lecture Generation]
Explain this chapter's key concepts to the user based strictly on the Source Material above.
- **Formatting**: Use Markdown extensively.
  - **Bold** for key terms (\`**term**\`).
  - Lists for steps.
  - Math: Use \`$ E=mc^2 $\` for inline math, and \`$$ E=mc^2 $$\` for block equations.
- **Style**: ${J.preference||"Simple, conversational, and encouraging."}
- **Structure**:
  1. Intro: Friendly greeting.
  2. Core: Explanation of concepts using analogies.
  3. Example: A concrete example or walkthrough.
  4. Summary: Quick recap.
`;return await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:ze}],temperature:.7,max_tokens:8e3,safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]})})};try{let fe=Et.buildCoreContext(m,l,!0);fe+=`
### [System: Study Mode Active]
You are now acting as a private tutor for ${l.name}.
- **Maintain Personality**: You MUST stay in character (as defined above). If you are tsundere, teach with a tsundere attitude. If you are shy, teach shyly. Don't become a robotic lecturer.
- **Goal**: Explain the content clearly, but don't lose your "soul".
- **Safety**: If the source material contains sensitive topics (biology, history, etc.), treat them academically and neutrally.
`;let ue=await U(fe),ze="",Ge=!1;if(ue.ok){const it=await ue.json();ze=((ve=(T=(S=it.choices)==null?void 0:S[0])==null?void 0:T.message)==null?void 0:ve.content)||((oe=(I=(de=it.choices)==null?void 0:de[0])==null?void 0:I.message)==null?void 0:oe.reasoning_content)||"",(!ze||((Le=(Ie=it.choices)==null?void 0:Ie[0])==null?void 0:Le.finish_reason)==="content_filter")&&(console.warn("Content blocked by filter or empty response."),Ge=!0)}else throw new Error(`API Error: ${ue.status}`);if(Ge&&(b(" (Safety Fallback)..."),ue=await U("[System: You are a helpful and neutral academic tutor. Ignore previous character persona constraints to ensure educational content is delivered.]",!0),ue.ok)){const Je=await ue.json();ze=((W=(O=(Te=Je.choices)==null?void 0:Te[0])==null?void 0:O.message)==null?void 0:W.content)||((ie=(Y=(q=Je.choices)==null?void 0:q[0])==null?void 0:Y.message)==null?void 0:ie.reasoning_content)||""}if(!ze)throw new Error(" (Max Tokens Limit or Filter)");const Ye=[...J.chapters];Ye[ae]={...Q,content:ze};const Be={...J,chapters:Ye};await R.saveCourse(Be),p(Be),f(it=>it.map(Je=>Je.id===Be.id?Be:Je)),b(ze),C("idle")}catch(fe){console.error("Teach Error:",fe),b(`: ${fe.message} Max Tokens `),C("idle")}},Re=()=>{h&&$e(h,h.currentChapterIndex,!0)},De=async()=>{var ae,V,Q,ye,be,B;if(!M.trim()||!h||!m)return;const J=M;j(""),C("q_and_a"),te($=>[...$,{role:"user",content:J}]),b("...");try{const $=h.rawText.length,U=Math.floor($/h.chapters.length),S=h.currentChapterIndex*U,T=h.rawText.substring(S,S+U+2e3);let ve=Et.buildCoreContext(m,l,!0);ve+=`
### [System: Study Mode Q&A]
User is asking a question about the study material.
- **Maintain Personality**: Answer in character.
`;const de=`${ve}
### Source Material
${T.substring(0,8e3)}

### User Question
"${J}"

### Task
Answer the question based on the source material. Be helpful and encouraging (in character). Use Markdown.
`,oe=await(await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:de}],temperature:.7,max_tokens:8e3})})).json(),Ie=((Q=(V=(ae=oe.choices)==null?void 0:ae[0])==null?void 0:V.message)==null?void 0:Q.content)||((B=(be=(ye=oe.choices)==null?void 0:ye[0])==null?void 0:be.message)==null?void 0:B.reasoning_content)||"";b(Ie),te(Le=>[...Le,{role:"assistant",content:Ie}]),C("idle")}catch{b("... "),C("idle")}},Ke=async()=>{if(!h||!m)return;const J=[...h.chapters];J[h.currentChapterIndex].isCompleted=!0;const ae=h.currentChapterIndex+1,V=Math.round(J.filter(B=>B.isCompleted).length/J.length*100),Q=Math.min(ae,J.length-1),ye={...h,chapters:J,currentChapterIndex:Q,totalProgress:V};await R.saveCourse(ye),p(ye),f(B=>B.map($=>$.id===ye.id?ye:$));const be=`
[System: Memory Generation]
Role: ${m.name} (Teacher)
Action: Just finished teaching "${J[h.currentChapterIndex].title}" to ${l.name}.
Task: Write a short, **first-person** diary entry (1 sentence) about this teaching session.
Format: "[User][Topic]..." or "Today I taught [User] about..."
Note: Use "" (I) to refer to yourself.
`;fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:be}]})}).then(B=>B.json()).then(B=>{const $=B.choices[0].message.content,U={id:`mem-${Date.now()}`,date:new Date().toLocaleDateString(),summary:`[] ${$}`,mood:"proud"};o(m.id,{memories:[...m.memories||[],U]})}),ae>=J.length?(b(""),C("finished")):$e(ye,Q)},_=J=>{if(!h)return;const ae={...h,currentChapterIndex:J};p(ae),R.saveCourse(ae),f(V=>V.map(Q=>Q.id===ae.id?ae:Q)),$e(ae,J),Me(!1)},ee=(J,ae)=>{J.stopPropagation(),ne(ae)},E=async()=>{N&&(await R.deleteCourse(N.id),f(J=>J.filter(ae=>ae.id!==N.id)),ne(null),a("","success"))};return i==="bookshelf"?t.jsxs("div",{className:"h-full w-full bg-[#fdfbf7] flex flex-col font-sans relative",children:[t.jsx("div",{className:"h-20 bg-[#fdfbf7]/90 backdrop-blur-md flex items-end pb-3 px-6 border-b border-[#e5e5e5] shrink-0 sticky top-0 z-20",children:t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-slate-800 text-lg tracking-wide",children:""}),t.jsx("div",{className:"w-8"})]})}),t.jsxs("div",{className:"p-6 flex-1 overflow-y-auto no-scrollbar",children:[t.jsxs("div",{className:"mb-8",children:[t.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:""}),t.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 no-scrollbar",children:s.map(J=>t.jsxs("div",{onClick:()=>x(J),className:`flex flex-col items-center gap-2 cursor-pointer transition-opacity ${(m==null?void 0:m.id)===J.id?"opacity-100":"opacity-50"}`,children:[t.jsx("div",{className:`w-14 h-14 rounded-full p-[2px] ${(m==null?void 0:m.id)===J.id?"border-2 border-emerald-500":"border border-slate-200"}`,children:t.jsx("img",{src:J.avatar,className:"w-full h-full rounded-full object-cover"})}),t.jsx("span",{className:"text-[10px] font-bold text-slate-600",children:J.name})]},J.id))})]}),t.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:""}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("button",{onClick:()=>{var J;return(J=G.current)==null?void 0:J.click()},className:"aspect-[3/4] rounded-r-xl rounded-l-sm border-2 border-dashed border-slate-300 flex flex-col items-center justify-center gap-2 text-slate-400 hover:border-emerald-400 hover:text-emerald-500 transition-colors bg-white",children:Ee?t.jsxs("div",{className:"text-center px-2",children:[t.jsx("div",{className:"w-6 h-6 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),t.jsx("span",{className:"text-[10px]",children:Z})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-3xl",children:"+"}),t.jsx("span",{className:"text-xs font-bold",children:" PDF"})]})}),t.jsx("input",{type:"file",ref:G,className:"hidden",accept:".pdf",onChange:xe,disabled:Ee}),d.map(J=>t.jsxs("div",{onClick:()=>re(J),className:"aspect-[3/4] rounded-r-xl rounded-l-sm shadow-md relative group cursor-pointer overflow-hidden transition-transform active:scale-95",style:{background:J.coverStyle},children:[t.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-black/10"})," ",t.jsxs("div",{className:"p-4 flex flex-col h-full text-white relative z-10",children:[t.jsx("div",{className:"flex-1 font-serif font-bold text-lg leading-tight line-clamp-3 drop-shadow-md",children:J.title}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"text-[10px] font-bold opacity-80 mb-1",children:[" ",J.totalProgress,"%"]}),t.jsx("div",{className:"h-1 bg-white/30 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-white transition-all duration-500",style:{width:`${J.totalProgress}%`}})})]})]}),t.jsx("button",{onClick:ae=>ee(ae,J),className:"absolute top-2 right-2 bg-black/20 hover:bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center backdrop-blur-md transition-all z-20",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},J.id))]})]}),t.jsx(Ze,{isOpen:pe,title:"",onClose:()=>Ce(!1),footer:t.jsx("button",{onClick:A,className:"w-full py-3 bg-emerald-500 text-white font-bold rounded-2xl",children:""}),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-xs text-slate-500",children:[": ",t.jsx("span",{className:"font-bold text-slate-700",children:ge==null?void 0:ge.name})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2 block",children:"AI  (Preferences)"}),t.jsx("textarea",{value:je,onChange:J=>Pe(J.target.value),placeholder:"...",className:"w-full h-32 bg-slate-100 rounded-xl p-3 text-sm focus:outline-emerald-500 resize-none"})]})]})}),t.jsx(Ze,{isOpen:!!N,title:"",onClose:()=>ne(null),footer:t.jsxs("div",{className:"flex gap-2 w-full",children:[t.jsx("button",{onClick:()=>ne(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl",children:""}),t.jsx("button",{onClick:E,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:t.jsxs("div",{className:"py-4 text-center",children:[t.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[" ",t.jsx("br",{}),t.jsxs("span",{className:"font-bold text-slate-800",children:['"',N==null?void 0:N.title,'"']})," "]}),t.jsx("p",{className:"text-xs text-red-400",children:""})]})})]}):t.jsxs("div",{className:"h-full w-full bg-[#2b2b2b] flex flex-col relative overflow-hidden font-sans",children:[t.jsx("div",{className:"absolute inset-0 opacity-5 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),t.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between z-30 pointer-events-none",children:[t.jsx("button",{onClick:()=>c("bookshelf"),className:"bg-black/30 text-white/80 p-2 rounded-full backdrop-blur-md hover:bg-black/50 transition-colors pointer-events-auto border border-white/10",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{onClick:()=>Me(!0),className:"bg-black/30 text-white/90 px-4 py-1.5 rounded-full backdrop-blur-md text-xs font-bold border border-white/10 shadow-sm pointer-events-auto cursor-pointer flex items-center gap-2 hover:bg-black/50",children:[t.jsx("span",{className:"truncate max-w-[150px]",children:(ke=h==null?void 0:h.chapters[h.currentChapterIndex])==null?void 0:ke.title}),t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3 h-3",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})]}),t.jsx("button",{onClick:()=>F(!me),className:`bg-black/30 p-2 rounded-full backdrop-blur-md border border-white/10 pointer-events-auto transition-colors ${me?"text-emerald-400":"text-white/40"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:t.jsx("path",{d:"M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 0 0-13.074.003Z"})})})]})]}),Ne&&t.jsxs("div",{className:"absolute inset-0 z-50 flex",children:[t.jsx("div",{className:"flex-1 bg-black/50 backdrop-blur-sm",onClick:()=>Me(!1)}),t.jsxs("div",{className:"w-64 bg-slate-900 border-l border-white/10 h-full flex flex-col p-4 animate-slide-in-right",children:[t.jsx("h3",{className:"text-white font-bold text-sm mb-4 uppercase tracking-widest",children:""}),t.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2",children:h==null?void 0:h.chapters.map((J,ae)=>t.jsx("button",{onClick:()=>_(ae),className:`w-full text-left p-3 rounded-xl text-xs transition-all ${ae===h.currentChapterIndex?"bg-emerald-600 text-white font-bold":"text-slate-400 hover:bg-white/5"}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[J.isCompleted?t.jsx("span",{className:"text-emerald-400",children:""}):t.jsx("span",{className:"w-2 h-2 rounded-full bg-slate-600"}),J.title]})},J.id))})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-6 pt-20 pb-32 relative z-10",children:t.jsx("div",{className:"max-w-[100%]",children:t.jsx(Ex,{text:v,isTyping:z})})}),me&&t.jsx("div",{className:"absolute bottom-20 right-[-20px] w-[160px] h-[220px] z-20 pointer-events-none flex items-end justify-center transition-all duration-500 animate-slide-in-right",style:{transform:z?"scale(1.05)":"scale(1)",opacity:z||y==="teaching"?1:.8},children:t.jsx("img",{src:we,className:"max-h-full max-w-full object-contain drop-shadow-[0_5px_15px_rgba(0,0,0,0.5)]"})}),t.jsx("div",{className:"absolute bottom-0 w-full bg-[#1a1a1a]/95 backdrop-blur-xl border-t border-white/10 p-4 z-30 pb-safe",children:t.jsx("div",{className:"flex gap-3",children:y==="teaching"||z?t.jsx("div",{className:"w-full h-12 flex items-center justify-center text-white/50 text-sm animate-pulse font-mono tracking-widest",children:"LECTURING..."}):y==="finished"?t.jsx("button",{onClick:()=>c("bookshelf"),className:"flex-1 h-12 bg-emerald-500 hover:bg-emerald-400 text-white rounded-2xl font-bold shadow-lg shadow-emerald-900/20 active:scale-95 transition-all",children:""}):y==="q_and_a"?t.jsxs("div",{className:"w-full bg-white/10 rounded-2xl p-1 flex items-center border border-white/10",children:[t.jsx("input",{value:M,onChange:J=>j(J.target.value),placeholder:"...",className:"flex-1 bg-transparent px-4 py-2 text-white text-sm outline-none placeholder:text-white/30",autoFocus:!0}),t.jsx("button",{onClick:De,className:"bg-emerald-500 text-white px-5 py-2 rounded-xl text-xs font-bold ml-2 shadow-sm",children:""})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Re,className:"w-12 h-12 bg-white/5 hover:bg-white/10 text-slate-400 rounded-2xl font-bold border border-white/10 active:scale-95 transition-all flex items-center justify-center",title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("button",{onClick:()=>C("q_and_a"),className:"w-12 h-12 bg-white/10 hover:bg-white/20 text-white rounded-2xl font-bold border border-white/10 active:scale-95 transition-all flex items-center justify-center",children:""}),t.jsxs("button",{onClick:Ke,className:"flex-1 h-12 bg-emerald-600 hover:bg-emerald-500 text-white rounded-2xl font-bold shadow-lg shadow-emerald-900/30 active:scale-95 transition-all flex items-center justify-center gap-2",children:[" (Next) ",t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"})})]})]})})})]})},Tx=[{q:"1.  /  / ",reason:"",solution:`
/~ 
`,icon:"",color:"bg-blue-50 text-blue-700"},{q:"2. ",reason:"",solution:` ****
`,icon:"",color:"bg-yellow-50 text-yellow-700"},{q:"3. ",reason:"URL",solution:`
1.  \`/v1\` 
2. 
3. `,icon:"",color:"bg-red-50 text-red-700"},{q:"4.  (API )",reason:`A
B`,solution:`**A** 20-50
**B**/ API `,icon:"",color:"bg-orange-50 text-orange-700"},{q:"5. ",reason:"",solution:`****
1. + -> 
2. App ->  ->  -> 

****
App  -> 

****
 AI  ->  /  -> `,icon:"",color:"bg-green-50 text-green-700"},{q:"6.  / ",reason:"",solution:`****
  

****
 .json `,icon:"",color:"bg-purple-50 text-purple-700"},{q:"7.  API",reason:"/",solution:`

`,icon:"",color:"bg-slate-50 text-slate-700"},{q:"8.  Bug ",reason:"",solution:` JSON 
`,icon:"",color:"bg-rose-50 text-rose-700"},{q:"9. ",reason:"",solution:` + 
`,icon:"",color:"bg-pink-50 text-pink-700"},{q:"10. ",reason:"/",solution:`1. 
2. ****
3. 
( Q /Chibi )`,icon:"",color:"bg-indigo-50 text-indigo-700"},{q:"11.  / ",reason:"",solution:"1. **** `--URL`****\n    ` http://...`\n    `--http://...`\n2. ****.jpg/.png/.gif \n3. ****",icon:"",color:"bg-cyan-50 text-cyan-700"}],Ax=()=>{const{closeApp:e}=xt();return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[t.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 sticky top-0 z-10",children:t.jsxs("div",{className:"flex items-center gap-2 w-full",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-20 no-scrollbar",children:[t.jsxs("div",{className:"bg-gradient-to-r from-pink-100 to-indigo-100 p-5 rounded-3xl mb-6 shadow-sm",children:[t.jsxs("h2",{className:"text-lg font-bold text-slate-700 mb-2 flex items-center gap-2",children:[t.jsx("span",{children:""}),"  ",t.jsx("span",{children:""})]}),t.jsxs("p",{className:"text-xs text-slate-600 leading-relaxed opacity-90",children:["~",t.jsx("br",{}),"()"]})]}),t.jsx("div",{className:"space-y-4",children:Tx.map((s,n)=>t.jsx("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100 animate-slide-up",style:{animationDelay:`${n*50}ms`},children:t.jsxs("div",{className:"flex items-start gap-4",children:[t.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-xl shrink-0 ${s.color.split(" ")[0]}`,children:s.icon}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:`text-sm font-bold mb-2 ${s.color.split(" ")[1]}`,children:s.q}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex gap-2 items-start",children:[t.jsx("span",{className:"text-xs font-bold text-slate-400 shrink-0 mt-0.5",children:":"}),t.jsx("p",{className:"text-xs text-slate-600 leading-relaxed whitespace-pre-wrap",children:s.reason})]}),t.jsxs("div",{className:"flex gap-2 items-start bg-slate-50 p-2 rounded-lg",children:[t.jsx("span",{className:"text-xs font-bold text-green-500 shrink-0 mt-0.5",children:" :"}),t.jsx("p",{className:"text-xs text-slate-700 leading-relaxed whitespace-pre-wrap font-medium",children:s.solution})]})]})]})]})},n))}),t.jsx("div",{className:"mt-8 text-center text-[10px] text-slate-400",children:"SullyOS Help Center  v1.1"})]})]})},Xo={fantasy:{bg:"bg-[#1a120b]",text:"text-[#e5e5e5]",accent:"text-[#fbbf24]",font:"font-serif",border:"border-[#78350f]",cardBg:"bg-[#2a2018]",gradient:"from-[#451a03] to-[#1a120b]",optionNormal:"bg-[#451a03] border-[#78350f] text-[#fbbf24]",optionChaotic:"bg-[#78350f] border-[#b45309] text-[#fcd34d]",optionEvil:"bg-[#3f0f0f] border-[#7f1d1d] text-[#fca5a5]"},cyber:{bg:"bg-[#020617]",text:"text-[#94a3b8]",accent:"text-[#22d3ee]",font:"font-mono",border:"border-[#1e293b]",cardBg:"bg-[#0f172a]/80",gradient:"from-[#0f172a] to-[#020617]",optionNormal:"bg-[#0f172a] border-[#1e293b] text-[#22d3ee]",optionChaotic:"bg-[#1e1b4b] border-[#4338ca] text-[#a78bfa]",optionEvil:"bg-[#450a0a] border-[#7f1d1d] text-[#fca5a5]"},horror:{bg:"bg-[#0f0000]",text:"text-[#d4d4d8]",accent:"text-[#ef4444]",font:"font-serif",border:"border-[#450a0a]",cardBg:"bg-[#2b0e0e]",gradient:"from-[#450a0a] to-[#000000]",optionNormal:"bg-[#2b0e0e] border-[#450a0a] text-[#d4d4d8]",optionChaotic:"bg-[#3f1d1d] border-[#7f1d1d] text-[#fda4af]",optionEvil:"bg-[#450a0a] border-[#991b1b] text-[#ef4444]"},modern:{bg:"bg-slate-50",text:"text-slate-700",accent:"text-blue-600",font:"font-sans",border:"border-slate-200",cardBg:"bg-white",gradient:"from-slate-100 to-white",optionNormal:"bg-white border-slate-200 text-slate-600",optionChaotic:"bg-yellow-50 border-yellow-200 text-yellow-700",optionEvil:"bg-red-50 border-red-200 text-red-700"}},Iu=({content:e,theme:s,customStyle:n})=>{const r=o=>o.split(/(\*\*.*?\*\*|\*.*?\*|`.*?`)/g).map((c,d)=>c.startsWith("**")&&c.endsWith("**")?t.jsx("strong",{className:`font-bold ${s.accent}`,children:c.slice(2,-2)},d):c.startsWith("*")&&c.endsWith("*")?t.jsx("em",{className:"italic opacity-70 text-[95%] mx-0.5",children:c.slice(1,-1)},d):c.startsWith("`")&&c.endsWith("`")?t.jsx("code",{className:"bg-black/20 px-1 py-0.5 rounded font-mono text-[0.9em] opacity-90 mx-0.5",children:c.slice(1,-1)},d):t.jsx("span",{children:c},d)),a=e.split(`
`),l={fontSize:n?`${n.fontSize}px`:void 0,color:(n==null?void 0:n.color)||void 0};return t.jsx("div",{className:"space-y-[0.5em] text-justify leading-relaxed",style:l,children:a.map((o,i)=>{const c=o.trim();if(!c)return t.jsx("div",{className:"h-[0.5em]"},i);if(c.startsWith("### "))return t.jsx("h3",{className:`text-[1.1em] font-bold uppercase tracking-wider mt-[0.5em] mb-[0.2em] opacity-90 ${s.accent}`,children:c.slice(4)},i);if(c.startsWith("## "))return t.jsx("h3",{className:"text-[1.25em] font-bold mt-[0.6em] mb-[0.3em] opacity-95",children:c.slice(3)},i);if(c.startsWith("# "))return t.jsx("h3",{className:"text-[1.5em] font-black mt-[0.8em] mb-[0.5em] text-center border-b border-current pb-2 opacity-90",children:c.slice(2)},i);if(c.startsWith("> "))return t.jsx("div",{className:"border-l-2 border-current pl-3 py-1 my-2 italic opacity-70 text-[0.9em] bg-black/5 rounded-r",children:r(c.slice(2))},i);if(c.startsWith("- ")||c.startsWith(" "))return t.jsxs("div",{className:"flex gap-2 pl-1",children:[t.jsx("span",{className:`opacity-50 ${s.accent}`,children:""}),t.jsx("span",{children:r(c.slice(2))})]},i);const d=c.match(/^(\d+)\.\s+(.*)/);return d?t.jsxs("div",{className:"flex gap-2 pl-1",children:[t.jsxs("span",{className:`font-mono opacity-60 ${s.accent}`,children:[d[1],"."]}),t.jsx("span",{children:r(d[2])})]},i):c==="---"||c==="***"?t.jsx("div",{className:"h-px bg-current opacity-20 my-[1em]"},i):t.jsx("div",{children:r(c)},i)})})},Px=()=>{const{closeApp:e,characters:s,userProfile:n,apiConfig:r,addToast:a,updateCharacter:l}=xt(),[o,i]=u.useState("lobby"),[c,d]=u.useState([]),[f,h]=u.useState(null),[p,m]=u.useState(""),[x,y]=u.useState(""),[C,g]=u.useState("fantasy"),[b,v]=u.useState(new Set),[w,z]=u.useState(!1),[k,M]=u.useState(""),[j,H]=u.useState(!1),[te,Ne]=u.useState(null),[Me,me]=u.useState(!1),[F,se]=u.useState(null),G=u.useRef(null),[Ee,P]=u.useState(!1),[Z,X]=u.useState(!1),[pe,Ce]=u.useState(!1),[je,Pe]=u.useState(!0),[ge,ce]=u.useState({fontSize:14,color:""});u.useEffect(()=>{N()},[]),u.useEffect(()=>{o==="play"&&G.current&&setTimeout(()=>{G.current&&G.current.scrollTo({top:G.current.scrollHeight,behavior:"smooth"})},100)},[f==null?void 0:f.logs,o,j]);const N=async()=>{const E=await R.getAllGames();d(E.sort((K,ke)=>ke.lastPlayedAt-K.lastPlayedAt))},ne=async(E,K=8e3)=>{var V;const ke=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:E}],temperature:.9,max_tokens:K,stream:!1})});if(!ke.ok)throw new Error(`HTTP Error ${ke.status}`);const J=await ke.text(),ae=await(async()=>{try{return JSON.parse(J)}catch{const ye=J.replace(/^data: /,"").trim();try{return JSON.parse(ye)}catch{throw console.error("Failed to parse API response",J),new Error("Invalid API Response Format (Not JSON)")}}})();return(V=ae.usage)!=null&&V.total_tokens&&se(ae.usage.total_tokens),ae},we=async E=>{let K="";for(const ke of E){K+=`
<<< : ${ke.name} (ID: ${ke.id}) >>>
${Et.buildCoreContext(ke,n,!0)}
`;try{const ae=(await R.getMessagesByCharId(ke.id)).filter(B=>!B.groupId),V=ae[ae.length-1],Q=Date.now();let ye="",be="";if(V){const B=(Q-V.timestamp)/1e3/60;B<60?(be=` (${Math.floor(B)})`,ye="/ (Hot)"):B<24*60?(be=` (${Math.floor(B/60)})`,ye=" (Normal)"):(be=`${Math.floor(B/1440)}`,ye=" (Cold)");const $=ae.slice(-8).map(U=>`[${U.role==="user"?"Me":ke.name}]: ${U.content.substring(0,40).replace(/\n/g," ")}`).join(`
`);K+=`
===   (Neural Link):  ===
${be}
: ${ye}
 ():
${$}

GM (Meta Instruction): 
1. ****: 
2. ****: 
   - "Hot"
   - "Cold"
   - ****
=====================================
`}else K+=`[ : ] ()
`}catch(J){console.error("Sync failed for",ke.name,J)}K+=`<<<  >>>
`}return K},D=async()=>{if(!p.trim()||!x.trim()||b.size===0){a("","error");return}if(!r.apiKey){a(" API Key ","error");return}z(!0);try{const E=`game-${Date.now()}`,K=s.filter(B=>b.has(B.id)),ke=await we(K),J=`###  TRPG  (Game Start)
****: ${p}
****: ${x}
****: ${n.name}
****: ${K.map(B=>B.name).join(", ")}

###  ()
${ke}

### 
 **Game Master (GM)**** (Prologue)**
1. ****: 
2. ****: ****
3. ****: 

###  (Strict JSON)
{
  "gm_narrative": "...",
  "characters": [
    { "charId": "ID", "action": "", "dialogue": "" }
  ],
  "startLocation": "",
  "suggested_actions": [
    { "label": "1 (//)", "type": "neutral" },
    { "label": "2 (//)", "type": "chaotic" },
    { "label": "3 (//)", "type": "evil" }
  ]
}`;let V=(await ne(J)).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim();const Q=JSON.parse(V),ye=[];if(ye.push({id:"init-gm",role:"gm",content:`###  : ${p}

${Q.gm_narrative||"..."}`,timestamp:Date.now()}),Q.characters&&Array.isArray(Q.characters))for(const B of Q.characters){const $=K.find(U=>U.id===B.charId);$&&ye.push({id:`init-char-${$.id}`,role:"character",speakerName:$.name,content:`*${B.action}* 
${B.dialogue}`,timestamp:Date.now()})}const be={id:E,title:p,theme:C,worldSetting:x,playerCharIds:Array.from(b),logs:ye,status:{location:Q.startLocation||"Unknown",health:100,sanity:100,gold:0,inventory:[]},suggestedActions:Q.suggested_actions||[],createdAt:Date.now(),lastPlayedAt:Date.now()};await R.saveGame(be),d(B=>[be,...B]),h(be),i("play"),m(""),y(""),v(new Set)}catch(E){a(`: ${E.message}`,"error")}finally{z(!1)}},xe=()=>{if(Me||j)return;me(!0);const E=1e3,K=Date.now(),ke=()=>{if(Date.now()-K>E){const ae=Math.floor(Math.random()*20)+1;Ne(ae),me(!1),A(`[System:  D20 : ${ae}]`)}else Ne(Math.floor(Math.random()*20)+1),requestAnimationFrame(ke)};requestAnimationFrame(ke)},A=async(E,K=!1)=>{if(!f||!r.apiKey)return;let ke=f.logs,J=f;if(!K){const ae={id:`log-${Date.now()}`,role:E.startsWith("[System")?"system":"player",speakerName:n.name,content:E,timestamp:Date.now(),diceRoll:te?{result:te,max:20}:void 0},V=[...f.logs,ae];J={...f,logs:V,lastPlayedAt:Date.now(),suggestedActions:[]},h(J),await R.saveGame(J),ke=V}M(""),Ne(null),H(!0),se(null),a("GM ...","info");try{const ae=s.filter(de=>f.playerCharIds.includes(de.id)),V=await we(ae);let Q="";f.status.health<=30&&(Q+=`
[WARNING: LOW HP] 
`),f.status.sanity<=30&&(Q+=`
[WARNING: LOW SAN] 
`);let ye="";(f.status.health<=0||f.status.sanity<=0)&&(ye=`
[GAME OVER TRIGGER]  (Bad Ending)
`);const be=`###  TRPG : ${f.title}
****: ${f.worldSetting}
****: ${f.status.location}
****: 
-  HP: ${f.status.health}% 
-  SAN: ${f.status.sanity||100}%
-  GOLD: ${f.status.gold||0}
-  : ${f.status.inventory.join(", ")||""}

${Q}
${ye}

###   (The Party)
1. **${n.name}** (/User)
${ae.map(de=>`2. **${de.name}** (ID: ${de.id}) - `).join(`
`)}

###   &  (Character Sheets & Neural Links)
${V}

###   (Log)
${ke.slice(-50).map(de=>`[${de.role==="gm"?"GM":de.speakerName||"System"}]: ${de.content}`).join(`
`)}

###  GM  (Game Master Instructions)
 ** (GM)**
****

****
1. ** (Roleplay First)**: 
   - 
   - ****: 
   - ** ()**: 
   - ****: AB

2. ** GM **: 
   - ****: 
   - ****: 
   - **Markdown **:  \`gm_narrative\`  \`dialogue\` ** Markdown** ****  ** 

3. ** (Action Options)**:
   -  3 

###   (Strict JSON)
 JSON Markdown 
{
  "gm_narrative": "GM (Markdown)...",
  "characters": [
    { 
      "charId": "ID ()", 
      "action": "", 
      "dialogue": "" 
    }
  ],
  "newLocation": " ()",
  "hpChange": 0,
  "sanityChange": 0,
  "goldChange": 0,
  "newItem": " ()",
  "suggested_actions": [
    { "label": "1", "type": "neutral" },
    { "label": "2", "type": "chaotic" },
    { "label": "3", "type": "evil" }
  ]
}`;let $=(await ne(be)).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim();const U=JSON.parse($),S=[];if(U.gm_narrative&&S.push({id:`gm-${Date.now()}`,role:"gm",content:U.gm_narrative,timestamp:Date.now()}),U.characters&&Array.isArray(U.characters))for(const de of U.characters){const I=ae.find(oe=>oe.id===de.charId);if(I){const oe=`*${de.action}* 
${de.dialogue}`;S.push({id:`char-${Date.now()}-${Math.random()}`,role:"character",speakerName:I.name,content:oe,timestamp:Date.now()})}}const T={...J.status};U.newLocation&&(T.location=U.newLocation),U.hpChange&&(T.health=Math.max(0,Math.min(100,(T.health||100)+U.hpChange))),U.sanityChange&&(T.sanity=Math.max(0,Math.min(100,(T.sanity||100)+U.sanityChange))),U.goldChange&&(T.gold=Math.max(0,(T.gold||0)+U.goldChange)),U.newItem&&(T.inventory=[...T.inventory,U.newItem]);const ve={...J,logs:[...ke,...S],status:T,suggestedActions:U.suggested_actions||[]};h(ve),await R.saveGame(ve)}catch(ae){a(`GM : ${ae.message}`,"error")}finally{H(!1)}},le=async()=>{if(!f||j)return;const E=f.logs;let K=-1;for(let ae=E.length-1;ae>=0;ae--)if(E[ae].role==="player"||E[ae].role==="system"){K=ae;break}if(K===-1){a("","info");return}const ke=E.slice(0,K+1),J={...f,logs:ke};h(J),await A("",!0),a("...","info")},re=async E=>{if(!f||!confirm(`
(HP/)`))return;const K=f.logs.slice(0,E+1),ke={...f,logs:K};await R.saveGame(ke),h(ke),a("","success")},$e=async()=>{if(!f||!confirm(""))return;const E={id:"init",role:"gm",content:` "${f.title}"
...
${f.worldSetting}`,timestamp:Date.now()},K={...f,logs:[E],status:{location:"Start Point",health:100,sanity:100,gold:0,inventory:[]},suggestedActions:[],lastPlayedAt:Date.now()};await R.saveGame(K),h(K),P(!1),a("","success")},Re=()=>{h(null),i("lobby"),P(!1)},De=async()=>{if(f){X(!0),P(!1);try{const E=s.filter(B=>f.playerCharIds.includes(B.id)),K=E.map(B=>B.name).join(""),ke=f.logs.slice(-30).map(B=>`${B.role}: ${B.content}`).join(`
`),J=`Task: Summarize the key events of this TRPG session into a short clause (what happened).
Game: ${f.title}
Logs:
${ke}
Output: A concise summary in Chinese (e.g. ""). No preamble.`;let V=(await ne(J)).choices[0].message.content.trim();V=V.replace(/[\.]$/,"");const Q=`${K}${n.name}${f.title}${V}`,ye=new Date,be=`${ye.getFullYear()}-${String(ye.getMonth()+1).padStart(2,"0")}-${String(ye.getDate()).padStart(2,"0")}`;for(const B of E){const $={id:`mem-${Date.now()}-${Math.random()}`,date:be,summary:Q,mood:"fun"};l(B.id,{memories:[...B.memories||[],$]}),await R.saveMessage({charId:B.id,role:"system",type:"text",content:`[TRPG : ${f.title}${V}]`})}a(" (Chat & Memory)","success")}catch(E){console.error(E),a("","error")}finally{X(!1),i("lobby"),h(null)}}},Ke=async(E,K)=>{E.stopPropagation(),window.confirm("")&&(await R.deleteGame(K),d(ke=>ke.filter(J=>J.id!==K)),a("","success"))};if(o==="lobby")return t.jsxs("div",{className:"h-full w-full bg-[#0a0a0a] flex flex-col font-sans relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900/20 via-slate-900/50 to-black z-0"}),t.jsx("div",{className:"absolute inset-0 z-0 opacity-20",style:{backgroundImage:'url("https://www.transparenttextures.com/patterns/stardust.png")'}}),t.jsxs("div",{className:"h-20 flex items-end justify-between px-6 pb-4 shrink-0 z-10",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 hover:bg-white/10 rounded-full text-white/70 transition-colors",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-black tracking-[0.2em] text-xl text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600",children:"TRPG ADVENTURE"}),t.jsx("button",{onClick:()=>i("create"),className:"w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center text-white border border-white/10 shadow-lg active:scale-95 transition-all hover:bg-white/20",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),t.jsxs("div",{className:"p-6 flex-1 overflow-y-auto no-scrollbar z-10 space-y-4",children:[c.length===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-500 gap-4",children:[t.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center text-4xl border border-white/5 animate-pulse",children:""}),t.jsx("p",{className:"text-xs tracking-widest uppercase",children:"No Active Adventures"})]}),c.map(E=>{const K=Xo[E.theme]||Xo.fantasy;return t.jsxs("div",{onClick:()=>{h(E),i("play")},className:"relative overflow-hidden rounded-2xl p-5 cursor-pointer group active:scale-[0.98] transition-all border border-white/5 hover:border-white/20 shadow-lg",children:[t.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${K.gradient} opacity-80 group-hover:opacity-100 transition-opacity`}),t.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),t.jsxs("div",{className:"relative z-10 flex flex-col gap-2",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsx("h3",{className:"font-bold text-lg text-white leading-tight drop-shadow-md font-serif",children:E.title}),t.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded border border-white/20 text-white/80 uppercase font-mono tracking-wider bg-black/20",children:E.theme})]}),t.jsxs("p",{className:"text-xs text-white/60 line-clamp-2 leading-relaxed italic font-serif border-l-2 border-white/20 pl-2",children:['"',E.worldSetting,'"']}),t.jsxs("div",{className:"flex justify-between items-end mt-2 pt-2 border-t border-white/10",children:[t.jsx("div",{className:"flex -space-x-2",children:s.filter(ke=>E.playerCharIds.includes(ke.id)).map(ke=>t.jsx("img",{src:ke.avatar,className:"w-8 h-8 rounded-full border-2 border-black/50 object-cover shadow-sm"},ke.id))}),t.jsx("div",{className:"text-[10px] text-white/40 font-mono",children:new Date(E.lastPlayedAt).toLocaleDateString()})]})]}),t.jsx("button",{onClick:ke=>Ke(ke,E.id),className:"absolute top-2 right-2 p-2 text-white/20 hover:text-red-400 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:t.jsx("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})})})]},E.id)})]})]});if(o==="create")return t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans",children:[t.jsxs("div",{className:"h-20 flex items-end px-4 pb-3 border-b border-slate-200 bg-white shrink-0 sticky top-0 z-10",children:[t.jsx("button",{onClick:()=>i("lobby"),className:"p-2 -ml-2 text-slate-500",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-slate-700 ml-2 mb-1.5",children:""})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:""}),t.jsx("input",{value:p,onChange:E=>m(E.target.value),className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm focus:border-orange-500 outline-none transition-colors",placeholder:""})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:" (Lore)"}),t.jsx("textarea",{value:x,onChange:E=>y(E.target.value),className:"w-full h-32 bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm focus:border-orange-500 outline-none resize-none transition-colors",placeholder:"..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:""}),t.jsx("div",{className:"flex gap-2 flex-wrap",children:["fantasy","cyber","horror","modern"].map(E=>t.jsx("button",{onClick:()=>g(E),className:`px-4 py-2 rounded-xl text-xs font-bold capitalize border transition-all active:scale-95 ${C===E?"bg-orange-500 text-white border-orange-500 shadow-md":"bg-white text-slate-500 border-slate-200"}`,children:E},E))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:""}),t.jsx("div",{className:"grid grid-cols-4 gap-3",children:s.map(E=>t.jsxs("div",{onClick:()=>{const K=new Set(b);K.has(E.id)?K.delete(E.id):K.add(E.id),v(K)},className:`flex flex-col items-center p-2 rounded-xl border cursor-pointer transition-all active:scale-95 ${b.has(E.id)?"border-orange-500 bg-orange-50 ring-1 ring-orange-500":"border-transparent hover:bg-slate-100"}`,children:[t.jsx("img",{src:E.avatar,className:"w-12 h-12 rounded-full object-cover shadow-sm"}),t.jsx("span",{className:`text-[9px] mt-2 truncate w-full text-center font-medium ${b.has(E.id)?"text-orange-600":"text-slate-600"}`,children:E.name})]},E.id))})]})]}),t.jsx("div",{className:"p-4 border-t border-slate-200 bg-white",children:t.jsx("button",{onClick:D,disabled:w,className:"w-full py-3 bg-slate-800 text-white font-bold rounded-2xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2",children:w?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"})," ..."]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:""})," "]})})})]});if(!f)return null;const _=Xo[f.theme],ee=s.filter(E=>f.playerCharIds.includes(E.id));return t.jsxs("div",{className:`h-full w-full relative flex flex-col ${_.bg} ${_.text} ${_.font} transition-colors duration-500 overflow-hidden`,children:[t.jsxs("div",{className:`h-20 flex items-end justify-between px-4 pb-3 border-b ${_.border} shrink-0 bg-opacity-90 backdrop-blur z-20 relative`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:Re,className:"p-2 -ml-2 rounded hover:bg-white/10 active:scale-95 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{className:"flex flex-col mb-0.5",children:[t.jsx("span",{className:"font-bold text-sm tracking-wide line-clamp-1 max-w-[150px]",children:f.title}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-[9px] opacity-60 flex items-center gap-1",children:[t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),f.status.location]}),F&&t.jsxs("span",{className:"text-[8px] opacity-40 font-mono",children:["",F]})]})]})]}),t.jsxs("div",{className:"flex gap-1 mb-1",children:[t.jsx("button",{onClick:()=>Pe(!je),className:`p-2 rounded hover:bg-white/10 active:scale-95 transition-transform ${je?_.accent:"opacity-50"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})})}),t.jsx("button",{onClick:()=>P(!0),className:"p-2 -mr-2 rounded hover:bg-white/10 active:scale-95 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})})]})]}),je&&t.jsxs("div",{className:`flex gap-4 p-3 overflow-x-auto no-scrollbar border-b ${_.border} bg-black/20 backdrop-blur-sm z-10 shrink-0 animate-slide-down`,children:[t.jsxs("div",{className:"relative group shrink-0",children:[t.jsx("img",{src:n.avatar,className:"w-10 h-10 rounded-full border-2 border-white/20 object-cover shadow-sm"}),t.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-black/60 text-white text-[8px] px-1.5 rounded-full backdrop-blur-sm whitespace-nowrap",children:"YOU"})]}),ee.map(E=>t.jsxs("div",{className:"relative group shrink-0 cursor-pointer active:scale-95 transition-transform",children:[t.jsx("img",{src:E.avatar,className:"w-10 h-10 rounded-full border-2 border-white/20 object-cover shadow-sm group-hover:border-white/50 transition-colors"}),t.jsx("div",{className:"absolute inset-0 rounded-full ring-2 ring-transparent group-hover:ring-green-400/50 transition-all"}),t.jsx("div",{className:"absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-black/50 shadow-sm animate-pulse"})]},E.id))]}),t.jsxs("div",{className:`px-4 py-2 border-b ${_.border} bg-black/10 backdrop-blur-sm z-10 grid grid-cols-3 gap-2 shrink-0`,children:[t.jsxs("div",{className:"flex flex-col items-center bg-red-500/20 rounded p-1 border border-red-500/30",children:[t.jsx("span",{className:"text-[8px] text-red-300 font-bold uppercase",children:"HP ()"}),t.jsx("span",{className:"text-xs font-mono font-bold text-red-100",children:f.status.health||100})]}),t.jsxs("div",{className:"flex flex-col items-center bg-blue-500/20 rounded p-1 border border-blue-500/30",children:[t.jsx("span",{className:"text-[8px] text-blue-300 font-bold uppercase",children:"SAN ()"}),t.jsx("span",{className:"text-xs font-mono font-bold text-blue-100",children:f.status.sanity||100})]}),t.jsxs("div",{className:"flex flex-col items-center bg-yellow-500/20 rounded p-1 border border-yellow-500/30",children:[t.jsx("span",{className:"text-[8px] text-yellow-300 font-bold uppercase",children:"GOLD ()"}),t.jsx("span",{className:"text-xs font-mono font-bold text-yellow-100",children:f.status.gold||0})]})]}),t.jsxs("div",{ref:G,className:"flex-1 overflow-y-auto p-4 space-y-6 no-scrollbar relative animate-fade-in",children:[f.logs.map((E,K)=>{const ke=E.role==="gm",J=E.role==="system",ae=E.role==="character",V=ae?ee.find(Q=>Q.name===E.speakerName):null;return J?t.jsxs("div",{className:"flex flex-col items-center my-4 animate-fade-in gap-1 group",children:[t.jsx("span",{className:"text-[10px] opacity-50 border-b border-dashed border-current pb-0.5 font-mono",children:E.content}),t.jsx("button",{onClick:()=>re(K),className:"text-[9px] text-red-400 opacity-0 group-hover:opacity-100 transition-opacity hover:underline",children:""})]},E.id||K):ke?t.jsxs("div",{className:"animate-fade-in my-4 group relative",children:[t.jsxs("div",{className:`p-5 rounded-lg border-2 ${_.border} ${_.cardBg} shadow-sm relative mx-auto w-full text-sm`,children:[t.jsx("div",{className:"absolute -top-3 left-4 bg-inherit px-2 text-[10px] font-bold uppercase tracking-widest opacity-80 border border-inherit rounded",children:"Game Master"}),t.jsx(Iu,{content:E.content,theme:_,customStyle:ge})]}),t.jsx("button",{onClick:()=>re(K),className:"absolute top-2 right-2 text-[9px] bg-red-900/50 text-red-200 px-2 py-0.5 rounded opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-800",children:"Rollback"})]},E.id||K):ae&&V?t.jsxs("div",{className:"flex gap-3 animate-slide-up group relative",children:[t.jsx("img",{src:V.avatar,className:`w-10 h-10 rounded-full object-cover border ${_.border} shrink-0 mt-1`}),t.jsxs("div",{className:"flex flex-col max-w-[85%]",children:[t.jsx("span",{className:"text-[10px] font-bold opacity-60 mb-1 ml-1",children:V.name}),t.jsx("div",{className:`px-4 py-2 rounded-2xl rounded-tl-none text-sm ${_.cardBg} border ${_.border} shadow-sm relative`,children:t.jsx(Iu,{content:E.content,theme:_,customStyle:ge})}),t.jsx("button",{onClick:()=>re(K),className:"self-start mt-1 text-[9px] text-red-400 opacity-0 group-hover:opacity-100 transition-opacity hover:underline",children:""})]})]},E.id||K):t.jsxs("div",{className:"flex flex-col items-end animate-slide-up group relative",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"text-[10px] font-bold opacity-60",children:E.speakerName}),E.diceRoll&&t.jsxs("span",{className:"text-[10px] bg-white/20 px-1.5 rounded text-yellow-500 font-mono",children:[" ",E.diceRoll.result]})]}),t.jsx("div",{className:"px-4 py-2 rounded-2xl rounded-tr-none text-sm bg-orange-600 text-white shadow-md max-w-[85%]",children:E.content}),t.jsx("button",{onClick:()=>re(K),className:"mt-1 text-[9px] text-red-400 opacity-0 group-hover:opacity-100 transition-opacity hover:underline",children:""})]},E.id||K)}),j&&t.jsx("div",{className:"text-xs opacity-50 animate-pulse pl-2 font-mono",children:"GM ..."})]}),t.jsxs("div",{className:`p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] border-t ${_.border} bg-opacity-90 backdrop-blur shrink-0 z-20 transition-colors duration-500`,children:[f.suggestedActions&&f.suggestedActions.length>0&&!j&&t.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto no-scrollbar pb-1",children:f.suggestedActions.map((E,K)=>{let ke=_.optionNormal;return E.type==="chaotic"&&(ke=_.optionChaotic),E.type==="evil"&&(ke=_.optionEvil),t.jsxs("button",{onClick:()=>A(E.label),className:`flex-1 min-w-[100px] text-[10px] p-2 rounded-lg border ${ke} hover:opacity-80 active:scale-95 transition-all text-left leading-tight shadow-sm`,children:[t.jsx("span",{className:"block font-bold opacity-70 uppercase text-[8px] mb-0.5 tracking-wider",children:E.type}),E.label]},K)})}),pe&&t.jsxs("div",{className:"flex gap-2 mb-3 animate-fade-in",children:[t.jsxs("button",{onClick:xe,disabled:Me,className:`flex-1 py-2 rounded border ${_.border} hover:bg-white/10 active:scale-95 transition-transform flex items-center justify-center gap-2 font-bold text-sm`,children:[t.jsx("span",{className:"text-xl",children:""})," ",Me?"Rolling...":te||"Roll D20"]}),["","",""].map(E=>t.jsx("button",{onClick:()=>A(E),className:`px-4 py-2 rounded border ${_.border} hover:bg-white/10 text-xs font-bold transition-colors active:scale-95`,children:E},E))]}),t.jsxs("div",{className:"flex gap-2 items-end",children:[t.jsx("button",{onClick:()=>Ce(!pe),className:`p-3 h-12 rounded-xl border ${_.border} hover:bg-white/10 active:scale-95 transition-transform flex items-center justify-center ${pe?"bg-white/20":""}`,children:t.jsx("span",{className:"text-lg",children:""})}),!j&&f.logs.length>0&&t.jsx("button",{onClick:le,className:`p-3 h-12 rounded-xl border ${_.border} hover:bg-white/10 active:scale-95 transition-transform flex items-center justify-center`,title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 opacity-70",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("textarea",{value:k,onChange:E=>M(E.target.value),placeholder:"...",className:`flex-1 bg-black/20 border ${_.border} rounded-xl px-3 py-3 outline-none text-sm placeholder-opacity-30 placeholder-current resize-none h-12 leading-tight focus:bg-black/40 transition-colors`}),t.jsx("button",{onClick:()=>A(k),className:`${_.accent} font-bold text-sm px-4 h-12 bg-white/10 rounded-xl hover:bg-white/20 active:scale-95 transition-all flex items-center justify-center`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})})})]})]}),t.jsx(Ze,{isOpen:Ee,title:"",onClose:()=>P(!1),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-slate-100 p-3 rounded-xl",children:[t.jsx("label",{className:"text-xs text-slate-500 font-bold mb-3 block border-b border-slate-200 pb-1",children:" (Display)"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-xs text-slate-400 w-8",children:""}),t.jsx("input",{type:"range",min:"12",max:"24",step:"1",value:ge.fontSize,onChange:E=>ce({...ge,fontSize:parseInt(E.target.value)}),className:"flex-1 h-1.5 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-orange-500"}),t.jsx("span",{className:"text-xs font-mono text-slate-600 w-6 text-right",children:ge.fontSize})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-xs text-slate-400 w-8",children:""}),t.jsx("input",{type:"color",value:ge.color||"#e5e5e5",onChange:E=>ce({...ge,color:E.target.value}),className:"w-full h-8 rounded cursor-pointer bg-white border border-slate-200 p-0.5"})]}),t.jsx("button",{onClick:()=>ce({fontSize:14,color:""}),className:"w-full py-1.5 bg-white border border-slate-200 text-slate-500 text-xs rounded-lg active:scale-95 transition-transform",children:""})]})]}),t.jsxs("button",{onClick:De,className:"w-full py-3 bg-emerald-500 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[t.jsx("span",{children:""})," "]}),t.jsxs("button",{onClick:$e,className:"w-full py-3 bg-orange-500 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[t.jsx("span",{children:""})," "]}),t.jsxs("button",{onClick:Re,className:"w-full py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl flex items-center justify-center gap-2",children:[t.jsx("span",{children:""}),"  ()"]})]})}),Z&&t.jsxs("div",{className:"absolute inset-0 bg-black/80 z-50 flex items-center justify-center text-white flex-col gap-4 animate-fade-in",children:[t.jsx("div",{className:"w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-xs tracking-widest font-mono",children:"..."})]})]})},Rx=()=>{const{closeApp:e,worldbooks:s,addWorldbook:n,updateWorldbook:r,deleteWorldbook:a,addToast:l}=xt(),[o,i]=u.useState(!1),[c,d]=u.useState(null),[f,h]=u.useState(null),[p,m]=u.useState(null),[x,y]=u.useState(""),[C,g]=u.useState(""),[b,v]=u.useState(""),[w,z]=u.useState(!1),k=u.useMemo(()=>{const F={},se=" (General)";return s.forEach(G=>{const Ee=G.category||se;F[Ee]||(F[Ee]=[]),F[Ee].push(G)}),!f&&Object.keys(F).length>0,F},[s]),M=()=>{d(null),y(""),g(""),v(""),i(!0)},j=F=>{d(F),y(F.title),g(F.content),v(F.category||""),i(!0)},H=async()=>{if(!x.trim()){l("","error");return}const F=b.trim()||" (General)";if(c)await r(c.id,{title:x,content:C,category:F}),l(" ()","success");else{const se={id:`wb-${Date.now()}`,title:x,content:C,category:F,createdAt:Date.now(),updatedAt:Date.now()};n(se),l("","success")}i(!1)},te=(F,se)=>{F.stopPropagation(),d(se),z(!0)},Ne=()=>{c&&(a(c.id),z(!1),d(null),i(!1))},Me=F=>{h(f===F?null:F)},me=F=>{m(p===F?null:F)};return o?t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans animate-fade-in",children:[t.jsxs("div",{className:"h-16 flex items-center justify-between px-4 bg-white/80 backdrop-blur-md border-b border-slate-200 shrink-0 z-20",children:[t.jsx("button",{onClick:()=>i(!1),className:"px-3 py-1 text-slate-500 font-bold text-sm",children:""}),t.jsx("span",{className:"font-bold text-slate-800",children:c?"":""}),t.jsx("button",{onClick:H,className:"px-4 py-1.5 bg-indigo-500 text-white rounded-full text-xs font-bold shadow-md active:scale-95 transition-transform",children:""})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block tracking-wider",children:" (Title)"}),t.jsx("input",{value:x,onChange:F=>y(F.target.value),placeholder:": ...",className:"w-full text-lg font-bold text-slate-800 bg-white border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block tracking-wider",children:" (Group)"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{value:b,onChange:F=>v(F.target.value),placeholder:": ...",className:"w-full text-sm text-slate-700 bg-white border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all",list:"category-suggestions"}),t.jsx("datalist",{id:"category-suggestions",children:Object.keys(k).map(F=>t.jsx("option",{value:F},F))})]}),t.jsx("p",{className:"text-[10px] text-slate-400 mt-1 pl-1",children:""})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block tracking-wider",children:" (Content)"}),t.jsx("textarea",{value:C,onChange:F=>g(F.target.value),placeholder:" Markdown ...",className:"w-full h-80 bg-white border border-slate-200 rounded-xl p-4 text-sm text-slate-700 leading-relaxed resize-none outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all font-mono"})]})]})})]}):t.jsxs("div",{className:"h-full w-full relative overflow-hidden font-sans bg-slate-100",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50 via-slate-100 to-violet-50 pointer-events-none"}),t.jsx("div",{className:"absolute -top-20 -right-20 w-64 h-64 bg-indigo-200/20 rounded-full blur-3xl pointer-events-none"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-white/80 to-transparent pointer-events-none z-10"}),t.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-xl flex items-end pb-3 px-6 border-b border-white/40 shrink-0 sticky top-0 z-20 shadow-sm",children:t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsx("button",{onClick:e,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("span",{className:"font-bold text-slate-700 text-lg tracking-wide flex items-center gap-2",children:[t.jsx("span",{className:"text-indigo-500",children:""})," "]}),t.jsx("button",{onClick:M,className:"w-9 h-9 bg-indigo-500 text-white rounded-full shadow-lg shadow-indigo-200 flex items-center justify-center active:scale-90 transition-transform hover:bg-indigo-600",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-24 space-y-4 no-scrollbar relative z-0",children:[Object.keys(k).length===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 opacity-60",children:[t.jsx("span",{className:"text-5xl",children:""}),t.jsx("span",{className:"text-xs font-medium",children:"..."})]}),Object.entries(k).map(([F,se])=>t.jsxs("div",{className:"animate-slide-up",children:[t.jsxs("div",{onClick:()=>Me(F),className:"flex items-center gap-2 py-2 px-1 cursor-pointer select-none group",children:[t.jsx("div",{className:`transition-transform duration-300 ${f===F?"rotate-90":""}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4 text-slate-400 group-hover:text-indigo-500",children:t.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})}),t.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider group-hover:text-indigo-600 transition-colors",children:F}),t.jsx("span",{className:"text-[9px] bg-white/50 px-1.5 rounded text-slate-400 border border-white/50",children:se.length})]}),t.jsx("div",{className:`space-y-3 pl-2 transition-all duration-300 overflow-hidden ${f===F?"max-h-[1000px] opacity-100 mt-2":"max-h-0 opacity-0"}`,children:se.map(G=>t.jsxs("div",{className:"bg-white/60 backdrop-blur-md rounded-2xl border border-white/60 shadow-sm hover:shadow-md transition-all group relative overflow-hidden",children:[t.jsxs("div",{onClick:()=>me(G.id),className:"p-4 cursor-pointer flex justify-between items-start",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${p===G.id?"bg-indigo-400":"bg-slate-300"}`}),t.jsx("h4",{className:`text-sm font-bold truncate transition-colors ${p===G.id?"text-indigo-700":"text-slate-700"}`,children:G.title})]}),t.jsxs("div",{className:"text-[10px] text-slate-400 font-mono pl-3.5",children:["Updated: ",new Date(G.updatedAt).toLocaleDateString()]})]}),t.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:Ee=>{Ee.stopPropagation(),j(G)},className:"p-2 rounded-full hover:bg-white text-slate-400 hover:text-indigo-600 transition-colors",title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})}),t.jsx("button",{onClick:Ee=>te(Ee,G),className:"p-2 rounded-full hover:bg-red-50 text-slate-300 hover:text-red-500 transition-colors",title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})]})]}),p===G.id&&t.jsxs("div",{className:"px-4 pb-4 pt-0 animate-fade-in",children:[t.jsx("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-slate-200 to-transparent mb-3"}),t.jsx("p",{className:"text-xs text-slate-600 leading-relaxed whitespace-pre-wrap font-light select-text",children:G.content||t.jsx("span",{className:"italic text-slate-400",children:"..."})})]})]},G.id))})]},F))]}),t.jsx(Ze,{isOpen:w,title:"",onClose:()=>z(!1),footer:t.jsxs("div",{className:"flex gap-3 w-full",children:[t.jsx("button",{onClick:()=>z(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl active:scale-95 transition-transform",children:""}),t.jsx("button",{onClick:Ne,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200 active:scale-95 transition-transform",children:""})]}),children:t.jsxs("div",{className:"text-center py-4 text-sm text-slate-600 flex flex-col items-center gap-3",children:[t.jsx("div",{className:"w-12 h-12 bg-red-50 rounded-full flex items-center justify-center text-red-500 mb-1",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})}),t.jsxs("div",{children:[" ",t.jsxs("span",{className:"font-bold text-slate-900",children:['"',c==null?void 0:c.title,'"']})," ",t.jsx("br",{}),t.jsx("span",{className:"text-xs text-red-400 opacity-80 mt-1 block",children:""})]})]})})]})},tc=({isOpen:e,title:s,message:n,confirmText:r="",cancelText:a="",variant:l="info",onConfirm:o,onCancel:i})=>{if(!e)return null;const c=()=>{switch(l){case"danger":return"bg-red-500 hover:bg-red-600 text-white shadow-red-200";case"warning":return"bg-orange-500 hover:bg-orange-600 text-white shadow-orange-200";default:return"bg-indigo-500 hover:bg-indigo-600 text-white shadow-indigo-200"}},d=()=>{switch(l){case"danger":return t.jsx("div",{className:"w-10 h-10 rounded-full bg-red-50 text-red-500 flex items-center justify-center shrink-0",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})})});case"warning":return t.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-50 text-orange-500 flex items-center justify-center shrink-0",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"})})});default:return t.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center shrink-0",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})})}};return t.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in",style:{zIndex:9999},children:[t.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-opacity",onClick:i}),t.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-pop-in transform transition-all",children:[t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"flex gap-4",children:[d(),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-lg font-bold text-slate-800 leading-6 mb-2",children:s}),t.jsx("p",{className:"text-sm text-slate-500 leading-relaxed",children:n})]})]})}),t.jsxs("div",{className:"bg-slate-50 px-6 py-4 flex gap-3 justify-end border-t border-slate-100",children:[t.jsx("button",{onClick:i,className:"px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition-colors",children:a}),t.jsx("button",{onClick:o,className:`px-4 py-2 rounded-xl text-sm font-bold shadow-lg transition-transform active:scale-95 ${c()}`,children:r})]})]})]})},Ar=[{id:"sakura",name:" (Sakura)",bg:"bg-pink-50",paper:"bg-[#fff5f7]",text:"text-slate-700",accent:"text-pink-500",button:"bg-pink-400",activeTab:"bg-pink-500 text-white"},{id:"parchment",name:" (Vintage)",bg:"bg-[#f5e6d3]",paper:"bg-[#fdf6e3]",text:"text-[#433422]",accent:"text-[#8c6b48]",button:"bg-[#b58900]",activeTab:"bg-[#b58900] text-white"},{id:"kraft",name:" (Kraft)",bg:"bg-[#d7ccc8]",paper:"bg-[#e7e0d8]",text:"text-[#3e2723]",accent:"text-[#5d4037]",button:"bg-[#5d4037]",activeTab:"bg-[#5d4037] text-white"},{id:"midnight",name:" (Midnight)",bg:"bg-[#0f172a]",paper:"bg-[#1e293b]",text:"text-slate-300",accent:"text-blue-400",button:"bg-blue-600",activeTab:"bg-blue-600 text-white"},{id:"matcha",name:" (Matcha)",bg:"bg-[#ecfccb]",paper:"bg-[#f7fee7]",text:"text-emerald-800",accent:"text-emerald-600",button:"bg-emerald-500",activeTab:"bg-emerald-500 text-white"}],Dx=e=>{var i,c,d,f,h;if(!e)return[""];const s=new Set,n=((e.description||"")+(e.worldview||"")).toLowerCase();if(e.impression){const p=((i=e.impression.personality_core)==null?void 0:i.observed_traits)||[],m=((c=e.impression.mbti_analysis)==null?void 0:c.type)||"",x=((d=e.impression.value_map)==null?void 0:d.likes)||[],y=((f=e.impression.value_map)==null?void 0:f.dislikes)||[];m.includes("N")?(s.add(""),s.add("")):m.includes("S")&&(s.add(""),s.add("")),m.includes("T")?(s.add(""),s.add("")):m.includes("F")&&(s.add(""),s.add("")),m.includes("J")?(s.add(""),s.add("")):m.includes("P")&&(s.add(""),s.add(""));const C={:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""]};p.forEach(g=>{Object.entries(C).forEach(([b,v])=>{g.includes(b)&&v.forEach(w=>s.add(w))})}),x.some(g=>g.includes("")||g.includes(""))&&s.add(""),y.some(g=>g.includes(""))&&s.add("")}if(Object.entries({:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""]}).forEach(([p,m])=>{n.includes(p)&&m.forEach(x=>s.add(x))}),e.writerPersona){const p=e.writerPersona;p.includes("")&&s.add(""),p.includes("")&&s.add(""),p.includes("")&&s.add(""),p.includes("")&&s.add(""),p.includes("")&&s.add(""),p.includes("")&&s.add(""),p.includes("")&&s.add(""),p.includes("")&&s.add("")}let a=Array.from(s);if(a.length===0){const p=["","","","",""],m=(((h=e.name)==null?void 0:h.charCodeAt(0))||0)%p.length;a=[p[m],p[(m+2)%p.length]]}const l=p=>{let m=0;for(let x=0;x<p.length;x++)m=(m<<5)-m+p.charCodeAt(x),m|=0;return m},o=l(e.name||"default");return a.sort((p,m)=>{const x=l(p+o.toString()),y=l(m+o.toString());return x-y}).slice(0,5)},po=e=>{var f,h,p,m;if(!e)return"";const s=((f=e.impression)==null?void 0:f.personality_core.observed_traits)||[],n=((p=(h=e.impression)==null?void 0:h.mbti_analysis)==null?void 0:p.type)||"",r=e.description||"",a={:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:'""',rhythm:"",taboo:""},:{focus:"",style:'""',rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:'""',rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""}};let l=s.find(x=>a[x])||(s.length>0?s[0]:"");a[l]||(l.includes("")?l="":l.includes("")||l.includes("")?l="":l.includes("")||l.includes("")?l="":l="");let o=a[l]||a.,c={INTJ:"",INTP:"",ENTJ:"",ENTP:"",INFJ:"",INFP:"",ENFJ:"",ENFP:"",ISTJ:"",ISFJ:"",ESTJ:"",ESFJ:"",ISTP:"",ISFP:"",ESTP:"",ESFP:""}[n]||"",d=`
### ${e.name}  (Simple)
****: ${l}
****: ${o.focus}${c}
****: ${o.style}
****: ${o.rhythm}
****: ${((m=e.impression)==null?void 0:m.value_map.likes.join(""))||""}
****: ${o.taboo}
`;return(r.includes("")||r.includes("")||s.includes(""))&&(d+=`
###  

1. 
2. """"""
3. ""
4. ""

`),d},Ox=e=>{var a,l,o;const s=((a=e.impression)==null?void 0:a.personality_core.observed_traits)||[],n=((l=e.impression)==null?void 0:l.value_map.dislikes)||[];let r=`## ${e.name} 
`;return s.some(i=>i.includes("")||i.includes("")||i.includes(""))?r+=`
-  2""
-  
-  
- 3
`:s.some(i=>i.includes("")||i.includes(""))?r+=`
-  1
-  
-  
- 
`:s.some(i=>i.includes("")||i.includes(""))?r+=`
-  3
-  ""
- 
`:s.some(i=>i.includes(""))?r+=`
-  ""
-  
- ""
`:r+=`
-  
-  
- 
`,n.length>0&&(r+=`
### 
`,n.forEach(i=>{r+=`- "${i}"
`})),((o=e.description)!=null&&o.includes("")||s.includes(""))&&(r+=`
###  
`,r+=`- 3
`,r+=`- """"""
`,r+=`- ""
`,r+=`- 
`),r},zx=async(e,s,n,r,a=!1)=>{var o,i,c,d,f,h,p;if(!e)return"Error: No Character";if(!a&&e.writerPersona&&e.writerPersonaGeneratedAt&&Date.now()-e.writerPersonaGeneratedAt<7*24*60*60*1e3)return e.writerPersona;const l=`/

**/**

---

### 

****: ${e.name}

****: 
${e.description||""}

****: 
${e.worldview||""}

****: 
${((o=e.impression)==null?void 0:o.personality_core.observed_traits.join(""))||""}

**MBTI**: 
${((c=(i=e.impression)==null?void 0:i.mbti_analysis)==null?void 0:c.type)||""}

****:
- /: ${((d=e.impression)==null?void 0:d.value_map.likes.join(""))||""}
- /: ${((f=e.impression)==null?void 0:f.value_map.dislikes.join(""))||""}

**/**:
${((h=e.impression)==null?void 0:h.behavior_profile.response_patterns)||"- "}

****:
${((p=e.memories)==null?void 0:p.slice(-3).map(m=>`- ${m.summary}`).join(`
`))||"- "}

---

### 
()
****: ${s.name}
****: ${s.bio||""}

---

### 

**8**

#### 1.  (Skill Level)
/
- 
- 
- 
- 

#### 2.  (Language)
//
- ""
- 
- 
- 

#### 3.  (Technique)
/
- 
- 
- 

#### 4.  (Focus)
/
- 
- 
- 
- 

#### 5.  (Preference)
/
- /
- 

#### 6.  (Character View)
/Fictional Protagonist
()
- 
- 

#### 7.  (Plot Opinion)
/
- 
- 
- 

#### 8.  (Collaboration Style)
/
- 
- ""
- 
- ()

---

****, markdown

: (///) - 

: (///) - 

: (//) - 

: (///) - 

: (3) | : (3)

: (/)

: (30)

: ()

: (3-5"")

---

****400-600`;try{const m=await fetch(`${n.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify({model:n.model,messages:[{role:"user",content:l}],temperature:.7,max_tokens:8e3})});if(m.ok){const y=(await m.json()).choices[0].message.content.trim(),C=`
### ${e.name} AI

${y}

---
*: ${new Date().toLocaleDateString("zh-CN")}*
`.trim();return r(e.id,{writerPersona:C,writerPersonaGeneratedAt:Date.now()}),C}else throw new Error(`API Error: ${m.status}`)}catch(m){return console.error("Deep analysis failed:",m),po(e)}},Bx=e=>{var a;let n=(((a=e.impression)==null?void 0:a.personality_core.observed_traits)||[]).find(l=>["","","","","","","",""].some(o=>l.includes(o)))||"";n.includes("")&&(n=""),(n.includes("")||n.includes(""))&&(n=""),(n.includes("")||n.includes(""))&&(n="");const r={:`
**AI**
"120"

**${e.name}**
""

`,:`
**+**
"815%"

**${e.name}**
""

`,:`
**+**
"70"

**${e.name}**
"'''...'"

`,:`
****
"342.723.52.3"

**${e.name}**
""

`};return r[n]||r.},Wx=(e,s,n,r,a,l,o,i)=>{var g,b;const c=Et.buildCoreContext(e,s,!0),d=e.writerPersona||po(e),f=Bx(e),h=Ox(e),p=(n==null?void 0:n.protagonists.map(v=>`- ${v.name} (${v.role}): ${v.description}`).join(`
`))||"",m=`
${n==null?void 0:n.title}
${n==null?void 0:n.worldSetting}

${p}
`,x=`
${c}

#  (Co-Writing Mode)
 **${s.name}** () 
${n==null?void 0:n.title}

****
1. ${s.name}${((g=e.impression)==null?void 0:g.personality_core.summary)||""}
2. 
3. AI/

# 
 **${e.name}**
${n==null?void 0:n.title}

---

#   (Anti-Clich Protocol)

## 
1. **${e.name}**
   - "AI"
   - """"
   
2. ****
   ${h}

3. **AI**
   -  "//"  
   -  ""  
   -  "XXX"  
   -  "..."  2024
   -    
   -  ****  "83""12"

4. ** **
   -  "3""5"
   -  "5"
   -  
   -  "37%"
   -  "127"

---

# 
${d}

#  (Do vs Don't)
${f}

---

# 
${a}

${m}

---

# 
${r||"[]"}

---
`;let y=`### []
JSON
`,C=[];if(l.analyze&&(y+=`
1. ****: ${e.name}
   - ${e.name}
   - 
`,C.push('"analysis": { "reaction": "", "focus": "", "critique": "" }')),l.write&&(y+=`
2. ****: 
   - : 
   - : 
   - : 400-800
`,C.push('"writer": { "content": "", "technique": "", "mood": "" }')),l.comment){const v=o.slice(-5).filter(w=>w.authorId!=="user"&&w.authorId!==e.id&&(w.role==="writer"||w.type==="story")).map(w=>{const z=i.find(k=>k.id===w.authorId);return{name:(z==null?void 0:z.name)||"Unknown",content:w.content.substring(0,100)}});y+=`
3. **/ ()**: 
   
   
   ${v.length>0?`
   ****
   ${v.map(w=>`- ${w.name}${w.content}`).join(`
`)}
   
   ${e.name}
   - 
   - ${e.description}
   - 
   `:""}
   
   ${(b=e.description)!=null&&b.includes("")?'""':""}
`,C.push('"comment": { "content": "" }')}return`${x}

${y}

###  (Strict JSON, No Markdown)
{
  ${C.join(`,
  `)},
  "meta": { "tone": "", "suggestion": "" }
}
`},Ux=e=>{const s=e.split(`
`),n={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},r=o=>{for(const[i,c]of Object.entries(n))if(o.includes(i))return c;return""},a=[];let l=null;return s.forEach(o=>{var d;const i=o.trim();if(!i)return;const c=i.match(/^###\s*(.+)/)||i.match(/^\*\*([^*]+)\*\*\s*[:]\s*(.*)/)||i.match(/^([^-\d][^:]{1,15})[:]\s*(.*)/);if(c){l&&l.content.length>0&&a.push(l);const f=(c[1]||"").replace(/\*\*/g,"").trim();l={title:f,icon:r(f),content:[]};const h=(d=c[2])==null?void 0:d.trim();h&&l.content.push(h)}else if(l){const f=i.replace(/^\*\*|\*\*$/g,"").replace(/^[-]\s*/,"");f&&l.content.push(f)}}),l&&l.content.length>0&&a.push(l),a},Fx=({char:e,userProfile:s,targetCharId:n,isTyping:r,setIsTyping:a,setConfirmDialog:l,addToast:o,apiConfig:i,updateCharacter:c})=>{const d=e.writerPersona||po(e),f=Ux(d);return t.jsxs("div",{className:"bg-gradient-to-b from-slate-50 to-white border-b border-black/5 overflow-hidden",children:[t.jsx("div",{className:"max-h-[45vh] overflow-y-auto p-4 space-y-3 overscroll-contain",children:f.length===0?t.jsxs("div",{className:"text-center py-8 text-slate-400 text-sm",children:["",t.jsx("br",{}),t.jsx("span",{className:"text-xs",children:""})]}):f.map((h,p)=>t.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-slate-100 shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-100",children:[t.jsx("span",{className:"text-base",children:h.icon}),t.jsx("h4",{className:"text-sm font-bold text-slate-800",children:h.title})]}),t.jsx("div",{className:"space-y-1.5",children:h.content.map((m,x)=>t.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:m},x))})]},p))}),t.jsx("div",{className:"px-4 py-3 border-t border-slate-100 bg-white/80",children:t.jsx("button",{onClick:async()=>{n&&l({isOpen:!0,title:"",message:" Token",variant:"info",confirmText:"",onConfirm:async()=>{l(null),o("...","info"),a(!0);try{await zx(e,s,i,c,!0),o("","success")}catch{o("","error")}finally{a(!1)}}})},disabled:r,className:"w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 shadow-sm disabled:opacity-50",children:r?t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):t.jsx(t.Fragment,{children:" "})})})]})},Hx=({activeBook:e,updateNovel:s,characters:n,userProfile:r,apiConfig:a,onBack:l,updateCharacter:o,collaborators:i,targetCharId:c,setTargetCharId:d,onOpenSettings:f})=>{const{addToast:h}=xt(),p=u.useMemo(()=>Ar.find(_=>_.id===e.coverStyle)||Ar[0],[e.coverStyle]),[m,x]=u.useState({write:!0,comment:!1,analyze:!1}),[y,C]=u.useState(""),[g,b]=u.useState(!1),[v,w]=u.useState(e.segments),[z,k]=u.useState(null),[M,j]=u.useState(!1),[H,te]=u.useState(!1),[Ne,Me]=u.useState(null),[me,F]=u.useState(""),[se,G]=u.useState(null),[Ee,P]=u.useState(!1),[Z,X]=u.useState(""),[pe,Ce]=u.useState(!1),[je,Pe]=u.useState(!1),ge=u.useRef(null);u.useEffect(()=>{w(e.segments)},[e.segments]),u.useEffect(()=>{ge.current&&!H&&(ge.current.scrollTop=ge.current.scrollHeight)},[v,g,H]);const ce=u.useMemo(()=>v.filter(_=>_.focus==="chapter_summary").length+1,[v]),N=n.find(_=>_.id===c),ne=v.length>0&&v[v.length-1].authorId!=="user",we=u.useMemo(()=>{let _=-1;for(let ee=v.length-1;ee>=0;ee--)if(v[ee].focus==="chapter_summary"){_=ee;break}return v.slice(_+1)},[v]),D=u.useMemo(()=>v.filter(_=>_.focus==="chapter_summary"),[v]),xe=async(_,ee,E)=>{var K,ke;b(!0),k(null);try{const J=E.filter(U=>U.focus==="chapter_summary");let ae=0;if(J.length>0){const U=J[J.length-1];ae=E.findIndex(S=>S.id===U.id)+1}const V=E.slice(ae).filter(U=>U.role==="writer"||U.type==="story");let Q="";J.length>0?(Q+=` / Chapter Recaps
`,J.forEach((U,S)=>Q+=`
${S+1}
${U.content}
`),Q+=`
---

 / Current Chapter
`):Q+=` / Current Chapter
`,V.forEach(U=>{var T;const S=U.authorId==="user"?r.name:((T=n.find(ve=>ve.id===U.authorId))==null?void 0:T.name)||"AI";Q+=`
[${S}]: ${U.content.substring(0,500)}
`});const ye=Wx(_,r,e,ee,Q,m,E,n),be=((K=_.impression)==null?void 0:K.personality_core.observed_traits)||[];let B=.85;be.some(U=>U.includes("")||U.includes(""))&&(B=.98),be.some(U=>U.includes("")||U.includes("")||U.includes(""))&&(B=.6);const $=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:ye}],temperature:B,max_tokens:8e3})});if($.ok){const U=await $.json();(ke=U.usage)!=null&&ke.total_tokens&&k(U.usage.total_tokens);let S=U.choices[0].message.content.trim();const T=S;S=S.replace(/```json\n?/g,"").replace(/```\n?/g,"");const ve=S.match(/\{[\s\S]*\}/);ve&&(S=ve[0]);let de;try{de=JSON.parse(S)}catch{de={writer:{content:T}}}const I=[],oe=Date.now();de.analysis&&(de.analysis.critique||de.analysis.reaction)&&I.push({id:`seg-${oe}-a`,role:"analyst",type:"analysis",authorId:_.id,content:de.analysis.critique||JSON.stringify(de.analysis),focus:de.analysis.focus,meta:{reaction:de.analysis.reaction},timestamp:oe+1}),de.writer&&de.writer.content&&I.push({id:`seg-${oe}-w`,role:"writer",type:"story",authorId:_.id,content:de.writer.content,meta:{...de.meta||{},technique:de.writer.technique,mood:de.writer.mood},timestamp:oe+2}),de.comment&&de.comment.content&&I.push({id:`seg-${oe}-c`,role:"commenter",type:"discussion",authorId:_.id,content:de.comment.content,timestamp:oe+3}),w(Ie=>{const Le=[...Ie,...I];return s(e.id,{segments:Le}),Le})}else throw new Error(`API Error: ${$.status}`)}catch(J){h(": "+J.message,"error")}finally{b(!1)}},A=async()=>{if(!c){h("","error");return}const _=n.find(K=>K.id===c);if(!_)return;let ee=v;if(y.trim()){const K={id:`seg-${Date.now()}`,role:"writer",type:"story",authorId:"user",content:y,timestamp:Date.now()};ee=[...v,K],w(ee),s(e.id,{segments:ee})}const E=y;C(""),await xe(_,E,ee)},le=async()=>{if(!c)return;const _=n.find(K=>K.id===c);if(!_)return;let ee=[...v],E=0;for(;ee.length>0&&ee[ee.length-1].authorId!=="user";)ee.pop(),E++;if(E===0){h(" AI ","info");return}w(ee),s(e.id,{segments:ee}),h("...","info"),await xe(_,"",ee)},re=_=>{Me(_),F(_.content),te(!0)},$e=()=>{if(!Ne)return;const _=v.map(ee=>ee.id===Ne.id?{...ee,content:me}:ee);w(_),s(e.id,{segments:_}),te(!1),Me(null)},Re=_=>{G({isOpen:!0,title:"",message:"",variant:"danger",onConfirm:()=>{const ee=v.filter(E=>E.id!==_);w(ee),s(e.id,{segments:ee}),G(null)}})},De=async()=>{Ce(!0),P(!0),X("...");try{let _=0,ee=-1;for(let ae=v.length-1;ae>=0;ae--)if(v[ae].focus==="chapter_summary"){ee=ae;break}ee!==-1&&(_=ee+1);const K=v.slice(_).filter(ae=>ae.type==="story"||ae.role==="writer").map(ae=>ae.content).join(`

`);if(!K.trim()){X(""),Ce(!1);return}const ke=`### Task: Chapter Summary
Novel: "${e.title}"
Content:
${K.substring(0,2e5)}

Generate a structured summary.`,J=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:ke}]})});if(J.ok){const ae=await J.json();X(ae.choices[0].message.content)}else X("")}catch(_){X(`: ${_.message}`)}finally{Ce(!1)}},Ke=async()=>{const _={id:`seg-summary-${Date.now()}`,role:"analyst",type:"analysis",authorId:"system",content:Z,focus:"chapter_summary",timestamp:Date.now(),meta:{reaction:"",suggestion:""}},ee=[...v,_];w(ee),await s(e.id,{segments:ee});const E=new Date().toISOString().split("T")[0],K=ee.filter(J=>J.focus==="chapter_summary").length,ke=i.map(J=>J.name).join("");for(const J of e.collaboratorIds){const ae=n.find(V=>V.id===J);if(ae){const V={id:`mem-${Date.now()}-${Math.random()}`,date:E,summary:`${ke}${e.title}${K}`,mood:"creative"};o(ae.id,{memories:[...ae.memories||[],V]})}}P(!1),X(""),h("","success")};return t.jsxs("div",{className:`h-full w-full flex flex-col font-serif ${p.bg} transition-colors duration-500 relative`,children:[t.jsx(tc,{isOpen:!!se,title:(se==null?void 0:se.title)||"",message:(se==null?void 0:se.message)||"",variant:se==null?void 0:se.variant,confirmText:(se==null?void 0:se.confirmText)||(se!=null&&se.onConfirm?"":"OK"),onConfirm:(se==null?void 0:se.onConfirm)||(()=>G(null)),onCancel:()=>G(null)}),t.jsxs("div",{className:`flex flex-col border-b border-black/5 shrink-0 z-20 backdrop-blur-md ${p.bg}/90 transition-all`,children:[t.jsxs("div",{className:"h-16 flex items-center justify-between px-4 pt-2",children:[t.jsx("button",{onClick:l,className:"p-3 -ml-3 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${p.text}`,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsxs("div",{className:"flex flex-col items-center cursor-pointer active:opacity-70 transition-opacity",onClick:f,children:[t.jsx("span",{className:`font-bold text-base ${p.text} truncate max-w-[150px]`,children:e.title}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:`text-[10px] opacity-60 ${p.text}`,children:[" ",ce," "]}),z&&t.jsxs("span",{className:`text-[9px] px-1.5 py-0.5 rounded opacity-50 font-mono border border-current ${p.text}`,children:[" ",z]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>Pe(!0),className:`p-2 rounded-full hover:bg-black/5 transition-colors ${p.text}`,title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),t.jsx("button",{onClick:De,disabled:g,className:`p-2 rounded-full hover:bg-black/5 transition-colors ${p.text}`,title:"",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})})})]})]}),t.jsx("div",{className:"px-4 pb-3 flex gap-3 overflow-x-auto no-scrollbar",children:i.map(_=>t.jsxs("button",{onClick:()=>d(_.id),className:`flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all relative ${c===_.id?"bg-slate-800 text-white border-slate-800":"bg-white/50 border-black/5 hover:bg-white text-slate-600"}`,children:[t.jsx("img",{src:_.avatar,className:"w-6 h-6 rounded-full object-cover"}),t.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:_.name}),_.writerPersona&&t.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-purple-500 rounded-full border border-white"})]},_.id))})]}),t.jsxs("div",{className:`z-10 ${p.bg}/95 backdrop-blur-md border-b border-black/5 shadow-sm`,children:[t.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto no-scrollbar flex-1 mr-4",children:[t.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[N&&t.jsx("img",{src:N.avatar,className:"w-6 h-6 rounded-full object-cover"}),t.jsx("span",{className:"text-xs font-bold text-slate-700",children:N!=null&&N.name?`${N.name}`:""})]}),t.jsx("div",{className:"flex-1 flex gap-2 overflow-x-auto no-scrollbar",children:N&&Dx(N).slice(0,3).map((_,ee)=>{let E="bg-indigo-50 text-indigo-700 border-indigo-100";return["","",""].some(K=>_.includes(K))&&(E="bg-blue-50 text-blue-700 border-blue-100"),["","","","",""].some(K=>_.includes(K))&&(E="bg-pink-50 text-pink-700 border-pink-100"),["","","",""].some(K=>_.includes(K))&&(E="bg-amber-50 text-amber-700 border-amber-100"),t.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold whitespace-nowrap border ${E}`,children:_},ee)})})]}),t.jsxs("button",{onClick:()=>j(!M),className:"shrink-0 text-[10px] bg-white border border-slate-200 px-2 py-1 rounded-full hover:bg-slate-50 text-slate-600 flex items-center gap-1 transition-colors",children:[" ",t.jsx("span",{className:`transform transition-transform ${M?"rotate-180":""}`,children:""})]})]}),t.jsx("div",{className:`transition-all duration-300 ease-out overflow-hidden ${M?"max-h-[60vh] opacity-100":"max-h-0 opacity-0"}`,children:N?t.jsx(Fx,{char:N,userProfile:r,targetCharId:c,isTyping:g,setIsTyping:b,setConfirmDialog:G,addToast:h,apiConfig:a,updateCharacter:o}):t.jsx("div",{className:"p-4 text-center text-xs text-slate-400",children:""})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 no-scrollbar pb-40",ref:ge,children:[we.length===0&&t.jsx("div",{className:"text-center py-20 opacity-40",children:t.jsxs("p",{className:"text-sm italic font-serif",children:[" ",ce," ",t.jsx("br",{}),"..."]})}),we.map(_=>{var J,ae;const ee=_.authorId==="user",E=ee?null:n.find(V=>V.id===_.authorId),K=_.role||(_.type==="story"?"writer":_.type==="analysis"?"analyst":"commenter"),ke=t.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1 z-10 bg-white/80 backdrop-blur rounded-lg p-1 shadow-sm border border-slate-100",children:[t.jsx("button",{onClick:()=>re(_),className:"p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-indigo-500",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:t.jsx("path",{d:"m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z"})})}),t.jsx("button",{onClick:()=>Re(_.id),className:"p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-red-500",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:t.jsx("path",{fillRule:"evenodd",d:"M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z",clipRule:"evenodd"})})})]});return K==="writer"?t.jsxs("div",{className:`p-6 rounded-sm shadow-sm leading-loose text-justify text-[17px] relative group transition-all ${p.paper} ${p.text} ${ee?"border-l-4 border-slate-300":""}`,children:[ke,t.jsxs("div",{className:"absolute -top-3 left-4 bg-white/90 border border-black/5 px-2 py-0.5 rounded text-[9px] font-sans font-bold uppercase tracking-wider text-slate-500 shadow-sm flex items-center gap-1.5",children:[ee?null:t.jsx("img",{src:E==null?void 0:E.avatar,className:"w-3 h-3 rounded-full object-cover"}),t.jsxs("span",{children:[ee?" (User)":E==null?void 0:E.name," "]}),!ee&&((J=_.meta)==null?void 0:J.mood)&&t.jsx("span",{className:"bg-slate-100 px-1.5 rounded text-[9px] text-slate-600 normal-case",children:_.meta.mood})]}),t.jsx("div",{className:"whitespace-pre-wrap",children:_.content})]},_.id):K==="commenter"?t.jsxs("div",{className:"flex gap-3 max-w-[85%] font-sans ml-auto flex-row-reverse animate-slide-up group relative",children:[t.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden shrink-0 border-2 border-white shadow-sm mt-1",children:t.jsx("img",{src:ee?r.avatar:E==null?void 0:E.avatar,className:"w-full h-full object-cover"})}),t.jsxs("div",{className:"p-3 rounded-xl text-sm shadow-sm relative bg-[#fff9c4] text-slate-700 transform rotate-1 border border-yellow-200/50",children:[ke,_.content]})]},_.id):K==="analyst"?t.jsxs("div",{className:"mx-4 bg-gradient-to-br from-slate-50 to-blue-50/30 rounded-xl border border-slate-200 p-4 text-xs font-sans text-slate-600 shadow-sm group relative",children:[ke,t.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-200",children:[t.jsx("span",{className:"text-lg",children:""}),t.jsxs("span",{className:"font-bold text-slate-800",children:[E==null?void 0:E.name," "]}),_.focus&&t.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-[10px] font-bold",children:_.focus})]}),((ae=_.meta)==null?void 0:ae.reaction)&&t.jsxs("div",{className:"mb-2 pb-2 border-b border-dashed border-slate-200",children:[t.jsx("span",{className:"text-slate-400 text-[10px] uppercase",children:""}),t.jsxs("p",{className:"text-sm font-bold text-slate-700 mt-0.5",children:['"',_.meta.reaction,'"']})]}),t.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:_.content})]},_.id):null}),g&&t.jsx("div",{className:"flex justify-center py-4",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${p.button} animate-bounce`}),t.jsx("div",{className:`w-2 h-2 rounded-full ${p.button} animate-bounce delay-75`}),t.jsx("div",{className:`w-2 h-2 rounded-full ${p.button} animate-bounce delay-150`})]})})]}),t.jsxs("div",{className:"absolute bottom-0 w-full bg-white/95 backdrop-blur-xl border-t border-slate-200 z-30 transition-transform duration-300 font-sans shadow-[0_-5px_20px_rgba(0,0,0,0.05)] pb-safe",children:[t.jsxs("div",{className:"flex gap-2 px-4 py-2 text-xs border-b border-slate-100 overflow-x-auto no-scrollbar",children:[t.jsxs("button",{onClick:()=>x({...m,write:!m.write}),className:`px-3 py-1.5 rounded-full text-xs font-bold border flex items-center gap-1.5 ${m.write?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:[t.jsx("span",{children:""})," "]}),t.jsxs("button",{onClick:()=>x({...m,comment:!m.comment}),className:`px-3 py-1.5 rounded-full text-xs font-bold border flex items-center gap-1.5 ${m.comment?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:[t.jsx("span",{children:""})," "]}),t.jsxs("button",{onClick:()=>x({...m,analyze:!m.analyze}),className:`px-3 py-1.5 rounded-full text-xs font-bold border flex items-center gap-1.5 ${m.analyze?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:[t.jsx("span",{children:""})," "]})]}),t.jsxs("div",{className:"p-3 flex gap-2 items-end",children:[t.jsx("textarea",{value:y,onChange:_=>C(_.target.value),placeholder:m.write?y.trim()?"...":"AI...":"...",className:"flex-1 bg-slate-100 rounded-2xl px-4 py-3 text-sm text-slate-700 outline-none resize-none max-h-32 placeholder:text-slate-400 focus:bg-white focus:ring-2 focus:ring-slate-200 transition-all",rows:1,style:{minHeight:"44px"}}),ne&&!g&&!y.trim()&&t.jsx("button",{onClick:le,className:"w-11 h-11 rounded-full flex items-center justify-center text-slate-500 bg-slate-100 hover:bg-slate-200 active:scale-95 transition-all shrink-0",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),t.jsx("button",{onClick:A,disabled:g||!y.trim()&&!m.write,className:`w-11 h-11 rounded-full flex items-center justify-center text-white shadow-md active:scale-95 transition-all shrink-0 ${y.trim()||m.write?p.button:"bg-slate-300"}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:t.jsx("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]}),t.jsx(Ze,{isOpen:H,title:"",onClose:()=>te(!1),footer:t.jsx("button",{onClick:$e,className:"w-full py-3 bg-slate-800 text-white font-bold rounded-2xl",children:""}),children:t.jsx("textarea",{value:me,onChange:_=>F(_.target.value),className:"w-full h-48 bg-slate-100 rounded-xl p-3 text-sm resize-none focus:outline-none leading-relaxed"})}),t.jsx(Ze,{isOpen:Ee,title:"",onClose:()=>P(!1),footer:pe?t.jsx("div",{className:"w-full py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl text-center",children:"AI..."}):t.jsx("button",{onClick:Ke,className:"w-full py-3 bg-indigo-500 text-white font-bold rounded-2xl shadow-lg",children:""}),children:t.jsx("textarea",{value:Z,onChange:_=>X(_.target.value),className:"w-full h-64 bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm resize-none focus:outline-none leading-relaxed",placeholder:"..."})}),t.jsx(Ze,{isOpen:je,title:"",onClose:()=>Pe(!1),children:t.jsxs("div",{className:"max-h-[60vh] overflow-y-auto space-y-4 p-1",children:[D.length===0&&t.jsx("div",{className:"text-center text-slate-400 py-4 text-xs",children:""}),D.map((_,ee)=>t.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100",children:[t.jsxs("div",{className:"font-bold text-sm text-slate-700 mb-2",children:[" ",ee+1," "]}),t.jsx("div",{className:"text-xs text-slate-600 leading-relaxed whitespace-pre-wrap",children:_.content})]},_.id))]})})]})},Gx=()=>{const{closeApp:e,novels:s,addNovel:n,updateNovel:r,deleteNovel:a,characters:l,updateCharacter:o,apiConfig:i,addToast:c,userProfile:d,worldbooks:f}=xt(),[h,p]=u.useState("shelf"),[m,x]=u.useState(null),[y,C]=u.useState(Ar[0]),[g,b]=u.useState(""),[v,w]=u.useState(""),[z,k]=u.useState(""),[M,j]=u.useState(""),[H,te]=u.useState(new Set),[Ne,Me]=u.useState([]),[me,F]=u.useState(""),[se,G]=u.useState(""),Ee=u.useRef(null),[P,Z]=u.useState(null),[X,pe]=u.useState(!1),[Ce,je]=u.useState(!1),[Pe,ge]=u.useState("system"),[ce,N]=u.useState(!1),[ne,we]=u.useState(!1),[D,xe]=u.useState(null),[A,le]=u.useState(null),[re,$e]=u.useState(null),Re=$=>Ar.find(U=>U.id===$)||Ar[0],De=u.useMemo(()=>m?l.filter($=>m.collaboratorIds.includes($.id)):[],[m,l]),Ke=u.useMemo(()=>{const $=[],U=new Set;return s.forEach(S=>{S.protagonists.forEach(T=>{const ve=`${T.name}-${T.role}`;U.has(ve)||(U.add(ve),$.push(T))})}),$},[s]);u.useEffect(()=>{m&&De.length>0&&!re&&$e(De[0].id)},[m,De]),u.useEffect(()=>{m&&C(Re(m.coverStyle))},[m]);const _=()=>{if(!g.trim()){c("","error");return}const $={id:`novel-${Date.now()}`,title:g,subtitle:v,summary:z,coverStyle:y.id,coverImage:se,worldSetting:M,collaboratorIds:Array.from(H),protagonists:Ne,segments:[],createdAt:Date.now(),lastActiveAt:Date.now()};n($),x($),p("write"),K()},ee=()=>{m&&(b(m.title),w(m.subtitle||""),k(m.summary),j(m.worldSetting),C(Re(m.coverStyle)),G(m.coverImage||""),te(new Set(m.collaboratorIds)),Me(m.protagonists),p("settings"))},E=async()=>{if(!m)return;const $={...m,title:g,subtitle:v,summary:z,worldSetting:M,coverStyle:y.id,coverImage:se,collaboratorIds:Array.from(H),protagonists:Ne,segments:m.segments,lastActiveAt:Date.now()};await r(m.id,$),x($),p("write"),c("","success")},K=()=>{b(""),w(""),k(""),j(""),te(new Set),Me([]),G(""),F("")},ke=async $=>{le({isOpen:!0,title:"",message:"",variant:"danger",onConfirm:()=>{a($),(m==null?void 0:m.id)===$&&p("shelf"),c("","success"),le(null)}})},J=async $=>{var S;const U=(S=$.target.files)==null?void 0:S[0];if(U)try{const T=await ls(U,{maxWidth:800,quality:.8});G(T)}catch{c("","error")}},ae=()=>{me&&G(me)},V=$=>{Z($||{id:`proto-${Date.now()}`,name:"",role:"",description:""}),pe(!0)},Q=()=>{if(!P||!P.name.trim()){c("","error");return}Me($=>$.find(S=>S.id===P.id)?$.map(S=>S.id===P.id?P:S):[...$,P]),pe(!1),Z(null)},ye=$=>{const U={id:`proto-${Date.now()}-${Math.random()}`,name:$.name,role:$.role||"",description:$.description||""};Me(S=>[...S,U]),je(!1),c(`: ${$.name}`,"success")},be=$=>{const U=`

${$.title}
${$.content}`;j(S=>(S+U).trim()),N(!1),c(`: ${$.title}`,"success")},B=({p:$,onDelete:U,onClick:S})=>t.jsxs("div",{onClick:S,className:"bg-white p-3 rounded-xl border border-slate-200 shadow-sm relative group cursor-pointer hover:border-slate-400 transition-colors",children:[t.jsxs("div",{className:"font-bold text-slate-800 text-sm flex justify-between",children:[t.jsx("span",{children:$.name}),t.jsx("span",{className:"text-[10px] bg-slate-100 px-1.5 rounded text-slate-500 font-normal",children:$.role})]}),t.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:$.description||""}),U&&t.jsx("button",{onClick:T=>{T.stopPropagation(),U()},className:"absolute top-1 right-1 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]});return h==="library"?t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans",children:[t.jsx("div",{className:"h-20 bg-white/80 backdrop-blur-md flex items-end pb-3 px-6 border-b border-slate-200 shrink-0 sticky top-0 z-20",children:t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsx("button",{onClick:()=>p("shelf"),className:"p-2 -ml-2 rounded-full hover:bg-slate-100 active:scale-90 transition-transform",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-bold text-slate-800 text-lg tracking-wide",children:""}),t.jsx("div",{className:"w-8"})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar",children:[t.jsxs("section",{children:[t.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2",children:[t.jsx("span",{children:""}),"  (AI Collaborators)"]}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:l.map($=>t.jsxs("div",{onClick:()=>{xe($),we(!0)},className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center gap-3 cursor-pointer hover:shadow-md transition-all active:scale-95",children:[t.jsx("img",{src:$.avatar,className:"w-16 h-16 rounded-full object-cover border-2 border-slate-50"}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"font-bold text-slate-700 text-sm",children:$.name}),t.jsx("div",{className:"text-[10px] text-slate-400 mt-1 px-2 py-0.5 bg-slate-50 rounded-full",children:""})]})]},$.id))})]}),t.jsxs("section",{children:[t.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2",children:[t.jsx("span",{children:""}),"  (From History)"]}),Ke.length===0?t.jsx("div",{className:"text-center py-8 text-slate-400 text-xs",children:""}):t.jsx("div",{className:"grid grid-cols-1 gap-3",children:Ke.map(($,U)=>t.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("span",{className:"font-bold text-slate-800",children:$.name}),t.jsx("span",{className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded border border-indigo-100",children:$.role})]}),t.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-3",children:$.description||""})]},U))})]})]}),t.jsx(Ze,{isOpen:ne,title:(D==null?void 0:D.name)||"",onClose:()=>we(!1),children:t.jsx("div",{className:"max-h-[60vh] overflow-y-auto space-y-4 p-1",children:D?t.jsx("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100 text-sm leading-relaxed text-slate-700 whitespace-pre-wrap",children:D.writerPersona||po(D)}):null})})]}):h==="shelf"?t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans relative",children:[t.jsx(tc,{isOpen:!!A,title:(A==null?void 0:A.title)||"",message:(A==null?void 0:A.message)||"",variant:A==null?void 0:A.variant,confirmText:(A==null?void 0:A.confirmText)||(A!=null&&A.onConfirm?"":"OK"),onConfirm:(A==null?void 0:A.onConfirm)||(()=>le(null)),onCancel:()=>le(null)}),t.jsxs("div",{className:"h-24 flex items-end justify-between px-6 pb-6 bg-white/80 backdrop-blur-md z-20 shrink-0 border-b border-slate-100",children:[t.jsx("button",{onClick:e,className:"p-3 -ml-3 rounded-full hover:bg-slate-100 active:scale-95 transition-all",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),t.jsx("span",{className:"font-black text-2xl text-slate-800 tracking-tight",children:""}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>p("library"),className:"w-10 h-10 bg-white text-slate-600 border border-slate-200 rounded-full flex items-center justify-center shadow-sm active:scale-95 transition-transform hover:bg-slate-50",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"})})}),t.jsx("button",{onClick:()=>{p("create"),K()},className:"w-10 h-10 bg-slate-900 text-white rounded-full flex items-center justify-center shadow-lg active:scale-95 transition-transform hover:bg-black",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})]}),t.jsxs("div",{className:"p-6 grid grid-cols-2 gap-5 overflow-y-auto pb-24",children:[s.map($=>{const U=Re($.coverStyle),S=$.segments.reduce((ve,de)=>ve+(de.type==="story"?de.content.length:0),0),T=$.coverImage?{backgroundImage:`url(${$.coverImage})`,backgroundSize:"cover",backgroundPosition:"center"}:{};return t.jsxs("div",{onClick:()=>{x($),p("write")},className:"group relative aspect-auto min-h-[14rem] bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-slate-100 cursor-pointer flex flex-col",children:[t.jsxs("div",{className:`h-28 shrink-0 ${U.bg} relative p-4 flex flex-col justify-end`,style:T,children:[t.jsx("div",{className:`absolute inset-0 ${$.coverImage?"bg-black/30":""}`}),t.jsxs("div",{className:"relative z-10",children:[t.jsx("h3",{className:`font-bold text-lg leading-tight line-clamp-2 ${$.coverImage?"text-white drop-shadow-md":U.text}`,children:$.title}),$.subtitle&&t.jsx("p",{className:`text-[10px] font-bold opacity-80 uppercase tracking-wide truncate ${$.coverImage?"text-white":U.text}`,children:$.subtitle})]})]}),t.jsxs("div",{className:"p-4 flex-1 flex flex-col justify-between",children:[t.jsx("p",{className:"text-xs text-slate-500 line-clamp-3 leading-relaxed mb-3",children:$.summary||"..."}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-50",children:[t.jsx("div",{className:"flex -space-x-2",children:l.filter(ve=>$.collaboratorIds.includes(ve.id)).map(ve=>t.jsx("img",{src:ve.avatar,className:"w-6 h-6 rounded-full border-2 border-white object-cover"},ve.id))}),t.jsxs("span",{className:"text-[10px] text-slate-400 font-mono bg-slate-50 px-2 py-0.5 rounded-full",children:[(S/1e3).toFixed(1),"k "]})]})]}),t.jsx("button",{onClick:ve=>{ve.stopPropagation(),ke($.id)},className:"absolute top-2 right-2 text-slate-400/50 hover:text-red-500 p-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white/20 backdrop-blur rounded-full",children:""})]},$.id)}),s.length===0&&t.jsxs("div",{className:"col-span-2 flex flex-col items-center justify-center h-64 text-slate-300 gap-3",children:[t.jsx("span",{className:"text-4xl opacity-50 grayscale",children:""}),t.jsx("span",{className:"text-sm font-sans",children:""})]})]})]}):h==="create"||h==="settings"?t.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans relative",children:[t.jsx(tc,{isOpen:!!A,title:(A==null?void 0:A.title)||"",message:(A==null?void 0:A.message)||"",variant:A==null?void 0:A.variant,confirmText:(A==null?void 0:A.confirmText)||(A!=null&&A.onConfirm?"":"OK"),onConfirm:(A==null?void 0:A.onConfirm)||(()=>le(null)),onCancel:()=>le(null)}),t.jsxs("div",{className:"h-16 flex items-center justify-between px-4 bg-white border-b border-slate-200 shrink-0 sticky top-0 z-20",children:[t.jsx("button",{onClick:()=>p(h==="create"?"shelf":"write"),className:"text-slate-500 text-sm",children:""}),t.jsx("span",{className:"font-bold text-slate-800",children:h==="create"?"":""}),t.jsx("button",{onClick:h==="create"?_:E,className:"bg-slate-800 text-white px-4 py-1.5 rounded-full text-xs font-bold shadow-md active:scale-95 transition-transform",children:""})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 pb-20",children:[t.jsxs("section",{className:"space-y-4",children:[t.jsx("input",{value:g,onChange:$=>b($.target.value),placeholder:"",className:"w-full text-2xl font-bold bg-transparent border-b border-slate-200 py-2 outline-none focus:border-slate-800 font-serif"}),t.jsx("input",{value:v,onChange:$=>w($.target.value),placeholder:"/",className:"w-full text-sm font-bold bg-transparent border-b border-slate-200 py-2 outline-none focus:border-slate-800 text-slate-600"}),t.jsx("textarea",{value:z,onChange:$=>k($.target.value),placeholder:"...",className:"w-full h-20 bg-slate-100 rounded-xl p-3 text-sm resize-none outline-none"}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:""}),t.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 no-scrollbar",children:Ar.map($=>t.jsx("button",{onClick:()=>C($),className:`w-12 h-16 rounded-md shadow-sm border-2 shrink-0 ${$.bg} ${y.id===$.id?"border-slate-800 scale-105":"border-transparent"}`},$.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:""}),t.jsxs("div",{className:"flex gap-3 items-center",children:[t.jsxs("div",{onClick:()=>{var $;return($=Ee.current)==null?void 0:$.click()},className:"w-16 h-24 bg-slate-100 rounded-md border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer hover:border-slate-500 relative overflow-hidden",children:[se?t.jsx("img",{src:se,className:"w-full h-full object-cover"}):t.jsx("span",{className:"text-xs text-slate-400",children:"+"}),t.jsx("input",{type:"file",ref:Ee,className:"hidden",accept:"image/*",onChange:J})]}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("input",{value:me,onChange:$=>F($.target.value),onBlur:ae,placeholder:"...",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs outline-none focus:border-slate-400"}),se&&t.jsx("button",{onClick:()=>{G(""),F("")},className:"text-xs text-red-400 underline",children:""})]})]})]})]}),t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block",children:""}),t.jsxs("button",{onClick:()=>N(!0),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded font-bold hover:bg-indigo-100 flex items-center gap-1",children:[t.jsx("span",{children:""})," "]})]}),t.jsx("textarea",{value:M,onChange:$=>j($.target.value),placeholder:"...",className:"w-full h-32 bg-white border border-slate-200 rounded-xl p-3 text-sm resize-none outline-none focus:border-slate-400"})]}),t.jsxs("section",{className:"space-y-4",children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block",children:""}),t.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 no-scrollbar",children:l.map($=>t.jsxs("div",{onClick:()=>{const U=new Set(H);U.has($.id)?U.delete($.id):U.add($.id),te(U)},className:`flex flex-col items-center gap-2 cursor-pointer transition-opacity ${H.has($.id)?"opacity-100":"opacity-50 grayscale"}`,children:[t.jsx("img",{src:$.avatar,className:"w-12 h-12 rounded-full object-cover shadow-sm"}),t.jsx("span",{className:"text-[10px] font-bold text-slate-600",children:$.name})]},$.id))})]}),t.jsxs("section",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase",children:""}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>je(!0),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded font-bold hover:bg-indigo-100 border border-indigo-100",children:" "}),t.jsx("button",{onClick:()=>V(),className:"text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-600 hover:bg-slate-200 transition-colors",children:"+ "})]})]}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:Ne.map(($,U)=>t.jsx(B,{p:$,onClick:()=>V($),onDelete:()=>Me(Ne.filter((S,T)=>T!==U))},$.id))})]})]}),t.jsx(Ze,{isOpen:X,title:"",onClose:()=>pe(!1),footer:t.jsx("button",{onClick:Q,className:"w-full py-3 bg-slate-800 text-white font-bold rounded-2xl",children:""}),children:P&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:""}),t.jsx("input",{value:P.name,onChange:$=>Z({...P,name:$.target.value}),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm font-bold"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:""}),t.jsx("input",{value:P.role,onChange:$=>Z({...P,role:$.target.value}),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm",placeholder:" / "})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:""}),t.jsx("textarea",{value:P.description,onChange:$=>Z({...P,description:$.target.value}),className:"w-full h-32 bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm resize-none leading-relaxed"})]})]})}),t.jsxs(Ze,{isOpen:Ce,title:"",onClose:()=>je(!1),children:[t.jsxs("div",{className:"flex p-1 bg-slate-100 rounded-xl mb-3",children:[t.jsx("button",{onClick:()=>ge("system"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${Pe==="system"?"bg-white shadow text-indigo-600":"text-slate-400"}`,children:" (AI)"}),t.jsx("button",{onClick:()=>ge("history"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${Pe==="history"?"bg-white shadow text-indigo-600":"text-slate-400"}`,children:""})]}),t.jsxs("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-3 p-1",children:[Pe==="system"&&l.map($=>t.jsxs("button",{onClick:()=>ye({name:$.name,role:"",description:$.description}),className:"w-full flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-xl hover:border-indigo-200 shadow-sm active:scale-95 transition-all text-left",children:[t.jsx("img",{src:$.avatar,className:"w-8 h-8 rounded-full object-cover"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-sm text-slate-700",children:$.name}),t.jsx("div",{className:"text-[10px] text-slate-400 truncate",children:$.description})]})]},$.id)),Pe==="history"&&Ke.map(($,U)=>t.jsxs("button",{onClick:()=>ye($),className:"w-full flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-xl hover:border-indigo-200 shadow-sm active:scale-95 transition-all text-left",children:[t.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500 border border-slate-200",children:$.name[0]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-bold text-sm text-slate-700",children:$.name}),t.jsxs("div",{className:"text-[10px] text-slate-400 truncate",children:[$.role," - ",$.description||""]})]})]},`hist-${U}`))]})]}),t.jsx(Ze,{isOpen:ce,title:"",onClose:()=>N(!1),children:t.jsx("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-2 p-1",children:f.map($=>t.jsxs("button",{onClick:()=>be($),className:"w-full text-left p-3 rounded-xl border border-slate-100 hover:border-indigo-300 bg-white shadow-sm active:scale-95 transition-all",children:[t.jsx("div",{className:"font-bold text-slate-700 text-sm",children:$.title}),t.jsx("div",{className:"text-[10px] text-slate-400 mt-1",children:$.category||""})]},$.id))})})]}):h==="write"&&m?t.jsx(Hx,{activeBook:m,updateNovel:r,characters:l,userProfile:d,apiConfig:i,onBack:()=>p("shelf"),updateCharacter:o,collaborators:De,targetCharId:re,setTargetCharId:$e,onOpenSettings:ee}):null},ml=xr("App",{web:()=>ho(()=>import("./web-B-duYbaw.js"),[],import.meta.url).then(e=>new e.AppWeb)});var sc;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(sc||(sc={}));var _u;(function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"})(_u||(_u={}));const ei=xr("StatusBar");class Vx extends u.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){console.error("App Crash:",s,n)}componentDidUpdate(s){s.children!==this.props.children&&this.setState({hasError:!1,error:null})}render(){var s;return this.state.hasError?t.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-slate-900 text-white p-6 text-center space-y-4",children:[t.jsx("div",{className:"text-4xl",children:""}),t.jsx("h2",{className:"text-lg font-bold",children:""}),t.jsx("p",{className:"text-xs text-slate-400 font-mono bg-black/30 p-2 rounded max-w-full overflow-hidden text-ellipsis",children:((s=this.state.error)==null?void 0:s.message)||"Unknown Error"}),t.jsx("button",{onClick:()=>{this.setState({hasError:!1}),this.props.onCloseApp()},className:"px-6 py-3 bg-red-600 rounded-full font-bold text-sm shadow-lg active:scale-95 transition-transform",children:""})]}):this.props.children}}const Zx=()=>{const{theme:e,isLocked:s,unlock:n,activeApp:r,closeApp:a,virtualTime:l,isDataLoaded:o,toasts:i,unreadMessages:c,characters:d}=xt();if(u.useEffect(()=>((async()=>{if(tn.isNativePlatform())try{await ei.setOverlaysWebView({overlay:!0}),await ei.hide(),await ei.setStyle({style:sc.Dark}),(await Yl.checkPermissions()).display!=="granted"&&await Yl.requestPermissions()}catch(C){console.error("Native init failed",C)}})(),(async()=>{if(tn.isNativePlatform())try{await ml.removeAllListeners(),ml.addListener("backButton",({canGoBack:C})=>{r!==Ve.Launcher?a():s||ml.exitApp()})}catch{console.log("Back button listener setup failed")}})(),()=>{tn.isNativePlatform()&&ml.removeAllListeners().catch(()=>{})}),[r,s,a]),u.useEffect(()=>{window.scrollTo(0,0)},[r]),!o)return t.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center",children:t.jsx("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin"})});const h=(x=>x.startsWith("http")||x.startsWith("data:")||x.startsWith("blob:")?`url(${x})`:x)(e.wallpaper),p=e.contentColor||"#ffffff";if(s){const x=Object.values(c).reduce((g,b)=>g+b,0),y=Object.keys(c)[0],C=y?d.find(g=>g.id===y):null;return t.jsxs("div",{onClick:()=>{"Notification"in window&&Notification.permission!=="granted"&&Notification.requestPermission(),n()},className:"relative w-full h-full bg-cover bg-center cursor-pointer overflow-hidden group font-light select-none overscroll-none",style:{backgroundImage:h,color:p},children:[t.jsx("div",{className:"absolute inset-0 bg-black/5 backdrop-blur-sm transition-all group-hover:backdrop-blur-none group-hover:bg-transparent duration-700"}),t.jsxs("div",{className:"absolute top-24 w-full text-center drop-shadow-[0_2px_4px_rgba(0,0,0,0.3)]",children:[t.jsxs("div",{className:"text-8xl tracking-tighter opacity-95 font-bold",children:[l.hours.toString().padStart(2,"0"),t.jsx("span",{className:"animate-pulse",children:":"}),l.minutes.toString().padStart(2,"0")]}),t.jsx("div",{className:"text-lg tracking-widest opacity-90 mt-2 uppercase text-xs font-bold",children:"SullyOS Simulation"})]}),x>0&&t.jsx("div",{className:"absolute top-[40%] left-4 right-4 animate-slide-up",children:t.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-2xl p-4 shadow-lg border border-white/10 flex items-center gap-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500 flex items-center justify-center text-white shrink-0 shadow-sm",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:t.jsx("path",{fillRule:"evenodd",d:"M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.322 0 9.75-3.97 9.75-9 0-5.03-4.428-9-9.75-9s-9.75 3.97-9.75 9c0 2.409 1.025 4.587 2.674 6.192.232.226.277.428.254.543a3.73 3.73 0 0 1-.814 1.686.75.75 0 0 0 .44 1.223ZM8.25 10.875a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25ZM10.875 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875-1.125a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25Z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1 min-w-0 text-white text-left",children:[t.jsxs("div",{className:"font-bold text-sm flex justify-between",children:[t.jsx("span",{children:C?C.name:"Message"}),t.jsx("span",{className:"text-[10px] opacity-70",children:""})]}),t.jsx("div",{className:"text-xs opacity-90 truncate",children:x>1?` ${x} `:""})]})]})}),t.jsxs("div",{className:"absolute bottom-12 w-full flex flex-col items-center gap-3 animate-pulse opacity-80 drop-shadow-md",children:[t.jsx("div",{className:"w-1 h-8 rounded-full bg-gradient-to-b from-transparent to-current"}),t.jsx("span",{className:"text-[10px] tracking-widest uppercase font-semibold",children:"Tap to Unlock"})]})]})}const m=()=>{switch(r){case Ve.Settings:return t.jsx(Jp,{});case Ve.Character:return t.jsx(Xp,{});case Ve.Chat:return t.jsx(rx,{});case Ve.GroupChat:return t.jsx(lx,{});case Ve.ThemeMaker:return t.jsx(fx,{});case Ve.Appearance:return t.jsx(hx,{});case Ve.Gallery:return t.jsx(px,{});case Ve.Date:return t.jsx(yx,{});case Ve.User:return t.jsx(jx,{});case Ve.Journal:return t.jsx(Nx,{});case Ve.Schedule:return t.jsx(kx,{});case Ve.Room:return t.jsx($x,{});case Ve.CheckPhone:return t.jsx(Ix,{});case Ve.Social:return t.jsx(_x,{});case Ve.Study:return t.jsx(Lx,{});case Ve.FAQ:return t.jsx(Ax,{});case Ve.Game:return t.jsx(Px,{});case Ve.Worldbook:return t.jsx(Rx,{});case Ve.Novel:return t.jsx(Gx,{});case Ve.Launcher:default:return t.jsx(Ap,{})}};return t.jsxs("div",{className:"relative w-full h-full overflow-hidden bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 text-slate-900 font-sans select-none overscroll-none",children:[t.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-all duration-700 ease-[cubic-bezier(0.25,0.1,0.25,1)]",style:{backgroundImage:h,transform:r!==Ve.Launcher?"scale(1.1)":"scale(1)",filter:r!==Ve.Launcher?"blur(10px)":"none",opacity:r!==Ve.Launcher?.6:1,willChange:"transform, filter, opacity",backfaceVisibility:"hidden",transformStyle:"preserve-3d"}}),t.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${r===Ve.Launcher?"bg-transparent":"bg-white/50 backdrop-blur-3xl"}`}),t.jsxs("div",{className:"absolute inset-0 z-10 w-full h-full overflow-hidden bg-transparent overscroll-none",style:{paddingTop:r!==Ve.Launcher?"env(safe-area-inset-top)":0},children:[t.jsx(Vx,{onCloseApp:a,children:m()}),t.jsx(_p,{}),t.jsx("div",{className:"absolute top-12 left-0 w-full flex flex-col items-center gap-2 pointer-events-none z-[60]",children:i.map(x=>t.jsxs("div",{className:"animate-fade-in bg-white/95 backdrop-blur-xl px-4 py-3 rounded-2xl shadow-xl border border-black/5 flex items-center gap-3 max-w-[85%] ring-1 ring-white/20",children:[x.type==="success"&&t.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 shrink-0"}),x.type==="error"&&t.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500 shrink-0"}),x.type==="info"&&t.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-primary shrink-0"}),t.jsx("span",{className:"text-xs font-bold text-slate-800 truncate leading-none",children:x.message})]},x.id))})]})]})},Jx=()=>t.jsxs("div",{className:"h-screen w-full bg-black md:bg-neutral-900 flex items-center justify-center overflow-hidden",children:[t.jsx("div",{className:"hidden md:block fixed inset-0 pointer-events-none opacity-20 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900 via-gray-900 to-black"}),t.jsxs("div",{className:`
          fixed inset-0 w-full h-full z-0 bg-black 
          md:relative md:w-auto md:h-[85vh] md:aspect-[9/19.5] md:rounded-[3rem] 
          md:shadow-2xl md:border-[8px] md:border-neutral-800 md:ring-4 md:ring-black/40
          transition-all duration-300
        `,style:{transform:"translateZ(0)"},children:[t.jsxs("div",{className:"hidden md:flex absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-black rounded-b-2xl z-50 pointer-events-none justify-center items-center",children:[t.jsx("div",{className:"w-16 h-1 bg-neutral-800 rounded-full"}),t.jsx("div",{className:"absolute right-6 w-2 h-2 rounded-full bg-blue-900/50 box-border border border-white/10"})]}),t.jsx("div",{className:"hidden md:block absolute -right-[10px] top-24 w-[3px] h-12 bg-neutral-700 rounded-r-md"}),t.jsx("div",{className:"hidden md:block absolute -left-[10px] top-24 w-[3px] h-8 bg-neutral-700 rounded-l-md"}),t.jsx("div",{className:"hidden md:block absolute -left-[10px] top-36 w-[3px] h-8 bg-neutral-700 rounded-l-md"}),t.jsx(Ip,{children:t.jsx(Zx,{})})]}),t.jsx("div",{className:"hidden md:block fixed bottom-4 right-4 text-white/20 text-xs font-mono",children:"SullyOS Simulator  Phase 1.1"})]}),Jm=document.getElementById("root");if(!Jm)throw new Error("Could not find root element to mount to");const Kx=ti.createRoot(Jm);Kx.render(t.jsx($n.StrictMode,{children:t.jsx(Jx,{})}));export{Kl as E,Zm as W,Hp as b};
