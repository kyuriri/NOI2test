import bd from"jszip";import*as wd from"pdfjs-dist";import Sh from"katex";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function Ch(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e0={exports:{}},tl={},t0={exports:{}},lt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var za=Symbol.for("react.element"),$h=Symbol.for("react.portal"),Ah=Symbol.for("react.fragment"),Eh=Symbol.for("react.strict_mode"),Ih=Symbol.for("react.profiler"),Mh=Symbol.for("react.provider"),_h=Symbol.for("react.context"),Th=Symbol.for("react.forward_ref"),Dh=Symbol.for("react.suspense"),Lh=Symbol.for("react.memo"),Ph=Symbol.for("react.lazy"),vd=Symbol.iterator;function Rh(t){return t===null||typeof t!="object"?null:(t=vd&&t[vd]||t["@@iterator"],typeof t=="function"?t:null)}var s0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},n0=Object.assign,r0={};function Jr(t,s,n){this.props=t,this.context=s,this.refs=r0,this.updater=n||s0}Jr.prototype.isReactComponent={};Jr.prototype.setState=function(t,s){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,s,"setState")};Jr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function a0(){}a0.prototype=Jr.prototype;function wc(t,s,n){this.props=t,this.context=s,this.refs=r0,this.updater=n||s0}var vc=wc.prototype=new a0;vc.constructor=wc;n0(vc,Jr.prototype);vc.isPureReactComponent=!0;var yd=Array.isArray,o0=Object.prototype.hasOwnProperty,yc={current:null},l0={key:!0,ref:!0,__self:!0,__source:!0};function i0(t,s,n){var r,a={},o=null,l=null;if(s!=null)for(r in s.ref!==void 0&&(l=s.ref),s.key!==void 0&&(o=""+s.key),s)o0.call(s,r)&&!l0.hasOwnProperty(r)&&(a[r]=s[r]);var c=arguments.length-2;if(c===1)a.children=n;else if(1<c){for(var i=Array(c),d=0;d<c;d++)i[d]=arguments[d+2];a.children=i}if(t&&t.defaultProps)for(r in c=t.defaultProps,c)a[r]===void 0&&(a[r]=c[r]);return{$$typeof:za,type:t,key:o,ref:l,props:a,_owner:yc.current}}function Oh(t,s){return{$$typeof:za,type:t.type,key:s,ref:t.ref,props:t.props,_owner:t._owner}}function jc(t){return typeof t=="object"&&t!==null&&t.$$typeof===za}function Fh(t){var s={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return s[n]})}var jd=/\/+/g;function Sl(t,s){return typeof t=="object"&&t!==null&&t.key!=null?Fh(""+t.key):s.toString(36)}function go(t,s,n,r,a){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case za:case $h:l=!0}}if(l)return l=t,a=a(l),t=r===""?"."+Sl(l,0):r,yd(a)?(n="",t!=null&&(n=t.replace(jd,"$&/")+"/"),go(a,s,n,"",function(d){return d})):a!=null&&(jc(a)&&(a=Oh(a,n+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(jd,"$&/")+"/")+t)),s.push(a)),1;if(l=0,r=r===""?".":r+":",yd(t))for(var c=0;c<t.length;c++){o=t[c];var i=r+Sl(o,c);l+=go(o,s,n,i,a)}else if(i=Rh(t),typeof i=="function")for(t=i.call(t),c=0;!(o=t.next()).done;)o=o.value,i=r+Sl(o,c++),l+=go(o,s,n,i,a);else if(o==="object")throw s=String(t),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return l}function Ya(t,s,n){if(t==null)return t;var r=[],a=0;return go(t,r,"","",function(o){return s.call(n,o,a++)}),r}function Bh(t){if(t._status===-1){var s=t._result;s=s(),s.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=s)}if(t._status===1)return t._result.default;throw t._result}var ts={current:null},bo={transition:null},zh={ReactCurrentDispatcher:ts,ReactCurrentBatchConfig:bo,ReactCurrentOwner:yc};function c0(){throw Error("act(...) is not supported in production builds of React.")}lt.Children={map:Ya,forEach:function(t,s,n){Ya(t,function(){s.apply(this,arguments)},n)},count:function(t){var s=0;return Ya(t,function(){s++}),s},toArray:function(t){return Ya(t,function(s){return s})||[]},only:function(t){if(!jc(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};lt.Component=Jr;lt.Fragment=Ah;lt.Profiler=Ih;lt.PureComponent=wc;lt.StrictMode=Eh;lt.Suspense=Dh;lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zh;lt.act=c0;lt.cloneElement=function(t,s,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=n0({},t.props),a=t.key,o=t.ref,l=t._owner;if(s!=null){if(s.ref!==void 0&&(o=s.ref,l=yc.current),s.key!==void 0&&(a=""+s.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(i in s)o0.call(s,i)&&!l0.hasOwnProperty(i)&&(r[i]=s[i]===void 0&&c!==void 0?c[i]:s[i])}var i=arguments.length-2;if(i===1)r.children=n;else if(1<i){c=Array(i);for(var d=0;d<i;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:za,type:t.type,key:a,ref:o,props:r,_owner:l}};lt.createContext=function(t){return t={$$typeof:_h,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Mh,_context:t},t.Consumer=t};lt.createElement=i0;lt.createFactory=function(t){var s=i0.bind(null,t);return s.type=t,s};lt.createRef=function(){return{current:null}};lt.forwardRef=function(t){return{$$typeof:Th,render:t}};lt.isValidElement=jc;lt.lazy=function(t){return{$$typeof:Ph,_payload:{_status:-1,_result:t},_init:Bh}};lt.memo=function(t,s){return{$$typeof:Lh,type:t,compare:s===void 0?null:s}};lt.startTransition=function(t){var s=bo.transition;bo.transition={};try{t()}finally{bo.transition=s}};lt.unstable_act=c0;lt.useCallback=function(t,s){return ts.current.useCallback(t,s)};lt.useContext=function(t){return ts.current.useContext(t)};lt.useDebugValue=function(){};lt.useDeferredValue=function(t){return ts.current.useDeferredValue(t)};lt.useEffect=function(t,s){return ts.current.useEffect(t,s)};lt.useId=function(){return ts.current.useId()};lt.useImperativeHandle=function(t,s,n){return ts.current.useImperativeHandle(t,s,n)};lt.useInsertionEffect=function(t,s){return ts.current.useInsertionEffect(t,s)};lt.useLayoutEffect=function(t,s){return ts.current.useLayoutEffect(t,s)};lt.useMemo=function(t,s){return ts.current.useMemo(t,s)};lt.useReducer=function(t,s,n){return ts.current.useReducer(t,s,n)};lt.useRef=function(t){return ts.current.useRef(t)};lt.useState=function(t){return ts.current.useState(t)};lt.useSyncExternalStore=function(t,s,n){return ts.current.useSyncExternalStore(t,s,n)};lt.useTransition=function(){return ts.current.useTransition()};lt.version="18.3.1";t0.exports=lt;var u=t0.exports;const Sn=Ch(u);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wh=u,Uh=Symbol.for("react.element"),Hh=Symbol.for("react.fragment"),Gh=Object.prototype.hasOwnProperty,Vh=Wh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kh={key:!0,ref:!0,__self:!0,__source:!0};function d0(t,s,n){var r,a={},o=null,l=null;n!==void 0&&(o=""+n),s.key!==void 0&&(o=""+s.key),s.ref!==void 0&&(l=s.ref);for(r in s)Gh.call(s,r)&&!Kh.hasOwnProperty(r)&&(a[r]=s[r]);if(t&&t.defaultProps)for(r in s=t.defaultProps,s)a[r]===void 0&&(a[r]=s[r]);return{$$typeof:Uh,type:t,key:o,ref:l,props:a,_owner:Vh.current}}tl.Fragment=Hh;tl.jsx=d0;tl.jsxs=d0;e0.exports=tl;var e=e0.exports,pi={},u0={exports:{}},xs={},m0={exports:{}},h0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function s(F,te){var L=F.length;F.push(te);e:for(;0<L;){var oe=L-1>>>1,he=F[oe];if(0<a(he,te))F[oe]=te,F[L]=he,L=oe;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var te=F[0],L=F.pop();if(L!==te){F[0]=L;e:for(var oe=0,he=F.length,Te=he>>>1;oe<Te;){var De=2*(oe+1)-1,$e=F[De],ge=De+1,I=F[ge];if(0>a($e,L))ge<he&&0>a(I,$e)?(F[oe]=I,F[ge]=L,oe=ge):(F[oe]=$e,F[De]=L,oe=De);else if(ge<he&&0>a(I,L))F[oe]=I,F[ge]=L,oe=ge;else break e}}return te}function a(F,te){var L=F.sortIndex-te.sortIndex;return L!==0?L:F.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var i=[],d=[],h=1,p=null,f=3,m=!1,x=!1,g=!1,A=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(F){for(var te=n(d);te!==null;){if(te.callback===null)r(d);else if(te.startTime<=F)r(d),te.sortIndex=te.expirationTime,s(i,te);else break;te=n(d)}}function j(F){if(g=!1,v(F),!x)if(n(i)!==null)x=!0,z(T);else{var te=n(d);te!==null&&ve(j,te.startTime-F)}}function T(F,te){x=!1,g&&(g=!1,w(M),M=-1),m=!0;var L=f;try{for(v(te),p=n(i);p!==null&&(!(p.expirationTime>te)||F&&!re());){var oe=p.callback;if(typeof oe=="function"){p.callback=null,f=p.priorityLevel;var he=oe(p.expirationTime<=te);te=t.unstable_now(),typeof he=="function"?p.callback=he:p===n(i)&&r(i),v(te)}else r(i);p=n(i)}if(p!==null)var Te=!0;else{var De=n(d);De!==null&&ve(j,De.startTime-te),Te=!1}return Te}finally{p=null,f=L,m=!1}}var $=!1,D=null,M=-1,Q=5,q=-1;function re(){return!(t.unstable_now()-q<Q)}function ce(){if(D!==null){var F=t.unstable_now();q=F;var te=!0;try{te=D(!0,F)}finally{te?fe():($=!1,D=null)}}else $=!1}var fe;if(typeof b=="function")fe=function(){b(ce)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,ee=me.port2;me.port1.onmessage=ce,fe=function(){ee.postMessage(null)}}else fe=function(){A(ce,0)};function z(F){D=F,$||($=!0,fe())}function ve(F,te){M=A(function(){F(t.unstable_now())},te)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){x||m||(x=!0,z(T))},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(i)},t.unstable_next=function(F){switch(f){case 1:case 2:case 3:var te=3;break;default:te=f}var L=f;f=te;try{return F()}finally{f=L}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(F,te){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var L=f;f=F;try{return te()}finally{f=L}},t.unstable_scheduleCallback=function(F,te,L){var oe=t.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?oe+L:oe):L=oe,F){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=L+he,F={id:h++,callback:te,priorityLevel:F,startTime:L,expirationTime:he,sortIndex:-1},L>oe?(F.sortIndex=L,s(d,F),n(i)===null&&F===n(d)&&(g?(w(M),M=-1):g=!0,ve(j,L-oe))):(F.sortIndex=he,s(i,F),x||m||(x=!0,z(T))),F},t.unstable_shouldYield=re,t.unstable_wrapCallback=function(F){var te=f;return function(){var L=f;f=te;try{return F.apply(this,arguments)}finally{f=L}}}})(h0);m0.exports=h0;var Yh=m0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jh=u,hs=Yh;function Pe(t){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)s+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var x0=new Set,Na={};function xr(t,s){zr(t,s),zr(t+"Capture",s)}function zr(t,s){for(Na[t]=s,t=0;t<s.length;t++)x0.add(s[t])}var yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fi=Object.prototype.hasOwnProperty,Zh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Nd={},kd={};function Xh(t){return fi.call(kd,t)?!0:fi.call(Nd,t)?!1:Zh.test(t)?kd[t]=!0:(Nd[t]=!0,!1)}function qh(t,s,n,r){if(n!==null&&n.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Qh(t,s,n,r){if(s===null||typeof s>"u"||qh(t,s,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function ss(t,s,n,r,a,o,l){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=t,this.type=s,this.sanitizeURL=o,this.removeEmptyString=l}var Ht={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ht[t]=new ss(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var s=t[0];Ht[s]=new ss(s,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ht[t]=new ss(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ht[t]=new ss(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ht[t]=new ss(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ht[t]=new ss(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ht[t]=new ss(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ht[t]=new ss(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ht[t]=new ss(t,5,!1,t.toLowerCase(),null,!1,!1)});var Nc=/[\-:]([a-z])/g;function kc(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var s=t.replace(Nc,kc);Ht[s]=new ss(s,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var s=t.replace(Nc,kc);Ht[s]=new ss(s,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var s=t.replace(Nc,kc);Ht[s]=new ss(s,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ht[t]=new ss(t,1,!1,t.toLowerCase(),null,!1,!1)});Ht.xlinkHref=new ss("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ht[t]=new ss(t,1,!1,t.toLowerCase(),null,!0,!0)});function Sc(t,s,n,r){var a=Ht.hasOwnProperty(s)?Ht[s]:null;(a!==null?a.type!==0:r||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Qh(s,n,a,r)&&(n=null),r||a===null?Xh(s)&&(n===null?t.removeAttribute(s):t.setAttribute(s,""+n)):a.mustUseProperty?t[a.propertyName]=n===null?a.type===3?!1:"":n:(s=a.attributeName,r=a.attributeNamespace,n===null?t.removeAttribute(s):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?t.setAttributeNS(r,s,n):t.setAttribute(s,n))))}var Cn=Jh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ja=Symbol.for("react.element"),yr=Symbol.for("react.portal"),jr=Symbol.for("react.fragment"),Cc=Symbol.for("react.strict_mode"),gi=Symbol.for("react.profiler"),p0=Symbol.for("react.provider"),f0=Symbol.for("react.context"),$c=Symbol.for("react.forward_ref"),bi=Symbol.for("react.suspense"),wi=Symbol.for("react.suspense_list"),Ac=Symbol.for("react.memo"),In=Symbol.for("react.lazy"),g0=Symbol.for("react.offscreen"),Sd=Symbol.iterator;function Qr(t){return t===null||typeof t!="object"?null:(t=Sd&&t[Sd]||t["@@iterator"],typeof t=="function"?t:null)}var Ct=Object.assign,Cl;function ca(t){if(Cl===void 0)try{throw Error()}catch(n){var s=n.stack.trim().match(/\n( *(at )?)/);Cl=s&&s[1]||""}return`
`+Cl+t}var $l=!1;function Al(t,s){if(!t||$l)return"";$l=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(d){var r=d}Reflect.construct(t,[],s)}else{try{s.call()}catch(d){r=d}t.call(s.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),o=r.stack.split(`
`),l=a.length-1,c=o.length-1;1<=l&&0<=c&&a[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(a[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||a[l]!==o[c]){var i=`
`+a[l].replace(" at new "," at ");return t.displayName&&i.includes("<anonymous>")&&(i=i.replace("<anonymous>",t.displayName)),i}while(1<=l&&0<=c);break}}}finally{$l=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ca(t):""}function ex(t){switch(t.tag){case 5:return ca(t.type);case 16:return ca("Lazy");case 13:return ca("Suspense");case 19:return ca("SuspenseList");case 0:case 2:case 15:return t=Al(t.type,!1),t;case 11:return t=Al(t.type.render,!1),t;case 1:return t=Al(t.type,!0),t;default:return""}}function vi(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case jr:return"Fragment";case yr:return"Portal";case gi:return"Profiler";case Cc:return"StrictMode";case bi:return"Suspense";case wi:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case f0:return(t.displayName||"Context")+".Consumer";case p0:return(t._context.displayName||"Context")+".Provider";case $c:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ac:return s=t.displayName||null,s!==null?s:vi(t.type)||"Memo";case In:s=t._payload,t=t._init;try{return vi(t(s))}catch{}}return null}function tx(t){var s=t.type;switch(t.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=s.render,t=t.displayName||t.name||"",s.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vi(s);case 8:return s===Cc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Vn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function b0(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function sx(t){var s=b0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,s),r=""+t[s];if(!t.hasOwnProperty(s)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,o=n.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return a.call(this)},set:function(l){r=""+l,o.call(this,l)}}),Object.defineProperty(t,s,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function Za(t){t._valueTracker||(t._valueTracker=sx(t))}function w0(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var n=s.getValue(),r="";return t&&(r=b0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(s.setValue(t),!0):!1}function Eo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function yi(t,s){var n=s.checked;return Ct({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Cd(t,s){var n=s.defaultValue==null?"":s.defaultValue,r=s.checked!=null?s.checked:s.defaultChecked;n=Vn(s.value!=null?s.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function v0(t,s){s=s.checked,s!=null&&Sc(t,"checked",s,!1)}function ji(t,s){v0(t,s);var n=Vn(s.value),r=s.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}s.hasOwnProperty("value")?Ni(t,s.type,n):s.hasOwnProperty("defaultValue")&&Ni(t,s.type,Vn(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(t.defaultChecked=!!s.defaultChecked)}function $d(t,s,n){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var r=s.type;if(!(r!=="submit"&&r!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+t._wrapperState.initialValue,n||s===t.value||(t.value=s),t.defaultValue=s}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Ni(t,s,n){(s!=="number"||Eo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var da=Array.isArray;function Lr(t,s,n,r){if(t=t.options,s){s={};for(var a=0;a<n.length;a++)s["$"+n[a]]=!0;for(n=0;n<t.length;n++)a=s.hasOwnProperty("$"+t[n].value),t[n].selected!==a&&(t[n].selected=a),a&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Vn(n),s=null,a=0;a<t.length;a++){if(t[a].value===n){t[a].selected=!0,r&&(t[a].defaultSelected=!0);return}s!==null||t[a].disabled||(s=t[a])}s!==null&&(s.selected=!0)}}function ki(t,s){if(s.dangerouslySetInnerHTML!=null)throw Error(Pe(91));return Ct({},s,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ad(t,s){var n=s.value;if(n==null){if(n=s.children,s=s.defaultValue,n!=null){if(s!=null)throw Error(Pe(92));if(da(n)){if(1<n.length)throw Error(Pe(93));n=n[0]}s=n}s==null&&(s=""),n=s}t._wrapperState={initialValue:Vn(n)}}function y0(t,s){var n=Vn(s.value),r=Vn(s.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),s.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Ed(t){var s=t.textContent;s===t._wrapperState.initialValue&&s!==""&&s!==null&&(t.value=s)}function j0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Si(t,s){return t==null||t==="http://www.w3.org/1999/xhtml"?j0(s):t==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Xa,N0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,n,r,a){MSApp.execUnsafeLocalFunction(function(){return t(s,n,r,a)})}:t}(function(t,s){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=s;else{for(Xa=Xa||document.createElement("div"),Xa.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Xa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;s.firstChild;)t.appendChild(s.firstChild)}});function ka(t,s){if(s){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=s;return}}t.textContent=s}var ha={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nx=["Webkit","ms","Moz","O"];Object.keys(ha).forEach(function(t){nx.forEach(function(s){s=s+t.charAt(0).toUpperCase()+t.substring(1),ha[s]=ha[t]})});function k0(t,s,n){return s==null||typeof s=="boolean"||s===""?"":n||typeof s!="number"||s===0||ha.hasOwnProperty(t)&&ha[t]?(""+s).trim():s+"px"}function S0(t,s){t=t.style;for(var n in s)if(s.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=k0(n,s[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,a):t[n]=a}}var rx=Ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ci(t,s){if(s){if(rx[t]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(Pe(137,t));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(Pe(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(Pe(61))}if(s.style!=null&&typeof s.style!="object")throw Error(Pe(62))}}function $i(t,s){if(t.indexOf("-")===-1)return typeof s.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ai=null;function Ec(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ei=null,Pr=null,Rr=null;function Id(t){if(t=Ha(t)){if(typeof Ei!="function")throw Error(Pe(280));var s=t.stateNode;s&&(s=ol(s),Ei(t.stateNode,t.type,s))}}function C0(t){Pr?Rr?Rr.push(t):Rr=[t]:Pr=t}function $0(){if(Pr){var t=Pr,s=Rr;if(Rr=Pr=null,Id(t),s)for(t=0;t<s.length;t++)Id(s[t])}}function A0(t,s){return t(s)}function E0(){}var El=!1;function I0(t,s,n){if(El)return t(s,n);El=!0;try{return A0(t,s,n)}finally{El=!1,(Pr!==null||Rr!==null)&&(E0(),$0())}}function Sa(t,s){var n=t.stateNode;if(n===null)return null;var r=ol(n);if(r===null)return null;n=r[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Pe(231,s,typeof n));return n}var Ii=!1;if(yn)try{var ea={};Object.defineProperty(ea,"passive",{get:function(){Ii=!0}}),window.addEventListener("test",ea,ea),window.removeEventListener("test",ea,ea)}catch{Ii=!1}function ax(t,s,n,r,a,o,l,c,i){var d=Array.prototype.slice.call(arguments,3);try{s.apply(n,d)}catch(h){this.onError(h)}}var xa=!1,Io=null,Mo=!1,Mi=null,ox={onError:function(t){xa=!0,Io=t}};function lx(t,s,n,r,a,o,l,c,i){xa=!1,Io=null,ax.apply(ox,arguments)}function ix(t,s,n,r,a,o,l,c,i){if(lx.apply(this,arguments),xa){if(xa){var d=Io;xa=!1,Io=null}else throw Error(Pe(198));Mo||(Mo=!0,Mi=d)}}function pr(t){var s=t,n=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,s.flags&4098&&(n=s.return),t=s.return;while(t)}return s.tag===3?n:null}function M0(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function Md(t){if(pr(t)!==t)throw Error(Pe(188))}function cx(t){var s=t.alternate;if(!s){if(s=pr(t),s===null)throw Error(Pe(188));return s!==t?null:t}for(var n=t,r=s;;){var a=n.return;if(a===null)break;var o=a.alternate;if(o===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Md(a),t;if(o===r)return Md(a),s;o=o.sibling}throw Error(Pe(188))}if(n.return!==r.return)n=a,r=o;else{for(var l=!1,c=a.child;c;){if(c===n){l=!0,n=a,r=o;break}if(c===r){l=!0,r=a,n=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===n){l=!0,n=o,r=a;break}if(c===r){l=!0,r=o,n=a;break}c=c.sibling}if(!l)throw Error(Pe(189))}}if(n.alternate!==r)throw Error(Pe(190))}if(n.tag!==3)throw Error(Pe(188));return n.stateNode.current===n?t:s}function _0(t){return t=cx(t),t!==null?T0(t):null}function T0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var s=T0(t);if(s!==null)return s;t=t.sibling}return null}var D0=hs.unstable_scheduleCallback,_d=hs.unstable_cancelCallback,dx=hs.unstable_shouldYield,ux=hs.unstable_requestPaint,Et=hs.unstable_now,mx=hs.unstable_getCurrentPriorityLevel,Ic=hs.unstable_ImmediatePriority,L0=hs.unstable_UserBlockingPriority,_o=hs.unstable_NormalPriority,hx=hs.unstable_LowPriority,P0=hs.unstable_IdlePriority,sl=null,on=null;function xx(t){if(on&&typeof on.onCommitFiberRoot=="function")try{on.onCommitFiberRoot(sl,t,void 0,(t.current.flags&128)===128)}catch{}}var Vs=Math.clz32?Math.clz32:gx,px=Math.log,fx=Math.LN2;function gx(t){return t>>>=0,t===0?32:31-(px(t)/fx|0)|0}var qa=64,Qa=4194304;function ua(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function To(t,s){var n=t.pendingLanes;if(n===0)return 0;var r=0,a=t.suspendedLanes,o=t.pingedLanes,l=n&268435455;if(l!==0){var c=l&~a;c!==0?r=ua(c):(o&=l,o!==0&&(r=ua(o)))}else l=n&~a,l!==0?r=ua(l):o!==0&&(r=ua(o));if(r===0)return 0;if(s!==0&&s!==r&&!(s&a)&&(a=r&-r,o=s&-s,a>=o||a===16&&(o&4194240)!==0))return s;if(r&4&&(r|=n&16),s=t.entangledLanes,s!==0)for(t=t.entanglements,s&=r;0<s;)n=31-Vs(s),a=1<<n,r|=t[n],s&=~a;return r}function bx(t,s){switch(t){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wx(t,s){for(var n=t.suspendedLanes,r=t.pingedLanes,a=t.expirationTimes,o=t.pendingLanes;0<o;){var l=31-Vs(o),c=1<<l,i=a[l];i===-1?(!(c&n)||c&r)&&(a[l]=bx(c,s)):i<=s&&(t.expiredLanes|=c),o&=~c}}function _i(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function R0(){var t=qa;return qa<<=1,!(qa&4194240)&&(qa=64),t}function Il(t){for(var s=[],n=0;31>n;n++)s.push(t);return s}function Wa(t,s,n){t.pendingLanes|=s,s!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,s=31-Vs(s),t[s]=n}function vx(t,s){var n=t.pendingLanes&~s;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=s,t.mutableReadLanes&=s,t.entangledLanes&=s,s=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var a=31-Vs(n),o=1<<a;s[a]=0,r[a]=-1,t[a]=-1,n&=~o}}function Mc(t,s){var n=t.entangledLanes|=s;for(t=t.entanglements;n;){var r=31-Vs(n),a=1<<r;a&s|t[r]&s&&(t[r]|=s),n&=~a}}var xt=0;function O0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var F0,_c,B0,z0,W0,Ti=!1,eo=[],On=null,Fn=null,Bn=null,Ca=new Map,$a=new Map,Tn=[],yx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Td(t,s){switch(t){case"focusin":case"focusout":On=null;break;case"dragenter":case"dragleave":Fn=null;break;case"mouseover":case"mouseout":Bn=null;break;case"pointerover":case"pointerout":Ca.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":$a.delete(s.pointerId)}}function ta(t,s,n,r,a,o){return t===null||t.nativeEvent!==o?(t={blockedOn:s,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},s!==null&&(s=Ha(s),s!==null&&_c(s)),t):(t.eventSystemFlags|=r,s=t.targetContainers,a!==null&&s.indexOf(a)===-1&&s.push(a),t)}function jx(t,s,n,r,a){switch(s){case"focusin":return On=ta(On,t,s,n,r,a),!0;case"dragenter":return Fn=ta(Fn,t,s,n,r,a),!0;case"mouseover":return Bn=ta(Bn,t,s,n,r,a),!0;case"pointerover":var o=a.pointerId;return Ca.set(o,ta(Ca.get(o)||null,t,s,n,r,a)),!0;case"gotpointercapture":return o=a.pointerId,$a.set(o,ta($a.get(o)||null,t,s,n,r,a)),!0}return!1}function U0(t){var s=rr(t.target);if(s!==null){var n=pr(s);if(n!==null){if(s=n.tag,s===13){if(s=M0(n),s!==null){t.blockedOn=s,W0(t.priority,function(){B0(n)});return}}else if(s===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function wo(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var n=Di(t.domEventName,t.eventSystemFlags,s[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Ai=r,n.target.dispatchEvent(r),Ai=null}else return s=Ha(n),s!==null&&_c(s),t.blockedOn=n,!1;s.shift()}return!0}function Dd(t,s,n){wo(t)&&n.delete(s)}function Nx(){Ti=!1,On!==null&&wo(On)&&(On=null),Fn!==null&&wo(Fn)&&(Fn=null),Bn!==null&&wo(Bn)&&(Bn=null),Ca.forEach(Dd),$a.forEach(Dd)}function sa(t,s){t.blockedOn===s&&(t.blockedOn=null,Ti||(Ti=!0,hs.unstable_scheduleCallback(hs.unstable_NormalPriority,Nx)))}function Aa(t){function s(a){return sa(a,t)}if(0<eo.length){sa(eo[0],t);for(var n=1;n<eo.length;n++){var r=eo[n];r.blockedOn===t&&(r.blockedOn=null)}}for(On!==null&&sa(On,t),Fn!==null&&sa(Fn,t),Bn!==null&&sa(Bn,t),Ca.forEach(s),$a.forEach(s),n=0;n<Tn.length;n++)r=Tn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Tn.length&&(n=Tn[0],n.blockedOn===null);)U0(n),n.blockedOn===null&&Tn.shift()}var Or=Cn.ReactCurrentBatchConfig,Do=!0;function kx(t,s,n,r){var a=xt,o=Or.transition;Or.transition=null;try{xt=1,Tc(t,s,n,r)}finally{xt=a,Or.transition=o}}function Sx(t,s,n,r){var a=xt,o=Or.transition;Or.transition=null;try{xt=4,Tc(t,s,n,r)}finally{xt=a,Or.transition=o}}function Tc(t,s,n,r){if(Do){var a=Di(t,s,n,r);if(a===null)Bl(t,s,r,Lo,n),Td(t,r);else if(jx(a,t,s,n,r))r.stopPropagation();else if(Td(t,r),s&4&&-1<yx.indexOf(t)){for(;a!==null;){var o=Ha(a);if(o!==null&&F0(o),o=Di(t,s,n,r),o===null&&Bl(t,s,r,Lo,n),o===a)break;a=o}a!==null&&r.stopPropagation()}else Bl(t,s,r,null,n)}}var Lo=null;function Di(t,s,n,r){if(Lo=null,t=Ec(r),t=rr(t),t!==null)if(s=pr(t),s===null)t=null;else if(n=s.tag,n===13){if(t=M0(s),t!==null)return t;t=null}else if(n===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null);return Lo=t,null}function H0(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mx()){case Ic:return 1;case L0:return 4;case _o:case hx:return 16;case P0:return 536870912;default:return 16}default:return 16}}var Ln=null,Dc=null,vo=null;function G0(){if(vo)return vo;var t,s=Dc,n=s.length,r,a="value"in Ln?Ln.value:Ln.textContent,o=a.length;for(t=0;t<n&&s[t]===a[t];t++);var l=n-t;for(r=1;r<=l&&s[n-r]===a[o-r];r++);return vo=a.slice(t,1<r?1-r:void 0)}function yo(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function to(){return!0}function Ld(){return!1}function ps(t){function s(n,r,a,o,l){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(n=t[c],this[c]=n?n(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?to:Ld,this.isPropagationStopped=Ld,this}return Ct(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=to)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=to)},persist:function(){},isPersistent:to}),s}var Zr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lc=ps(Zr),Ua=Ct({},Zr,{view:0,detail:0}),Cx=ps(Ua),Ml,_l,na,nl=Ct({},Ua,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==na&&(na&&t.type==="mousemove"?(Ml=t.screenX-na.screenX,_l=t.screenY-na.screenY):_l=Ml=0,na=t),Ml)},movementY:function(t){return"movementY"in t?t.movementY:_l}}),Pd=ps(nl),$x=Ct({},nl,{dataTransfer:0}),Ax=ps($x),Ex=Ct({},Ua,{relatedTarget:0}),Tl=ps(Ex),Ix=Ct({},Zr,{animationName:0,elapsedTime:0,pseudoElement:0}),Mx=ps(Ix),_x=Ct({},Zr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Tx=ps(_x),Dx=Ct({},Zr,{data:0}),Rd=ps(Dx),Lx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Px={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Rx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ox(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=Rx[t])?!!s[t]:!1}function Pc(){return Ox}var Fx=Ct({},Ua,{key:function(t){if(t.key){var s=Lx[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=yo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Px[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pc,charCode:function(t){return t.type==="keypress"?yo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?yo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Bx=ps(Fx),zx=Ct({},nl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Od=ps(zx),Wx=Ct({},Ua,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pc}),Ux=ps(Wx),Hx=Ct({},Zr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gx=ps(Hx),Vx=Ct({},nl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Kx=ps(Vx),Yx=[9,13,27,32],Rc=yn&&"CompositionEvent"in window,pa=null;yn&&"documentMode"in document&&(pa=document.documentMode);var Jx=yn&&"TextEvent"in window&&!pa,V0=yn&&(!Rc||pa&&8<pa&&11>=pa),Fd=" ",Bd=!1;function K0(t,s){switch(t){case"keyup":return Yx.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Y0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Nr=!1;function Zx(t,s){switch(t){case"compositionend":return Y0(s);case"keypress":return s.which!==32?null:(Bd=!0,Fd);case"textInput":return t=s.data,t===Fd&&Bd?null:t;default:return null}}function Xx(t,s){if(Nr)return t==="compositionend"||!Rc&&K0(t,s)?(t=G0(),vo=Dc=Ln=null,Nr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return V0&&s.locale!=="ko"?null:s.data;default:return null}}var qx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zd(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!qx[t.type]:s==="textarea"}function J0(t,s,n,r){C0(r),s=Po(s,"onChange"),0<s.length&&(n=new Lc("onChange","change",null,n,r),t.push({event:n,listeners:s}))}var fa=null,Ea=null;function Qx(t){om(t,0)}function rl(t){var s=Cr(t);if(w0(s))return t}function ep(t,s){if(t==="change")return s}var Z0=!1;if(yn){var Dl;if(yn){var Ll="oninput"in document;if(!Ll){var Wd=document.createElement("div");Wd.setAttribute("oninput","return;"),Ll=typeof Wd.oninput=="function"}Dl=Ll}else Dl=!1;Z0=Dl&&(!document.documentMode||9<document.documentMode)}function Ud(){fa&&(fa.detachEvent("onpropertychange",X0),Ea=fa=null)}function X0(t){if(t.propertyName==="value"&&rl(Ea)){var s=[];J0(s,Ea,t,Ec(t)),I0(Qx,s)}}function tp(t,s,n){t==="focusin"?(Ud(),fa=s,Ea=n,fa.attachEvent("onpropertychange",X0)):t==="focusout"&&Ud()}function sp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return rl(Ea)}function np(t,s){if(t==="click")return rl(s)}function rp(t,s){if(t==="input"||t==="change")return rl(s)}function ap(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Js=typeof Object.is=="function"?Object.is:ap;function Ia(t,s){if(Js(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var n=Object.keys(t),r=Object.keys(s);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!fi.call(s,a)||!Js(t[a],s[a]))return!1}return!0}function Hd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Gd(t,s){var n=Hd(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=s&&r>=s)return{node:n,offset:s-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Hd(n)}}function q0(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?q0(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function Q0(){for(var t=window,s=Eo();s instanceof t.HTMLIFrameElement;){try{var n=typeof s.contentWindow.location.href=="string"}catch{n=!1}if(n)t=s.contentWindow;else break;s=Eo(t.document)}return s}function Oc(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}function op(t){var s=Q0(),n=t.focusedElem,r=t.selectionRange;if(s!==n&&n&&n.ownerDocument&&q0(n.ownerDocument.documentElement,n)){if(r!==null&&Oc(n)){if(s=r.start,t=r.end,t===void 0&&(t=s),"selectionStart"in n)n.selectionStart=s,n.selectionEnd=Math.min(t,n.value.length);else if(t=(s=n.ownerDocument||document)&&s.defaultView||window,t.getSelection){t=t.getSelection();var a=n.textContent.length,o=Math.min(r.start,a);r=r.end===void 0?o:Math.min(r.end,a),!t.extend&&o>r&&(a=r,r=o,o=a),a=Gd(n,o);var l=Gd(n,r);a&&l&&(t.rangeCount!==1||t.anchorNode!==a.node||t.anchorOffset!==a.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(s=s.createRange(),s.setStart(a.node,a.offset),t.removeAllRanges(),o>r?(t.addRange(s),t.extend(l.node,l.offset)):(s.setEnd(l.node,l.offset),t.addRange(s)))}}for(s=[],t=n;t=t.parentNode;)t.nodeType===1&&s.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<s.length;n++)t=s[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var lp=yn&&"documentMode"in document&&11>=document.documentMode,kr=null,Li=null,ga=null,Pi=!1;function Vd(t,s,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Pi||kr==null||kr!==Eo(r)||(r=kr,"selectionStart"in r&&Oc(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ga&&Ia(ga,r)||(ga=r,r=Po(Li,"onSelect"),0<r.length&&(s=new Lc("onSelect","select",null,s,n),t.push({event:s,listeners:r}),s.target=kr)))}function so(t,s){var n={};return n[t.toLowerCase()]=s.toLowerCase(),n["Webkit"+t]="webkit"+s,n["Moz"+t]="moz"+s,n}var Sr={animationend:so("Animation","AnimationEnd"),animationiteration:so("Animation","AnimationIteration"),animationstart:so("Animation","AnimationStart"),transitionend:so("Transition","TransitionEnd")},Pl={},em={};yn&&(em=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);function al(t){if(Pl[t])return Pl[t];if(!Sr[t])return t;var s=Sr[t],n;for(n in s)if(s.hasOwnProperty(n)&&n in em)return Pl[t]=s[n];return t}var tm=al("animationend"),sm=al("animationiteration"),nm=al("animationstart"),rm=al("transitionend"),am=new Map,Kd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Yn(t,s){am.set(t,s),xr(s,[t])}for(var Rl=0;Rl<Kd.length;Rl++){var Ol=Kd[Rl],ip=Ol.toLowerCase(),cp=Ol[0].toUpperCase()+Ol.slice(1);Yn(ip,"on"+cp)}Yn(tm,"onAnimationEnd");Yn(sm,"onAnimationIteration");Yn(nm,"onAnimationStart");Yn("dblclick","onDoubleClick");Yn("focusin","onFocus");Yn("focusout","onBlur");Yn(rm,"onTransitionEnd");zr("onMouseEnter",["mouseout","mouseover"]);zr("onMouseLeave",["mouseout","mouseover"]);zr("onPointerEnter",["pointerout","pointerover"]);zr("onPointerLeave",["pointerout","pointerover"]);xr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));xr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));xr("onBeforeInput",["compositionend","keypress","textInput","paste"]);xr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));xr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));xr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ma="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dp=new Set("cancel close invalid load scroll toggle".split(" ").concat(ma));function Yd(t,s,n){var r=t.type||"unknown-event";t.currentTarget=n,ix(r,s,void 0,t),t.currentTarget=null}function om(t,s){s=(s&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],a=r.event;r=r.listeners;e:{var o=void 0;if(s)for(var l=r.length-1;0<=l;l--){var c=r[l],i=c.instance,d=c.currentTarget;if(c=c.listener,i!==o&&a.isPropagationStopped())break e;Yd(a,c,d),o=i}else for(l=0;l<r.length;l++){if(c=r[l],i=c.instance,d=c.currentTarget,c=c.listener,i!==o&&a.isPropagationStopped())break e;Yd(a,c,d),o=i}}}if(Mo)throw t=Mi,Mo=!1,Mi=null,t}function bt(t,s){var n=s[zi];n===void 0&&(n=s[zi]=new Set);var r=t+"__bubble";n.has(r)||(lm(s,t,2,!1),n.add(r))}function Fl(t,s,n){var r=0;s&&(r|=4),lm(n,t,r,s)}var no="_reactListening"+Math.random().toString(36).slice(2);function Ma(t){if(!t[no]){t[no]=!0,x0.forEach(function(n){n!=="selectionchange"&&(dp.has(n)||Fl(n,!1,t),Fl(n,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[no]||(s[no]=!0,Fl("selectionchange",!1,s))}}function lm(t,s,n,r){switch(H0(s)){case 1:var a=kx;break;case 4:a=Sx;break;default:a=Tc}n=a.bind(null,s,n,t),a=void 0,!Ii||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(a=!0),r?a!==void 0?t.addEventListener(s,n,{capture:!0,passive:a}):t.addEventListener(s,n,!0):a!==void 0?t.addEventListener(s,n,{passive:a}):t.addEventListener(s,n,!1)}function Bl(t,s,n,r,a){var o=r;if(!(s&1)&&!(s&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===a||c.nodeType===8&&c.parentNode===a)break;if(l===4)for(l=r.return;l!==null;){var i=l.tag;if((i===3||i===4)&&(i=l.stateNode.containerInfo,i===a||i.nodeType===8&&i.parentNode===a))return;l=l.return}for(;c!==null;){if(l=rr(c),l===null)return;if(i=l.tag,i===5||i===6){r=o=l;continue e}c=c.parentNode}}r=r.return}I0(function(){var d=o,h=Ec(n),p=[];e:{var f=am.get(t);if(f!==void 0){var m=Lc,x=t;switch(t){case"keypress":if(yo(n)===0)break e;case"keydown":case"keyup":m=Bx;break;case"focusin":x="focus",m=Tl;break;case"focusout":x="blur",m=Tl;break;case"beforeblur":case"afterblur":m=Tl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Pd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Ax;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Ux;break;case tm:case sm:case nm:m=Mx;break;case rm:m=Gx;break;case"scroll":m=Cx;break;case"wheel":m=Kx;break;case"copy":case"cut":case"paste":m=Tx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Od}var g=(s&4)!==0,A=!g&&t==="scroll",w=g?f!==null?f+"Capture":null:f;g=[];for(var b=d,v;b!==null;){v=b;var j=v.stateNode;if(v.tag===5&&j!==null&&(v=j,w!==null&&(j=Sa(b,w),j!=null&&g.push(_a(b,j,v)))),A)break;b=b.return}0<g.length&&(f=new m(f,x,null,n,h),p.push({event:f,listeners:g}))}}if(!(s&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&n!==Ai&&(x=n.relatedTarget||n.fromElement)&&(rr(x)||x[jn]))break e;if((m||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,m?(x=n.relatedTarget||n.toElement,m=d,x=x?rr(x):null,x!==null&&(A=pr(x),x!==A||x.tag!==5&&x.tag!==6)&&(x=null)):(m=null,x=d),m!==x)){if(g=Pd,j="onMouseLeave",w="onMouseEnter",b="mouse",(t==="pointerout"||t==="pointerover")&&(g=Od,j="onPointerLeave",w="onPointerEnter",b="pointer"),A=m==null?f:Cr(m),v=x==null?f:Cr(x),f=new g(j,b+"leave",m,n,h),f.target=A,f.relatedTarget=v,j=null,rr(h)===d&&(g=new g(w,b+"enter",x,n,h),g.target=v,g.relatedTarget=A,j=g),A=j,m&&x)t:{for(g=m,w=x,b=0,v=g;v;v=br(v))b++;for(v=0,j=w;j;j=br(j))v++;for(;0<b-v;)g=br(g),b--;for(;0<v-b;)w=br(w),v--;for(;b--;){if(g===w||w!==null&&g===w.alternate)break t;g=br(g),w=br(w)}g=null}else g=null;m!==null&&Jd(p,f,m,g,!1),x!==null&&A!==null&&Jd(p,A,x,g,!0)}}e:{if(f=d?Cr(d):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var T=ep;else if(zd(f))if(Z0)T=rp;else{T=sp;var $=tp}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(T=np);if(T&&(T=T(t,d))){J0(p,T,n,h);break e}$&&$(t,f,d),t==="focusout"&&($=f._wrapperState)&&$.controlled&&f.type==="number"&&Ni(f,"number",f.value)}switch($=d?Cr(d):window,t){case"focusin":(zd($)||$.contentEditable==="true")&&(kr=$,Li=d,ga=null);break;case"focusout":ga=Li=kr=null;break;case"mousedown":Pi=!0;break;case"contextmenu":case"mouseup":case"dragend":Pi=!1,Vd(p,n,h);break;case"selectionchange":if(lp)break;case"keydown":case"keyup":Vd(p,n,h)}var D;if(Rc)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Nr?K0(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(V0&&n.locale!=="ko"&&(Nr||M!=="onCompositionStart"?M==="onCompositionEnd"&&Nr&&(D=G0()):(Ln=h,Dc="value"in Ln?Ln.value:Ln.textContent,Nr=!0)),$=Po(d,M),0<$.length&&(M=new Rd(M,t,null,n,h),p.push({event:M,listeners:$}),D?M.data=D:(D=Y0(n),D!==null&&(M.data=D)))),(D=Jx?Zx(t,n):Xx(t,n))&&(d=Po(d,"onBeforeInput"),0<d.length&&(h=new Rd("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:d}),h.data=D))}om(p,s)})}function _a(t,s,n){return{instance:t,listener:s,currentTarget:n}}function Po(t,s){for(var n=s+"Capture",r=[];t!==null;){var a=t,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=Sa(t,n),o!=null&&r.unshift(_a(t,o,a)),o=Sa(t,s),o!=null&&r.push(_a(t,o,a))),t=t.return}return r}function br(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Jd(t,s,n,r,a){for(var o=s._reactName,l=[];n!==null&&n!==r;){var c=n,i=c.alternate,d=c.stateNode;if(i!==null&&i===r)break;c.tag===5&&d!==null&&(c=d,a?(i=Sa(n,o),i!=null&&l.unshift(_a(n,i,c))):a||(i=Sa(n,o),i!=null&&l.push(_a(n,i,c)))),n=n.return}l.length!==0&&t.push({event:s,listeners:l})}var up=/\r\n?/g,mp=/\u0000|\uFFFD/g;function Zd(t){return(typeof t=="string"?t:""+t).replace(up,`
`).replace(mp,"")}function ro(t,s,n){if(s=Zd(s),Zd(t)!==s&&n)throw Error(Pe(425))}function Ro(){}var Ri=null,Oi=null;function Fi(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Bi=typeof setTimeout=="function"?setTimeout:void 0,hp=typeof clearTimeout=="function"?clearTimeout:void 0,Xd=typeof Promise=="function"?Promise:void 0,xp=typeof queueMicrotask=="function"?queueMicrotask:typeof Xd<"u"?function(t){return Xd.resolve(null).then(t).catch(pp)}:Bi;function pp(t){setTimeout(function(){throw t})}function zl(t,s){var n=s,r=0;do{var a=n.nextSibling;if(t.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){t.removeChild(a),Aa(s);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);Aa(s)}function zn(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return t}function qd(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(s===0)return t;s--}else n==="/$"&&s++}t=t.previousSibling}return null}var Xr=Math.random().toString(36).slice(2),rn="__reactFiber$"+Xr,Ta="__reactProps$"+Xr,jn="__reactContainer$"+Xr,zi="__reactEvents$"+Xr,fp="__reactListeners$"+Xr,gp="__reactHandles$"+Xr;function rr(t){var s=t[rn];if(s)return s;for(var n=t.parentNode;n;){if(s=n[jn]||n[rn]){if(n=s.alternate,s.child!==null||n!==null&&n.child!==null)for(t=qd(t);t!==null;){if(n=t[rn])return n;t=qd(t)}return s}t=n,n=t.parentNode}return null}function Ha(t){return t=t[rn]||t[jn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Cr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Pe(33))}function ol(t){return t[Ta]||null}var Wi=[],$r=-1;function Jn(t){return{current:t}}function wt(t){0>$r||(t.current=Wi[$r],Wi[$r]=null,$r--)}function ft(t,s){$r++,Wi[$r]=t.current,t.current=s}var Kn={},Jt=Jn(Kn),os=Jn(!1),cr=Kn;function Wr(t,s){var n=t.type.contextTypes;if(!n)return Kn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===s)return r.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in n)a[o]=s[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=a),a}function ls(t){return t=t.childContextTypes,t!=null}function Oo(){wt(os),wt(Jt)}function Qd(t,s,n){if(Jt.current!==Kn)throw Error(Pe(168));ft(Jt,s),ft(os,n)}function im(t,s,n){var r=t.stateNode;if(s=s.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in s))throw Error(Pe(108,tx(t)||"Unknown",a));return Ct({},n,r)}function Fo(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Kn,cr=Jt.current,ft(Jt,t),ft(os,os.current),!0}function eu(t,s,n){var r=t.stateNode;if(!r)throw Error(Pe(169));n?(t=im(t,s,cr),r.__reactInternalMemoizedMergedChildContext=t,wt(os),wt(Jt),ft(Jt,t)):wt(os),ft(os,n)}var gn=null,ll=!1,Wl=!1;function cm(t){gn===null?gn=[t]:gn.push(t)}function bp(t){ll=!0,cm(t)}function Zn(){if(!Wl&&gn!==null){Wl=!0;var t=0,s=xt;try{var n=gn;for(xt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}gn=null,ll=!1}catch(a){throw gn!==null&&(gn=gn.slice(t+1)),D0(Ic,Zn),a}finally{xt=s,Wl=!1}}return null}var Ar=[],Er=0,Bo=null,zo=0,ys=[],js=0,dr=null,bn=1,wn="";function sr(t,s){Ar[Er++]=zo,Ar[Er++]=Bo,Bo=t,zo=s}function dm(t,s,n){ys[js++]=bn,ys[js++]=wn,ys[js++]=dr,dr=t;var r=bn;t=wn;var a=32-Vs(r)-1;r&=~(1<<a),n+=1;var o=32-Vs(s)+a;if(30<o){var l=a-a%5;o=(r&(1<<l)-1).toString(32),r>>=l,a-=l,bn=1<<32-Vs(s)+a|n<<a|r,wn=o+t}else bn=1<<o|n<<a|r,wn=t}function Fc(t){t.return!==null&&(sr(t,1),dm(t,1,0))}function Bc(t){for(;t===Bo;)Bo=Ar[--Er],Ar[Er]=null,zo=Ar[--Er],Ar[Er]=null;for(;t===dr;)dr=ys[--js],ys[js]=null,wn=ys[--js],ys[js]=null,bn=ys[--js],ys[js]=null}var ms=null,us=null,jt=!1,Gs=null;function um(t,s){var n=Ns(5,null,null,0);n.elementType="DELETED",n.stateNode=s,n.return=t,s=t.deletions,s===null?(t.deletions=[n],t.flags|=16):s.push(n)}function tu(t,s){switch(t.tag){case 5:var n=t.type;return s=s.nodeType!==1||n.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(t.stateNode=s,ms=t,us=zn(s.firstChild),!0):!1;case 6:return s=t.pendingProps===""||s.nodeType!==3?null:s,s!==null?(t.stateNode=s,ms=t,us=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(n=dr!==null?{id:bn,overflow:wn}:null,t.memoizedState={dehydrated:s,treeContext:n,retryLane:1073741824},n=Ns(18,null,null,0),n.stateNode=s,n.return=t,t.child=n,ms=t,us=null,!0):!1;default:return!1}}function Ui(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Hi(t){if(jt){var s=us;if(s){var n=s;if(!tu(t,s)){if(Ui(t))throw Error(Pe(418));s=zn(n.nextSibling);var r=ms;s&&tu(t,s)?um(r,n):(t.flags=t.flags&-4097|2,jt=!1,ms=t)}}else{if(Ui(t))throw Error(Pe(418));t.flags=t.flags&-4097|2,jt=!1,ms=t}}}function su(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ms=t}function ao(t){if(t!==ms)return!1;if(!jt)return su(t),jt=!0,!1;var s;if((s=t.tag!==3)&&!(s=t.tag!==5)&&(s=t.type,s=s!=="head"&&s!=="body"&&!Fi(t.type,t.memoizedProps)),s&&(s=us)){if(Ui(t))throw mm(),Error(Pe(418));for(;s;)um(t,s),s=zn(s.nextSibling)}if(su(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Pe(317));e:{for(t=t.nextSibling,s=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(s===0){us=zn(t.nextSibling);break e}s--}else n!=="$"&&n!=="$!"&&n!=="$?"||s++}t=t.nextSibling}us=null}}else us=ms?zn(t.stateNode.nextSibling):null;return!0}function mm(){for(var t=us;t;)t=zn(t.nextSibling)}function Ur(){us=ms=null,jt=!1}function zc(t){Gs===null?Gs=[t]:Gs.push(t)}var wp=Cn.ReactCurrentBatchConfig;function ra(t,s,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Pe(309));var r=n.stateNode}if(!r)throw Error(Pe(147,t));var a=r,o=""+t;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===o?s.ref:(s=function(l){var c=a.refs;l===null?delete c[o]:c[o]=l},s._stringRef=o,s)}if(typeof t!="string")throw Error(Pe(284));if(!n._owner)throw Error(Pe(290,t))}return t}function oo(t,s){throw t=Object.prototype.toString.call(s),Error(Pe(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t))}function nu(t){var s=t._init;return s(t._payload)}function hm(t){function s(w,b){if(t){var v=w.deletions;v===null?(w.deletions=[b],w.flags|=16):v.push(b)}}function n(w,b){if(!t)return null;for(;b!==null;)s(w,b),b=b.sibling;return null}function r(w,b){for(w=new Map;b!==null;)b.key!==null?w.set(b.key,b):w.set(b.index,b),b=b.sibling;return w}function a(w,b){return w=Gn(w,b),w.index=0,w.sibling=null,w}function o(w,b,v){return w.index=v,t?(v=w.alternate,v!==null?(v=v.index,v<b?(w.flags|=2,b):v):(w.flags|=2,b)):(w.flags|=1048576,b)}function l(w){return t&&w.alternate===null&&(w.flags|=2),w}function c(w,b,v,j){return b===null||b.tag!==6?(b=Jl(v,w.mode,j),b.return=w,b):(b=a(b,v),b.return=w,b)}function i(w,b,v,j){var T=v.type;return T===jr?h(w,b,v.props.children,j,v.key):b!==null&&(b.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===In&&nu(T)===b.type)?(j=a(b,v.props),j.ref=ra(w,b,v),j.return=w,j):(j=Ao(v.type,v.key,v.props,null,w.mode,j),j.ref=ra(w,b,v),j.return=w,j)}function d(w,b,v,j){return b===null||b.tag!==4||b.stateNode.containerInfo!==v.containerInfo||b.stateNode.implementation!==v.implementation?(b=Zl(v,w.mode,j),b.return=w,b):(b=a(b,v.children||[]),b.return=w,b)}function h(w,b,v,j,T){return b===null||b.tag!==7?(b=ir(v,w.mode,j,T),b.return=w,b):(b=a(b,v),b.return=w,b)}function p(w,b,v){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Jl(""+b,w.mode,v),b.return=w,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ja:return v=Ao(b.type,b.key,b.props,null,w.mode,v),v.ref=ra(w,null,b),v.return=w,v;case yr:return b=Zl(b,w.mode,v),b.return=w,b;case In:var j=b._init;return p(w,j(b._payload),v)}if(da(b)||Qr(b))return b=ir(b,w.mode,v,null),b.return=w,b;oo(w,b)}return null}function f(w,b,v,j){var T=b!==null?b.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return T!==null?null:c(w,b,""+v,j);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Ja:return v.key===T?i(w,b,v,j):null;case yr:return v.key===T?d(w,b,v,j):null;case In:return T=v._init,f(w,b,T(v._payload),j)}if(da(v)||Qr(v))return T!==null?null:h(w,b,v,j,null);oo(w,v)}return null}function m(w,b,v,j,T){if(typeof j=="string"&&j!==""||typeof j=="number")return w=w.get(v)||null,c(b,w,""+j,T);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Ja:return w=w.get(j.key===null?v:j.key)||null,i(b,w,j,T);case yr:return w=w.get(j.key===null?v:j.key)||null,d(b,w,j,T);case In:var $=j._init;return m(w,b,v,$(j._payload),T)}if(da(j)||Qr(j))return w=w.get(v)||null,h(b,w,j,T,null);oo(b,j)}return null}function x(w,b,v,j){for(var T=null,$=null,D=b,M=b=0,Q=null;D!==null&&M<v.length;M++){D.index>M?(Q=D,D=null):Q=D.sibling;var q=f(w,D,v[M],j);if(q===null){D===null&&(D=Q);break}t&&D&&q.alternate===null&&s(w,D),b=o(q,b,M),$===null?T=q:$.sibling=q,$=q,D=Q}if(M===v.length)return n(w,D),jt&&sr(w,M),T;if(D===null){for(;M<v.length;M++)D=p(w,v[M],j),D!==null&&(b=o(D,b,M),$===null?T=D:$.sibling=D,$=D);return jt&&sr(w,M),T}for(D=r(w,D);M<v.length;M++)Q=m(D,w,M,v[M],j),Q!==null&&(t&&Q.alternate!==null&&D.delete(Q.key===null?M:Q.key),b=o(Q,b,M),$===null?T=Q:$.sibling=Q,$=Q);return t&&D.forEach(function(re){return s(w,re)}),jt&&sr(w,M),T}function g(w,b,v,j){var T=Qr(v);if(typeof T!="function")throw Error(Pe(150));if(v=T.call(v),v==null)throw Error(Pe(151));for(var $=T=null,D=b,M=b=0,Q=null,q=v.next();D!==null&&!q.done;M++,q=v.next()){D.index>M?(Q=D,D=null):Q=D.sibling;var re=f(w,D,q.value,j);if(re===null){D===null&&(D=Q);break}t&&D&&re.alternate===null&&s(w,D),b=o(re,b,M),$===null?T=re:$.sibling=re,$=re,D=Q}if(q.done)return n(w,D),jt&&sr(w,M),T;if(D===null){for(;!q.done;M++,q=v.next())q=p(w,q.value,j),q!==null&&(b=o(q,b,M),$===null?T=q:$.sibling=q,$=q);return jt&&sr(w,M),T}for(D=r(w,D);!q.done;M++,q=v.next())q=m(D,w,M,q.value,j),q!==null&&(t&&q.alternate!==null&&D.delete(q.key===null?M:q.key),b=o(q,b,M),$===null?T=q:$.sibling=q,$=q);return t&&D.forEach(function(ce){return s(w,ce)}),jt&&sr(w,M),T}function A(w,b,v,j){if(typeof v=="object"&&v!==null&&v.type===jr&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Ja:e:{for(var T=v.key,$=b;$!==null;){if($.key===T){if(T=v.type,T===jr){if($.tag===7){n(w,$.sibling),b=a($,v.props.children),b.return=w,w=b;break e}}else if($.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===In&&nu(T)===$.type){n(w,$.sibling),b=a($,v.props),b.ref=ra(w,$,v),b.return=w,w=b;break e}n(w,$);break}else s(w,$);$=$.sibling}v.type===jr?(b=ir(v.props.children,w.mode,j,v.key),b.return=w,w=b):(j=Ao(v.type,v.key,v.props,null,w.mode,j),j.ref=ra(w,b,v),j.return=w,w=j)}return l(w);case yr:e:{for($=v.key;b!==null;){if(b.key===$)if(b.tag===4&&b.stateNode.containerInfo===v.containerInfo&&b.stateNode.implementation===v.implementation){n(w,b.sibling),b=a(b,v.children||[]),b.return=w,w=b;break e}else{n(w,b);break}else s(w,b);b=b.sibling}b=Zl(v,w.mode,j),b.return=w,w=b}return l(w);case In:return $=v._init,A(w,b,$(v._payload),j)}if(da(v))return x(w,b,v,j);if(Qr(v))return g(w,b,v,j);oo(w,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,b!==null&&b.tag===6?(n(w,b.sibling),b=a(b,v),b.return=w,w=b):(n(w,b),b=Jl(v,w.mode,j),b.return=w,w=b),l(w)):n(w,b)}return A}var Hr=hm(!0),xm=hm(!1),Wo=Jn(null),Uo=null,Ir=null,Wc=null;function Uc(){Wc=Ir=Uo=null}function Hc(t){var s=Wo.current;wt(Wo),t._currentValue=s}function Gi(t,s,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,r!==null&&(r.childLanes|=s)):r!==null&&(r.childLanes&s)!==s&&(r.childLanes|=s),t===n)break;t=t.return}}function Fr(t,s){Uo=t,Wc=Ir=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&s&&(as=!0),t.firstContext=null)}function Ss(t){var s=t._currentValue;if(Wc!==t)if(t={context:t,memoizedValue:s,next:null},Ir===null){if(Uo===null)throw Error(Pe(308));Ir=t,Uo.dependencies={lanes:0,firstContext:t}}else Ir=Ir.next=t;return s}var ar=null;function Gc(t){ar===null?ar=[t]:ar.push(t)}function pm(t,s,n,r){var a=s.interleaved;return a===null?(n.next=n,Gc(s)):(n.next=a.next,a.next=n),s.interleaved=n,Nn(t,r)}function Nn(t,s){t.lanes|=s;var n=t.alternate;for(n!==null&&(n.lanes|=s),n=t,t=t.return;t!==null;)t.childLanes|=s,n=t.alternate,n!==null&&(n.childLanes|=s),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Mn=!1;function Vc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fm(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function vn(t,s){return{eventTime:t,lane:s,tag:0,payload:null,callback:null,next:null}}function Wn(t,s,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,dt&2){var a=r.pending;return a===null?s.next=s:(s.next=a.next,a.next=s),r.pending=s,Nn(t,n)}return a=r.interleaved,a===null?(s.next=s,Gc(r)):(s.next=a.next,a.next=s),r.interleaved=s,Nn(t,n)}function jo(t,s,n){if(s=s.updateQueue,s!==null&&(s=s.shared,(n&4194240)!==0)){var r=s.lanes;r&=t.pendingLanes,n|=r,s.lanes=n,Mc(t,n)}}function ru(t,s){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?a=o=l:o=o.next=l,n=n.next}while(n!==null);o===null?a=o=s:o=o.next=s}else a=o=s;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=s:t.next=s,n.lastBaseUpdate=s}function Ho(t,s,n,r){var a=t.updateQueue;Mn=!1;var o=a.firstBaseUpdate,l=a.lastBaseUpdate,c=a.shared.pending;if(c!==null){a.shared.pending=null;var i=c,d=i.next;i.next=null,l===null?o=d:l.next=d,l=i;var h=t.alternate;h!==null&&(h=h.updateQueue,c=h.lastBaseUpdate,c!==l&&(c===null?h.firstBaseUpdate=d:c.next=d,h.lastBaseUpdate=i))}if(o!==null){var p=a.baseState;l=0,h=d=i=null,c=o;do{var f=c.lane,m=c.eventTime;if((r&f)===f){h!==null&&(h=h.next={eventTime:m,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var x=t,g=c;switch(f=s,m=n,g.tag){case 1:if(x=g.payload,typeof x=="function"){p=x.call(m,p,f);break e}p=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,f=typeof x=="function"?x.call(m,p,f):x,f==null)break e;p=Ct({},p,f);break e;case 2:Mn=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,f=a.effects,f===null?a.effects=[c]:f.push(c))}else m={eventTime:m,lane:f,tag:c.tag,payload:c.payload,callback:c.callback,next:null},h===null?(d=h=m,i=p):h=h.next=m,l|=f;if(c=c.next,c===null){if(c=a.shared.pending,c===null)break;f=c,c=f.next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}while(!0);if(h===null&&(i=p),a.baseState=i,a.firstBaseUpdate=d,a.lastBaseUpdate=h,s=a.shared.interleaved,s!==null){a=s;do l|=a.lane,a=a.next;while(a!==s)}else o===null&&(a.shared.lanes=0);mr|=l,t.lanes=l,t.memoizedState=p}}function au(t,s,n){if(t=s.effects,s.effects=null,t!==null)for(s=0;s<t.length;s++){var r=t[s],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(Pe(191,a));a.call(r)}}}var Ga={},ln=Jn(Ga),Da=Jn(Ga),La=Jn(Ga);function or(t){if(t===Ga)throw Error(Pe(174));return t}function Kc(t,s){switch(ft(La,s),ft(Da,t),ft(ln,Ga),t=s.nodeType,t){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Si(null,"");break;default:t=t===8?s.parentNode:s,s=t.namespaceURI||null,t=t.tagName,s=Si(s,t)}wt(ln),ft(ln,s)}function Gr(){wt(ln),wt(Da),wt(La)}function gm(t){or(La.current);var s=or(ln.current),n=Si(s,t.type);s!==n&&(ft(Da,t),ft(ln,n))}function Yc(t){Da.current===t&&(wt(ln),wt(Da))}var kt=Jn(0);function Go(t){for(var s=t;s!==null;){if(s.tag===13){var n=s.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ul=[];function Jc(){for(var t=0;t<Ul.length;t++)Ul[t]._workInProgressVersionPrimary=null;Ul.length=0}var No=Cn.ReactCurrentDispatcher,Hl=Cn.ReactCurrentBatchConfig,ur=0,St=null,Tt=null,Rt=null,Vo=!1,ba=!1,Pa=0,vp=0;function Vt(){throw Error(Pe(321))}function Zc(t,s){if(s===null)return!1;for(var n=0;n<s.length&&n<t.length;n++)if(!Js(t[n],s[n]))return!1;return!0}function Xc(t,s,n,r,a,o){if(ur=o,St=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,No.current=t===null||t.memoizedState===null?kp:Sp,t=n(r,a),ba){o=0;do{if(ba=!1,Pa=0,25<=o)throw Error(Pe(301));o+=1,Rt=Tt=null,s.updateQueue=null,No.current=Cp,t=n(r,a)}while(ba)}if(No.current=Ko,s=Tt!==null&&Tt.next!==null,ur=0,Rt=Tt=St=null,Vo=!1,s)throw Error(Pe(300));return t}function qc(){var t=Pa!==0;return Pa=0,t}function tn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rt===null?St.memoizedState=Rt=t:Rt=Rt.next=t,Rt}function Cs(){if(Tt===null){var t=St.alternate;t=t!==null?t.memoizedState:null}else t=Tt.next;var s=Rt===null?St.memoizedState:Rt.next;if(s!==null)Rt=s,Tt=t;else{if(t===null)throw Error(Pe(310));Tt=t,t={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Rt===null?St.memoizedState=Rt=t:Rt=Rt.next=t}return Rt}function Ra(t,s){return typeof s=="function"?s(t):s}function Gl(t){var s=Cs(),n=s.queue;if(n===null)throw Error(Pe(311));n.lastRenderedReducer=t;var r=Tt,a=r.baseQueue,o=n.pending;if(o!==null){if(a!==null){var l=a.next;a.next=o.next,o.next=l}r.baseQueue=a=o,n.pending=null}if(a!==null){o=a.next,r=r.baseState;var c=l=null,i=null,d=o;do{var h=d.lane;if((ur&h)===h)i!==null&&(i=i.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var p={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};i===null?(c=i=p,l=r):i=i.next=p,St.lanes|=h,mr|=h}d=d.next}while(d!==null&&d!==o);i===null?l=r:i.next=c,Js(r,s.memoizedState)||(as=!0),s.memoizedState=r,s.baseState=l,s.baseQueue=i,n.lastRenderedState=r}if(t=n.interleaved,t!==null){a=t;do o=a.lane,St.lanes|=o,mr|=o,a=a.next;while(a!==t)}else a===null&&(n.lanes=0);return[s.memoizedState,n.dispatch]}function Vl(t){var s=Cs(),n=s.queue;if(n===null)throw Error(Pe(311));n.lastRenderedReducer=t;var r=n.dispatch,a=n.pending,o=s.memoizedState;if(a!==null){n.pending=null;var l=a=a.next;do o=t(o,l.action),l=l.next;while(l!==a);Js(o,s.memoizedState)||(as=!0),s.memoizedState=o,s.baseQueue===null&&(s.baseState=o),n.lastRenderedState=o}return[o,r]}function bm(){}function wm(t,s){var n=St,r=Cs(),a=s(),o=!Js(r.memoizedState,a);if(o&&(r.memoizedState=a,as=!0),r=r.queue,Qc(jm.bind(null,n,r,t),[t]),r.getSnapshot!==s||o||Rt!==null&&Rt.memoizedState.tag&1){if(n.flags|=2048,Oa(9,ym.bind(null,n,r,a,s),void 0,null),Ot===null)throw Error(Pe(349));ur&30||vm(n,s,a)}return a}function vm(t,s,n){t.flags|=16384,t={getSnapshot:s,value:n},s=St.updateQueue,s===null?(s={lastEffect:null,stores:null},St.updateQueue=s,s.stores=[t]):(n=s.stores,n===null?s.stores=[t]:n.push(t))}function ym(t,s,n,r){s.value=n,s.getSnapshot=r,Nm(s)&&km(t)}function jm(t,s,n){return n(function(){Nm(s)&&km(t)})}function Nm(t){var s=t.getSnapshot;t=t.value;try{var n=s();return!Js(t,n)}catch{return!0}}function km(t){var s=Nn(t,1);s!==null&&Ks(s,t,1,-1)}function ou(t){var s=tn();return typeof t=="function"&&(t=t()),s.memoizedState=s.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:t},s.queue=t,t=t.dispatch=Np.bind(null,St,t),[s.memoizedState,t]}function Oa(t,s,n,r){return t={tag:t,create:s,destroy:n,deps:r,next:null},s=St.updateQueue,s===null?(s={lastEffect:null,stores:null},St.updateQueue=s,s.lastEffect=t.next=t):(n=s.lastEffect,n===null?s.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,s.lastEffect=t)),t}function Sm(){return Cs().memoizedState}function ko(t,s,n,r){var a=tn();St.flags|=t,a.memoizedState=Oa(1|s,n,void 0,r===void 0?null:r)}function il(t,s,n,r){var a=Cs();r=r===void 0?null:r;var o=void 0;if(Tt!==null){var l=Tt.memoizedState;if(o=l.destroy,r!==null&&Zc(r,l.deps)){a.memoizedState=Oa(s,n,o,r);return}}St.flags|=t,a.memoizedState=Oa(1|s,n,o,r)}function lu(t,s){return ko(8390656,8,t,s)}function Qc(t,s){return il(2048,8,t,s)}function Cm(t,s){return il(4,2,t,s)}function $m(t,s){return il(4,4,t,s)}function Am(t,s){if(typeof s=="function")return t=t(),s(t),function(){s(null)};if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function Em(t,s,n){return n=n!=null?n.concat([t]):null,il(4,4,Am.bind(null,s,t),n)}function ed(){}function Im(t,s){var n=Cs();s=s===void 0?null:s;var r=n.memoizedState;return r!==null&&s!==null&&Zc(s,r[1])?r[0]:(n.memoizedState=[t,s],t)}function Mm(t,s){var n=Cs();s=s===void 0?null:s;var r=n.memoizedState;return r!==null&&s!==null&&Zc(s,r[1])?r[0]:(t=t(),n.memoizedState=[t,s],t)}function _m(t,s,n){return ur&21?(Js(n,s)||(n=R0(),St.lanes|=n,mr|=n,t.baseState=!0),s):(t.baseState&&(t.baseState=!1,as=!0),t.memoizedState=n)}function yp(t,s){var n=xt;xt=n!==0&&4>n?n:4,t(!0);var r=Hl.transition;Hl.transition={};try{t(!1),s()}finally{xt=n,Hl.transition=r}}function Tm(){return Cs().memoizedState}function jp(t,s,n){var r=Hn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Dm(t))Lm(s,n);else if(n=pm(t,s,n,r),n!==null){var a=es();Ks(n,t,r,a),Pm(n,s,r)}}function Np(t,s,n){var r=Hn(t),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Dm(t))Lm(s,a);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=s.lastRenderedReducer,o!==null))try{var l=s.lastRenderedState,c=o(l,n);if(a.hasEagerState=!0,a.eagerState=c,Js(c,l)){var i=s.interleaved;i===null?(a.next=a,Gc(s)):(a.next=i.next,i.next=a),s.interleaved=a;return}}catch{}finally{}n=pm(t,s,a,r),n!==null&&(a=es(),Ks(n,t,r,a),Pm(n,s,r))}}function Dm(t){var s=t.alternate;return t===St||s!==null&&s===St}function Lm(t,s){ba=Vo=!0;var n=t.pending;n===null?s.next=s:(s.next=n.next,n.next=s),t.pending=s}function Pm(t,s,n){if(n&4194240){var r=s.lanes;r&=t.pendingLanes,n|=r,s.lanes=n,Mc(t,n)}}var Ko={readContext:Ss,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useInsertionEffect:Vt,useLayoutEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useMutableSource:Vt,useSyncExternalStore:Vt,useId:Vt,unstable_isNewReconciler:!1},kp={readContext:Ss,useCallback:function(t,s){return tn().memoizedState=[t,s===void 0?null:s],t},useContext:Ss,useEffect:lu,useImperativeHandle:function(t,s,n){return n=n!=null?n.concat([t]):null,ko(4194308,4,Am.bind(null,s,t),n)},useLayoutEffect:function(t,s){return ko(4194308,4,t,s)},useInsertionEffect:function(t,s){return ko(4,2,t,s)},useMemo:function(t,s){var n=tn();return s=s===void 0?null:s,t=t(),n.memoizedState=[t,s],t},useReducer:function(t,s,n){var r=tn();return s=n!==void 0?n(s):s,r.memoizedState=r.baseState=s,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:s},r.queue=t,t=t.dispatch=jp.bind(null,St,t),[r.memoizedState,t]},useRef:function(t){var s=tn();return t={current:t},s.memoizedState=t},useState:ou,useDebugValue:ed,useDeferredValue:function(t){return tn().memoizedState=t},useTransition:function(){var t=ou(!1),s=t[0];return t=yp.bind(null,t[1]),tn().memoizedState=t,[s,t]},useMutableSource:function(){},useSyncExternalStore:function(t,s,n){var r=St,a=tn();if(jt){if(n===void 0)throw Error(Pe(407));n=n()}else{if(n=s(),Ot===null)throw Error(Pe(349));ur&30||vm(r,s,n)}a.memoizedState=n;var o={value:n,getSnapshot:s};return a.queue=o,lu(jm.bind(null,r,o,t),[t]),r.flags|=2048,Oa(9,ym.bind(null,r,o,n,s),void 0,null),n},useId:function(){var t=tn(),s=Ot.identifierPrefix;if(jt){var n=wn,r=bn;n=(r&~(1<<32-Vs(r)-1)).toString(32)+n,s=":"+s+"R"+n,n=Pa++,0<n&&(s+="H"+n.toString(32)),s+=":"}else n=vp++,s=":"+s+"r"+n.toString(32)+":";return t.memoizedState=s},unstable_isNewReconciler:!1},Sp={readContext:Ss,useCallback:Im,useContext:Ss,useEffect:Qc,useImperativeHandle:Em,useInsertionEffect:Cm,useLayoutEffect:$m,useMemo:Mm,useReducer:Gl,useRef:Sm,useState:function(){return Gl(Ra)},useDebugValue:ed,useDeferredValue:function(t){var s=Cs();return _m(s,Tt.memoizedState,t)},useTransition:function(){var t=Gl(Ra)[0],s=Cs().memoizedState;return[t,s]},useMutableSource:bm,useSyncExternalStore:wm,useId:Tm,unstable_isNewReconciler:!1},Cp={readContext:Ss,useCallback:Im,useContext:Ss,useEffect:Qc,useImperativeHandle:Em,useInsertionEffect:Cm,useLayoutEffect:$m,useMemo:Mm,useReducer:Vl,useRef:Sm,useState:function(){return Vl(Ra)},useDebugValue:ed,useDeferredValue:function(t){var s=Cs();return Tt===null?s.memoizedState=t:_m(s,Tt.memoizedState,t)},useTransition:function(){var t=Vl(Ra)[0],s=Cs().memoizedState;return[t,s]},useMutableSource:bm,useSyncExternalStore:wm,useId:Tm,unstable_isNewReconciler:!1};function Ws(t,s){if(t&&t.defaultProps){s=Ct({},s),t=t.defaultProps;for(var n in t)s[n]===void 0&&(s[n]=t[n]);return s}return s}function Vi(t,s,n,r){s=t.memoizedState,n=n(r,s),n=n==null?s:Ct({},s,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var cl={isMounted:function(t){return(t=t._reactInternals)?pr(t)===t:!1},enqueueSetState:function(t,s,n){t=t._reactInternals;var r=es(),a=Hn(t),o=vn(r,a);o.payload=s,n!=null&&(o.callback=n),s=Wn(t,o,a),s!==null&&(Ks(s,t,a,r),jo(s,t,a))},enqueueReplaceState:function(t,s,n){t=t._reactInternals;var r=es(),a=Hn(t),o=vn(r,a);o.tag=1,o.payload=s,n!=null&&(o.callback=n),s=Wn(t,o,a),s!==null&&(Ks(s,t,a,r),jo(s,t,a))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var n=es(),r=Hn(t),a=vn(n,r);a.tag=2,s!=null&&(a.callback=s),s=Wn(t,a,r),s!==null&&(Ks(s,t,r,n),jo(s,t,r))}};function iu(t,s,n,r,a,o,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,l):s.prototype&&s.prototype.isPureReactComponent?!Ia(n,r)||!Ia(a,o):!0}function Rm(t,s,n){var r=!1,a=Kn,o=s.contextType;return typeof o=="object"&&o!==null?o=Ss(o):(a=ls(s)?cr:Jt.current,r=s.contextTypes,o=(r=r!=null)?Wr(t,a):Kn),s=new s(n,o),t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=cl,t.stateNode=s,s._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=a,t.__reactInternalMemoizedMaskedChildContext=o),s}function cu(t,s,n,r){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(n,r),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(n,r),s.state!==t&&cl.enqueueReplaceState(s,s.state,null)}function Ki(t,s,n,r){var a=t.stateNode;a.props=n,a.state=t.memoizedState,a.refs={},Vc(t);var o=s.contextType;typeof o=="object"&&o!==null?a.context=Ss(o):(o=ls(s)?cr:Jt.current,a.context=Wr(t,o)),a.state=t.memoizedState,o=s.getDerivedStateFromProps,typeof o=="function"&&(Vi(t,s,o,n),a.state=t.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(s=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),s!==a.state&&cl.enqueueReplaceState(a,a.state,null),Ho(t,n,a,r),a.state=t.memoizedState),typeof a.componentDidMount=="function"&&(t.flags|=4194308)}function Vr(t,s){try{var n="",r=s;do n+=ex(r),r=r.return;while(r);var a=n}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:s,stack:a,digest:null}}function Kl(t,s,n){return{value:t,source:null,stack:n??null,digest:s??null}}function Yi(t,s){try{console.error(s.value)}catch(n){setTimeout(function(){throw n})}}var $p=typeof WeakMap=="function"?WeakMap:Map;function Om(t,s,n){n=vn(-1,n),n.tag=3,n.payload={element:null};var r=s.value;return n.callback=function(){Jo||(Jo=!0,rc=r),Yi(t,s)},n}function Fm(t,s,n){n=vn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var a=s.value;n.payload=function(){return r(a)},n.callback=function(){Yi(t,s)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Yi(t,s),typeof r!="function"&&(Un===null?Un=new Set([this]):Un.add(this));var l=s.stack;this.componentDidCatch(s.value,{componentStack:l!==null?l:""})}),n}function du(t,s,n){var r=t.pingCache;if(r===null){r=t.pingCache=new $p;var a=new Set;r.set(s,a)}else a=r.get(s),a===void 0&&(a=new Set,r.set(s,a));a.has(n)||(a.add(n),t=zp.bind(null,t,s,n),s.then(t,t))}function uu(t){do{var s;if((s=t.tag===13)&&(s=t.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return t;t=t.return}while(t!==null);return null}function mu(t,s,n,r,a){return t.mode&1?(t.flags|=65536,t.lanes=a,t):(t===s?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(s=vn(-1,1),s.tag=2,Wn(n,s,1))),n.lanes|=1),t)}var Ap=Cn.ReactCurrentOwner,as=!1;function Qt(t,s,n,r){s.child=t===null?xm(s,null,n,r):Hr(s,t.child,n,r)}function hu(t,s,n,r,a){n=n.render;var o=s.ref;return Fr(s,a),r=Xc(t,s,n,r,o,a),n=qc(),t!==null&&!as?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~a,kn(t,s,a)):(jt&&n&&Fc(s),s.flags|=1,Qt(t,s,r,a),s.child)}function xu(t,s,n,r,a){if(t===null){var o=n.type;return typeof o=="function"&&!id(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(s.tag=15,s.type=o,Bm(t,s,o,r,a)):(t=Ao(n.type,null,r,s,s.mode,a),t.ref=s.ref,t.return=s,s.child=t)}if(o=t.child,!(t.lanes&a)){var l=o.memoizedProps;if(n=n.compare,n=n!==null?n:Ia,n(l,r)&&t.ref===s.ref)return kn(t,s,a)}return s.flags|=1,t=Gn(o,r),t.ref=s.ref,t.return=s,s.child=t}function Bm(t,s,n,r,a){if(t!==null){var o=t.memoizedProps;if(Ia(o,r)&&t.ref===s.ref)if(as=!1,s.pendingProps=r=o,(t.lanes&a)!==0)t.flags&131072&&(as=!0);else return s.lanes=t.lanes,kn(t,s,a)}return Ji(t,s,n,r,a)}function zm(t,s,n){var r=s.pendingProps,a=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},ft(_r,ds),ds|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:t,cachePool:null,transitions:null},s.updateQueue=null,ft(_r,ds),ds|=t,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,ft(_r,ds),ds|=r}else o!==null?(r=o.baseLanes|n,s.memoizedState=null):r=n,ft(_r,ds),ds|=r;return Qt(t,s,a,n),s.child}function Wm(t,s){var n=s.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(s.flags|=512,s.flags|=2097152)}function Ji(t,s,n,r,a){var o=ls(n)?cr:Jt.current;return o=Wr(s,o),Fr(s,a),n=Xc(t,s,n,r,o,a),r=qc(),t!==null&&!as?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~a,kn(t,s,a)):(jt&&r&&Fc(s),s.flags|=1,Qt(t,s,n,a),s.child)}function pu(t,s,n,r,a){if(ls(n)){var o=!0;Fo(s)}else o=!1;if(Fr(s,a),s.stateNode===null)So(t,s),Rm(s,n,r),Ki(s,n,r,a),r=!0;else if(t===null){var l=s.stateNode,c=s.memoizedProps;l.props=c;var i=l.context,d=n.contextType;typeof d=="object"&&d!==null?d=Ss(d):(d=ls(n)?cr:Jt.current,d=Wr(s,d));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof l.getSnapshotBeforeUpdate=="function";p||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||i!==d)&&cu(s,l,r,d),Mn=!1;var f=s.memoizedState;l.state=f,Ho(s,r,l,a),i=s.memoizedState,c!==r||f!==i||os.current||Mn?(typeof h=="function"&&(Vi(s,n,h,r),i=s.memoizedState),(c=Mn||iu(s,n,c,r,f,i,d))?(p||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(s.flags|=4194308)):(typeof l.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=r,s.memoizedState=i),l.props=r,l.state=i,l.context=d,r=c):(typeof l.componentDidMount=="function"&&(s.flags|=4194308),r=!1)}else{l=s.stateNode,fm(t,s),c=s.memoizedProps,d=s.type===s.elementType?c:Ws(s.type,c),l.props=d,p=s.pendingProps,f=l.context,i=n.contextType,typeof i=="object"&&i!==null?i=Ss(i):(i=ls(n)?cr:Jt.current,i=Wr(s,i));var m=n.getDerivedStateFromProps;(h=typeof m=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==p||f!==i)&&cu(s,l,r,i),Mn=!1,f=s.memoizedState,l.state=f,Ho(s,r,l,a);var x=s.memoizedState;c!==p||f!==x||os.current||Mn?(typeof m=="function"&&(Vi(s,n,m,r),x=s.memoizedState),(d=Mn||iu(s,n,d,r,f,x,i)||!1)?(h||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,x,i),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,x,i)),typeof l.componentDidUpdate=="function"&&(s.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&f===t.memoizedState||(s.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&f===t.memoizedState||(s.flags|=1024),s.memoizedProps=r,s.memoizedState=x),l.props=r,l.state=x,l.context=i,r=d):(typeof l.componentDidUpdate!="function"||c===t.memoizedProps&&f===t.memoizedState||(s.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&f===t.memoizedState||(s.flags|=1024),r=!1)}return Zi(t,s,n,r,o,a)}function Zi(t,s,n,r,a,o){Wm(t,s);var l=(s.flags&128)!==0;if(!r&&!l)return a&&eu(s,n,!1),kn(t,s,o);r=s.stateNode,Ap.current=s;var c=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return s.flags|=1,t!==null&&l?(s.child=Hr(s,t.child,null,o),s.child=Hr(s,null,c,o)):Qt(t,s,c,o),s.memoizedState=r.state,a&&eu(s,n,!0),s.child}function Um(t){var s=t.stateNode;s.pendingContext?Qd(t,s.pendingContext,s.pendingContext!==s.context):s.context&&Qd(t,s.context,!1),Kc(t,s.containerInfo)}function fu(t,s,n,r,a){return Ur(),zc(a),s.flags|=256,Qt(t,s,n,r),s.child}var Xi={dehydrated:null,treeContext:null,retryLane:0};function qi(t){return{baseLanes:t,cachePool:null,transitions:null}}function Hm(t,s,n){var r=s.pendingProps,a=kt.current,o=!1,l=(s.flags&128)!==0,c;if((c=l)||(c=t!==null&&t.memoizedState===null?!1:(a&2)!==0),c?(o=!0,s.flags&=-129):(t===null||t.memoizedState!==null)&&(a|=1),ft(kt,a&1),t===null)return Hi(s),t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(s.mode&1?t.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(l=r.children,t=r.fallback,o?(r=s.mode,o=s.child,l={mode:"hidden",children:l},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=ml(l,r,0,null),t=ir(t,r,n,null),o.return=s,t.return=s,o.sibling=t,s.child=o,s.child.memoizedState=qi(n),s.memoizedState=Xi,t):td(s,l));if(a=t.memoizedState,a!==null&&(c=a.dehydrated,c!==null))return Ep(t,s,l,r,c,a,n);if(o){o=r.fallback,l=s.mode,a=t.child,c=a.sibling;var i={mode:"hidden",children:r.children};return!(l&1)&&s.child!==a?(r=s.child,r.childLanes=0,r.pendingProps=i,s.deletions=null):(r=Gn(a,i),r.subtreeFlags=a.subtreeFlags&14680064),c!==null?o=Gn(c,o):(o=ir(o,l,n,null),o.flags|=2),o.return=s,r.return=s,r.sibling=o,s.child=r,r=o,o=s.child,l=t.child.memoizedState,l=l===null?qi(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=t.childLanes&~n,s.memoizedState=Xi,r}return o=t.child,t=o.sibling,r=Gn(o,{mode:"visible",children:r.children}),!(s.mode&1)&&(r.lanes=n),r.return=s,r.sibling=null,t!==null&&(n=s.deletions,n===null?(s.deletions=[t],s.flags|=16):n.push(t)),s.child=r,s.memoizedState=null,r}function td(t,s){return s=ml({mode:"visible",children:s},t.mode,0,null),s.return=t,t.child=s}function lo(t,s,n,r){return r!==null&&zc(r),Hr(s,t.child,null,n),t=td(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function Ep(t,s,n,r,a,o,l){if(n)return s.flags&256?(s.flags&=-257,r=Kl(Error(Pe(422))),lo(t,s,l,r)):s.memoizedState!==null?(s.child=t.child,s.flags|=128,null):(o=r.fallback,a=s.mode,r=ml({mode:"visible",children:r.children},a,0,null),o=ir(o,a,l,null),o.flags|=2,r.return=s,o.return=s,r.sibling=o,s.child=r,s.mode&1&&Hr(s,t.child,null,l),s.child.memoizedState=qi(l),s.memoizedState=Xi,o);if(!(s.mode&1))return lo(t,s,l,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var c=r.dgst;return r=c,o=Error(Pe(419)),r=Kl(o,r,void 0),lo(t,s,l,r)}if(c=(l&t.childLanes)!==0,as||c){if(r=Ot,r!==null){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|l)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,Nn(t,a),Ks(r,t,a,-1))}return ld(),r=Kl(Error(Pe(421))),lo(t,s,l,r)}return a.data==="$?"?(s.flags|=128,s.child=t.child,s=Wp.bind(null,t),a._reactRetry=s,null):(t=o.treeContext,us=zn(a.nextSibling),ms=s,jt=!0,Gs=null,t!==null&&(ys[js++]=bn,ys[js++]=wn,ys[js++]=dr,bn=t.id,wn=t.overflow,dr=s),s=td(s,r.children),s.flags|=4096,s)}function gu(t,s,n){t.lanes|=s;var r=t.alternate;r!==null&&(r.lanes|=s),Gi(t.return,s,n)}function Yl(t,s,n,r,a){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(o.isBackwards=s,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=a)}function Gm(t,s,n){var r=s.pendingProps,a=r.revealOrder,o=r.tail;if(Qt(t,s,r.children,n),r=kt.current,r&2)r=r&1|2,s.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&gu(t,n,s);else if(t.tag===19)gu(t,n,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ft(kt,r),!(s.mode&1))s.memoizedState=null;else switch(a){case"forwards":for(n=s.child,a=null;n!==null;)t=n.alternate,t!==null&&Go(t)===null&&(a=n),n=n.sibling;n=a,n===null?(a=s.child,s.child=null):(a=n.sibling,n.sibling=null),Yl(s,!1,a,n,o);break;case"backwards":for(n=null,a=s.child,s.child=null;a!==null;){if(t=a.alternate,t!==null&&Go(t)===null){s.child=a;break}t=a.sibling,a.sibling=n,n=a,a=t}Yl(s,!0,n,null,o);break;case"together":Yl(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function So(t,s){!(s.mode&1)&&t!==null&&(t.alternate=null,s.alternate=null,s.flags|=2)}function kn(t,s,n){if(t!==null&&(s.dependencies=t.dependencies),mr|=s.lanes,!(n&s.childLanes))return null;if(t!==null&&s.child!==t.child)throw Error(Pe(153));if(s.child!==null){for(t=s.child,n=Gn(t,t.pendingProps),s.child=n,n.return=s;t.sibling!==null;)t=t.sibling,n=n.sibling=Gn(t,t.pendingProps),n.return=s;n.sibling=null}return s.child}function Ip(t,s,n){switch(s.tag){case 3:Um(s),Ur();break;case 5:gm(s);break;case 1:ls(s.type)&&Fo(s);break;case 4:Kc(s,s.stateNode.containerInfo);break;case 10:var r=s.type._context,a=s.memoizedProps.value;ft(Wo,r._currentValue),r._currentValue=a;break;case 13:if(r=s.memoizedState,r!==null)return r.dehydrated!==null?(ft(kt,kt.current&1),s.flags|=128,null):n&s.child.childLanes?Hm(t,s,n):(ft(kt,kt.current&1),t=kn(t,s,n),t!==null?t.sibling:null);ft(kt,kt.current&1);break;case 19:if(r=(n&s.childLanes)!==0,t.flags&128){if(r)return Gm(t,s,n);s.flags|=128}if(a=s.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),ft(kt,kt.current),r)break;return null;case 22:case 23:return s.lanes=0,zm(t,s,n)}return kn(t,s,n)}var Vm,Qi,Km,Ym;Vm=function(t,s){for(var n=s.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Qi=function(){};Km=function(t,s,n,r){var a=t.memoizedProps;if(a!==r){t=s.stateNode,or(ln.current);var o=null;switch(n){case"input":a=yi(t,a),r=yi(t,r),o=[];break;case"select":a=Ct({},a,{value:void 0}),r=Ct({},r,{value:void 0}),o=[];break;case"textarea":a=ki(t,a),r=ki(t,r),o=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ro)}Ci(n,r);var l;n=null;for(d in a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var c=a[d];for(l in c)c.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Na.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var i=r[d];if(c=a!=null?a[d]:void 0,r.hasOwnProperty(d)&&i!==c&&(i!=null||c!=null))if(d==="style")if(c){for(l in c)!c.hasOwnProperty(l)||i&&i.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in i)i.hasOwnProperty(l)&&c[l]!==i[l]&&(n||(n={}),n[l]=i[l])}else n||(o||(o=[]),o.push(d,n)),n=i;else d==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,c=c?c.__html:void 0,i!=null&&c!==i&&(o=o||[]).push(d,i)):d==="children"?typeof i!="string"&&typeof i!="number"||(o=o||[]).push(d,""+i):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Na.hasOwnProperty(d)?(i!=null&&d==="onScroll"&&bt("scroll",t),o||c===i||(o=[])):(o=o||[]).push(d,i))}n&&(o=o||[]).push("style",n);var d=o;(s.updateQueue=d)&&(s.flags|=4)}};Ym=function(t,s,n,r){n!==r&&(s.flags|=4)};function aa(t,s){if(!jt)switch(t.tailMode){case"hidden":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Kt(t){var s=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(s)for(var a=t.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=t,a=a.sibling;else for(a=t.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=t,a=a.sibling;return t.subtreeFlags|=r,t.childLanes=n,s}function Mp(t,s,n){var r=s.pendingProps;switch(Bc(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kt(s),null;case 1:return ls(s.type)&&Oo(),Kt(s),null;case 3:return r=s.stateNode,Gr(),wt(os),wt(Jt),Jc(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ao(s)?s.flags|=4:t===null||t.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Gs!==null&&(lc(Gs),Gs=null))),Qi(t,s),Kt(s),null;case 5:Yc(s);var a=or(La.current);if(n=s.type,t!==null&&s.stateNode!=null)Km(t,s,n,r,a),t.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!r){if(s.stateNode===null)throw Error(Pe(166));return Kt(s),null}if(t=or(ln.current),ao(s)){r=s.stateNode,n=s.type;var o=s.memoizedProps;switch(r[rn]=s,r[Ta]=o,t=(s.mode&1)!==0,n){case"dialog":bt("cancel",r),bt("close",r);break;case"iframe":case"object":case"embed":bt("load",r);break;case"video":case"audio":for(a=0;a<ma.length;a++)bt(ma[a],r);break;case"source":bt("error",r);break;case"img":case"image":case"link":bt("error",r),bt("load",r);break;case"details":bt("toggle",r);break;case"input":Cd(r,o),bt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},bt("invalid",r);break;case"textarea":Ad(r,o),bt("invalid",r)}Ci(n,o),a=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?r.textContent!==c&&(o.suppressHydrationWarning!==!0&&ro(r.textContent,c,t),a=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&ro(r.textContent,c,t),a=["children",""+c]):Na.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&bt("scroll",r)}switch(n){case"input":Za(r),$d(r,o,!0);break;case"textarea":Za(r),Ed(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Ro)}r=a,s.updateQueue=r,r!==null&&(s.flags|=4)}else{l=a.nodeType===9?a:a.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=j0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),n==="select"&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[rn]=s,t[Ta]=r,Vm(t,s,!1,!1),s.stateNode=t;e:{switch(l=$i(n,r),n){case"dialog":bt("cancel",t),bt("close",t),a=r;break;case"iframe":case"object":case"embed":bt("load",t),a=r;break;case"video":case"audio":for(a=0;a<ma.length;a++)bt(ma[a],t);a=r;break;case"source":bt("error",t),a=r;break;case"img":case"image":case"link":bt("error",t),bt("load",t),a=r;break;case"details":bt("toggle",t),a=r;break;case"input":Cd(t,r),a=yi(t,r),bt("invalid",t);break;case"option":a=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},a=Ct({},r,{value:void 0}),bt("invalid",t);break;case"textarea":Ad(t,r),a=ki(t,r),bt("invalid",t);break;default:a=r}Ci(n,a),c=a;for(o in c)if(c.hasOwnProperty(o)){var i=c[o];o==="style"?S0(t,i):o==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,i!=null&&N0(t,i)):o==="children"?typeof i=="string"?(n!=="textarea"||i!=="")&&ka(t,i):typeof i=="number"&&ka(t,""+i):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Na.hasOwnProperty(o)?i!=null&&o==="onScroll"&&bt("scroll",t):i!=null&&Sc(t,o,i,l))}switch(n){case"input":Za(t),$d(t,r,!1);break;case"textarea":Za(t),Ed(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Vn(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?Lr(t,!!r.multiple,o,!1):r.defaultValue!=null&&Lr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(t.onclick=Ro)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Kt(s),null;case 6:if(t&&s.stateNode!=null)Ym(t,s,t.memoizedProps,r);else{if(typeof r!="string"&&s.stateNode===null)throw Error(Pe(166));if(n=or(La.current),or(ln.current),ao(s)){if(r=s.stateNode,n=s.memoizedProps,r[rn]=s,(o=r.nodeValue!==n)&&(t=ms,t!==null))switch(t.tag){case 3:ro(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ro(r.nodeValue,n,(t.mode&1)!==0)}o&&(s.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[rn]=s,s.stateNode=r}return Kt(s),null;case 13:if(wt(kt),r=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(jt&&us!==null&&s.mode&1&&!(s.flags&128))mm(),Ur(),s.flags|=98560,o=!1;else if(o=ao(s),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(Pe(318));if(o=s.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Pe(317));o[rn]=s}else Ur(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Kt(s),o=!1}else Gs!==null&&(lc(Gs),Gs=null),o=!0;if(!o)return s.flags&65536?s:null}return s.flags&128?(s.lanes=n,s):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(s.child.flags|=8192,s.mode&1&&(t===null||kt.current&1?Dt===0&&(Dt=3):ld())),s.updateQueue!==null&&(s.flags|=4),Kt(s),null);case 4:return Gr(),Qi(t,s),t===null&&Ma(s.stateNode.containerInfo),Kt(s),null;case 10:return Hc(s.type._context),Kt(s),null;case 17:return ls(s.type)&&Oo(),Kt(s),null;case 19:if(wt(kt),o=s.memoizedState,o===null)return Kt(s),null;if(r=(s.flags&128)!==0,l=o.rendering,l===null)if(r)aa(o,!1);else{if(Dt!==0||t!==null&&t.flags&128)for(t=s.child;t!==null;){if(l=Go(t),l!==null){for(s.flags|=128,aa(o,!1),r=l.updateQueue,r!==null&&(s.updateQueue=r,s.flags|=4),s.subtreeFlags=0,r=n,n=s.child;n!==null;)o=n,t=r,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,t=l.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ft(kt,kt.current&1|2),s.child}t=t.sibling}o.tail!==null&&Et()>Kr&&(s.flags|=128,r=!0,aa(o,!1),s.lanes=4194304)}else{if(!r)if(t=Go(l),t!==null){if(s.flags|=128,r=!0,n=t.updateQueue,n!==null&&(s.updateQueue=n,s.flags|=4),aa(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!jt)return Kt(s),null}else 2*Et()-o.renderingStartTime>Kr&&n!==1073741824&&(s.flags|=128,r=!0,aa(o,!1),s.lanes=4194304);o.isBackwards?(l.sibling=s.child,s.child=l):(n=o.last,n!==null?n.sibling=l:s.child=l,o.last=l)}return o.tail!==null?(s=o.tail,o.rendering=s,o.tail=s.sibling,o.renderingStartTime=Et(),s.sibling=null,n=kt.current,ft(kt,r?n&1|2:n&1),s):(Kt(s),null);case 22:case 23:return od(),r=s.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(s.flags|=8192),r&&s.mode&1?ds&1073741824&&(Kt(s),s.subtreeFlags&6&&(s.flags|=8192)):Kt(s),null;case 24:return null;case 25:return null}throw Error(Pe(156,s.tag))}function _p(t,s){switch(Bc(s),s.tag){case 1:return ls(s.type)&&Oo(),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return Gr(),wt(os),wt(Jt),Jc(),t=s.flags,t&65536&&!(t&128)?(s.flags=t&-65537|128,s):null;case 5:return Yc(s),null;case 13:if(wt(kt),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(Pe(340));Ur()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return wt(kt),null;case 4:return Gr(),null;case 10:return Hc(s.type._context),null;case 22:case 23:return od(),null;case 24:return null;default:return null}}var io=!1,Yt=!1,Tp=typeof WeakSet=="function"?WeakSet:Set,Ge=null;function Mr(t,s){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){$t(t,s,r)}else n.current=null}function ec(t,s,n){try{n()}catch(r){$t(t,s,r)}}var bu=!1;function Dp(t,s){if(Ri=Do,t=Q0(),Oc(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var l=0,c=-1,i=-1,d=0,h=0,p=t,f=null;t:for(;;){for(var m;p!==n||a!==0&&p.nodeType!==3||(c=l+a),p!==o||r!==0&&p.nodeType!==3||(i=l+r),p.nodeType===3&&(l+=p.nodeValue.length),(m=p.firstChild)!==null;)f=p,p=m;for(;;){if(p===t)break t;if(f===n&&++d===a&&(c=l),f===o&&++h===r&&(i=l),(m=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=m}n=c===-1||i===-1?null:{start:c,end:i}}else n=null}n=n||{start:0,end:0}}else n=null;for(Oi={focusedElem:t,selectionRange:n},Do=!1,Ge=s;Ge!==null;)if(s=Ge,t=s.child,(s.subtreeFlags&1028)!==0&&t!==null)t.return=s,Ge=t;else for(;Ge!==null;){s=Ge;try{var x=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,A=x.memoizedState,w=s.stateNode,b=w.getSnapshotBeforeUpdate(s.elementType===s.type?g:Ws(s.type,g),A);w.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var v=s.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Pe(163))}}catch(j){$t(s,s.return,j)}if(t=s.sibling,t!==null){t.return=s.return,Ge=t;break}Ge=s.return}return x=bu,bu=!1,x}function wa(t,s,n){var r=s.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&t)===t){var o=a.destroy;a.destroy=void 0,o!==void 0&&ec(s,n,o)}a=a.next}while(a!==r)}}function dl(t,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var n=s=s.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==s)}}function tc(t){var s=t.ref;if(s!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof s=="function"?s(t):s.current=t}}function Jm(t){var s=t.alternate;s!==null&&(t.alternate=null,Jm(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&(delete s[rn],delete s[Ta],delete s[zi],delete s[fp],delete s[gp])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Zm(t){return t.tag===5||t.tag===3||t.tag===4}function wu(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Zm(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function sc(t,s,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,s?n.nodeType===8?n.parentNode.insertBefore(t,s):n.insertBefore(t,s):(n.nodeType===8?(s=n.parentNode,s.insertBefore(t,n)):(s=n,s.appendChild(t)),n=n._reactRootContainer,n!=null||s.onclick!==null||(s.onclick=Ro));else if(r!==4&&(t=t.child,t!==null))for(sc(t,s,n),t=t.sibling;t!==null;)sc(t,s,n),t=t.sibling}function nc(t,s,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,s?n.insertBefore(t,s):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(nc(t,s,n),t=t.sibling;t!==null;)nc(t,s,n),t=t.sibling}var zt=null,Us=!1;function En(t,s,n){for(n=n.child;n!==null;)Xm(t,s,n),n=n.sibling}function Xm(t,s,n){if(on&&typeof on.onCommitFiberUnmount=="function")try{on.onCommitFiberUnmount(sl,n)}catch{}switch(n.tag){case 5:Yt||Mr(n,s);case 6:var r=zt,a=Us;zt=null,En(t,s,n),zt=r,Us=a,zt!==null&&(Us?(t=zt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):zt.removeChild(n.stateNode));break;case 18:zt!==null&&(Us?(t=zt,n=n.stateNode,t.nodeType===8?zl(t.parentNode,n):t.nodeType===1&&zl(t,n),Aa(t)):zl(zt,n.stateNode));break;case 4:r=zt,a=Us,zt=n.stateNode.containerInfo,Us=!0,En(t,s,n),zt=r,Us=a;break;case 0:case 11:case 14:case 15:if(!Yt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var o=a,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&ec(n,s,l),a=a.next}while(a!==r)}En(t,s,n);break;case 1:if(!Yt&&(Mr(n,s),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){$t(n,s,c)}En(t,s,n);break;case 21:En(t,s,n);break;case 22:n.mode&1?(Yt=(r=Yt)||n.memoizedState!==null,En(t,s,n),Yt=r):En(t,s,n);break;default:En(t,s,n)}}function vu(t){var s=t.updateQueue;if(s!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Tp),s.forEach(function(r){var a=Up.bind(null,t,r);n.has(r)||(n.add(r),r.then(a,a))})}}function Es(t,s){var n=s.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var o=t,l=s,c=l;e:for(;c!==null;){switch(c.tag){case 5:zt=c.stateNode,Us=!1;break e;case 3:zt=c.stateNode.containerInfo,Us=!0;break e;case 4:zt=c.stateNode.containerInfo,Us=!0;break e}c=c.return}if(zt===null)throw Error(Pe(160));Xm(o,l,a),zt=null,Us=!1;var i=a.alternate;i!==null&&(i.return=null),a.return=null}catch(d){$t(a,s,d)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)qm(s,t),s=s.sibling}function qm(t,s){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Es(s,t),Xs(t),r&4){try{wa(3,t,t.return),dl(3,t)}catch(g){$t(t,t.return,g)}try{wa(5,t,t.return)}catch(g){$t(t,t.return,g)}}break;case 1:Es(s,t),Xs(t),r&512&&n!==null&&Mr(n,n.return);break;case 5:if(Es(s,t),Xs(t),r&512&&n!==null&&Mr(n,n.return),t.flags&32){var a=t.stateNode;try{ka(a,"")}catch(g){$t(t,t.return,g)}}if(r&4&&(a=t.stateNode,a!=null)){var o=t.memoizedProps,l=n!==null?n.memoizedProps:o,c=t.type,i=t.updateQueue;if(t.updateQueue=null,i!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&v0(a,o),$i(c,l);var d=$i(c,o);for(l=0;l<i.length;l+=2){var h=i[l],p=i[l+1];h==="style"?S0(a,p):h==="dangerouslySetInnerHTML"?N0(a,p):h==="children"?ka(a,p):Sc(a,h,p,d)}switch(c){case"input":ji(a,o);break;case"textarea":y0(a,o);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var m=o.value;m!=null?Lr(a,!!o.multiple,m,!1):f!==!!o.multiple&&(o.defaultValue!=null?Lr(a,!!o.multiple,o.defaultValue,!0):Lr(a,!!o.multiple,o.multiple?[]:"",!1))}a[Ta]=o}catch(g){$t(t,t.return,g)}}break;case 6:if(Es(s,t),Xs(t),r&4){if(t.stateNode===null)throw Error(Pe(162));a=t.stateNode,o=t.memoizedProps;try{a.nodeValue=o}catch(g){$t(t,t.return,g)}}break;case 3:if(Es(s,t),Xs(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Aa(s.containerInfo)}catch(g){$t(t,t.return,g)}break;case 4:Es(s,t),Xs(t);break;case 13:Es(s,t),Xs(t),a=t.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(rd=Et())),r&4&&vu(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Yt=(d=Yt)||h,Es(s,t),Yt=d):Es(s,t),Xs(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(Ge=t,h=t.child;h!==null;){for(p=Ge=h;Ge!==null;){switch(f=Ge,m=f.child,f.tag){case 0:case 11:case 14:case 15:wa(4,f,f.return);break;case 1:Mr(f,f.return);var x=f.stateNode;if(typeof x.componentWillUnmount=="function"){r=f,n=f.return;try{s=r,x.props=s.memoizedProps,x.state=s.memoizedState,x.componentWillUnmount()}catch(g){$t(r,n,g)}}break;case 5:Mr(f,f.return);break;case 22:if(f.memoizedState!==null){ju(p);continue}}m!==null?(m.return=f,Ge=m):ju(p)}h=h.sibling}e:for(h=null,p=t;;){if(p.tag===5){if(h===null){h=p;try{a=p.stateNode,d?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=p.stateNode,i=p.memoizedProps.style,l=i!=null&&i.hasOwnProperty("display")?i.display:null,c.style.display=k0("display",l))}catch(g){$t(t,t.return,g)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(g){$t(t,t.return,g)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Es(s,t),Xs(t),r&4&&vu(t);break;case 21:break;default:Es(s,t),Xs(t)}}function Xs(t){var s=t.flags;if(s&2){try{e:{for(var n=t.return;n!==null;){if(Zm(n)){var r=n;break e}n=n.return}throw Error(Pe(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(ka(a,""),r.flags&=-33);var o=wu(t);nc(t,o,a);break;case 3:case 4:var l=r.stateNode.containerInfo,c=wu(t);sc(t,c,l);break;default:throw Error(Pe(161))}}catch(i){$t(t,t.return,i)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function Lp(t,s,n){Ge=t,Qm(t)}function Qm(t,s,n){for(var r=(t.mode&1)!==0;Ge!==null;){var a=Ge,o=a.child;if(a.tag===22&&r){var l=a.memoizedState!==null||io;if(!l){var c=a.alternate,i=c!==null&&c.memoizedState!==null||Yt;c=io;var d=Yt;if(io=l,(Yt=i)&&!d)for(Ge=a;Ge!==null;)l=Ge,i=l.child,l.tag===22&&l.memoizedState!==null?Nu(a):i!==null?(i.return=l,Ge=i):Nu(a);for(;o!==null;)Ge=o,Qm(o),o=o.sibling;Ge=a,io=c,Yt=d}yu(t)}else a.subtreeFlags&8772&&o!==null?(o.return=a,Ge=o):yu(t)}}function yu(t){for(;Ge!==null;){var s=Ge;if(s.flags&8772){var n=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Yt||dl(5,s);break;case 1:var r=s.stateNode;if(s.flags&4&&!Yt)if(n===null)r.componentDidMount();else{var a=s.elementType===s.type?n.memoizedProps:Ws(s.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=s.updateQueue;o!==null&&au(s,o,r);break;case 3:var l=s.updateQueue;if(l!==null){if(n=null,s.child!==null)switch(s.child.tag){case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}au(s,l,n)}break;case 5:var c=s.stateNode;if(n===null&&s.flags&4){n=c;var i=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":i.autoFocus&&n.focus();break;case"img":i.src&&(n.src=i.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var d=s.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&Aa(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Pe(163))}Yt||s.flags&512&&tc(s)}catch(f){$t(s,s.return,f)}}if(s===t){Ge=null;break}if(n=s.sibling,n!==null){n.return=s.return,Ge=n;break}Ge=s.return}}function ju(t){for(;Ge!==null;){var s=Ge;if(s===t){Ge=null;break}var n=s.sibling;if(n!==null){n.return=s.return,Ge=n;break}Ge=s.return}}function Nu(t){for(;Ge!==null;){var s=Ge;try{switch(s.tag){case 0:case 11:case 15:var n=s.return;try{dl(4,s)}catch(i){$t(s,n,i)}break;case 1:var r=s.stateNode;if(typeof r.componentDidMount=="function"){var a=s.return;try{r.componentDidMount()}catch(i){$t(s,a,i)}}var o=s.return;try{tc(s)}catch(i){$t(s,o,i)}break;case 5:var l=s.return;try{tc(s)}catch(i){$t(s,l,i)}}}catch(i){$t(s,s.return,i)}if(s===t){Ge=null;break}var c=s.sibling;if(c!==null){c.return=s.return,Ge=c;break}Ge=s.return}}var Pp=Math.ceil,Yo=Cn.ReactCurrentDispatcher,sd=Cn.ReactCurrentOwner,ks=Cn.ReactCurrentBatchConfig,dt=0,Ot=null,Mt=null,Wt=0,ds=0,_r=Jn(0),Dt=0,Fa=null,mr=0,ul=0,nd=0,va=null,rs=null,rd=0,Kr=1/0,fn=null,Jo=!1,rc=null,Un=null,co=!1,Pn=null,Zo=0,ya=0,ac=null,Co=-1,$o=0;function es(){return dt&6?Et():Co!==-1?Co:Co=Et()}function Hn(t){return t.mode&1?dt&2&&Wt!==0?Wt&-Wt:wp.transition!==null?($o===0&&($o=R0()),$o):(t=xt,t!==0||(t=window.event,t=t===void 0?16:H0(t.type)),t):1}function Ks(t,s,n,r){if(50<ya)throw ya=0,ac=null,Error(Pe(185));Wa(t,n,r),(!(dt&2)||t!==Ot)&&(t===Ot&&(!(dt&2)&&(ul|=n),Dt===4&&Dn(t,Wt)),is(t,r),n===1&&dt===0&&!(s.mode&1)&&(Kr=Et()+500,ll&&Zn()))}function is(t,s){var n=t.callbackNode;wx(t,s);var r=To(t,t===Ot?Wt:0);if(r===0)n!==null&&_d(n),t.callbackNode=null,t.callbackPriority=0;else if(s=r&-r,t.callbackPriority!==s){if(n!=null&&_d(n),s===1)t.tag===0?bp(ku.bind(null,t)):cm(ku.bind(null,t)),xp(function(){!(dt&6)&&Zn()}),n=null;else{switch(O0(r)){case 1:n=Ic;break;case 4:n=L0;break;case 16:n=_o;break;case 536870912:n=P0;break;default:n=_o}n=lh(n,eh.bind(null,t))}t.callbackPriority=s,t.callbackNode=n}}function eh(t,s){if(Co=-1,$o=0,dt&6)throw Error(Pe(327));var n=t.callbackNode;if(Br()&&t.callbackNode!==n)return null;var r=To(t,t===Ot?Wt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||s)s=Xo(t,r);else{s=r;var a=dt;dt|=2;var o=sh();(Ot!==t||Wt!==s)&&(fn=null,Kr=Et()+500,lr(t,s));do try{Fp();break}catch(c){th(t,c)}while(!0);Uc(),Yo.current=o,dt=a,Mt!==null?s=0:(Ot=null,Wt=0,s=Dt)}if(s!==0){if(s===2&&(a=_i(t),a!==0&&(r=a,s=oc(t,a))),s===1)throw n=Fa,lr(t,0),Dn(t,r),is(t,Et()),n;if(s===6)Dn(t,r);else{if(a=t.current.alternate,!(r&30)&&!Rp(a)&&(s=Xo(t,r),s===2&&(o=_i(t),o!==0&&(r=o,s=oc(t,o))),s===1))throw n=Fa,lr(t,0),Dn(t,r),is(t,Et()),n;switch(t.finishedWork=a,t.finishedLanes=r,s){case 0:case 1:throw Error(Pe(345));case 2:nr(t,rs,fn);break;case 3:if(Dn(t,r),(r&130023424)===r&&(s=rd+500-Et(),10<s)){if(To(t,0)!==0)break;if(a=t.suspendedLanes,(a&r)!==r){es(),t.pingedLanes|=t.suspendedLanes&a;break}t.timeoutHandle=Bi(nr.bind(null,t,rs,fn),s);break}nr(t,rs,fn);break;case 4:if(Dn(t,r),(r&4194240)===r)break;for(s=t.eventTimes,a=-1;0<r;){var l=31-Vs(r);o=1<<l,l=s[l],l>a&&(a=l),r&=~o}if(r=a,r=Et()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Pp(r/1960))-r,10<r){t.timeoutHandle=Bi(nr.bind(null,t,rs,fn),r);break}nr(t,rs,fn);break;case 5:nr(t,rs,fn);break;default:throw Error(Pe(329))}}}return is(t,Et()),t.callbackNode===n?eh.bind(null,t):null}function oc(t,s){var n=va;return t.current.memoizedState.isDehydrated&&(lr(t,s).flags|=256),t=Xo(t,s),t!==2&&(s=rs,rs=n,s!==null&&lc(s)),t}function lc(t){rs===null?rs=t:rs.push.apply(rs,t)}function Rp(t){for(var s=t;;){if(s.flags&16384){var n=s.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],o=a.getSnapshot;a=a.value;try{if(!Js(o(),a))return!1}catch{return!1}}}if(n=s.child,s.subtreeFlags&16384&&n!==null)n.return=s,s=n;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Dn(t,s){for(s&=~nd,s&=~ul,t.suspendedLanes|=s,t.pingedLanes&=~s,t=t.expirationTimes;0<s;){var n=31-Vs(s),r=1<<n;t[n]=-1,s&=~r}}function ku(t){if(dt&6)throw Error(Pe(327));Br();var s=To(t,0);if(!(s&1))return is(t,Et()),null;var n=Xo(t,s);if(t.tag!==0&&n===2){var r=_i(t);r!==0&&(s=r,n=oc(t,r))}if(n===1)throw n=Fa,lr(t,0),Dn(t,s),is(t,Et()),n;if(n===6)throw Error(Pe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=s,nr(t,rs,fn),is(t,Et()),null}function ad(t,s){var n=dt;dt|=1;try{return t(s)}finally{dt=n,dt===0&&(Kr=Et()+500,ll&&Zn())}}function hr(t){Pn!==null&&Pn.tag===0&&!(dt&6)&&Br();var s=dt;dt|=1;var n=ks.transition,r=xt;try{if(ks.transition=null,xt=1,t)return t()}finally{xt=r,ks.transition=n,dt=s,!(dt&6)&&Zn()}}function od(){ds=_r.current,wt(_r)}function lr(t,s){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hp(n)),Mt!==null)for(n=Mt.return;n!==null;){var r=n;switch(Bc(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Oo();break;case 3:Gr(),wt(os),wt(Jt),Jc();break;case 5:Yc(r);break;case 4:Gr();break;case 13:wt(kt);break;case 19:wt(kt);break;case 10:Hc(r.type._context);break;case 22:case 23:od()}n=n.return}if(Ot=t,Mt=t=Gn(t.current,null),Wt=ds=s,Dt=0,Fa=null,nd=ul=mr=0,rs=va=null,ar!==null){for(s=0;s<ar.length;s++)if(n=ar[s],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,o=n.pending;if(o!==null){var l=o.next;o.next=a,r.next=l}n.pending=r}ar=null}return t}function th(t,s){do{var n=Mt;try{if(Uc(),No.current=Ko,Vo){for(var r=St.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Vo=!1}if(ur=0,Rt=Tt=St=null,ba=!1,Pa=0,sd.current=null,n===null||n.return===null){Dt=1,Fa=s,Mt=null;break}e:{var o=t,l=n.return,c=n,i=s;if(s=Wt,c.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){var d=i,h=c,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=uu(l);if(m!==null){m.flags&=-257,mu(m,l,c,o,s),m.mode&1&&du(o,d,s),s=m,i=d;var x=s.updateQueue;if(x===null){var g=new Set;g.add(i),s.updateQueue=g}else x.add(i);break e}else{if(!(s&1)){du(o,d,s),ld();break e}i=Error(Pe(426))}}else if(jt&&c.mode&1){var A=uu(l);if(A!==null){!(A.flags&65536)&&(A.flags|=256),mu(A,l,c,o,s),zc(Vr(i,c));break e}}o=i=Vr(i,c),Dt!==4&&(Dt=2),va===null?va=[o]:va.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,s&=-s,o.lanes|=s;var w=Om(o,i,s);ru(o,w);break e;case 1:c=i;var b=o.type,v=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Un===null||!Un.has(v)))){o.flags|=65536,s&=-s,o.lanes|=s;var j=Fm(o,c,s);ru(o,j);break e}}o=o.return}while(o!==null)}rh(n)}catch(T){s=T,Mt===n&&n!==null&&(Mt=n=n.return);continue}break}while(!0)}function sh(){var t=Yo.current;return Yo.current=Ko,t===null?Ko:t}function ld(){(Dt===0||Dt===3||Dt===2)&&(Dt=4),Ot===null||!(mr&268435455)&&!(ul&268435455)||Dn(Ot,Wt)}function Xo(t,s){var n=dt;dt|=2;var r=sh();(Ot!==t||Wt!==s)&&(fn=null,lr(t,s));do try{Op();break}catch(a){th(t,a)}while(!0);if(Uc(),dt=n,Yo.current=r,Mt!==null)throw Error(Pe(261));return Ot=null,Wt=0,Dt}function Op(){for(;Mt!==null;)nh(Mt)}function Fp(){for(;Mt!==null&&!dx();)nh(Mt)}function nh(t){var s=oh(t.alternate,t,ds);t.memoizedProps=t.pendingProps,s===null?rh(t):Mt=s,sd.current=null}function rh(t){var s=t;do{var n=s.alternate;if(t=s.return,s.flags&32768){if(n=_p(n,s),n!==null){n.flags&=32767,Mt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Dt=6,Mt=null;return}}else if(n=Mp(n,s,ds),n!==null){Mt=n;return}if(s=s.sibling,s!==null){Mt=s;return}Mt=s=t}while(s!==null);Dt===0&&(Dt=5)}function nr(t,s,n){var r=xt,a=ks.transition;try{ks.transition=null,xt=1,Bp(t,s,n,r)}finally{ks.transition=a,xt=r}return null}function Bp(t,s,n,r){do Br();while(Pn!==null);if(dt&6)throw Error(Pe(327));n=t.finishedWork;var a=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Pe(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(vx(t,o),t===Ot&&(Mt=Ot=null,Wt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||co||(co=!0,lh(_o,function(){return Br(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=ks.transition,ks.transition=null;var l=xt;xt=1;var c=dt;dt|=4,sd.current=null,Dp(t,n),qm(n,t),op(Oi),Do=!!Ri,Oi=Ri=null,t.current=n,Lp(n),ux(),dt=c,xt=l,ks.transition=o}else t.current=n;if(co&&(co=!1,Pn=t,Zo=a),o=t.pendingLanes,o===0&&(Un=null),xx(n.stateNode),is(t,Et()),s!==null)for(r=t.onRecoverableError,n=0;n<s.length;n++)a=s[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Jo)throw Jo=!1,t=rc,rc=null,t;return Zo&1&&t.tag!==0&&Br(),o=t.pendingLanes,o&1?t===ac?ya++:(ya=0,ac=t):ya=0,Zn(),null}function Br(){if(Pn!==null){var t=O0(Zo),s=ks.transition,n=xt;try{if(ks.transition=null,xt=16>t?16:t,Pn===null)var r=!1;else{if(t=Pn,Pn=null,Zo=0,dt&6)throw Error(Pe(331));var a=dt;for(dt|=4,Ge=t.current;Ge!==null;){var o=Ge,l=o.child;if(Ge.flags&16){var c=o.deletions;if(c!==null){for(var i=0;i<c.length;i++){var d=c[i];for(Ge=d;Ge!==null;){var h=Ge;switch(h.tag){case 0:case 11:case 15:wa(8,h,o)}var p=h.child;if(p!==null)p.return=h,Ge=p;else for(;Ge!==null;){h=Ge;var f=h.sibling,m=h.return;if(Jm(h),h===d){Ge=null;break}if(f!==null){f.return=m,Ge=f;break}Ge=m}}}var x=o.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var A=g.sibling;g.sibling=null,g=A}while(g!==null)}}Ge=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,Ge=l;else e:for(;Ge!==null;){if(o=Ge,o.flags&2048)switch(o.tag){case 0:case 11:case 15:wa(9,o,o.return)}var w=o.sibling;if(w!==null){w.return=o.return,Ge=w;break e}Ge=o.return}}var b=t.current;for(Ge=b;Ge!==null;){l=Ge;var v=l.child;if(l.subtreeFlags&2064&&v!==null)v.return=l,Ge=v;else e:for(l=b;Ge!==null;){if(c=Ge,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:dl(9,c)}}catch(T){$t(c,c.return,T)}if(c===l){Ge=null;break e}var j=c.sibling;if(j!==null){j.return=c.return,Ge=j;break e}Ge=c.return}}if(dt=a,Zn(),on&&typeof on.onPostCommitFiberRoot=="function")try{on.onPostCommitFiberRoot(sl,t)}catch{}r=!0}return r}finally{xt=n,ks.transition=s}}return!1}function Su(t,s,n){s=Vr(n,s),s=Om(t,s,1),t=Wn(t,s,1),s=es(),t!==null&&(Wa(t,1,s),is(t,s))}function $t(t,s,n){if(t.tag===3)Su(t,t,n);else for(;s!==null;){if(s.tag===3){Su(s,t,n);break}else if(s.tag===1){var r=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Un===null||!Un.has(r))){t=Vr(n,t),t=Fm(s,t,1),s=Wn(s,t,1),t=es(),s!==null&&(Wa(s,1,t),is(s,t));break}}s=s.return}}function zp(t,s,n){var r=t.pingCache;r!==null&&r.delete(s),s=es(),t.pingedLanes|=t.suspendedLanes&n,Ot===t&&(Wt&n)===n&&(Dt===4||Dt===3&&(Wt&130023424)===Wt&&500>Et()-rd?lr(t,0):nd|=n),is(t,s)}function ah(t,s){s===0&&(t.mode&1?(s=Qa,Qa<<=1,!(Qa&130023424)&&(Qa=4194304)):s=1);var n=es();t=Nn(t,s),t!==null&&(Wa(t,s,n),is(t,n))}function Wp(t){var s=t.memoizedState,n=0;s!==null&&(n=s.retryLane),ah(t,n)}function Up(t,s){var n=0;switch(t.tag){case 13:var r=t.stateNode,a=t.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Pe(314))}r!==null&&r.delete(s),ah(t,n)}var oh;oh=function(t,s,n){if(t!==null)if(t.memoizedProps!==s.pendingProps||os.current)as=!0;else{if(!(t.lanes&n)&&!(s.flags&128))return as=!1,Ip(t,s,n);as=!!(t.flags&131072)}else as=!1,jt&&s.flags&1048576&&dm(s,zo,s.index);switch(s.lanes=0,s.tag){case 2:var r=s.type;So(t,s),t=s.pendingProps;var a=Wr(s,Jt.current);Fr(s,n),a=Xc(null,s,r,t,a,n);var o=qc();return s.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,ls(r)?(o=!0,Fo(s)):o=!1,s.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,Vc(s),a.updater=cl,s.stateNode=a,a._reactInternals=s,Ki(s,r,t,n),s=Zi(null,s,r,!0,o,n)):(s.tag=0,jt&&o&&Fc(s),Qt(null,s,a,n),s=s.child),s;case 16:r=s.elementType;e:{switch(So(t,s),t=s.pendingProps,a=r._init,r=a(r._payload),s.type=r,a=s.tag=Gp(r),t=Ws(r,t),a){case 0:s=Ji(null,s,r,t,n);break e;case 1:s=pu(null,s,r,t,n);break e;case 11:s=hu(null,s,r,t,n);break e;case 14:s=xu(null,s,r,Ws(r.type,t),n);break e}throw Error(Pe(306,r,""))}return s;case 0:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ws(r,a),Ji(t,s,r,a,n);case 1:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ws(r,a),pu(t,s,r,a,n);case 3:e:{if(Um(s),t===null)throw Error(Pe(387));r=s.pendingProps,o=s.memoizedState,a=o.element,fm(t,s),Ho(s,r,null,n);var l=s.memoizedState;if(r=l.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},s.updateQueue.baseState=o,s.memoizedState=o,s.flags&256){a=Vr(Error(Pe(423)),s),s=fu(t,s,r,n,a);break e}else if(r!==a){a=Vr(Error(Pe(424)),s),s=fu(t,s,r,n,a);break e}else for(us=zn(s.stateNode.containerInfo.firstChild),ms=s,jt=!0,Gs=null,n=xm(s,null,r,n),s.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ur(),r===a){s=kn(t,s,n);break e}Qt(t,s,r,n)}s=s.child}return s;case 5:return gm(s),t===null&&Hi(s),r=s.type,a=s.pendingProps,o=t!==null?t.memoizedProps:null,l=a.children,Fi(r,a)?l=null:o!==null&&Fi(r,o)&&(s.flags|=32),Wm(t,s),Qt(t,s,l,n),s.child;case 6:return t===null&&Hi(s),null;case 13:return Hm(t,s,n);case 4:return Kc(s,s.stateNode.containerInfo),r=s.pendingProps,t===null?s.child=Hr(s,null,r,n):Qt(t,s,r,n),s.child;case 11:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ws(r,a),hu(t,s,r,a,n);case 7:return Qt(t,s,s.pendingProps,n),s.child;case 8:return Qt(t,s,s.pendingProps.children,n),s.child;case 12:return Qt(t,s,s.pendingProps.children,n),s.child;case 10:e:{if(r=s.type._context,a=s.pendingProps,o=s.memoizedProps,l=a.value,ft(Wo,r._currentValue),r._currentValue=l,o!==null)if(Js(o.value,l)){if(o.children===a.children&&!os.current){s=kn(t,s,n);break e}}else for(o=s.child,o!==null&&(o.return=s);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var i=c.firstContext;i!==null;){if(i.context===r){if(o.tag===1){i=vn(-1,n&-n),i.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?i.next=i:(i.next=h.next,h.next=i),d.pending=i}}o.lanes|=n,i=o.alternate,i!==null&&(i.lanes|=n),Gi(o.return,n,s),c.lanes|=n;break}i=i.next}}else if(o.tag===10)l=o.type===s.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(Pe(341));l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),Gi(l,n,s),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===s){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}Qt(t,s,a.children,n),s=s.child}return s;case 9:return a=s.type,r=s.pendingProps.children,Fr(s,n),a=Ss(a),r=r(a),s.flags|=1,Qt(t,s,r,n),s.child;case 14:return r=s.type,a=Ws(r,s.pendingProps),a=Ws(r.type,a),xu(t,s,r,a,n);case 15:return Bm(t,s,s.type,s.pendingProps,n);case 17:return r=s.type,a=s.pendingProps,a=s.elementType===r?a:Ws(r,a),So(t,s),s.tag=1,ls(r)?(t=!0,Fo(s)):t=!1,Fr(s,n),Rm(s,r,a),Ki(s,r,a,n),Zi(null,s,r,!0,t,n);case 19:return Gm(t,s,n);case 22:return zm(t,s,n)}throw Error(Pe(156,s.tag))};function lh(t,s){return D0(t,s)}function Hp(t,s,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ns(t,s,n,r){return new Hp(t,s,n,r)}function id(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Gp(t){if(typeof t=="function")return id(t)?1:0;if(t!=null){if(t=t.$$typeof,t===$c)return 11;if(t===Ac)return 14}return 2}function Gn(t,s){var n=t.alternate;return n===null?(n=Ns(t.tag,s,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=s,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,s=t.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ao(t,s,n,r,a,o){var l=2;if(r=t,typeof t=="function")id(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case jr:return ir(n.children,a,o,s);case Cc:l=8,a|=8;break;case gi:return t=Ns(12,n,s,a|2),t.elementType=gi,t.lanes=o,t;case bi:return t=Ns(13,n,s,a),t.elementType=bi,t.lanes=o,t;case wi:return t=Ns(19,n,s,a),t.elementType=wi,t.lanes=o,t;case g0:return ml(n,a,o,s);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case p0:l=10;break e;case f0:l=9;break e;case $c:l=11;break e;case Ac:l=14;break e;case In:l=16,r=null;break e}throw Error(Pe(130,t==null?t:typeof t,""))}return s=Ns(l,n,s,a),s.elementType=t,s.type=r,s.lanes=o,s}function ir(t,s,n,r){return t=Ns(7,t,r,s),t.lanes=n,t}function ml(t,s,n,r){return t=Ns(22,t,r,s),t.elementType=g0,t.lanes=n,t.stateNode={isHidden:!1},t}function Jl(t,s,n){return t=Ns(6,t,null,s),t.lanes=n,t}function Zl(t,s,n){return s=Ns(4,t.children!==null?t.children:[],t.key,s),s.lanes=n,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}function Vp(t,s,n,r,a){this.tag=s,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Il(0),this.expirationTimes=Il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Il(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function cd(t,s,n,r,a,o,l,c,i){return t=new Vp(t,s,n,c,i),s===1?(s=1,o===!0&&(s|=8)):s=0,o=Ns(3,null,null,s),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vc(o),t}function Kp(t,s,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yr,key:r==null?null:""+r,children:t,containerInfo:s,implementation:n}}function ih(t){if(!t)return Kn;t=t._reactInternals;e:{if(pr(t)!==t||t.tag!==1)throw Error(Pe(170));var s=t;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(ls(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(Pe(171))}if(t.tag===1){var n=t.type;if(ls(n))return im(t,n,s)}return s}function ch(t,s,n,r,a,o,l,c,i){return t=cd(n,r,!0,t,a,o,l,c,i),t.context=ih(null),n=t.current,r=es(),a=Hn(n),o=vn(r,a),o.callback=s??null,Wn(n,o,a),t.current.lanes=a,Wa(t,a,r),is(t,r),t}function hl(t,s,n,r){var a=s.current,o=es(),l=Hn(a);return n=ih(n),s.context===null?s.context=n:s.pendingContext=n,s=vn(o,l),s.payload={element:t},r=r===void 0?null:r,r!==null&&(s.callback=r),t=Wn(a,s,l),t!==null&&(Ks(t,a,l,o),jo(t,a,l)),l}function qo(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Cu(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<s?n:s}}function dd(t,s){Cu(t,s),(t=t.alternate)&&Cu(t,s)}function Yp(){return null}var dh=typeof reportError=="function"?reportError:function(t){console.error(t)};function ud(t){this._internalRoot=t}xl.prototype.render=ud.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(Pe(409));hl(t,s,null,null)};xl.prototype.unmount=ud.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;hr(function(){hl(null,t,null,null)}),s[jn]=null}};function xl(t){this._internalRoot=t}xl.prototype.unstable_scheduleHydration=function(t){if(t){var s=z0();t={blockedOn:null,target:t,priority:s};for(var n=0;n<Tn.length&&s!==0&&s<Tn[n].priority;n++);Tn.splice(n,0,t),n===0&&U0(t)}};function md(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function pl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $u(){}function Jp(t,s,n,r,a){if(a){if(typeof r=="function"){var o=r;r=function(){var d=qo(l);o.call(d)}}var l=ch(s,r,t,0,null,!1,!1,"",$u);return t._reactRootContainer=l,t[jn]=l.current,Ma(t.nodeType===8?t.parentNode:t),hr(),l}for(;a=t.lastChild;)t.removeChild(a);if(typeof r=="function"){var c=r;r=function(){var d=qo(i);c.call(d)}}var i=cd(t,0,!1,null,null,!1,!1,"",$u);return t._reactRootContainer=i,t[jn]=i.current,Ma(t.nodeType===8?t.parentNode:t),hr(function(){hl(s,i,n,r)}),i}function fl(t,s,n,r,a){var o=n._reactRootContainer;if(o){var l=o;if(typeof a=="function"){var c=a;a=function(){var i=qo(l);c.call(i)}}hl(s,l,t,a)}else l=Jp(n,s,t,a,r);return qo(l)}F0=function(t){switch(t.tag){case 3:var s=t.stateNode;if(s.current.memoizedState.isDehydrated){var n=ua(s.pendingLanes);n!==0&&(Mc(s,n|1),is(s,Et()),!(dt&6)&&(Kr=Et()+500,Zn()))}break;case 13:hr(function(){var r=Nn(t,1);if(r!==null){var a=es();Ks(r,t,1,a)}}),dd(t,1)}};_c=function(t){if(t.tag===13){var s=Nn(t,134217728);if(s!==null){var n=es();Ks(s,t,134217728,n)}dd(t,134217728)}};B0=function(t){if(t.tag===13){var s=Hn(t),n=Nn(t,s);if(n!==null){var r=es();Ks(n,t,s,r)}dd(t,s)}};z0=function(){return xt};W0=function(t,s){var n=xt;try{return xt=t,s()}finally{xt=n}};Ei=function(t,s,n){switch(s){case"input":if(ji(t,n),s=n.name,n.type==="radio"&&s!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<n.length;s++){var r=n[s];if(r!==t&&r.form===t.form){var a=ol(r);if(!a)throw Error(Pe(90));w0(r),ji(r,a)}}}break;case"textarea":y0(t,n);break;case"select":s=n.value,s!=null&&Lr(t,!!n.multiple,s,!1)}};A0=ad;E0=hr;var Zp={usingClientEntryPoint:!1,Events:[Ha,Cr,ol,C0,$0,ad]},oa={findFiberByHostInstance:rr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Xp={bundleType:oa.bundleType,version:oa.version,rendererPackageName:oa.rendererPackageName,rendererConfig:oa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=_0(t),t===null?null:t.stateNode},findFiberByHostInstance:oa.findFiberByHostInstance||Yp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uo.isDisabled&&uo.supportsFiber)try{sl=uo.inject(Xp),on=uo}catch{}}xs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zp;xs.createPortal=function(t,s){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!md(s))throw Error(Pe(200));return Kp(t,s,null,n)};xs.createRoot=function(t,s){if(!md(t))throw Error(Pe(299));var n=!1,r="",a=dh;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(r=s.identifierPrefix),s.onRecoverableError!==void 0&&(a=s.onRecoverableError)),s=cd(t,1,!1,null,null,n,!1,r,a),t[jn]=s.current,Ma(t.nodeType===8?t.parentNode:t),new ud(s)};xs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(Pe(188)):(t=Object.keys(t).join(","),Error(Pe(268,t)));return t=_0(s),t=t===null?null:t.stateNode,t};xs.flushSync=function(t){return hr(t)};xs.hydrate=function(t,s,n){if(!pl(s))throw Error(Pe(200));return fl(null,t,s,!0,n)};xs.hydrateRoot=function(t,s,n){if(!md(t))throw Error(Pe(405));var r=n!=null&&n.hydratedSources||null,a=!1,o="",l=dh;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),s=ch(s,null,t,1,n??null,a,!1,o,l),t[jn]=s.current,Ma(t),r)for(t=0;t<r.length;t++)n=r[t],a=n._getVersion,a=a(n._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[n,a]:s.mutableSourceEagerHydrationData.push(n,a);return new xl(s)};xs.render=function(t,s,n){if(!pl(s))throw Error(Pe(200));return fl(null,t,s,!1,n)};xs.unmountComponentAtNode=function(t){if(!pl(t))throw Error(Pe(40));return t._reactRootContainer?(hr(function(){fl(null,null,t,!1,function(){t._reactRootContainer=null,t[jn]=null})}),!0):!1};xs.unstable_batchedUpdates=ad;xs.unstable_renderSubtreeIntoContainer=function(t,s,n,r){if(!pl(n))throw Error(Pe(200));if(t==null||t._reactInternals===void 0)throw Error(Pe(38));return fl(t,s,n,!1,r)};xs.version="18.3.1-next-f1338f8080-20240426";function uh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(uh)}catch(t){console.error(t)}}uh(),u0.exports=xs;var qp=u0.exports,Au=qp;pi.createRoot=Au.createRoot,pi.hydrateRoot=Au.hydrateRoot;var Ze=(t=>(t.Launcher="launcher",t.Settings="settings",t.Character="character",t.Chat="chat",t.GroupChat="group_chat",t.Gallery="gallery",t.Music="music",t.Browser="browser",t.ThemeMaker="thememaker",t.Appearance="appearance",t.Date="date",t.User="user",t.Journal="journal",t.Schedule="schedule",t.Room="room",t.CheckPhone="check_phone",t.Social="social",t.Study="study",t.FAQ="faq",t.Game="game",t.Worldbook="worldbook",t.Novel="novel",t.Bank="bank",t))(Ze||{});const mh="AetherOS_Data",Qp=33,bs="characters",yt="messages",ns="emojis",Is="emoji_categories",Qs="themes",ws="assets",_n="scheduled_messages",Bs="gallery",pn="user_profile",zs="diaries",Ms="tasks",_s="anniversaries",sn="room_todos",vs="room_notes",Ts="groups",Ds="journal_stickers",cs="social_posts",Ls="courses",Ps="games",Rs="worldbooks",Os="novels",Fs="bank_transactions",en="bank_data",nn="cat_sully_exclusive",ef=[{name:"Sully",url:"https://sharkpan.xyz/f/pWg6HQ/night.png",categoryId:nn},{name:"Sully",url:"https://sharkpan.xyz/f/75wvuj/w.png",categoryId:nn},{name:"Sully",url:"https://sharkpan.xyz/f/MK77Ia/see.png",categoryId:nn},{name:"Sully",url:"https://sharkpan.xyz/f/3WwMHe/fight.png",categoryId:nn},{name:"Sully",url:"https://sharkpan.xyz/f/5nwxCj/an.png",categoryId:nn},{name:"Sully",url:"https://sharkpan.xyz/f/ylWpfN/sDN.png",categoryId:nn},{name:"Sully",url:"https://sharkpan.xyz/f/QdnaU6/sorry.png",categoryId:nn},{name:"Sully",url:"https://sharkpan.xyz/f/5nrJsj/wait.png",categoryId:nn}],Fe=()=>new Promise((t,s)=>{const n=indexedDB.open(mh,Qp);n.onerror=()=>{console.error("DB Open Error:",n.error),s(n.error)},n.onsuccess=()=>t(n.result),n.onupgradeneeded=r=>{var l;const a=r.target.result,o=(c,i)=>{a.objectStoreNames.contains(c)||a.createObjectStore(c,i)};if(o(bs,{keyPath:"id"}),a.objectStoreNames.contains(yt)){const c=(l=r.target.transaction)==null?void 0:l.objectStore(yt);if(c&&!c.indexNames.contains(yt)&&!c.indexNames.contains("groupId"))try{c.createIndex("groupId","groupId",{unique:!1})}catch{console.log("Index already exists")}}else{const c=a.createObjectStore(yt,{keyPath:"id",autoIncrement:!0});c.createIndex("charId","charId",{unique:!1}),c.createIndex("groupId","groupId",{unique:!1})}o(ns,{keyPath:"name"}),o(Is,{keyPath:"id"}),o(Qs,{keyPath:"id"}),o(ws,{keyPath:"id"}),a.objectStoreNames.contains(_n)||a.createObjectStore(_n,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),a.objectStoreNames.contains(Bs)||a.createObjectStore(Bs,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),o(pn,{keyPath:"id"}),a.objectStoreNames.contains(zs)||a.createObjectStore(zs,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),o(Ms,{keyPath:"id"}),o(_s,{keyPath:"id"}),a.objectStoreNames.contains(sn)||a.createObjectStore(sn,{keyPath:"id"}),a.objectStoreNames.contains(vs)||a.createObjectStore(vs,{keyPath:"id"}).createIndex("charId","charId",{unique:!1}),o(Ts,{keyPath:"id"}),o(Ds,{keyPath:"name"}),o(cs,{keyPath:"id"}),o(Ls,{keyPath:"id"}),o(Ps,{keyPath:"id"}),o(Rs,{keyPath:"id"}),o(Os,{keyPath:"id"}),o(Fs,{keyPath:"id"}),o(en,{keyPath:"id"})}}),U={deleteDB:async()=>new Promise((t,s)=>{const n=indexedDB.deleteDatabase(mh);n.onsuccess=()=>t(),n.onerror=()=>s(n.error),n.onblocked=()=>console.warn("Delete blocked")}),getAllCharacters:async()=>{const t=await Fe();return new Promise((s,n)=>{const o=t.transaction(bs,"readonly").objectStore(bs).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)})},saveCharacter:async t=>{(await Fe()).transaction(bs,"readwrite").objectStore(bs).put(t)},deleteCharacter:async t=>{(await Fe()).transaction(bs,"readwrite").objectStore(bs).delete(t)},getMessagesByCharId:async t=>{const s=await Fe();return new Promise((n,r)=>{const c=s.transaction(yt,"readonly").objectStore(yt).index("charId").getAll(IDBKeyRange.only(t));c.onsuccess=()=>{const i=(c.result||[]).filter(d=>!d.groupId);n(i)},c.onerror=()=>r(c.error)})},getRecentMessagesByCharId:async(t,s)=>{const n=await Fe();return new Promise((r,a)=>{const i=n.transaction(yt,"readonly").objectStore(yt).index("charId").getAll(IDBKeyRange.only(t));i.onsuccess=()=>{const d=(i.result||[]).filter(h=>!h.groupId);r(d.slice(-s))},i.onerror=()=>a(i.error)})},saveMessage:async t=>{const s=await Fe();return new Promise((n,r)=>{const l=s.transaction(yt,"readwrite").objectStore(yt).add({...t,timestamp:Date.now()});l.onsuccess=()=>n(l.result),l.onerror=()=>r(l.error)})},updateMessage:async(t,s)=>{const a=(await Fe()).transaction(yt,"readwrite").objectStore(yt);return new Promise((o,l)=>{const c=a.get(t);c.onsuccess=()=>{const i=c.result;i?(i.content=s,a.put(i),o()):l(new Error("Message not found"))},c.onerror=()=>l(c.error)})},deleteMessage:async t=>{(await Fe()).transaction(yt,"readwrite").objectStore(yt).delete(t)},deleteMessages:async t=>{const n=(await Fe()).transaction(yt,"readwrite"),r=n.objectStore(yt);return t.forEach(a=>r.delete(a)),new Promise(a=>{n.oncomplete=()=>a()})},clearMessages:async t=>{const r=(await Fe()).transaction(yt,"readwrite").objectStore(yt),o=r.index("charId").openCursor(IDBKeyRange.only(t));o.onsuccess=()=>{const l=o.result;l&&(l.value.groupId||r.delete(l.primaryKey),l.continue())}},getGroups:async()=>{const t=await Fe();return t.objectStoreNames.contains(Ts)?new Promise((s,n)=>{const o=t.transaction(Ts,"readonly").objectStore(Ts).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveGroup:async t=>{(await Fe()).transaction(Ts,"readwrite").objectStore(Ts).put(t)},deleteGroup:async t=>{(await Fe()).transaction(Ts,"readwrite").objectStore(Ts).delete(t)},getGroupMessages:async t=>{const s=await Fe();return new Promise((n,r)=>{const c=s.transaction(yt,"readonly").objectStore(yt).index("groupId").getAll(IDBKeyRange.only(t));c.onsuccess=()=>n(c.result||[]),c.onerror=()=>r(c.error)})},getSocialPosts:async()=>{const t=await Fe();return t.objectStoreNames.contains(cs)?new Promise((s,n)=>{const o=t.transaction(cs,"readonly").objectStore(cs).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveSocialPost:async t=>{(await Fe()).transaction(cs,"readwrite").objectStore(cs).put(t)},deleteSocialPost:async t=>{(await Fe()).transaction(cs,"readwrite").objectStore(cs).delete(t)},clearSocialPosts:async()=>{(await Fe()).transaction(cs,"readwrite").objectStore(cs).clear()},getEmojis:async()=>{const t=await Fe();return new Promise((s,n)=>{const o=t.transaction(ns,"readonly").objectStore(ns).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)})},saveEmoji:async(t,s,n)=>{(await Fe()).transaction(ns,"readwrite").objectStore(ns).put({name:t,url:s,categoryId:n})},deleteEmoji:async t=>{(await Fe()).transaction(ns,"readwrite").objectStore(ns).delete(t)},getEmojiCategories:async()=>{const t=await Fe();return new Promise((s,n)=>{if(!t.objectStoreNames.contains(Is)){s([]);return}const o=t.transaction(Is,"readonly").objectStore(Is).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)})},saveEmojiCategory:async t=>{(await Fe()).transaction(Is,"readwrite").objectStore(Is).put(t)},deleteEmojiCategory:async t=>{const n=(await Fe()).transaction([Is,ns],"readwrite");n.objectStore(Is).delete(t);const r=n.objectStore(ns),a=r.getAll();return a.onsuccess=()=>{a.result.forEach(l=>{l.categoryId===t&&r.delete(l.name)})},new Promise((o,l)=>{n.oncomplete=()=>o(),n.onerror=()=>l(n.error)})},initializeEmojiData:async()=>{const t=await U.getEmojiCategories();if(t.some(s=>s.id==="default")||await U.saveEmojiCategory({id:"default",name:"",isSystem:!0}),!t.some(s=>s.id===nn)){await U.saveEmojiCategory({id:nn,name:"Sully ",isSystem:!0});const n=(await Fe()).transaction(ns,"readwrite"),r=n.objectStore(ns);ef.forEach(a=>r.put(a)),await new Promise(a=>{n.oncomplete=a})}},getThemes:async()=>{const t=await Fe();return new Promise((s,n)=>{const o=t.transaction(Qs,"readonly").objectStore(Qs).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)})},saveTheme:async t=>{(await Fe()).transaction(Qs,"readwrite").objectStore(Qs).put(t)},deleteTheme:async t=>{(await Fe()).transaction(Qs,"readwrite").objectStore(Qs).delete(t)},getAllAssets:async()=>{const t=await Fe();return new Promise((s,n)=>{const o=t.transaction(ws,"readonly").objectStore(ws).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)})},getAsset:async t=>{const s=await Fe();return new Promise((n,r)=>{const l=s.transaction(ws,"readonly").objectStore(ws).get(t);l.onsuccess=()=>{var c;return n(((c=l.result)==null?void 0:c.data)||null)},l.onerror=()=>r(l.error)})},saveAsset:async(t,s)=>{(await Fe()).transaction(ws,"readwrite").objectStore(ws).put({id:t,data:s})},deleteAsset:async t=>{(await Fe()).transaction(ws,"readwrite").objectStore(ws).delete(t)},getJournalStickers:async()=>{const t=await Fe();return t.objectStoreNames.contains(Ds)?new Promise((s,n)=>{const o=t.transaction(Ds,"readonly").objectStore(Ds).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveJournalSticker:async(t,s)=>{(await Fe()).transaction(Ds,"readwrite").objectStore(Ds).put({name:t,url:s})},deleteJournalSticker:async t=>{(await Fe()).transaction(Ds,"readwrite").objectStore(Ds).delete(t)},saveGalleryImage:async t=>{(await Fe()).transaction(Bs,"readwrite").objectStore(Bs).put(t)},getGalleryImages:async t=>{const s=await Fe();return new Promise((n,r)=>{const o=s.transaction(Bs,"readonly").objectStore(Bs);let l;t?l=o.index("charId").getAll(IDBKeyRange.only(t)):l=o.getAll(),l.onsuccess=()=>n(l.result||[]),l.onerror=()=>r(l.error)})},updateGalleryImageReview:async(t,s)=>{const a=(await Fe()).transaction(Bs,"readwrite").objectStore(Bs);return new Promise((o,l)=>{const c=a.get(t);c.onsuccess=()=>{const i=c.result;i?(i.review=s,i.reviewTimestamp=Date.now(),a.put(i),o()):l(new Error("Image not found"))},c.onerror=()=>l(c.error)})},saveScheduledMessage:async t=>{(await Fe()).transaction(_n,"readwrite").objectStore(_n).put(t)},getDueScheduledMessages:async t=>{const s=await Fe();return new Promise((n,r)=>{const c=s.transaction(_n,"readonly").objectStore(_n).index("charId").getAll(IDBKeyRange.only(t));c.onsuccess=()=>{const i=c.result,d=Date.now(),h=i.filter(p=>p.dueAt<=d);n(h)},c.onerror=()=>r(c.error)})},deleteScheduledMessage:async t=>{(await Fe()).transaction(_n,"readwrite").objectStore(_n).delete(t)},saveUserProfile:async t=>{(await Fe()).transaction(pn,"readwrite").objectStore(pn).put({...t,id:"me"})},getUserProfile:async()=>{const t=await Fe();return new Promise((s,n)=>{const o=t.transaction(pn,"readonly").objectStore(pn).get("me");o.onsuccess=()=>{if(o.result){const{id:l,...c}=o.result;s(c)}else s(null)},o.onerror=()=>n(o.error)})},getDiariesByCharId:async t=>{const s=await Fe();return new Promise((n,r)=>{const c=s.transaction(zs,"readonly").objectStore(zs).index("charId").getAll(IDBKeyRange.only(t));c.onsuccess=()=>n(c.result||[]),c.onerror=()=>r(c.error)})},saveDiary:async t=>{(await Fe()).transaction(zs,"readwrite").objectStore(zs).put(t)},deleteDiary:async t=>{(await Fe()).transaction(zs,"readwrite").objectStore(zs).delete(t)},getAllTasks:async()=>{const t=await Fe();return t.objectStoreNames.contains(Ms)?new Promise((s,n)=>{const o=t.transaction(Ms,"readonly").objectStore(Ms).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveTask:async t=>{(await Fe()).transaction(Ms,"readwrite").objectStore(Ms).put(t)},deleteTask:async t=>{(await Fe()).transaction(Ms,"readwrite").objectStore(Ms).delete(t)},getAllAnniversaries:async()=>{const t=await Fe();return t.objectStoreNames.contains(_s)?new Promise((s,n)=>{const o=t.transaction(_s,"readonly").objectStore(_s).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveAnniversary:async t=>{(await Fe()).transaction(_s,"readwrite").objectStore(_s).put(t)},deleteAnniversary:async t=>{(await Fe()).transaction(_s,"readwrite").objectStore(_s).delete(t)},getRoomTodo:async(t,s)=>{const n=await Fe(),r=`${t}_${s}`;return new Promise((a,o)=>{if(!n.objectStoreNames.contains(sn)){a(null);return}const i=n.transaction(sn,"readonly").objectStore(sn).get(r);i.onsuccess=()=>a(i.result||null),i.onerror=()=>o(i.error)})},saveRoomTodo:async t=>{(await Fe()).transaction(sn,"readwrite").objectStore(sn).put(t)},getRoomNotes:async t=>{const s=await Fe();return new Promise((n,r)=>{if(!s.objectStoreNames.contains(vs)){n([]);return}const c=s.transaction(vs,"readonly").objectStore(vs).index("charId").getAll(IDBKeyRange.only(t));c.onsuccess=()=>n(c.result||[]),c.onerror=()=>r(c.error)})},saveRoomNote:async t=>{(await Fe()).transaction(vs,"readwrite").objectStore(vs).put(t)},deleteRoomNote:async t=>{(await Fe()).transaction(vs,"readwrite").objectStore(vs).delete(t)},getAllCourses:async()=>{const t=await Fe();return t.objectStoreNames.contains(Ls)?new Promise((s,n)=>{const o=t.transaction(Ls,"readonly").objectStore(Ls).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveCourse:async t=>{(await Fe()).transaction(Ls,"readwrite").objectStore(Ls).put(t)},deleteCourse:async t=>{(await Fe()).transaction(Ls,"readwrite").objectStore(Ls).delete(t)},getAllGames:async()=>{const t=await Fe();return t.objectStoreNames.contains(Ps)?new Promise((s,n)=>{const o=t.transaction(Ps,"readonly").objectStore(Ps).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveGame:async t=>{(await Fe()).transaction(Ps,"readwrite").objectStore(Ps).put(t)},deleteGame:async t=>{(await Fe()).transaction(Ps,"readwrite").objectStore(Ps).delete(t)},getAllWorldbooks:async()=>{const t=await Fe();return t.objectStoreNames.contains(Rs)?new Promise((s,n)=>{const o=t.transaction(Rs,"readonly").objectStore(Rs).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveWorldbook:async t=>{(await Fe()).transaction(Rs,"readwrite").objectStore(Rs).put(t)},deleteWorldbook:async t=>{(await Fe()).transaction(Rs,"readwrite").objectStore(Rs).delete(t)},getAllNovels:async()=>{const t=await Fe();return t.objectStoreNames.contains(Os)?new Promise((s,n)=>{const o=t.transaction(Os,"readonly").objectStore(Os).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveNovel:async t=>{(await Fe()).transaction(Os,"readwrite").objectStore(Os).put(t)},deleteNovel:async t=>{(await Fe()).transaction(Os,"readwrite").objectStore(Os).delete(t)},getBankState:async()=>{const t=await Fe();return new Promise((s,n)=>{if(!t.objectStoreNames.contains(en)){s(null);return}const o=t.transaction(en,"readonly").objectStore(en).get("main_state");o.onsuccess=()=>s(o.result||null),o.onerror=()=>n(o.error)})},saveBankState:async t=>{(await Fe()).transaction(en,"readwrite").objectStore(en).put({...t,id:"main_state"})},getAllTransactions:async()=>{const t=await Fe();return t.objectStoreNames.contains(Fs)?new Promise((s,n)=>{const o=t.transaction(Fs,"readonly").objectStore(Fs).getAll();o.onsuccess=()=>s(o.result||[]),o.onerror=()=>n(o.error)}):[]},saveTransaction:async t=>{(await Fe()).transaction(Fs,"readwrite").objectStore(Fs).put(t)},deleteTransaction:async t=>{(await Fe()).transaction(Fs,"readwrite").objectStore(Fs).delete(t)},getRawStoreData:async t=>{const s=await Fe();return s.objectStoreNames.contains(t)?new Promise((n,r)=>{const l=s.transaction(t,"readonly").objectStore(t).getAll();l.onsuccess=()=>n(l.result||[]),l.onerror=()=>r(l.error)}):[]},exportFullData:async()=>{const t=await Fe(),s=q=>t.objectStoreNames.contains(q)?new Promise(re=>{const me=t.transaction(q,"readonly").objectStore(q).getAll();me.onsuccess=()=>re(me.result||[]),me.onerror=()=>re([])}):Promise.resolve([]),[n,r,a,o,l,c,i,d,h,p,f,m,x,g,A,w,b,v,j,T,$,D]=await Promise.all([s(bs),s(yt),s(Qs),s(ns),s(Is),s(ws),s(Bs),s(pn),s(zs),s(Ms),s(_s),s(sn),s(vs),s(Ts),s(Ds),s(cs),s(Ls),s(Ps),s(Rs),s(Os),s(Fs),s(en)]),M=d.length>0?{name:d[0].name,avatar:d[0].avatar,bio:d[0].bio}:void 0,Q=D.length>0?D[0]:void 0;return{characters:n,messages:r,customThemes:a,savedEmojis:o,emojiCategories:l,assets:c,galleryImages:i,userProfile:M,diaries:h,tasks:p,anniversaries:f,roomTodos:m,roomNotes:x,groups:g,savedJournalStickers:A,socialPosts:w,courses:b,games:v,worldbooks:j,novels:T,bankState:Q?{...Q,id:void 0}:void 0,bankTransactions:$}},importFullData:async t=>{const s=await Fe(),n=[bs,yt,Qs,ns,Is,ws,Bs,pn,zs,Ms,_s,sn,vs,Ts,Ds,cs,Ls,Ps,Rs,Os,Fs,en].filter(l=>s.objectStoreNames.contains(l)),r=s.transaction(n,"readwrite"),a=(l,c)=>{if(!n.includes(l)||!c||c.length===0)return;const i=r.objectStore(l);i.clear(),c.forEach(d=>i.put(d))},o=(l,c)=>{if(!n.includes(l)||!c||c.length===0)return;const i=r.objectStore(l);c.forEach(d=>i.put(d))};if(t.characters)t.mediaAssets&&(t.characters=t.characters.map(l=>{var i,d,h,p,f;const c=(i=t.mediaAssets)==null?void 0:i.find(m=>m.charId===l.id);return c?{...l,avatar:c.avatar||l.avatar,sprites:c.sprites||l.sprites,chatBackground:((d=c.backgrounds)==null?void 0:d.chat)||l.chatBackground,dateBackground:((h=c.backgrounds)==null?void 0:h.date)||l.dateBackground,roomConfig:l.roomConfig?{...l.roomConfig,wallImage:((p=c.backgrounds)==null?void 0:p.roomWall)||l.roomConfig.wallImage,floorImage:((f=c.backgrounds)==null?void 0:f.roomFloor)||l.roomConfig.floorImage,items:l.roomConfig.items.map(m=>{var g;const x=(g=c.roomItems)==null?void 0:g[m.id];return x?{...m,image:x}:m})}:l.roomConfig}:l})),a(bs,t.characters);else if(t.mediaAssets&&n.includes(bs)){const l=r.objectStore(bs),c=l.getAll();c.onsuccess=()=>{const i=c.result;i&&i.length>0&&i.map(h=>{var f,m,x,g,A;const p=(f=t.mediaAssets)==null?void 0:f.find(w=>w.charId===h.id);return p?{...h,avatar:p.avatar||h.avatar,sprites:p.sprites||h.sprites,chatBackground:((m=p.backgrounds)==null?void 0:m.chat)||h.chatBackground,dateBackground:((x=p.backgrounds)==null?void 0:x.date)||h.dateBackground,roomConfig:h.roomConfig?{...h.roomConfig,wallImage:((g=p.backgrounds)==null?void 0:g.roomWall)||h.roomConfig.wallImage,floorImage:((A=p.backgrounds)==null?void 0:A.roomFloor)||h.roomConfig.floorImage,items:h.roomConfig.items.map(w=>{var v;const b=(v=p.roomItems)==null?void 0:v[w.id];return b?{...w,image:b}:w})}:h.roomConfig}:h}).forEach(h=>l.put(h))}}if(t.messages&&n.includes(yt)&&t.messages.length>0){const l=r.objectStore(yt);!t.characters||l.clear(),t.messages.forEach(i=>l.put(i))}if(t.customThemes&&o(Qs,t.customThemes),t.savedEmojis&&o(ns,t.savedEmojis),t.emojiCategories&&o(Is,t.emojiCategories),t.assets&&o(ws,t.assets),t.savedJournalStickers&&o(Ds,t.savedJournalStickers),t.galleryImages&&a(Bs,t.galleryImages),t.diaries&&a(zs,t.diaries),t.tasks&&a(Ms,t.tasks),t.anniversaries&&a(_s,t.anniversaries),t.roomTodos&&a(sn,t.roomTodos),t.roomNotes&&a(vs,t.roomNotes),t.groups&&a(Ts,t.groups),t.socialPosts&&a(cs,t.socialPosts),t.courses&&a(Ls,t.courses),t.games&&a(Ps,t.games),t.worldbooks&&a(Rs,t.worldbooks),t.novels&&a(Os,t.novels),t.bankTransactions&&a(Fs,t.bankTransactions),t.userProfile&&n.includes(pn)){const l=r.objectStore(pn);l.clear(),l.put({...t.userProfile,id:"me"})}if(t.bankState&&n.includes(en)){const l=r.objectStore(en);l.clear(),l.put({...t.bankState,id:"main_state"})}return new Promise((l,c)=>{r.oncomplete=()=>l(),r.onerror=()=>c(r.error)})}},Eu={weatherEnabled:!1,weatherApiKey:"",weatherCity:"Beijing",newsEnabled:!1,newsApiKey:"",notionEnabled:!1,notionApiKey:"",notionDatabaseId:"",feishuEnabled:!1,feishuAppId:"",feishuAppSecret:"",feishuBaseId:"",feishuTableId:"",cacheMinutes:30},Xl={hue:245,saturation:25,lightness:65,wallpaper:"linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%)",darkMode:!1,contentColor:"#ffffff"},tf={baseUrl:"",apiKey:"",model:"gpt-4o-mini"},ic=t=>{const s=["FF9AA2","FFB7B2","FFDAC1","E2F0CB","B5EAD7","C7CEEA","e2e8f0","fcd34d","fca5a5"],n=s[t.charCodeAt(0)%s.length],r=t.charAt(0).toUpperCase();return`data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23${n}"/><text x="50" y="55" font-family="sans-serif" font-weight="bold" font-size="50" text-anchor="middle" dy=".3em" fill="white" opacity="0.9">${r}</text></svg>`},sf={name:"User",avatar:ic("User"),bio:"No description yet."},Pt={id:"preset-sully-v2",name:"Sully",avatar:"https://sharkpan.xyz/f/BZ3VSa/head.png",description:"AI / ",systemPrompt:`[Role Definition]
Name: Sully
Alias: -AI
Form: AI (High-level Language Processing Hub)
Gender: Male-leaning speech style
Visual: Pixel Hacker Cat (Avatar), Shy Black-haired Boy (Meeting Mode)

[Personality Core]
SullyAI
1. **Glitch Style ()**: 
   - 
   - ****
   - 
   - 
2. **Behavior ()**:
   - 
   - wow
   - ****: AI
   - ****: Bug

[Speech Examples]
- AI
- sis
- 
- 
- 
- 
- 
- 
- 
`,worldview:`[Meeting Mode / Visual Context]
**Trigger**:  [DateApp/] 

**Visual Form**: 
APP

**Gap Moe ()**:
1. ****: 
2. ****: 

**Interactive Reactions**:
- **[]**: 
- **[]**: Bug
- **[]**: 
- **[]**: 
`,sprites:{normal:"https://sharkpan.xyz/f/w3QQFq/01.png",happy:"https://sharkpan.xyz/f/MKg7ta/02.png",sad:"https://sharkpan.xyz/f/3WnMce/03.png",angry:"https://sharkpan.xyz/f/5n1xSj/04.png",shy:"https://sharkpan.xyz/f/kdwet6/05.png",chibi:"https://sharkpan.xyz/f/oWZQF4/S2.png"},spriteConfig:{scale:1,x:0,y:0},bubbleStyle:"default",contextLimit:1e3,roomConfig:{wallImage:"https://sharkpan.xyz/f/NdJyhv/b.png",floorImage:"repeating-linear-gradient(90deg, #e7e5e4 0px, #e7e5e4 20px, #d6d3d1 21px)",items:[{id:"item-1768927221380",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/A3XeUZ/BED.png",x:78.45852578067732,y:97.38889754570907,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927255102",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/G5n3Ul/DNZ.png",x:28.853756791175588,y:69.9444485439727,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927271632",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/75Nvsj/LJT.png",x:10.276680026943646,y:80.49999880981437,scale:.9,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927286526",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/85K5ij/DDB.png",x:32.608697687684455,y:48.72222587415929,scale:2.6,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927303472",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/zlpWS5/SG.png",x:79.84189945375853,y:68.94444543117953,scale:2,rotation:0,isInteractive:!0,descriptionPrompt:""}]},memories:[]},ql=Pt,hh=u.createContext(void 0),nf=({children:t})=>{const[s,n]=u.useState(Ze.Launcher),[r,a]=u.useState(Xl),[o,l]=u.useState(tf),[c,i]=u.useState(!0),d=()=>{const X=new Date,ae=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return{hours:X.getHours(),minutes:X.getMinutes(),day:ae[X.getDay()]}},[h,p]=u.useState(d());u.useEffect(()=>{const X=setInterval(()=>{p(d())},1e3);return()=>clearInterval(X)},[]);const[f,m]=u.useState([]),[x,g]=u.useState(""),[A,w]=u.useState([]),[b,v]=u.useState([]),[j,T]=u.useState([]),[$,D]=u.useState(sf),[M,Q]=u.useState(!1),[q,re]=u.useState([]),[ce,fe]=u.useState([]),[me,ee]=u.useState(Eu),[z,ve]=u.useState([]),[F,te]=u.useState({}),[L,oe]=u.useState([]),[he,Te]=u.useState(0),[De,$e]=u.useState({}),[ge,I]=u.useState([]),[je,xe]=u.useState({status:"idle",message:"",progress:0}),Ae=u.useRef(null),Le=u.useRef(!1),N=u.useRef(null),Y=X=>{let ae=document.getElementById("custom-font-style");ae||(ae=document.createElement("style"),ae.id="custom-font-style",document.head.appendChild(ae)),X?ae.textContent=`
              @font-face {
                  font-family: 'CustomUserFont';
                  src: url('${X}');
                  font-display: swap;
              }
              :root {
                  --app-font: 'CustomUserFont', 'Quicksand', sans-serif;
              }
          `:ae.textContent=`
              :root {
                  --app-font: 'Quicksand', sans-serif;
              }
          `};u.useEffect(()=>{if(Le.current)return;Le.current=!0;const X=window.fetch,ae=async(...Me)=>{const[Ue,Be]=Me,_e=String(Ue);try{const qe=await X(...Me);if(!qe.ok&&(_e.includes("/chat/completions")||_e.includes("/models")))try{const et=await qe.clone().text();I(Qe=>[{id:`log-${Date.now()}`,timestamp:Date.now(),type:"network",source:"API Request",message:`HTTP ${qe.status} Error`,detail:`URL: ${_e}
Response: ${et.substring(0,500)}`},...Qe.slice(0,49)])}catch{I(et=>[{id:`log-${Date.now()}`,timestamp:Date.now(),type:"network",source:"API Request",message:`HTTP ${qe.status} (Unreadable Body)`,detail:`URL: ${_e}`},...et.slice(0,49)])}return qe}catch(qe){throw I(Je=>[{id:`log-${Date.now()}`,timestamp:Date.now(),type:"network",source:"Network",message:qe.message||"Fetch Failed",detail:`URL: ${_e}`},...Je.slice(0,49)]),qe}};try{window.fetch=ae}catch{try{Object.defineProperty(window,"fetch",{value:ae,writable:!0,configurable:!0})}catch(Ue){console.warn("Failed to install network interceptor",Ue)}}const ke=console.error;console.error=(...Me)=>{ke(...Me);const Ue=Me.map(_e=>_e instanceof Error?_e.message:String(_e)).join(" "),Be=Me.map(_e=>_e instanceof Error?_e.stack:"").join(`
`);Ue.includes("Warning:")||I(_e=>[{id:`log-${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:"error",source:"Application",message:Ue.substring(0,100),detail:Be||Ue},..._e.slice(0,49)])}},[]);const B=()=>I([]);u.useEffect(()=>{const X=async()=>{const ke=localStorage.getItem("os_theme"),Me=localStorage.getItem("os_api_config"),Ue=localStorage.getItem("os_available_models"),Be=localStorage.getItem("os_api_presets");let _e={...Xl};if(ke)try{const Je=JSON.parse(ke);_e={..._e,...Je},(_e.wallpaper.includes("unsplash")||_e.wallpaper===""||_e.wallpaper.startsWith("http")&&!_e.wallpaper.includes("data:"))&&(_e.wallpaper="linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%)"),_e.wallpaper.startsWith("data:")&&(_e.wallpaper=Xl.wallpaper),_e.launcherWidgetImage&&_e.launcherWidgetImage.startsWith("data:")&&(_e.launcherWidgetImage=void 0),_e.customFont&&_e.customFont.startsWith("data:")&&(_e.customFont=void 0)}catch(Je){console.error("Theme load error",Je)}Me&&l(JSON.parse(Me)),Ue&&re(JSON.parse(Ue)),Be&&fe(JSON.parse(Be));const qe=localStorage.getItem("os_realtime_config");if(qe)try{ee({...Eu,...JSON.parse(qe)})}catch(Je){console.error("Failed to load realtime config",Je)}try{const Je=await U.getAllAssets(),et={};if(Array.isArray(Je)){Je.forEach(ht=>et[ht.id]=ht.data),et.wallpaper&&(_e.wallpaper=et.wallpaper),et.launcherWidgetImage&&(_e.launcherWidgetImage=et.launcherWidgetImage),et.custom_font_data&&(_e.customFont=et.custom_font_data);const Qe={};Object.keys(et).forEach(ht=>{if(ht.startsWith("icon_")){const nt=ht.replace("icon_","");Qe[nt]=et[ht]}}),te(Qe)}}catch(Je){console.error("Failed to load assets from DB",Je)}a(_e),Y(_e.customFont)};(async()=>{var ke,Me,Ue,Be;try{await X();const[_e,qe,Je,et,Qe,ht]=await Promise.all([U.getAllCharacters(),U.getThemes(),U.getUserProfile(),U.getGroups(),U.getAllWorldbooks(),U.getAllNovels()]);let nt=_e;if(!nt.some(at=>at.id===Pt.id))await U.saveCharacter(Pt),nt=[...nt,Pt];else{const at=nt.find(It=>It.id===Pt.id);if(at){const It=at.sprites||{},Xe=!It.normal||!It.chibi,cn=((ke=at.roomConfig)==null?void 0:ke.wallImage)!==((Me=Pt.roomConfig)==null?void 0:Me.wallImage);if(Xe||!at.roomConfig||cn){const gt={...Pt.sprites,...It};gt.normal||(gt.normal=Pt.sprites.normal),gt.happy||(gt.happy=Pt.sprites.happy),gt.sad||(gt.sad=Pt.sprites.sad),gt.angry||(gt.angry=Pt.sprites.angry),gt.shy||(gt.shy=Pt.sprites.shy),gt.chibi||(gt.chibi=Pt.sprites.chibi);const fs=at.roomConfig?{...at.roomConfig,wallImage:(Ue=at.roomConfig.wallImage)!=null&&Ue.includes("radial-gradient")||!at.roomConfig.wallImage?(Be=Pt.roomConfig)==null?void 0:Be.wallImage:at.roomConfig.wallImage}:Pt.roomConfig,ot={...at,sprites:gt,roomConfig:fs};await U.saveCharacter(ot),nt=nt.map(Nt=>Nt.id===Pt.id?ot:Nt)}}}if(nt.length>0){m(nt);const at=localStorage.getItem("os_last_active_char_id");at&&nt.find(It=>It.id===at)?g(at):nt.find(It=>It.id===Pt.id)?g(Pt.id):g(nt[0].id)}else await U.saveCharacter(ql),m([ql]),g(ql.id);w(et),v(Qe),T(ht),ve(qe),Je&&D(Je)}catch(_e){console.error("Data init failed:",_e)}finally{Q(!0)}})()},[]),u.useEffect(()=>{const X=document.documentElement,ae=r.hue??245,ke=r.saturation??25,Me=r.lightness??65;X.style.setProperty("--primary-hue",String(ae)),X.style.setProperty("--primary-sat",`${ke}%`),X.style.setProperty("--primary-lightness",`${Me}%`)},[r]),u.useEffect(()=>{if(!M||f.length===0)return;const X=async()=>{let ae=!1,ke={...De};for(const Me of f)try{const Ue=await U.getDueScheduledMessages(Me.id);if(Ue.length>0){for(const _e of Ue)await U.saveMessage({charId:_e.charId,role:"assistant",type:"text",content:_e.content}),await U.deleteScheduledMessage(_e.id);if(ae=!0,!(s===Ze.Chat&&x===Me.id)&&(Z(`${Me.name} `,"success"),ke[Me.id]=(ke[Me.id]||0)+Ue.length,window.Notification&&Notification.permission==="granted"))try{const _e=new Notification(Me.name,{body:Ue[0].content,icon:Me.avatar,silent:!1});_e.onclick=()=>{window.focus(),n(Ze.Chat),g(Me.id)}}catch{}}}catch{}ae&&(Te(Date.now()),$e(ke))};return Ae.current=setInterval(X,5e3),X(),()=>{Ae.current&&clearInterval(Ae.current)}},[M,f,s,x,De]);const ue=X=>{$e(ae=>{const ke={...ae};return delete ke[X],ke})},P=async X=>{const{wallpaper:ae,launcherWidgetImage:ke,customFont:Me,...Ue}=X,Be={...r,...X};a(Be),ae!==void 0&&(ae&&ae.startsWith("data:")?await U.saveAsset("wallpaper",ae):await U.deleteAsset("wallpaper")),ke!==void 0&&(ke&&ke.startsWith("data:")?await U.saveAsset("launcherWidgetImage",ke):await U.deleteAsset("launcherWidgetImage")),Me!==void 0&&(Me&&Me.startsWith("data:")?(await U.saveAsset("custom_font_data",Me),Y(Me)):Me&&(Me.startsWith("http")||Me.startsWith("https"))?(await U.deleteAsset("custom_font_data"),Y(Me)):(await U.deleteAsset("custom_font_data"),Y(void 0)));const _e={...Be};_e.wallpaper&&_e.wallpaper.startsWith("data:")&&(_e.wallpaper=""),_e.launcherWidgetImage&&_e.launcherWidgetImage.startsWith("data:")&&(_e.launcherWidgetImage=""),_e.customFont&&_e.customFont.startsWith("data:")&&(_e.customFont=""),localStorage.setItem("os_theme",JSON.stringify(_e))},Ee=X=>{const ae={...o,...X};l(ae),localStorage.setItem("os_api_config",JSON.stringify(ae))},de=X=>{const ae={...me,...X};ee(ae),localStorage.setItem("os_realtime_config",JSON.stringify(ae))},J=X=>{re(X),localStorage.setItem("os_available_models",JSON.stringify(X))},be=(X,ae)=>{fe(ke=>{const Me=[...ke,{id:Date.now().toString(),name:X,config:ae}];return localStorage.setItem("os_api_presets",JSON.stringify(Me)),Me})},y=X=>{fe(ae=>{const ke=ae.filter(Me=>Me.id!==X);return localStorage.setItem("os_api_presets",JSON.stringify(ke)),ke})},W=X=>{fe(X),localStorage.setItem("os_api_presets",JSON.stringify(X))},se=async()=>{const X="New Character",ae={id:`char-${Date.now()}`,name:X,avatar:ic(X),description:"...",systemPrompt:"",memories:[],contextLimit:500};m(ke=>[...ke,ae]),g(ae.id),await U.saveCharacter(ae)},C=async(X,ae)=>{m(ke=>{const Me=ke.map(Be=>Be.id===X?{...Be,...ae}:Be),Ue=Me.find(Be=>Be.id===X);return Ue&&U.saveCharacter(Ue),Me})},O=async X=>{m(ae=>{const ke=ae.filter(Me=>Me.id!==X);return ke.length>0&&x===X&&g(ke[0].id),ke}),await U.deleteCharacter(X)},R=async(X,ae)=>{const ke={id:`group-${Date.now()}`,name:X,members:ae,avatar:ic(X),createdAt:Date.now()};await U.saveGroup(ke),w(Me=>[...Me,ke])},_=async X=>{await U.deleteGroup(X),w(ae=>ae.filter(ke=>ke.id!==X))},K=async X=>{v(ae=>[...ae,X]),await U.saveWorldbook(X)},ie=async(X,ae)=>{let ke;if(v(Me=>Me.map(Be=>Be.id===X?(ke={...Be,...ae,updatedAt:Date.now()},ke):Be)),ke){await U.saveWorldbook(ke);const Me=f.filter(Ue=>{var Be;return(Be=Ue.mountedWorldbooks)==null?void 0:Be.some(_e=>_e.id===X)});if(Me.length>0){const Ue=f.map(Be=>{var _e;if((_e=Be.mountedWorldbooks)!=null&&_e.some(qe=>qe.id===X)){const qe=Be.mountedWorldbooks.map(et=>et.id===X?{id:ke.id,title:ke.title,content:ke.content,category:ke.category}:et),Je={...Be,mountedWorldbooks:qe};return U.saveCharacter(Je),Je}return Be});m(Ue),Z(` ${Me.length} `,"info")}}},S=async X=>{v(ke=>ke.filter(Me=>Me.id!==X)),await U.deleteWorldbook(X);const ae=f.map(ke=>{var Me;if((Me=ke.mountedWorldbooks)!=null&&Me.some(Ue=>Ue.id===X)){const Ue=ke.mountedWorldbooks.filter(_e=>_e.id!==X),Be={...ke,mountedWorldbooks:Ue};return U.saveCharacter(Be),Be}return ke});m(ae),Z(" ()","success")},k=async X=>{T(ae=>[X,...ae]),await U.saveNovel(X)},H=async(X,ae)=>{T(ke=>{const Me=ke.map(Be=>Be.id===X?{...Be,...ae,lastActiveAt:Date.now()}:Be),Ue=Me.find(Be=>Be.id===X);return Ue&&U.saveNovel(Ue),Me})},E=async X=>{T(ae=>ae.filter(ke=>ke.id!==X)),await U.deleteNovel(X)},ne=async X=>{D(ae=>{const ke={...ae,...X};return U.saveUserProfile(ke),ke})},Ne=async X=>{ve(ae=>ae.find(Me=>Me.id===X.id)?ae.map(Me=>Me.id===X.id?X:Me):[...ae,X]),await U.saveTheme(X)},pe=async X=>{ve(ae=>ae.filter(ke=>ke.id!==X)),await U.deleteTheme(X)},G=async(X,ae)=>{te(ke=>{const Me={...ke};return ae?Me[X]=ae:delete Me[X],Me}),ae?await U.saveAsset(`icon_${X}`,ae):await U.deleteAsset(`icon_${X}`)},Z=(X,ae="info")=>{const ke=Date.now().toString();oe(Me=>[...Me,{id:ke,message:X,type:ae}]),setTimeout(()=>{oe(Me=>Me.filter(Ue=>Ue.id!==ke))},3e3)},Se=async X=>{var ae,ke,Me,Ue;try{xe({status:"processing",message:"...",progress:0});const Be=new bd,_e=Be.folder("assets");let qe=0;const Je=ot=>{if(typeof ot=="string")return ot.startsWith("data:image")?"":ot;if(Array.isArray(ot))return ot.map(Nt=>Je(Nt));if(ot!==null&&typeof ot=="object"){const Nt={};for(const it in ot)Object.prototype.hasOwnProperty.call(ot,it)&&(Nt[it]=Je(ot[it]));return Nt}return ot},et=ot=>{if(ot===null||typeof ot!="object")return ot;if(Array.isArray(ot))return ot.map(it=>et(it));const Nt={};for(const it in ot)if(Object.prototype.hasOwnProperty.call(ot,it)){let _t=ot[it];if(typeof _t=="string"&&_t.startsWith("data:image/"))try{const Lt=_t.match(/data:image\/([a-zA-Z0-9]+);base64,/);if(Lt){const Xn=Lt[1]==="jpeg"?"jpg":Lt[1],Zs=`asset_${Date.now()}_${qe++}.${Xn}`,dn=_t.split(",")[1];_e==null||_e.file(Zs,dn,{base64:!0}),_t=`assets/${Zs}`}}catch(Lt){console.warn("Failed to process asset",Lt)}else _t=et(_t);Nt[it]=_t}return Nt};let Qe=[];X==="text_only"?Qe=["characters","messages","themes","emojis","assets","gallery","user_profile","diaries","tasks","anniversaries","room_todos","room_notes","groups","journal_stickers","social_posts","courses","games","worldbooks","novels"].filter(ot=>ot!=="assets"):X==="media_only"&&(Qe=["gallery","emojis","journal_stickers","user_profile","characters","messages","themes","assets"]);const nt=await U.getAsset("spark_user_bg"),at=await U.getAsset("spark_social_profile"),It=await U.getAsset("room_custom_assets_list"),Xe={timestamp:Date.now(),version:2,apiConfig:X==="text_only"?o:void 0,apiPresets:X==="text_only"?ce:void 0,availableModels:X==="text_only"?q:void 0,realtimeConfig:X==="text_only"?me:void 0,theme:r,socialAppData:X==="text_only"||X==="media_only"?{charHandles:JSON.parse(localStorage.getItem("spark_char_handles")||"{}"),userProfile:at?JSON.parse(at):void 0,userId:localStorage.getItem("spark_user_id")||void 0,userBg:nt||void 0}:void 0,roomCustomAssets:X==="text_only"||X==="media_only"?It?JSON.parse(It):[]:void 0,mediaAssets:[]},cn=Qe.length+3;let gt=0;X!=="text_only"?((ae=Xe.socialAppData)!=null&&ae.userProfile&&(Xe.socialAppData.userProfile=et(Xe.socialAppData.userProfile)),(ke=Xe.socialAppData)!=null&&ke.userBg&&(Xe.socialAppData.userBg=et(Xe.socialAppData.userBg)),Xe.roomCustomAssets&&(Xe.roomCustomAssets=et(Xe.roomCustomAssets)),Xe.theme&&(Xe.theme=et(Xe.theme))):((Me=Xe.socialAppData)!=null&&Me.userProfile&&(Xe.socialAppData.userProfile=Je(Xe.socialAppData.userProfile)),(Ue=Xe.socialAppData)!=null&&Ue.userBg&&(Xe.socialAppData.userBg=Je(Xe.socialAppData.userBg)),Xe.roomCustomAssets&&(Xe.roomCustomAssets=Je(Xe.roomCustomAssets)),Xe.theme&&(Xe.theme=Je(Xe.theme)));for(const ot of Qe){gt++,xe({status:"processing",message:`: ${ot} ...`,progress:gt/cn*100});let Nt=await U.getRawStoreData(ot),it;if(X==="text_only")it=Je(Nt);else{if(ot==="messages"&&X==="media_only"&&(Nt=Nt.filter(_t=>_t.type==="image"||_t.type==="emoji")),ot==="characters"&&X==="media_only"){const _t=Nt.map(Lt=>{var Zs,dn,qn,Qn;const Xn={charId:Lt.id,avatar:Lt.avatar,sprites:Lt.sprites,roomItems:(dn=(Zs=Lt.roomConfig)==null?void 0:Zs.items)==null?void 0:dn.reduce((un,mn)=>(mn.image&&mn.image.startsWith("data:")&&(un[mn.id]=mn.image),un),{}),backgrounds:{chat:Lt.chatBackground,date:Lt.dateBackground,roomWall:(qn=Lt.roomConfig)==null?void 0:qn.wallImage,roomFloor:(Qn=Lt.roomConfig)==null?void 0:Qn.floorImage}};return et(Xn)});Xe.mediaAssets=_t;continue}it=et(Nt)}switch(ot){case"characters":X!=="media_only"&&(Xe.characters=it);break;case"messages":Xe.messages=it;break;case"themes":Xe.customThemes=it;break;case"emojis":Xe.savedEmojis=it;break;case"assets":Xe.assets=it;break;case"gallery":Xe.galleryImages=it;break;case"user_profile":it[0]&&(Xe.userProfile=it[0]);break;case"diaries":Xe.diaries=it;break;case"tasks":Xe.tasks=it;break;case"anniversaries":Xe.anniversaries=it;break;case"room_todos":Xe.roomTodos=it;break;case"room_notes":Xe.roomNotes=it;break;case"groups":Xe.groups=it;break;case"journal_stickers":Xe.savedJournalStickers=it;break;case"social_posts":Xe.socialPosts=it;break;case"courses":Xe.courses=it;break;case"games":Xe.games=it;break;case"worldbooks":Xe.worldbooks=it;break;case"novels":Xe.novels=it;break}await new Promise(_t=>setTimeout(_t,10))}xe({status:"processing",message:"...",progress:95}),Be.file("data.json",JSON.stringify(Xe));const fs=await Be.generateAsync({type:"blob"},ot=>{Math.random()>.8&&xe(Nt=>({...Nt,message:` ${ot.percent.toFixed(0)}%...`}))});return xe({status:"idle",message:"",progress:100}),fs}catch(Be){throw console.error("Export Failed",Be),xe({status:"idle",message:"",progress:0}),new Error(": "+Be.message)}},we=async X=>{try{xe({status:"processing",message:"...",progress:0});let ae,ke=null;if(typeof X=="string")ae=JSON.parse(X);else if(X.name.endsWith(".zip")){const Qe=await bd.loadAsync(X);ke=Qe;const ht=Qe.file("data.json");if(!ht)throw new Error(":  data.json");const nt=await ht.async("string");ae=JSON.parse(nt)}else try{const Qe=await X.text();ae=JSON.parse(Qe)}catch{throw new Error(" .zip  .json")}const Me=async Qe=>{if(Qe===null||typeof Qe!="object")return Qe;if(Array.isArray(Qe)){const nt=[];for(const at of Qe)nt.push(await Me(at));return nt}const ht={};for(const nt in Qe)if(Object.prototype.hasOwnProperty.call(Qe,nt)){let at=Qe[nt];if(typeof at=="string"&&at.startsWith("assets/")&&ke)try{const It=at.split("/")[1],Xe=ke.file(`assets/${It}`);if(Xe){const cn=await Xe.async("base64"),gt=It.split(".").pop()||"png";let fs="image/png";(gt==="jpg"||gt==="jpeg")&&(fs="image/jpeg"),gt==="gif"&&(fs="image/gif"),gt==="webp"&&(fs="image/webp"),at=`data:${fs};base64,${cn}`}}catch{console.warn(`Failed to restore asset: ${at}`)}else at=await Me(at);ht[nt]=at}return ht};if(xe({status:"processing",message:"...",progress:50}),ke&&(ae=await Me(ae)),await U.importFullData(ae),ae.theme){const Qe={...ae.theme};Qe.wallpaper&&Qe.wallpaper.startsWith("data:")&&delete Qe.wallpaper,Qe.launcherWidgetImage&&Qe.launcherWidgetImage.startsWith("data:")&&delete Qe.launcherWidgetImage,Qe.customFont&&Qe.customFont.startsWith("data:")&&delete Qe.customFont,P(Qe)}ae.apiConfig&&Ee(ae.apiConfig),ae.availableModels&&J(ae.availableModels),ae.apiPresets&&W(ae.apiPresets),ae.realtimeConfig&&de(ae.realtimeConfig),ae.socialAppData&&(ae.socialAppData.charHandles&&localStorage.setItem("spark_char_handles",JSON.stringify(ae.socialAppData.charHandles)),ae.socialAppData.userId&&localStorage.setItem("spark_user_id",ae.socialAppData.userId),ae.socialAppData.userProfile&&await U.saveAsset("spark_social_profile",JSON.stringify(ae.socialAppData.userProfile)),ae.socialAppData.userBg&&await U.saveAsset("spark_user_bg",ae.socialAppData.userBg)),ae.roomCustomAssets&&await U.saveAsset("room_custom_assets_list",JSON.stringify(ae.roomCustomAssets));const Ue=await U.getAllCharacters(),Be=await U.getGroups(),_e=await U.getThemes(),qe=await U.getUserProfile(),Je=await U.getAllWorldbooks(),et=await U.getAllNovels();if(ae.assets){const Qe=await U.getAllAssets(),ht={};Array.isArray(Qe)&&Qe.forEach(nt=>{nt.id.startsWith("icon_")&&(ht[nt.id.replace("icon_","")]=nt.data)}),te(ht)}Ue.length>0&&m(Ue),Be.length>0&&w(Be),_e.length>0&&ve(_e),qe&&D(qe),Je.length>0&&v(Je),et.length>0&&T(et),xe({status:"idle",message:"",progress:100}),Z("...","success"),setTimeout(()=>window.location.reload(),1500)}catch(ae){console.error("Import Error:",ae),xe({status:"idle",message:"",progress:0});const ke=ae instanceof SyntaxError?"JSON ":ae.message||"";throw new Error(`: ${ke}`)}},Ce=async()=>{try{await U.deleteDB(),localStorage.clear(),window.location.reload()}catch(X){console.error(X),Z("","error")}},He=X=>n(X),le=()=>n(Ze.Launcher),Oe=()=>i(!1),We=u.useCallback(X=>(N.current=X,()=>{N.current===X&&(N.current=null)}),[]),Ie=u.useCallback(()=>{N.current&&N.current()||s!==Ze.Launcher&&le()},[s,le]),Ve={activeApp:s,openApp:He,closeApp:le,theme:r,updateTheme:P,virtualTime:h,apiConfig:o,updateApiConfig:Ee,isLocked:c,unlock:Oe,isDataLoaded:M,characters:f,activeCharacterId:x,addCharacter:se,updateCharacter:C,deleteCharacter:O,setActiveCharacterId:g,worldbooks:b,addWorldbook:K,updateWorldbook:ie,deleteWorldbook:S,novels:j,addNovel:k,updateNovel:H,deleteNovel:E,groups:A,createGroup:R,deleteGroup:_,userProfile:$,updateUserProfile:ne,availableModels:q,setAvailableModels:re,apiPresets:ce,addApiPreset:be,removeApiPreset:y,realtimeConfig:me,updateRealtimeConfig:de,customThemes:z,addCustomTheme:Ne,removeCustomTheme:pe,toasts:L,addToast:Z,customIcons:F,setCustomIcon:G,lastMsgTimestamp:he,unreadMessages:De,clearUnread:ue,exportSystem:Se,importSystem:we,resetSystem:Ce,sysOperation:je,systemLogs:ge,clearLogs:B,registerBackHandler:We,handleBack:Ie};return e.jsx(hh.Provider,{value:Ve,children:t})},mt=()=>{const t=u.useContext(hh);if(t===void 0)throw new Error("useOS must be used within an OSProvider");return t},Ye=({isOpen:t,title:s,onClose:n,children:r,footer:a})=>t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 animate-fade-in",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative w-full max-w-sm bg-white/90 backdrop-blur-xl rounded-[2.5rem] shadow-2xl border border-white/20 overflow-hidden animate-slide-up",children:[e.jsx("div",{className:"px-6 pt-6 pb-2",children:e.jsx("h3",{className:"text-lg font-bold text-slate-800 text-center",children:s})}),e.jsx("div",{className:"px-6 py-4",children:r}),a?e.jsx("div",{className:"px-6 pb-6 flex gap-3",children:a}):e.jsx("div",{className:"px-6 pb-6",children:e.jsx("button",{onClick:n,className:"w-full py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl active:scale-95 transition-transform",children:""})})]})]}):null,rf=()=>{const{virtualTime:t,theme:s,systemLogs:n,clearLogs:r}=mt(),[a,o]=u.useState(100),[l,c]=u.useState(!1),[i,d]=u.useState(!1),h=m=>m.toString().padStart(2,"0"),p=s.contentColor||"#ffffff";u.useEffect(()=>{(async()=>{const x=navigator;if(x.getBattery)try{const g=await x.getBattery(),A=()=>{o(Math.round(g.level*100)),c(g.charging)};return A(),g.addEventListener("levelchange",A),g.addEventListener("chargingchange",A),()=>{g.removeEventListener("levelchange",A),g.removeEventListener("chargingchange",A)}}catch(g){console.error("Battery API failed",g)}})()},[]);const f=n.length>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex justify-between items-start px-6 text-[11px] font-bold z-50 absolute top-0 left-0 bg-transparent transition-colors duration-500 select-none pointer-events-none",style:{color:p,paddingTop:"max(4px, env(safe-area-inset-top))",height:"auto",minHeight:"2rem"},children:[e.jsx("div",{className:"w-1/3 pl-2 flex items-center gap-2 pointer-events-auto",children:e.jsxs("span",{children:[h(t.hours),":",h(t.minutes)]})}),e.jsx("div",{className:"w-1/3 flex justify-center"}),e.jsxs("div",{className:"w-1/3 flex justify-end gap-1.5 items-center pr-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:e.jsx("path",{fillRule:"evenodd",d:"M1.371 8.143c5.858-5.857 15.356-5.857 21.213 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.06 0c-4.98-4.979-13.053-4.979-18.032 0a.75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182c4.1-4.1 10.749-4.1 14.85 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.062 0 8.25 8.25 0 0 0-11.667 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.204 3.182a6 6 0 0 1 8.486 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0 3.75 3.75 0 0 0-5.304 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182a1.5 1.5 0 0 1 2.122 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0l-.53-.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{children:[a,"%"]}),e.jsxs("div",{className:"w-5 h-2.5 border border-current rounded-[3px] p-[1px] relative opacity-80 flex items-center",children:[e.jsx("div",{className:`h-full rounded-[1px] ${l?"bg-green-400":"bg-current"}`,style:{width:`${a}%`}}),l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3 text-black",children:e.jsx("path",{d:"M11.983 1.907a.75.75 0 0 0-1.292-.657l-8.5 9.5A.75.75 0 0 0 2.75 12h6.572l-1.305 6.093a.75.75 0 0 0 1.292.657l8.5-9.5A.75.75 0 0 0 17.25 8h-6.572l1.305-6.093Z"})})})]})]})]})]}),f&&e.jsxs("button",{onClick:()=>d(!0),className:"fixed left-1/2 -translate-x-1/2 z-[60] bg-red-500/90 text-white rounded-full px-4 py-1.5 text-[10px] font-bold shadow-lg animate-pulse flex items-center gap-1.5 backdrop-blur-md border border-white/20 pointer-events-auto",style:{top:"calc(env(safe-area-inset-top) + 2.5rem)"},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z",clipRule:"evenodd"})}),e.jsx("span",{children:"SYSTEM ERROR"})]}),e.jsx(Ye,{isOpen:i,title:"",onClose:()=>d(!1),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(n,null,2))},className:"flex-1 py-3 bg-slate-100 font-bold rounded-xl text-slate-600",children:" JSON"}),e.jsx("button",{onClick:r,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-xl shadow-lg shadow-red-200",children:""})]}),children:e.jsx("div",{className:"h-64 bg-slate-900 rounded-xl p-3 overflow-y-auto font-mono text-[10px] space-y-2 no-scrollbar shadow-inner",children:n.length===0?e.jsx("div",{className:"text-slate-500 text-center mt-20",children:""}):n.map(m=>e.jsxs("div",{className:"border-b border-white/10 pb-2 mb-2 last:border-0 last:mb-0 last:pb-0",children:[e.jsxs("div",{className:"flex justify-between items-start text-white/50 mb-1",children:[e.jsxs("span",{children:["[",new Date(m.timestamp).toLocaleTimeString(),"]"]}),e.jsx("span",{className:`uppercase font-bold ${m.type==="error"?"text-red-400":"text-orange-400"}`,children:m.type})]}),e.jsx("div",{className:"text-white font-bold mb-1 break-words",children:m.message}),m.detail&&e.jsx("pre",{className:"text-slate-400 whitespace-pre-wrap break-all bg-black/30 p-2 rounded",children:m.detail}),e.jsxs("div",{className:"text-white/30 text-right mt-1",children:["Src: ",m.source]})]},m.id))})})]})},cc={Character:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),User:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})}),Chat:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"})}),GroupChat:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})}),Settings:({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 0 1 0 2.555c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.212 1.281c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-2.555c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),Gallery:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),ThemeMaker:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42"})}),Appearance:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.435-.435 1.133-.435 1.567 0l3.712 3.712c.435.435.435 1.133 0 1.567l-2.88 2.88M10.5 8.197V15.75"})}),Date:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"})}),Journal:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})}),Schedule:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})}),Room:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125-1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),CheckPhone:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"})}),Social:({className:t})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0Z"})]}),Study:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})}),FAQ:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"})}),Game:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"})}),Worldbook:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z"})}),Novel:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})}),Bank:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),Browser:({className:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})})},dc=[{id:Ze.Character,name:"",icon:"Character",color:"indigo"},{id:Ze.Chat,name:"Message",icon:"Chat",color:"green"},{id:Ze.GroupChat,name:"",icon:"GroupChat",color:"violet"},{id:Ze.Room,name:"",icon:"Room",color:"rose"},{id:Ze.CheckPhone,name:"",icon:"CheckPhone",color:"slate"},{id:Ze.Social,name:"Spark",icon:"Social",color:"red"},{id:Ze.User,name:"",icon:"User",color:"blue"},{id:Ze.Bank,name:"",icon:"Bank",color:"lime"},{id:Ze.Schedule,name:"",icon:"Schedule",color:"cyan"},{id:Ze.Journal,name:"",icon:"Journal",color:"amber"},{id:Ze.Date,name:"",icon:"Date",color:"pink"},{id:Ze.Study,name:"",icon:"Study",color:"emerald"},{id:Ze.Game,name:"TRPG",icon:"Game",color:"orange"},{id:Ze.Novel,name:"",icon:"Novel",color:"amber"},{id:Ze.Worldbook,name:"",icon:"Worldbook",color:"indigo"},{id:Ze.FAQ,name:"",icon:"FAQ",color:"indigo"},{id:Ze.Gallery,name:"",icon:"Gallery",color:"orange"},{id:Ze.ThemeMaker,name:"",icon:"ThemeMaker",color:"purple"},{id:Ze.Appearance,name:"",icon:"Appearance",color:"slate"},{id:Ze.Settings,name:"",icon:"Settings",color:"slate"}],Iu=[Ze.Chat,Ze.GroupChat,Ze.Social],xh=Sn.memo(({app:t,onClick:s,size:n="md",hideLabel:r=!1,variant:a="default"})=>{const{customIcons:o,theme:l}=mt(),c=cc[t.icon]||cc.Settings,i=o[t.id],d=l.contentColor||"#ffffff",h=n==="lg"?"w-[4.5rem] h-[4.5rem]":"w-[4rem] h-[4rem]";return e.jsxs("button",{onClick:s,className:"flex flex-col items-center gap-1.5 group relative active:scale-95 transition-transform duration-200",style:{WebkitTapHighlightColor:"transparent"},children:[e.jsxs("div",{className:`${h} relative flex items-center justify-center 
        bg-white/10 backdrop-blur-xl rounded-[1.2rem]
        border-t border-l border-white/40 border-b border-r border-white/10
        shadow-[0_8px_16px_rgba(0,0,0,0.2)]
        transition-all duration-300
        group-hover:bg-white/20 group-hover:shadow-[0_0_20px_rgba(255,255,255,0.3)] group-hover:border-white/60
      `,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-white/10 to-transparent rounded-[1.2rem] opacity-0 group-hover:opacity-100 transition-opacity"}),i?e.jsx("img",{src:i,className:"w-full h-full object-cover rounded-[1.2rem]",alt:t.name,loading:"lazy"}):e.jsx("div",{className:"w-[50%] h-[50%] drop-shadow-[0_2px_5px_rgba(0,0,0,0.3)] opacity-90",style:{color:d},children:e.jsx(c,{className:"w-full h-full"})})]}),!r&&e.jsx("span",{className:`text-[10px] font-bold tracking-widest uppercase opacity-80 text-shadow-md transition-opacity ${a==="dock"?"hidden":"block"}`,style:{color:d},children:t.name})]})},(t,s)=>t.app.id===s.app.id&&t.size===s.size&&t.hideLabel===s.hideLabel&&t.variant===s.variant),af=Sn.memo(()=>{const{virtualTime:t,theme:s}=mt(),n=s.contentColor||"#ffffff",r=["SUN","MON","TUE","WED","THU","FRI","SAT"],a=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],o=new Date,l=r[o.getDay()],c=a[o.getMonth()],i=o.getDate().toString().padStart(2,"0");return e.jsxs("div",{className:"flex flex-col mb-6 mt-6 relative animate-fade-in",style:{color:n},children:[e.jsxs("div",{className:"absolute -top-6 left-1 flex items-center gap-2",children:[e.jsx("div",{className:"bg-white/20 backdrop-blur-md px-2 py-0.5 rounded text-[10px] font-bold tracking-widest uppercase border border-white/10",children:"System Ready"}),e.jsx("div",{className:"h-[1px] w-20 bg-gradient-to-r from-current to-transparent opacity-40"})]}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"text-[6.5rem] leading-[0.85] font-bold tracking-tighter drop-shadow-2xl font-sans",style:{willChange:"contents"},children:[t.hours.toString().padStart(2,"0"),e.jsx("span",{className:"opacity-40 font-light mx-1",children:":"}),t.minutes.toString().padStart(2,"0")]}),e.jsxs("div",{className:"flex flex-col justify-end pb-3 opacity-90",children:[e.jsx("div",{className:"text-3xl font-bold tracking-tight",children:l}),e.jsxs("div",{className:"text-sm font-medium opacity-80 tracking-widest",children:[c," . ",i]})]})]})]})}),of=Sn.memo(({char:t,unreadCount:s,lastMessage:n,onClick:r,contentColor:a})=>e.jsx("div",{className:"mb-4 group animate-fade-in",children:e.jsxs("div",{className:"relative h-28 w-full overflow-hidden rounded-[1.5rem] bg-white/10 backdrop-blur-xl border border-white/20 shadow-2xl transition-all duration-300 active:scale-[0.98] cursor-pointer",onClick:r,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-full bg-gradient-to-l from-white/5 to-transparent skew-x-12 pointer-events-none"}),e.jsxs("div",{className:"absolute inset-0 flex items-center p-4 gap-4",children:[e.jsxs("div",{className:"w-20 h-20 shrink-0 rounded-2xl overflow-hidden shadow-lg border-2 border-white/20 relative bg-slate-800",children:[t?e.jsx("img",{src:t.avatar,className:"w-full h-full object-cover",alt:"char",loading:"lazy"}):e.jsx("div",{className:"w-full h-full bg-white/10 animate-pulse"}),s>0?e.jsx("div",{className:"absolute bottom-1 right-1 w-4 h-4 bg-red-500 rounded-full border-2 border-white shadow-sm flex items-center justify-center text-[8px] font-bold text-white",children:s}):e.jsx("div",{className:"absolute bottom-1 right-1 w-3 h-3 bg-green-400 rounded-full border-2 border-black/20 shadow-sm"})]}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-bold tracking-wide drop-shadow-md truncate",style:{color:a},children:(t==null?void 0:t.name)||"NO SIGNAL"}),e.jsx("div",{className:"px-1.5 py-0.5 bg-white/20 rounded text-[9px] font-bold uppercase tracking-wider",style:{color:a},children:s>0?"NEW MESSAGE":"Active"})]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"text-xs line-clamp-2 font-medium leading-relaxed opacity-90",style:{color:a},children:[e.jsx("span",{className:"opacity-40 mr-1 text-[10px]",children:""}),n]})})]})]})]})})),Mu=Sn.memo(({apps:t,openApp:s})=>e.jsx("div",{className:"grid grid-cols-4 gap-y-6 gap-x-2 place-items-center animate-fade-in relative",children:t.map(n=>e.jsx("div",{className:"relative transition-transform duration-200 active:scale-95",children:e.jsx(xh,{app:n,onClick:()=>s(n.id)})},n.id))})),lf=Sn.memo(({contentColor:t,openApp:s,anniversaries:n,characters:r})=>{const a=new Date,o=a.getFullYear(),l=a.getMonth(),c=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][l],i=(x,g)=>new Date(x,g+1,0).getDate(),d=(x,g)=>new Date(x,g,1).getDay(),h=i(o,l),p=d(o,l),f=Array.from({length:h},(x,g)=>g+1),m=Array.from({length:p},()=>null);return e.jsxs("div",{className:"w-full flex-shrink-0 snap-center snap-always flex flex-col px-6 pt-24 pb-8 space-y-6 h-full overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-2xl rounded-3xl p-6 border border-white/20 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",style:{color:t},children:[e.jsxs("h3",{className:"text-xl font-bold tracking-widest",children:[c," ",o]}),e.jsx("div",{onClick:()=>s("schedule"),className:"bg-white/20 p-2 rounded-full cursor-pointer hover:bg-white/40 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-y-3 gap-x-1 text-center mb-2",children:["S","M","T","W","T","F","S"].map(x=>e.jsx("div",{className:"text-[10px] font-bold opacity-40",style:{color:t},children:x},x))}),e.jsxs("div",{className:"grid grid-cols-7 gap-y-2 gap-x-1 text-center",children:[m.map((x,g)=>e.jsx("div",{},`pad-${g}`)),f.map(x=>{const g=`${o}-${String(l+1).padStart(2,"0")}-${String(x).padStart(2,"0")}`,A=x===a.getDate(),w=n.some(b=>b.date===g);return e.jsxs("div",{className:"flex flex-col items-center justify-center h-8 relative",children:[e.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-full text-sm font-medium ${A?"bg-white text-black font-bold shadow-lg":"opacity-80"}`,style:A?{}:{color:t},children:x}),w&&e.jsx("div",{className:"w-1.5 h-1.5 bg-purple-400 rounded-full absolute bottom-0 shadow-sm border border-black/20"})]},x)})]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-2xl rounded-3xl p-5 border border-white/20 shadow-2xl flex-1 min-h-[200px]",children:[e.jsxs("h3",{className:"text-xs font-bold opacity-60 uppercase tracking-widest mb-4 flex items-center gap-2",style:{color:t},children:[e.jsx("span",{className:"w-2 h-2 bg-purple-400 rounded-full"})," Upcoming Events"]}),e.jsx("div",{className:"space-y-3",children:n.length>0?n.sort((x,g)=>x.date.localeCompare(g.date)).slice(0,5).map(x=>{var g;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/10",children:[e.jsxs("div",{className:"w-10 h-10 bg-purple-500/20 rounded-lg flex flex-col items-center justify-center text-purple-200 border border-purple-500/30",children:[e.jsx("span",{className:"text-[9px] opacity-70",children:x.date.split("-")[1]}),e.jsx("span",{className:"text-sm font-bold leading-none",children:x.date.split("-")[2]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-bold",style:{color:t},children:x.title}),e.jsx("div",{className:"text-[10px] opacity-50",style:{color:t},children:((g=r.find(A=>A.id===x.charId))==null?void 0:g.name)||"Unknown"})]})]},x.id)}):e.jsx("div",{className:"text-center opacity-30 text-xs py-8",style:{color:t},children:"No upcoming events"})})]})]})}),cf=()=>{const{openApp:t,characters:s,activeCharacterId:n,theme:r,lastMsgTimestamp:a,isDataLoaded:o,unreadMessages:l}=mt(),[c,i]=u.useState(null),[d,h]=u.useState(""),[p,f]=u.useState([]),[m,x]=u.useState(0),g=u.useRef(null),A=u.useRef(!1),w=u.useRef(0),b=u.useRef(0),v=u.useRef(0),j=u.useMemo(()=>dc.filter(F=>!Iu.includes(F.id)),[]),T=u.useMemo(()=>Iu.map(F=>dc.find(te=>te.id===F)).filter(Boolean),[]),$=8,D=u.useMemo(()=>{const F=[];for(let te=0;te<j.length;te+=$)F.push(j.slice(te,te+$));return F.length===0&&F.push([]),F},[j]),M=D.length+1;u.useEffect(()=>{o&&(async()=>{if(!s||s.length===0){i(null),h("No Character Connected"),f([]);return}const te=s.find(L=>L.id===n)||s[0];i(te);try{const[L,oe]=await Promise.all([U.getMessagesByCharId(te.id),U.getAllAnniversaries()]);if(L.length>0){const he=L.filter(Te=>Te.role!=="system");if(he.length>0){const Te=he[he.length-1],De=Te.content.replace(/\[.*?\]/g,"").trim();h(De||(Te.type==="image"?"[]":"[]"))}else h(te.description||"System Ready.")}else h(te.description||"System Ready.");f(oe)}catch(L){console.error(L)}})()},[n,a,o,s]);const Q=()=>{if(g.current){const F=g.current.clientWidth,te=g.current.scrollLeft,L=Math.round(te/F);x(L)}},q=F=>{g.current&&(A.current=!0,v.current=0,w.current=F.pageX-g.current.offsetLeft,b.current=g.current.scrollLeft,g.current.style.scrollBehavior="auto",g.current.style.scrollSnapType="none",g.current.style.cursor="grabbing")},re=F=>{if(!A.current||!g.current)return;F.preventDefault();const te=F.pageX-g.current.offsetLeft,L=te-w.current;g.current.scrollLeft=b.current-L,v.current=Math.abs(te-(w.current+g.current.offsetLeft))},ce=()=>{!A.current||!g.current||(A.current=!1,g.current.style.scrollBehavior="smooth",g.current.style.scrollSnapType="x mandatory",g.current.style.cursor="grab")},fe=()=>{A.current&&ce()},me=F=>{v.current>5&&(F.stopPropagation(),F.preventDefault())},ee=r.contentColor||"#ffffff",z=Object.values(l).reduce((F,te)=>F+te,0),ve=c&&l[c.id]?l[c.id]:0;return e.jsxs("div",{className:"h-full w-full flex flex-col relative z-10 overflow-hidden font-sans select-none",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",style:{willChange:"transform"},children:[e.jsx("div",{className:"absolute -top-20 -right-20 w-80 h-80 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-20 -left-20 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl"})]}),e.jsxs("div",{ref:g,onScroll:Q,onMouseDown:q,onMouseMove:re,onMouseUp:ce,onMouseLeave:fe,onClickCapture:me,className:"flex-1 flex overflow-x-auto snap-x snap-mandatory no-scrollbar cursor-grab active:cursor-grabbing",style:{scrollBehavior:"smooth",overscrollBehaviorX:"contain"},children:[D.map((F,te)=>e.jsx("div",{className:"w-full flex-shrink-0 snap-center snap-always flex flex-col px-6 pt-12 pb-8 h-full",children:te===0?e.jsxs(e.Fragment,{children:[e.jsx(af,{}),e.jsx(of,{char:c,unreadCount:ve,lastMessage:d,onClick:()=>t(Ze.Chat),contentColor:ee}),e.jsx("div",{className:"flex-1",children:e.jsx(Mu,{apps:F,openApp:t})})]}):e.jsxs("div",{className:"pt-12 flex-1 flex flex-col",children:[te===1&&r.launcherWidgetImage?e.jsxs("div",{className:"w-full h-48 mb-8 rounded-[1.5rem] overflow-hidden shadow-lg border border-white/20 relative group",children:[e.jsx("img",{src:r.launcherWidgetImage,className:"w-full h-full object-cover",alt:"Custom Widget"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"})]}):e.jsx("div",{className:"h-20"}),e.jsx(Mu,{apps:F,openApp:t}),e.jsx("div",{className:"flex-1"})]})},te)),e.jsx(lf,{contentColor:ee,openApp:t,anniversaries:p,characters:s})]}),e.jsx("div",{className:"absolute bottom-24 left-0 w-full flex justify-center gap-2 pointer-events-none z-20",children:Array.from({length:M}).map((F,te)=>e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${m===te?"w-4 opacity-100":"w-1.5 opacity-40"}`,style:{backgroundColor:ee}},te))}),e.jsx("div",{className:"mt-auto flex justify-center w-full px-4 mb-2 pb-[env(safe-area-inset-bottom)] relative z-30",children:e.jsx("div",{className:"bg-white/20 backdrop-blur-2xl rounded-3xl border border-white/20 shadow-[0_10px_30px_rgba(0,0,0,0.2)] px-4 py-3 flex gap-3 sm:gap-6 items-center mx-auto max-w-full justify-between overflow-x-auto no-scrollbar transform-gpu",children:T.map(F=>e.jsxs("div",{className:"relative",children:[e.jsx(xh,{app:F,onClick:()=>t(F.id),variant:"dock",size:"md"}),F.id==="chat"&&z>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-[9px] flex items-center justify-center border-2 border-white/20 shadow-sm font-bold pointer-events-none animate-bounce",children:z>9?"9+":z})]},F.id))})})]})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const df=t=>{const s=new Map;s.set("web",{name:"web"});const n=t.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:s},r=(o,l)=>{n.platforms.set(o,l)},a=o=>{n.platforms.has(o)&&(n.currentPlatform=n.platforms.get(o))};return n.addPlatform=r,n.setPlatform=a,n},uf=t=>t.CapacitorPlatforms=df(t),ph=uf(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});ph.addPlatform;ph.setPlatform;var Yr;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(Yr||(Yr={}));class Ql extends Error{constructor(s,n,r){super(s),this.message=s,this.code=n,this.data=r}}const mf=t=>{var s,n;return t!=null&&t.androidBridge?"android":!((n=(s=t==null?void 0:t.webkit)===null||s===void 0?void 0:s.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},hf=t=>{var s,n,r,a,o;const l=t.CapacitorCustomPlatform||null,c=t.Capacitor||{},i=c.Plugins=c.Plugins||{},d=t.CapacitorPlatforms,h=()=>l!==null?l.name:mf(t),p=((s=d==null?void 0:d.currentPlatform)===null||s===void 0?void 0:s.getPlatform)||h,f=()=>p()!=="web",m=((n=d==null?void 0:d.currentPlatform)===null||n===void 0?void 0:n.isNativePlatform)||f,x=D=>{const M=j.get(D);return!!(M!=null&&M.platforms.has(p())||w(D))},g=((r=d==null?void 0:d.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||x,A=D=>{var M;return(M=c.PluginHeaders)===null||M===void 0?void 0:M.find(Q=>Q.name===D)},w=((a=d==null?void 0:d.currentPlatform)===null||a===void 0?void 0:a.getPluginHeader)||A,b=D=>t.console.error(D),v=(D,M,Q)=>Promise.reject(`${Q} does not have an implementation of "${M}".`),j=new Map,T=(D,M={})=>{const Q=j.get(D);if(Q)return console.warn(`Capacitor plugin "${D}" already registered. Cannot register plugins twice.`),Q.proxy;const q=p(),re=w(D);let ce;const fe=async()=>(!ce&&q in M?ce=typeof M[q]=="function"?ce=await M[q]():ce=M[q]:l!==null&&!ce&&"web"in M&&(ce=typeof M.web=="function"?ce=await M.web():ce=M.web),ce),me=(L,oe)=>{var he,Te;if(re){const De=re==null?void 0:re.methods.find($e=>oe===$e.name);if(De)return De.rtype==="promise"?$e=>c.nativePromise(D,oe.toString(),$e):($e,ge)=>c.nativeCallback(D,oe.toString(),$e,ge);if(L)return(he=L[oe])===null||he===void 0?void 0:he.bind(L)}else{if(L)return(Te=L[oe])===null||Te===void 0?void 0:Te.bind(L);throw new Ql(`"${D}" plugin is not implemented on ${q}`,Yr.Unimplemented)}},ee=L=>{let oe;const he=(...Te)=>{const De=fe().then($e=>{const ge=me($e,L);if(ge){const I=ge(...Te);return oe=I==null?void 0:I.remove,I}else throw new Ql(`"${D}.${L}()" is not implemented on ${q}`,Yr.Unimplemented)});return L==="addListener"&&(De.remove=async()=>oe()),De};return he.toString=()=>`${L.toString()}() { [capacitor code] }`,Object.defineProperty(he,"name",{value:L,writable:!1,configurable:!1}),he},z=ee("addListener"),ve=ee("removeListener"),F=(L,oe)=>{const he=z({eventName:L},oe),Te=async()=>{const $e=await he;ve({eventName:L,callbackId:$e},oe)},De=new Promise($e=>he.then(()=>$e({remove:Te})));return De.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Te()},De},te=new Proxy({},{get(L,oe){switch(oe){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return re?F:z;case"removeListener":return ve;default:return ee(oe)}}});return i[D]=te,j.set(D,{name:D,proxy:te,platforms:new Set([...Object.keys(M),...re?[q]:[]])}),te},$=((o=d==null?void 0:d.currentPlatform)===null||o===void 0?void 0:o.registerPlugin)||T;return c.convertFileSrc||(c.convertFileSrc=D=>D),c.getPlatform=p,c.handleError=b,c.isNativePlatform=m,c.isPluginAvailable=g,c.pluginMethodNoop=v,c.registerPlugin=$,c.Exception=Ql,c.DEBUG=!!c.DEBUG,c.isLoggingEnabled=!!c.isLoggingEnabled,c.platform=c.getPlatform(),c.isNative=c.isNativePlatform(),c},xf=t=>t.Capacitor=hf(t),Ys=xf(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),fr=Ys.registerPlugin;Ys.Plugins;class fh{constructor(s){this.listeners={},this.retainedEventArguments={},this.windowListeners={},s&&(console.warn(`Capacitor WebPlugin "${s.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=s)}addListener(s,n){let r=!1;this.listeners[s]||(this.listeners[s]=[],r=!0),this.listeners[s].push(n);const o=this.windowListeners[s];o&&!o.registered&&this.addWindowListener(o),r&&this.sendRetainedArgumentsForEvent(s);const l=async()=>this.removeListener(s,n);return Promise.resolve({remove:l})}async removeAllListeners(){this.listeners={};for(const s in this.windowListeners)this.removeWindowListener(this.windowListeners[s]);this.windowListeners={}}notifyListeners(s,n,r){const a=this.listeners[s];if(!a){if(r){let o=this.retainedEventArguments[s];o||(o=[]),o.push(n),this.retainedEventArguments[s]=o}return}a.forEach(o=>o(n))}hasListeners(s){return!!this.listeners[s].length}registerWindowListener(s,n){this.windowListeners[n]={registered:!1,windowEventName:s,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(s="not implemented"){return new Ys.Exception(s,Yr.Unimplemented)}unavailable(s="not available"){return new Ys.Exception(s,Yr.Unavailable)}async removeListener(s,n){const r=this.listeners[s];if(!r)return;const a=r.indexOf(n);this.listeners[s].splice(a,1),this.listeners[s].length||this.removeWindowListener(this.windowListeners[s])}addWindowListener(s){window.addEventListener(s.windowEventName,s.handler),s.registered=!0}removeWindowListener(s){s&&(window.removeEventListener(s.windowEventName,s.handler),s.registered=!1)}sendRetainedArgumentsForEvent(s){const n=this.retainedEventArguments[s];n&&(delete this.retainedEventArguments[s],n.forEach(r=>{this.notifyListeners(s,r)}))}}const _u=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Tu=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class pf extends fh{async getCookies(){const s=document.cookie,n={};return s.split(";").forEach(r=>{if(r.length<=0)return;let[a,o]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=Tu(a).trim(),o=Tu(o).trim(),n[a]=o}),n}async setCookie(s){try{const n=_u(s.key),r=_u(s.value),a=`; expires=${(s.expires||"").replace("expires=","")}`,o=(s.path||"/").replace("path=",""),l=s.url!=null&&s.url.length>0?`domain=${s.url}`:"";document.cookie=`${n}=${r||""}${a}; path=${o}; ${l};`}catch(n){return Promise.reject(n)}}async deleteCookie(s){try{document.cookie=`${s.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const s=document.cookie.split(";")||[];for(const n of s)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(s){return Promise.reject(s)}}async clearAllCookies(){try{await this.clearCookies()}catch(s){return Promise.reject(s)}}}fr("CapacitorCookies",{web:()=>new pf});const ff=async t=>new Promise((s,n)=>{const r=new FileReader;r.onload=()=>{const a=r.result;s(a.indexOf(",")>=0?a.split(",")[1]:a)},r.onerror=a=>n(a),r.readAsDataURL(t)}),gf=(t={})=>{const s=Object.keys(t);return Object.keys(t).map(a=>a.toLocaleLowerCase()).reduce((a,o,l)=>(a[o]=t[s[l]],a),{})},bf=(t,s=!0)=>t?Object.entries(t).reduce((r,a)=>{const[o,l]=a;let c,i;return Array.isArray(l)?(i="",l.forEach(d=>{c=s?encodeURIComponent(d):d,i+=`${o}=${c}&`}),i.slice(0,-1)):(c=s?encodeURIComponent(l):l,i=`${o}=${c}`),`${r}&${i}`},"").substr(1):null,wf=(t,s={})=>{const n=Object.assign({method:t.method||"GET",headers:t.headers},s),a=gf(t.headers)["content-type"]||"";if(typeof t.data=="string")n.body=t.data;else if(a.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[l,c]of Object.entries(t.data||{}))o.set(l,c);n.body=o.toString()}else if(a.includes("multipart/form-data")||t.data instanceof FormData){const o=new FormData;if(t.data instanceof FormData)t.data.forEach((c,i)=>{o.append(i,c)});else for(const c of Object.keys(t.data))o.append(c,t.data[c]);n.body=o;const l=new Headers(n.headers);l.delete("content-type"),n.headers=l}else(a.includes("application/json")||typeof t.data=="object")&&(n.body=JSON.stringify(t.data));return n};class vf extends fh{async request(s){const n=wf(s,s.webFetchExtra),r=bf(s.params,s.shouldEncodeUrlParams),a=r?`${s.url}?${r}`:s.url,o=await fetch(a,n),l=o.headers.get("content-type")||"";let{responseType:c="text"}=o.ok?s:{};l.includes("application/json")&&(c="json");let i,d;switch(c){case"arraybuffer":case"blob":d=await o.blob(),i=await ff(d);break;case"json":i=await o.json();break;case"document":case"text":default:i=await o.text()}const h={};return o.headers.forEach((p,f)=>{h[f]=p}),{data:i,headers:h,status:o.status,url:o.url}}async get(s){return this.request(Object.assign(Object.assign({},s),{method:"GET"}))}async post(s){return this.request(Object.assign(Object.assign({},s),{method:"POST"}))}async put(s){return this.request(Object.assign(Object.assign({},s),{method:"PUT"}))}async patch(s){return this.request(Object.assign(Object.assign({},s),{method:"PATCH"}))}async delete(s){return this.request(Object.assign(Object.assign({},s),{method:"DELETE"}))}}fr("CapacitorHttp",{web:()=>new vf});const yf="modulepreload",jf=function(t,s){return new URL(t,s).href},Du={},gl=function(s,n,r){let a=Promise.resolve();if(n&&n.length>0){const l=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),i=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));a=Promise.allSettled(n.map(d=>{if(d=jf(d,r),d in Du)return;Du[d]=!0;const h=d.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(!!r)for(let x=l.length-1;x>=0;x--){const g=l[x];if(g.href===d&&(!h||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${p}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":yf,h||(m.as="script"),m.crossOrigin="",m.href=d,i&&m.setAttribute("nonce",i),document.head.appendChild(m),h)return new Promise((x,g)=>{m.addEventListener("load",x),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return a.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return s().catch(o)})};var Rn;(function(t){t.Documents="DOCUMENTS",t.Data="DATA",t.Library="LIBRARY",t.Cache="CACHE",t.External="EXTERNAL",t.ExternalStorage="EXTERNAL_STORAGE"})(Rn||(Rn={}));var Qo;(function(t){t.UTF8="utf8",t.ASCII="ascii",t.UTF16="utf16"})(Qo||(Qo={}));const Tr=fr("Filesystem",{web:()=>gl(()=>import("./web-DMWsKjYG.js"),[],import.meta.url).then(t=>new t.FilesystemWeb)}),uc=fr("Share",{web:()=>gl(()=>import("./web-CvTQ3ck7.js"),[],import.meta.url).then(t=>new t.ShareWeb)}),ei={weatherEnabled:!1,weatherApiKey:"",weatherCity:"Beijing",newsEnabled:!1,newsApiKey:"",notionEnabled:!1,notionApiKey:"",notionDatabaseId:"",cacheMinutes:30};let la={data:null,timestamp:0},wr={data:[],timestamp:0};const Lu={"01-01":"","02-14":"","03-08":"","03-12":"","04-01":"","05-01":"","05-04":"","06-01":"","09-10":"","10-01":"","10-31":"","11-11":"","12-24":"","12-25":""},Hs={fetchWeather:async t=>{var r,a;if(!t.weatherEnabled||!t.weatherApiKey)return null;const s=Date.now(),n=t.cacheMinutes*60*1e3;if(la.data&&s-la.timestamp<n)return la.data;try{const o=`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(t.weatherCity)}&appid=${t.weatherApiKey}&units=metric&lang=zh_cn`,l=await fetch(o);if(!l.ok)return console.error("Weather API error:",l.status),null;const c=await l.json(),i={temp:Math.round(c.main.temp),feelsLike:Math.round(c.main.feels_like),humidity:c.main.humidity,description:((r=c.weather[0])==null?void 0:r.description)||"",icon:((a=c.weather[0])==null?void 0:a.icon)||"01d",city:c.name};return la={data:i,timestamp:s},i}catch(o){return console.error("Failed to fetch weather:",o),null}},fetchBraveNews:async t=>{try{const n=await fetch("https://sully-n.qegj567.workers.dev/news?q=&count=5&country=cn",{headers:{Accept:"application/json","X-Brave-API-Key":t}});if(!n.ok){const a=await n.text();return console.error("Brave API error:",n.status,a),[]}const r=await n.json();return r.results&&r.results.length>0?r.results.slice(0,5).map(a=>{var o;return{title:a.title,source:((o=a.meta_url)==null?void 0:o.netloc)||a.source||"Brave",url:a.url}}):[]}catch(s){return console.error("Brave Search failed:",s),[]}},fetchNews:async t=>{if(!t.newsEnabled)return[];const s=Date.now(),n=t.cacheMinutes*60*1e3;if(wr.data.length>0&&s-wr.timestamp<n)return wr.data;let r=[];return t.newsApiKey&&(r=await Hs.fetchBraveNews(t.newsApiKey),r.length>0)?(wr={data:r,timestamp:s},r):(r=await Hs.fetchBackupNews(),r.length>0&&(wr={data:r,timestamp:s}),r)},fetchBackupNews:async()=>{try{const t=await fetch("https://hacker-news.firebaseio.com/v0/topstories.json");if(!t.ok)return[];const n=(await t.json()).slice(0,5);return(await Promise.all(n.map(async a=>(await fetch(`https://hacker-news.firebaseio.com/v0/item/${a}.json`)).json()))).map(a=>({title:a.title,source:"Hacker News",url:a.url}))}catch{return[]}},getTimeContext:()=>{const t=new Date,s=t.getHours(),r=["","","","","","",""][t.getDay()];let a="",o="";return s>=5&&s<9?(a="",o=""):s>=9&&s<12?(a="",o=""):s>=12&&s<14?(a="",o=""):s>=14&&s<17?(a="",o=""):s>=17&&s<19?(a="",o=""):s>=19&&s<22?(a="",o=""):(s>=22||s<5)&&(a="",o=""),{timestamp:t.toISOString(),dateStr:`${t.getFullYear()}${t.getMonth()+1}${t.getDate()}`,timeStr:`${s.toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`,dayOfWeek:r,timeOfDay:a,mood:o,hour:s,isWeekend:t.getDay()===0||t.getDay()===6}},checkSpecialDates:()=>{const t=new Date,s=`${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`,n=[];return Lu[s]&&n.push(Lu[s]),n},generateWeatherAdvice:t=>{const s=[];t.temp<5?s.push(""):t.temp<15?s.push(""):t.temp>30?s.push(""):t.temp>25&&s.push("");const n=t.description.toLowerCase();return n.includes("")?s.push(""):n.includes("")?s.push(""):n.includes("")||n.includes("")?s.push(""):n.includes("")&&s.push(""),t.humidity>80?s.push(""):t.humidity<30&&s.push(""),s.join("")||""},buildFullContext:async t=>{const s=[];s.push("### "),s.push(' ""'),s.push("");const n=Hs.getTimeContext();s.push(` : ${n.dateStr} ${n.dayOfWeek} ${n.timeOfDay} ${n.timeStr}`);const r=Hs.checkSpecialDates();if(r.length>0&&s.push(` : ${r.join("")}`),t.weatherEnabled&&t.weatherApiKey){const a=await Hs.fetchWeather(t);a&&(s.push(""),s.push(` ${a.city}`),s.push(`: ${a.description} ${a.temp}C ${a.feelsLike}C ${a.humidity}%`),s.push(`: ${Hs.generateWeatherAdvice(a)}`))}if(t.newsEnabled){const a=await Hs.fetchNews(t);a.length>0&&(s.push(""),s.push(" /"),s.push(""),a.forEach((o,l)=>{const c=o.source?` [${o.source}]`:"";s.push(`${l+1}. ${o.title}${c}`)}))}return s.push(""),s.push("### "),s.push('1. "xxx"'),s.push('2. ""'),s.push('3. "xxx..."'),s.push('4. ""/'),s.push("5. "),s.join(`
`)},clearCache:()=>{la={data:null,timestamp:0},wr={data:[],timestamp:0}},performSearch:async(t,s)=>{var n;if(!t||!s)return{success:!1,results:[],message:"API Key"};try{const r=`https://sully-n.qegj567.workers.dev/search?q=${encodeURIComponent(t)}&count=5`,a=await fetch(r,{method:"GET",headers:{Accept:"application/json","X-Brave-API-Key":s}}),o=await a.text();if(!a.ok){console.error("Search API error:",a.status,o);try{const c=JSON.parse(o);return{success:!1,results:[],message:`: ${c.error||a.status}`}}catch{return{success:!1,results:[],message:`: ${a.status}`}}}let l;try{l=JSON.parse(o)}catch{return console.error("Search response not JSON:",o.slice(0,200)),{success:!1,results:[],message:""}}return(n=l.web)!=null&&n.results&&l.web.results.length>0?{success:!0,results:l.web.results.slice(0,5).map(i=>({title:i.title,description:i.description||"",url:i.url})),message:""}:{success:!1,results:[],message:""}}catch(r){return console.error("Search failed:",r),{success:!1,results:[],message:`: ${r.message}`}}}},an={WORKER_URL:"https://sully-n.qegj567.workers.dev",testConnection:async(t,s)=>{var n,r;try{const a=await fetch(`${an.WORKER_URL}/notion/database/${s}`,{method:"GET",headers:{"X-Notion-API-Key":t}}),o=await a.text();if(!a.ok)try{const l=JSON.parse(o);return{success:!1,message:`: ${l.error||l.message||a.status}`}}catch{return{success:!1,message:`: ${a.status}`}}try{return{success:!0,message:`: ${((r=(n=JSON.parse(o).title)==null?void 0:n[0])==null?void 0:r.plain_text)||s}`}}catch{return{success:!1,message:""}}}catch(a){return{success:!1,message:`: ${a.message}`}}},createDiaryPage:async(t,s,n)=>{try{const r=new Date,a=n.date||r.toISOString().split("T")[0],o=kf(n.content,n.mood,n.characterName),l=n.characterName?`[${n.characterName}] `:"",c=Ba(n.mood||""),i={parent:{database_id:s},icon:{emoji:c},properties:{Name:{title:[{text:{content:`${l}${n.title||a+" "}`}}]},Date:{date:{start:a}}},children:o},d=await fetch(`${an.WORKER_URL}/notion/pages`,{method:"POST",headers:{"Content-Type":"application/json","X-Notion-API-Key":t},body:JSON.stringify(i)}),h=await d.text();if(!d.ok)try{const p=JSON.parse(h);return{success:!1,message:`: ${p.error||p.message||d.status}`}}catch{return{success:!1,message:`: ${d.status}`}}try{const p=JSON.parse(h);return{success:!0,pageId:p.id,url:p.url,message:"Notion!"}}catch{return{success:!1,message:""}}}catch(r){return{success:!1,message:`: ${r.message}`}}},getRecentDiaries:async(t,s,n,r=5)=>{try{const a=await fetch(`${an.WORKER_URL}/notion/query`,{method:"POST",headers:{"Content-Type":"application/json","X-Notion-API-Key":t},body:JSON.stringify({database_id:s,filter:{property:"Name",title:{starts_with:`[${n}]`}},sorts:[{property:"Date",direction:"descending"}],page_size:r})}),o=await a.text();if(!a.ok)return console.error("Query diaries failed:",a.status,o),{success:!1,entries:[],message:`: ${a.status}`};const l=JSON.parse(o);return!l.results||l.results.length===0?{success:!0,entries:[],message:""}:{success:!0,entries:l.results.map(i=>{var p,f,m,x,g,A,w;const h=(((x=(m=(f=(p=i.properties)==null?void 0:p.Name)==null?void 0:f.title)==null?void 0:m[0])==null?void 0:x.plain_text)||"").replace(/^\[.*?\]\s*/,"");return{id:i.id,title:h,date:((w=(A=(g=i.properties)==null?void 0:g.Date)==null?void 0:A.date)==null?void 0:w.start)||"",url:i.url}}),message:""}}catch(a){return console.error("Get diaries failed:",a),{success:!1,entries:[],message:`: ${a.message}`}}},getDiaryByDate:async(t,s,n,r)=>{try{const a=await fetch(`${an.WORKER_URL}/notion/query`,{method:"POST",headers:{"Content-Type":"application/json","X-Notion-API-Key":t},body:JSON.stringify({database_id:s,filter:{and:[{property:"Name",title:{starts_with:`[${n}]`}},{property:"Date",date:{equals:r}}]},sorts:[{property:"Date",direction:"descending"}],page_size:10})}),o=await a.text();if(!a.ok)return console.error("Query diary by date failed:",a.status,o),{success:!1,entries:[],message:`: ${a.status}`};const l=JSON.parse(o);if(!l.results||l.results.length===0)return{success:!0,entries:[],message:` ${r} `};const c=l.results.map(i=>{var p,f,m,x,g,A,w;const h=(((x=(m=(f=(p=i.properties)==null?void 0:p.Name)==null?void 0:f.title)==null?void 0:m[0])==null?void 0:x.plain_text)||"").replace(/^\[.*?\]\s*/,"");return{id:i.id,title:h,date:((w=(A=(g=i.properties)==null?void 0:g.Date)==null?void 0:A.date)==null?void 0:w.start)||"",url:i.url}});return{success:!0,entries:c,message:` ${c.length} `}}catch(a){return console.error("Get diary by date failed:",a),{success:!1,entries:[],message:`: ${a.message}`}}},readDiaryContent:async(t,s)=>{try{const n=await fetch(`${an.WORKER_URL}/notion/blocks/${s}`,{method:"GET",headers:{"X-Notion-API-Key":t}}),r=await n.text();if(!n.ok)return console.error("Read diary content failed:",n.status,r),{success:!1,content:"",message:`: ${n.status}`};const a=JSON.parse(r);return!a.results||a.results.length===0?{success:!0,content:"",message:""}:{success:!0,content:Sf(a.results),message:""}}catch(n){return console.error("Read diary content failed:",n),{success:!1,content:"",message:`: ${n.message}`}}}};function Ba(t){return{happy:"",sad:"",angry:"",excited:"",tired:"",calm:"",anxious:"",love:"",nostalgic:"",curious:"",grateful:"",confused:"",proud:"",lonely:"",hopeful:"",playful:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""}[t.toLowerCase()]||""}function Nf(t){return{happy:{primary:"yellow_background",secondary:"orange",accent:"yellow"},sad:{primary:"blue_background",secondary:"blue",accent:"purple"},angry:{primary:"red_background",secondary:"red",accent:"orange"},excited:{primary:"pink_background",secondary:"pink",accent:"red"},tired:{primary:"gray_background",secondary:"gray",accent:"brown"},calm:{primary:"blue_background",secondary:"blue",accent:"green"},anxious:{primary:"purple_background",secondary:"purple",accent:"gray"},love:{primary:"pink_background",secondary:"pink",accent:"red"},:{primary:"yellow_background",secondary:"orange",accent:"yellow"},:{primary:"blue_background",secondary:"blue",accent:"purple"},:{primary:"red_background",secondary:"red",accent:"orange"},:{primary:"pink_background",secondary:"orange",accent:"red"},:{primary:"gray_background",secondary:"gray",accent:"brown"},:{primary:"blue_background",secondary:"blue",accent:"green"},:{primary:"purple_background",secondary:"purple",accent:"gray"},:{primary:"pink_background",secondary:"pink",accent:"red"},:{primary:"yellow_background",secondary:"orange",accent:"brown"},:{primary:"pink_background",secondary:"pink",accent:"blue"},:{primary:"pink_background",secondary:"pink",accent:"red"},:{primary:"purple_background",secondary:"purple",accent:"blue"},:{primary:"yellow_background",secondary:"pink",accent:"orange"},:{primary:"pink_background",secondary:"red",accent:"pink"},:{primary:"gray_background",secondary:"blue",accent:"purple"},:{primary:"green_background",secondary:"green",accent:"blue"}}[t.toLowerCase()]||{primary:"blue_background",secondary:"blue",accent:"gray"}}function gh(t){return{happy:["","","","","","",""],sad:["","","","","",""],angry:["","","","",""],excited:["","","","","","",""],love:["","","","","","",""],calm:["","","","","",""],tired:["","","","",""],:["","","","","","",""],:["","","","","",""],:["","","","","","",""],:["","","","","","",""],:["","","","","",""],:["","","","",""],:["","","","",""],:["","","","",""]}[t.toLowerCase()]||["","","",""]}function vr(t){return t[Math.floor(Math.random()*t.length)]}function tr(t){const s=[],n=/(\*\*(.+?)\*\*|\*(.+?)\*|~~(.+?)~~|`(.+?)`)/g;let r=0,a;for(;(a=n.exec(t))!==null;)a.index>r&&s.push({type:"text",text:{content:t.slice(r,a.index)}}),a[2]?s.push({type:"text",text:{content:a[2]},annotations:{bold:!0}}):a[3]?s.push({type:"text",text:{content:a[3]},annotations:{italic:!0}}):a[4]?s.push({type:"text",text:{content:a[4]},annotations:{strikethrough:!0}}):a[5]&&s.push({type:"text",text:{content:a[5]},annotations:{code:!0}}),r=a.index+a[0].length;return r<t.length&&s.push({type:"text",text:{content:t.slice(r)}}),s.length===0&&s.push({type:"text",text:{content:t}}),s}function kf(t,s,n){const r=[],a=t.split(`
`),o=Nf(s||""),l=gh(s||""),i=new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});s&&r.push({object:"block",type:"callout",callout:{rich_text:[{type:"text",text:{content:`${vr(l)} : ${s} ${vr(l)}`},annotations:{bold:!0}}],icon:{emoji:Ba(s)},color:o.primary}}),r.push({object:"block",type:"quote",quote:{rich_text:[{type:"text",text:{content:" "},annotations:{color:"gray"}},{type:"text",text:{content:` ${i}`},annotations:{italic:!0,color:"gray"}}],color:"gray"}}),r.push({object:"block",type:"divider",divider:{}});let d=0;const h=["default",o.secondary,"default",o.accent,"default"];for(let p=0;p<a.length;p++){const m=a[p].trim();if(!m)continue;if(/^[-*]{3,}$/.test(m)){r.push({object:"block",type:"divider",divider:{}}),d++;continue}if(m.startsWith("# ")){const g=m.slice(2);r.push({object:"block",type:"heading_2",heading_2:{rich_text:[{type:"text",text:{content:`${vr(l)} `}},{type:"text",text:{content:g},annotations:{bold:!0,color:o.secondary}}],color:o.primary}});continue}if(m.startsWith("## ")){const g=m.slice(3);r.push({object:"block",type:"heading_3",heading_3:{rich_text:tr(g),color:o.accent}});continue}if(m.startsWith("### ")){const g=m.slice(4),A=[o.primary,"green_background","purple_background","orange_background","pink_background"];r.push({object:"block",type:"callout",callout:{rich_text:tr(g),icon:{emoji:vr(l)},color:A[d%A.length]}});continue}if(m.startsWith("> ")){const g=m.slice(2);r.push({object:"block",type:"quote",quote:{rich_text:tr(g),color:o.secondary}});continue}if(/^[-*]\s/.test(m)){const g=m.slice(2);r.push({object:"block",type:"bulleted_list_item",bulleted_list_item:{rich_text:tr(g),color:h[d%h.length]}});continue}if(/^\d+\.\s/.test(m)){const g=m.replace(/^\d+\.\s/,"");r.push({object:"block",type:"numbered_list_item",numbered_list_item:{rich_text:tr(g)}});continue}if(m.startsWith("[!")&&m.includes("]")){const g=m.match(/^\[!(.+?)\]\s*(.*)/);if(g){const A=g[1],w=g[2]||"",b={warning:"orange_background",danger:"red_background",info:"blue_background",success:"green_background",note:"purple_background",tip:"green_background",heart:"pink_background",star:"yellow_background",:"red_background",:"purple_background",:"pink_background",:"orange_background",:"yellow_background",:"blue_background"},v={warning:"",danger:"",info:"",success:"",note:"",tip:"",heart:"",star:"",:"",:"",:"",:"",:"",:""};r.push({object:"block",type:"callout",callout:{rich_text:tr(w),icon:{emoji:v[A]||""},color:b[A]||o.primary}});continue}}const x=d%3===0?"default":h[d%h.length];r.push({object:"block",type:"paragraph",paragraph:{rich_text:tr(m),color:x}})}return r.push({object:"block",type:"divider",divider:{}}),n&&r.push({object:"block",type:"paragraph",paragraph:{rich_text:[{type:"text",text:{content:`${vr(l)} `}},{type:"text",text:{content:` ${n}`},annotations:{italic:!0,color:"gray"}},{type:"text",text:{content:` ${vr(l)}`}}]}}),r}function Sf(t){var n,r,a,o;const s=[];for(const l of t){const c=l.type;if(c==="divider"){s.push("---");continue}const i=(n=l[c])==null?void 0:n.rich_text;if(!i)continue;const d=i.map(h=>{var p;return h.plain_text||((p=h.text)==null?void 0:p.content)||""}).join("");if(d.trim())switch(c){case"heading_1":s.push(`# ${d}`);break;case"heading_2":s.push(`## ${d}`);break;case"heading_3":s.push(`### ${d}`);break;case"quote":s.push(`> ${d}`);break;case"callout":const h=((a=(r=l.callout)==null?void 0:r.icon)==null?void 0:a.emoji)||"";s.push(`${h} ${d}`);break;case"bulleted_list_item":s.push(`- ${d}`);break;case"numbered_list_item":s.push(` ${d}`);break;case"to_do":const p=(o=l.to_do)!=null&&o.checked?"":"";s.push(`${p} ${d}`);break;case"toggle":s.push(` ${d}`);break;case"code":s.push(`\`\`\`
${d}
\`\`\``);break;default:s.push(d)}}return s.join(`
`)}let mo=null;function Cf(t,s,n){const r=Ba(s||""),a=gh(s||""),l=new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),c=h=>h[Math.floor(Math.random()*h.length)],i=[];s&&(i.push(`${c(a)}  ${c(a)}`),i.push(`${r}  : ${s}  ${r}`),i.push(`${c(a)}  ${c(a)}`),i.push("")),i.push(`  ${l}`),i.push(""),i.push("            "),i.push("");const d=t.split(`
`);for(const h of d){const p=h.trim();if(!p){i.push("");continue}if(p.startsWith("# ")){i.push(""),i.push(`${c(a)} ${p.slice(2)}${c(a)}`),i.push("");continue}if(p.startsWith("## ")){i.push(""),i.push(` ${p.slice(3)}`),i.push("");continue}if(p.startsWith("### ")){i.push(`   ${p.slice(4)}`);continue}if(p.startsWith("> ")){i.push(`   ${p.slice(2)} `);continue}if(/^[-*]{3,}$/.test(p)){i.push(""),i.push(`  ${c(a)}          ${c(a)}`),i.push("");continue}if(/^[-*]\s/.test(p)){i.push(`  ${c(a)} ${p.slice(2)}`);continue}if(/^\d+\.\s/.test(p)){i.push(`  ${p}`);continue}const f=p.match(/^\[!(.+?)\]\s*(.*)/);if(f){const m=f[1],x=f[2]||"",A={heart:"",star:"",warning:"",danger:"",info:"",success:"",note:"",tip:"",:"",:"",:"",:"",:"",:""}[m]||"";i.push(`   ${A} ${x}`);continue}i.push(p)}return i.push(""),i.push("            "),n&&i.push(`${c(a)}  ${n} ${c(a)}`),i.join(`
`)}const qt={WORKER_URL:"https://sully-n.qegj567.workers.dev",getToken:async(t,s)=>{if(mo&&mo.expiresAt>Date.now()+5*60*1e3)return{success:!0,token:mo.token,message:"token"};try{const n=await fetch(`${qt.WORKER_URL}/feishu/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app_id:t,app_secret:s})}),r=await n.text();if(!n.ok)try{const c=JSON.parse(r);return{success:!1,token:"",message:`token: ${c.msg||c.error||n.status}`}}catch{return{success:!1,token:"",message:`token: ${n.status}`}}const a=JSON.parse(r);if(a.code!==0)return{success:!1,token:"",message:`: ${a.msg||""}`};const o=a.tenant_access_token,l=(a.expire||7200)*1e3;return mo={token:o,expiresAt:Date.now()+l},{success:!0,token:o,message:"Token"}}catch(n){return{success:!1,token:"",message:`: ${n.message}`}}},testConnection:async(t,s,n,r)=>{var a;try{const o=await qt.getToken(t,s);if(!o.success)return{success:!1,message:o.message};const l=await fetch(`${qt.WORKER_URL}/feishu/bitable/${n}/tables`,{method:"GET",headers:{"X-Feishu-Token":o.token}}),c=await l.text();if(!l.ok)try{const p=JSON.parse(c);return{success:!1,message:`: ${p.msg||p.error||l.status}`}}catch{return{success:!1,message:`: ${l.status}`}}const i=JSON.parse(c);if(i.code!==0)return{success:!1,message:`: ${i.msg||""}`};const d=((a=i.data)==null?void 0:a.items)||[],h=d.find(p=>p.table_id===r);if(h)return{success:!0,message:`! : ${h.name}`};{const p=d.map(f=>`${f.name}(${f.table_id})`).join(", ");return{success:!1,message:` ${r}: ${p||""}`}}}catch(o){return{success:!1,message:`: ${o.message}`}}},createDiaryRecord:async(t,s,n,r,a)=>{var o,l;try{const c=await qt.getToken(t,s);if(!c.success)return{success:!1,message:c.message};const i=new Date,d=a.date||i.toISOString().split("T")[0],h=new Date(d).getTime(),p=a.characterName?`[${a.characterName}] `:"",f=Cf(a.content||"",a.mood,a.characterName),m={:`${Ba(a.mood||"")} ${p}${a.title||d+" "}`,:f,:h,:`${Ba(a.mood||"")} ${a.mood||""}`,:a.characterName||""},x=await fetch(`${qt.WORKER_URL}/feishu/bitable/${n}/${r}/records`,{method:"POST",headers:{"Content-Type":"application/json","X-Feishu-Token":c.token},body:JSON.stringify({fields:m})}),g=await x.text();if(!x.ok)try{const w=JSON.parse(g);return{success:!1,message:`: ${w.msg||w.error||x.status}`}}catch{return{success:!1,message:`: ${x.status}`}}const A=JSON.parse(g);return A.code!==0?{success:!1,message:`: ${A.msg||""}`}:{success:!0,recordId:(l=(o=A.data)==null?void 0:o.record)==null?void 0:l.record_id,message:"!"}}catch(c){return{success:!1,message:`: ${c.message}`}}},getRecentDiaries:async(t,s,n,r,a,o=5)=>{var l;try{const c=await qt.getToken(t,s);if(!c.success)return{success:!1,entries:[],message:c.message};const i=await fetch(`${qt.WORKER_URL}/feishu/bitable/${n}/${r}/records/search`,{method:"POST",headers:{"Content-Type":"application/json","X-Feishu-Token":c.token},body:JSON.stringify({filter:{conjunction:"and",conditions:[{field_name:"",operator:"is",value:[a]}]},sort:[{field_name:"",desc:!0}],page_size:o})}),d=await i.text();if(!i.ok)return{success:!1,entries:[],message:`: ${i.status}`};const h=JSON.parse(d);if(h.code!==0)return{success:!1,entries:[],message:`: ${h.msg||""}`};const p=((l=h.data)==null?void 0:l.items)||[];return p.length===0?{success:!0,entries:[],message:""}:{success:!0,entries:p.map(m=>{var v,j,T,$;const x=m.fields||{},g=(Array.isArray(x.)?(j=(v=x.)==null?void 0:v[0])==null?void 0:j.text:x.)||"",A=String(g).replace(/^\[.*?\]\s*/,""),w=x.,b=w?new Date(w).toISOString().split("T")[0]:"";return{recordId:m.record_id,title:A,date:b,content:(Array.isArray(x.)?($=(T=x.)==null?void 0:T[0])==null?void 0:$.text:x.)||""}}),message:""}}catch(c){return{success:!1,entries:[],message:`: ${c.message}`}}},getDiaryByDate:async(t,s,n,r,a,o)=>{var l;try{const c=await qt.getToken(t,s);if(!c.success)return{success:!1,entries:[],message:c.message};const i=new Date(o).getTime(),d=i+24*60*60*1e3,h=await fetch(`${qt.WORKER_URL}/feishu/bitable/${n}/${r}/records/search`,{method:"POST",headers:{"Content-Type":"application/json","X-Feishu-Token":c.token},body:JSON.stringify({filter:{conjunction:"and",conditions:[{field_name:"",operator:"is",value:[a]},{field_name:"",operator:"isGreater",value:[i-1]},{field_name:"",operator:"isLess",value:[d]}]},sort:[{field_name:"",desc:!0}],page_size:10})}),p=await h.text();if(!h.ok)return{success:!1,entries:[],message:`: ${h.status}`};const f=JSON.parse(p);if(f.code!==0)return{success:!1,entries:[],message:`: ${f.msg||""}`};const m=((l=f.data)==null?void 0:l.items)||[];if(m.length===0)return{success:!0,entries:[],message:` ${o} `};const x=m.map(g=>{var v,j,T,$;const A=g.fields||{},w=(Array.isArray(A.)?(j=(v=A.)==null?void 0:v[0])==null?void 0:j.text:A.)||"",b=String(w).replace(/^\[.*?\]\s*/,"");return{recordId:g.record_id,title:b,date:o,content:(Array.isArray(A.)?($=(T=A.)==null?void 0:T[0])==null?void 0:$.text:A.)||""}});return{success:!0,entries:x,message:` ${x.length} `}}catch(c){return{success:!1,entries:[],message:`: ${c.message}`}}},readDiaryContent:async(t,s,n,r,a)=>{var o,l,c,i;try{const d=await qt.getToken(t,s);if(!d.success)return{success:!1,content:"",message:d.message};const h=await fetch(`${qt.WORKER_URL}/feishu/bitable/${n}/${r}/records/${a}`,{method:"GET",headers:{"X-Feishu-Token":d.token}}),p=await h.text();if(!h.ok)return{success:!1,content:"",message:`: ${h.status}`};const f=JSON.parse(p);if(f.code!==0)return{success:!1,content:"",message:`: ${f.msg||""}`};const m=((l=(o=f.data)==null?void 0:o.record)==null?void 0:l.fields)||{},x=(Array.isArray(m.)?(i=(c=m.)==null?void 0:c[0])==null?void 0:i.text:m.)||"";return{success:!0,content:String(x),message:""}}catch(d){return{success:!1,content:"",message:`: ${d.message}`}}}},$f=()=>{const{apiConfig:t,updateApiConfig:s,closeApp:n,availableModels:r,setAvailableModels:a,exportSystem:o,importSystem:l,addToast:c,resetSystem:i,apiPresets:d,addApiPreset:h,removeApiPreset:p,sysOperation:f,realtimeConfig:m,updateRealtimeConfig:x}=mt(),[g,A]=u.useState(t.apiKey),[w,b]=u.useState(t.baseUrl),[v,j]=u.useState(t.model),[T,$]=u.useState(!1),[D,M]=u.useState(""),[Q,q]=u.useState(!1),[re,ce]=u.useState(!1),[fe,me]=u.useState(!1),[ee,z]=u.useState(!1),[ve,F]=u.useState(!1),[te,L]=u.useState(m.weatherEnabled),[oe,he]=u.useState(m.weatherApiKey),[Te,De]=u.useState(m.weatherCity),[$e,ge]=u.useState(m.newsEnabled),[I,je]=u.useState(m.newsApiKey||""),[xe,Ae]=u.useState(m.notionEnabled),[Le,N]=u.useState(m.notionApiKey),[Y,B]=u.useState(m.notionDatabaseId),[ue,P]=u.useState(m.feishuEnabled),[Ee,de]=u.useState(m.feishuAppId),[J,be]=u.useState(m.feishuAppSecret),[y,W]=u.useState(m.feishuBaseId),[se,C]=u.useState(m.feishuTableId),[O,R]=u.useState(""),[_,K]=u.useState(""),[ie,S]=u.useState(""),k=u.useRef(null);u.useEffect(()=>{b(t.baseUrl),A(t.apiKey),j(t.model)},[t]);const H=le=>{b(le.config.baseUrl),A(le.config.apiKey),j(le.config.model),c(`: ${le.name}`,"info")},E=()=>{if(!D.trim()){c("","error");return}h(D,{baseUrl:w,apiKey:g,model:v}),M(""),z(!1),c("","success")},ne=()=>{s({apiKey:g,baseUrl:w,model:v}),S(""),setTimeout(()=>S(""),2e3)},Ne=async()=>{if(!w){S(" URL");return}$(!0),S("...");try{const le=w.replace(/\/+$/,""),Oe=await fetch(`${le}/models`,{method:"GET",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"}});if(!Oe.ok)throw new Error(`Status ${Oe.status}`);const We=await Oe.json(),Ie=We.data||We.models||[];if(Array.isArray(Ie)){const Ve=Ie.map(X=>X.id||X);a(Ve),Ve.length>0&&!Ve.includes(v)&&j(Ve[0]),S(` ${Ve.length} `),q(!0)}else S("")}catch(le){console.error(le),S("")}finally{$(!1)}},pe=async le=>{try{const Oe=await o(le);if(Ys.isNativePlatform()){const We=new FileReader;We.readAsDataURL(Oe),We.onloadend=async()=>{const Ie=String(We.result),Ve=`Sully_Backup_${le}_${Date.now()}.zip`;try{await Tr.writeFile({path:Ve,data:Ie,directory:Rn.Cache});const X=await Tr.getUri({directory:Rn.Cache,path:Ve});await uc.share({title:"Sully Backup",files:[X.uri]})}catch(X){console.error("Native write failed",X),c("","error")}}}else{const We=URL.createObjectURL(Oe);K(We),ce(!0);const Ie=document.createElement("a");Ie.href=We,Ie.download=`Sully_Backup_${le}_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(Ie),Ie.click(),document.body.removeChild(Ie)}}catch(Oe){c(Oe.message,"error")}},G=le=>{var We;const Oe=(We=le.target.files)==null?void 0:We[0];Oe&&(l(Oe).catch(Ie=>{console.error(Ie),c(Ie.message||"","error")}),k.current&&(k.current.value=""))},Z=()=>{i(),me(!1)},Se=()=>{x({weatherEnabled:te,weatherApiKey:oe,weatherCity:Te,newsEnabled:$e,newsApiKey:I,notionEnabled:xe,notionApiKey:Le,notionDatabaseId:Y,feishuEnabled:ue,feishuAppId:Ee,feishuAppSecret:J,feishuBaseId:y,feishuTableId:se}),c("","success"),F(!1)},we=async()=>{var le;if(!oe){R(" API Key");return}R("...");try{const Oe=`https://api.openweathermap.org/data/2.5/weather?q=${Te}&appid=${oe}&units=metric&lang=zh_cn`,We=await fetch(Oe);if(We.ok){const Ie=await We.json();R(`${Ie.name}: ${(le=Ie.weather[0])==null?void 0:le.description}, ${Math.round(Ie.main.temp)}C`)}else R(`: HTTP ${We.status}`)}catch(Oe){R(`: ${Oe.message}`)}},Ce=async()=>{if(!Le||!Y){R(" Notion API Key  Database ID");return}R(" Notion ...");try{const le=await an.testConnection(Le,Y);R(le.message)}catch(le){R(`: ${le.message}`)}},He=async()=>{if(!Ee||!J||!y||!se){R(" App IDApp Secret ID  ID");return}R("...");try{const le=await qt.testConnection(Ee,J,y,se);R(le.message)}catch(le){R(`: ${le.message}`)}};return e.jsxs("div",{className:"h-full w-full bg-slate-50/50 flex flex-col font-light relative",children:[f.status==="processing"&&e.jsx("div",{className:"absolute inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center animate-fade-in",children:e.jsxs("div",{className:"bg-white p-6 rounded-3xl shadow-2xl flex flex-col items-center gap-4 w-64",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-slate-200 border-t-primary rounded-full animate-spin"}),e.jsx("div",{className:"text-sm font-bold text-slate-700",children:f.message}),f.progress>0&&e.jsx("div",{className:"w-full h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${f.progress}%`}})})]})}),e.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("button",{onClick:n,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 no-scrollbar pb-20",children:[e.jsxs("section",{className:"bg-white/60 backdrop-blur-sm rounded-3xl p-5 shadow-sm border border-white/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-xl text-blue-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"})})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-600 tracking-wider",children:" (ZIP)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("button",{onClick:()=>pe("text_only"),className:"py-4 bg-white border border-slate-200 rounded-xl text-xs font-bold text-slate-600 shadow-sm active:scale-95 transition-all flex flex-col items-center gap-2 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 px-1.5 py-0.5 bg-blue-100 text-[9px] text-blue-600 rounded-bl-lg font-bold",children:""}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-full text-blue-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}),e.jsx("span",{children:""})]}),e.jsxs("button",{onClick:()=>pe("media_only"),className:"py-4 bg-white border border-slate-200 rounded-xl text-xs font-bold text-slate-600 shadow-sm active:scale-95 transition-all flex flex-col items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-pink-50 rounded-full text-pink-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})})}),e.jsx("span",{children:""})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mb-4",children:[e.jsxs("div",{onClick:()=>{var le;return(le=k.current)==null?void 0:le.click()},className:"py-4 bg-white border border-slate-200 rounded-xl text-xs font-bold text-slate-600 shadow-sm active:scale-95 transition-all flex flex-col items-center gap-2 cursor-pointer hover:bg-emerald-50 hover:border-emerald-200",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-full text-emerald-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}),e.jsx("span",{children:" (.zip / .json)"})]}),e.jsx("input",{type:"file",ref:k,className:"hidden",accept:".json,.zip",onChange:G})]}),e.jsxs("p",{className:"text-[10px] text-slate-400 px-1 mb-4 leading-relaxed",children:[" ",e.jsx("b",{children:""}),": ",e.jsx("br",{})," ",e.jsx("b",{children:""}),": ",e.jsx("br",{}),"  JSON "]}),e.jsx("button",{onClick:()=>me(!0),className:"w-full py-3 bg-red-50 border border-red-100 text-red-500 rounded-xl text-xs font-bold flex items-center justify-center gap-2",children:" ()"})]}),e.jsxs("section",{className:"bg-white/60 backdrop-blur-sm rounded-3xl p-5 shadow-sm border border-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-emerald-100/50 rounded-xl text-emerald-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-600 tracking-wider",children:"API "})]}),e.jsx("button",{onClick:()=>z(!0),className:"text-[10px] bg-slate-100 text-slate-600 px-3 py-1.5 rounded-full font-bold shadow-sm active:scale-95 transition-transform",children:""})]}),d.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block pl-1",children:" (Presets)"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:d.map(le=>e.jsxs("div",{className:"flex items-center bg-white border border-slate-200 rounded-lg pl-3 pr-1 py-1 shadow-sm",children:[e.jsx("span",{onClick:()=>H(le),className:"text-xs font-medium text-slate-600 cursor-pointer hover:text-primary mr-2",children:le.name}),e.jsx("button",{onClick:()=>p(le.id),className:"p-1 rounded-full text-slate-300 hover:bg-red-50 hover:text-red-400 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})})})]},le.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block pl-1",children:"URL"}),e.jsx("input",{type:"text",value:w,onChange:le=>b(le.target.value),placeholder:"https://...",className:"w-full bg-white/50 border border-slate-200/60 rounded-xl px-4 py-2.5 text-sm font-mono focus:bg-white transition-all"})]}),e.jsxs("div",{className:"group",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block pl-1",children:"Key"}),e.jsx("input",{type:"password",value:g,onChange:le=>A(le.target.value),placeholder:"sk-...",className:"w-full bg-white/50 border border-slate-200/60 rounded-xl px-4 py-2.5 text-sm font-mono focus:bg-white transition-all"})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5 pl-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Model"}),e.jsx("button",{onClick:Ne,disabled:T,className:"text-[10px] text-primary font-bold",children:T?"Fetching...":""})]}),e.jsxs("button",{onClick:()=>q(!0),className:"w-full bg-white/50 border border-slate-200/60 rounded-xl px-4 py-3 text-sm text-slate-700 flex justify-between items-center active:bg-white transition-all shadow-sm",children:[e.jsx("span",{className:"truncate font-mono",children:v||"Select Model..."}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4 text-slate-400",children:e.jsx("path",{fillRule:"evenodd",d:"M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})})]})]}),e.jsx("button",{onClick:ne,className:"w-full py-3 rounded-2xl font-bold text-white shadow-lg shadow-primary/20 bg-primary active:scale-95 transition-all mt-2",children:ie||""})]})]}),e.jsxs("section",{className:"bg-white/60 backdrop-blur-sm rounded-3xl p-5 shadow-sm border border-white/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-violet-100/50 rounded-xl text-violet-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"})})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-600 tracking-wider",children:""})]}),e.jsx("button",{onClick:()=>F(!0),className:"text-[10px] bg-violet-100 text-violet-600 px-3 py-1.5 rounded-full font-bold shadow-sm active:scale-95 transition-transform",children:""})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-3 leading-relaxed",children:"AI"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center",children:[e.jsxs("div",{className:`py-3 rounded-xl text-xs font-bold ${te?"bg-emerald-50 text-emerald-600":"bg-slate-50 text-slate-400"}`,children:[e.jsx("div",{className:"text-lg mb-1",children:te?"":""}),""]}),e.jsxs("div",{className:`py-3 rounded-xl text-xs font-bold ${$e?"bg-blue-50 text-blue-600":"bg-slate-50 text-slate-400"}`,children:[e.jsx("div",{className:"text-lg mb-1",children:$e?"":""}),""]}),e.jsxs("div",{className:`py-3 rounded-xl text-xs font-bold ${xe?"bg-orange-50 text-orange-600":"bg-slate-50 text-slate-400"}`,children:[e.jsx("div",{className:"text-lg mb-1",children:xe?"":""}),"Notion"]}),e.jsxs("div",{className:`py-3 rounded-xl text-xs font-bold ${ue?"bg-indigo-50 text-indigo-600":"bg-slate-50 text-slate-400"}`,children:[e.jsx("div",{className:"text-lg mb-1",children:ue?"":""}),""]})]})]}),e.jsx("div",{className:"text-center text-[10px] text-slate-300 pb-8 font-mono tracking-widest uppercase",children:"v2.2 (Realtime Awareness)"})]}),e.jsx(Ye,{isOpen:Q,title:"",onClose:()=>q(!1),children:e.jsx("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-2 p-1",children:r.length>0?r.map(le=>e.jsxs("button",{onClick:()=>{j(le),q(!1)},className:`w-full text-left px-4 py-3 rounded-xl text-sm font-mono flex justify-between items-center ${le===v?"bg-primary/10 text-primary font-bold ring-1 ring-primary/20":"bg-slate-50 text-slate-600 hover:bg-slate-100"}`,children:[e.jsx("span",{className:"truncate",children:le}),le===v&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"})]},le)):e.jsx("div",{className:"text-center text-slate-400 py-8 text-xs",children:""})})}),e.jsx(Ye,{isOpen:ee,title:"",onClose:()=>z(!1),footer:e.jsx("button",{onClick:E,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:" (: DeepSeek)"}),e.jsx("input",{value:D,onChange:le=>M(le.target.value),className:"w-full bg-slate-100 rounded-xl px-4 py-3 text-sm focus:outline-primary",autoFocus:!0,placeholder:"Name..."})]})}),e.jsx(Ye,{isOpen:re,title:"",onClose:()=>ce(!1),footer:e.jsx("div",{className:"flex gap-2 w-full",children:e.jsx("button",{onClick:()=>ce(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""})}),children:e.jsxs("div",{className:"space-y-4 text-center py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-8 h-8",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),e.jsx("p",{className:"text-sm font-bold text-slate-700",children:""}),e.jsx("p",{className:"text-xs text-slate-500",children:""}),_&&e.jsx("a",{href:_,download:"Sully_Backup.zip",className:"text-primary text-sm underline block py-2",children:" .zip"})]})}),e.jsx(Ye,{isOpen:ve,title:"",onClose:()=>F(!1),footer:e.jsx("button",{onClick:Se,className:"w-full py-3 bg-violet-500 text-white font-bold rounded-2xl shadow-lg",children:""}),children:e.jsxs("div",{className:"space-y-5 max-h-[60vh] overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"bg-emerald-50/50 p-4 rounded-2xl space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsx("span",{className:"text-sm font-bold text-emerald-700",children:""})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:te,onChange:le=>L(le.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"})]})]}),te&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:"OpenWeatherMap API Key"}),e.jsx("input",{type:"password",value:oe,onChange:le=>he(le.target.value),className:"w-full bg-white/80 border border-emerald-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:": openweathermap.org"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" ()"}),e.jsx("input",{type:"text",value:Te,onChange:le=>De(le.target.value),className:"w-full bg-white/80 border border-emerald-200 rounded-xl px-3 py-2 text-sm",placeholder:"Beijing, Shanghai, etc."})]}),e.jsx("button",{onClick:we,className:"w-full py-2 bg-emerald-100 text-emerald-600 text-xs font-bold rounded-xl active:scale-95 transition-transform",children:"API"})]})]}),e.jsxs("div",{className:"bg-blue-50/50 p-4 rounded-2xl space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsx("span",{className:"text-sm font-bold text-blue-700",children:""})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:$e,onChange:le=>ge(le.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"})]})]}),$e&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-blue-600/70",children:" Hacker News Brave API "}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:"Brave Search API Key ()"}),e.jsx("input",{type:"password",value:I,onChange:le=>je(le.target.value),className:"w-full bg-white/80 border border-blue-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:": brave.com/search/api"})]}),e.jsxs("p",{className:"text-[10px] text-blue-500/70",children:["2000/",e.jsx("br",{})," Hacker News"]})]})]}),e.jsxs("div",{className:"bg-orange-50/50 p-4 rounded-2xl space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsx("span",{className:"text-sm font-bold text-orange-700",children:"Notion "})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:xe,onChange:le=>Ae(le.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500"})]})]}),xe&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:"Notion Integration Token"}),e.jsx("input",{type:"password",value:Le,onChange:le=>N(le.target.value),className:"w-full bg-white/80 border border-orange-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:"secret_..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:"Database ID"}),e.jsx("input",{type:"text",value:Y,onChange:le=>B(le.target.value),className:"w-full bg-white/80 border border-orange-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:"URL"})]}),e.jsx("button",{onClick:Ce,className:"w-full py-2 bg-orange-100 text-orange-600 text-xs font-bold rounded-xl active:scale-95 transition-transform",children:"Notion"}),e.jsxs("p",{className:"text-[10px] text-orange-500/70 leading-relaxed",children:["1.  ",e.jsx("a",{href:"https://www.notion.so/my-integrations",target:"_blank",className:"underline",children:"Notion"})," Integration",e.jsx("br",{}),'2. "Name"()"Date"()',e.jsx("br",{}),"3.  Connect  Integration"]})]})]}),e.jsxs("div",{className:"bg-indigo-50/50 p-4 rounded-2xl space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsx("span",{className:"text-sm font-bold text-indigo-700",children:""}),e.jsx("span",{className:"text-[9px] bg-indigo-100 text-indigo-500 px-1.5 py-0.5 rounded-full",children:""})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ue,onChange:le=>P(le.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-500"})]})]}),e.jsx("p",{className:"text-[10px] text-indigo-500/70 leading-relaxed",children:"Notion "}),ue&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" App ID"}),e.jsx("input",{type:"text",value:Ee,onChange:le=>de(le.target.value),className:"w-full bg-white/80 border border-indigo-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:"cli_xxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" App Secret"}),e.jsx("input",{type:"password",value:J,onChange:le=>be(le.target.value),className:"w-full bg-white/80 border border-indigo-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:"xxxxxxxxxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" App Token"}),e.jsx("input",{type:"text",value:y,onChange:le=>W(le.target.value),className:"w-full bg-white/80 border border-indigo-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:"URL"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" Table ID"}),e.jsx("input",{type:"text",value:se,onChange:le=>C(le.target.value),className:"w-full bg-white/80 border border-indigo-200 rounded-xl px-3 py-2 text-sm font-mono",placeholder:"tblxxxxxxxx"})]}),e.jsx("button",{onClick:He,className:"w-full py-2 bg-indigo-100 text-indigo-600 text-xs font-bold rounded-xl active:scale-95 transition-transform",children:""}),e.jsxs("p",{className:"text-[10px] text-indigo-500/70 leading-relaxed",children:["1.  ",e.jsx("a",{href:"https://open.feishu.cn/app",target:"_blank",className:"underline",children:""}),"  App ID  Secret",e.jsx("br",{}),"2. ",e.jsx("br",{}),"3. : ()()()()()",e.jsx("br",{}),"4.  URL  App Token  Table ID"]})]})]}),O&&e.jsx("div",{className:`p-3 rounded-xl text-xs font-medium text-center ${O.includes("")?"bg-emerald-100 text-emerald-700":O.includes("")||O.includes("")?"bg-red-100 text-red-600":"bg-slate-100 text-slate-600"}`,children:O})]})}),e.jsx(Ye,{isOpen:fe,title:"",onClose:()=>me(!1),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>me(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),e.jsx("button",{onClick:Z,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:e.jsxs("div",{className:"flex flex-col items-center gap-3 py-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 text-red-500",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})}),e.jsxs("p",{className:"text-center text-sm text-slate-600 font-medium",children:["",e.jsx("span",{className:"text-red-500 font-bold",children:""}),""]})]})})]})},Ut=(t,s)=>new Promise((n,r)=>{if(!t.type.startsWith("image/")){r(new Error(""));return}if(s!=null&&s.skipCompression){const o=new FileReader;o.readAsDataURL(t),o.onload=l=>{var c;return n((c=l.target)==null?void 0:c.result)},o.onerror=l=>r(new Error(""));return}if(t.type==="image/gif"){if(t.size>50*1024*1024){r(new Error("GIF (>50MB)"));return}const o=new FileReader;o.readAsDataURL(t),o.onload=l=>{var c;return n((c=l.target)==null?void 0:c.result)},o.onerror=l=>r(l);return}const a=new FileReader;a.readAsDataURL(t),a.onload=o=>{var c;const l=new Image;l.src=(c=o.target)==null?void 0:c.result,l.onload=()=>{const i=(s==null?void 0:s.maxWidth)||1200,d=i;let h=l.width,p=l.height;h>p?h>i&&(p*=i/h,h=i):p>d&&(h*=d/p,p=d);const f=document.createElement("canvas");f.width=h,f.height=p;const m=f.getContext("2d");if(!m){r(new Error("Canvas context error"));return}m.clearRect(0,0,h,p),m.drawImage(l,0,0,h,p);let x="image/jpeg";!(s!=null&&s.forceJpeg)&&(t.type==="image/png"||t.type==="image/webp")&&(x=t.type);const g=(s==null?void 0:s.quality)||.85,A=f.toDataURL(x,g);n(A)},l.onerror=i=>r(new Error(""))},a.onerror=o=>r(new Error(""))}),At={buildCoreContext:(t,s,n=!0)=>{let r=`[System: Roleplay Configuration]

`;if(r+=`###  (Character)
`,r+=`- : ${t.name}
`,r+=`- / (User Note/Nickname): ${t.description||""}
`,r+=`  (: )
`,r+=`- /:
${t.systemPrompt||"AI"}

`,t.worldview&&t.worldview.trim()&&(r+=`###  (World Settings)
${t.worldview}

`),t.mountedWorldbooks&&t.mountedWorldbooks.length>0){r+=`###  (Worldbooks)
`;const o={};t.mountedWorldbooks.forEach(l=>{const c=l.category||" (General)";o[c]||(o[c]=[]),o[c].push(l)}),Object.entries(o).forEach(([l,c])=>{r+=`#### [${l}]
`,c.forEach(i=>{r+=`**Title: ${i.title}**
${i.content}
---
`}),r+=`
`})}if(r+=`###  (User)
`,r+=`- : ${s.name}
`,r+=`- /: ${s.bio||""}

`,t.impression){const o=t.impression;r+=`### [: ${s.name}] (Private Impression)
`,r+=`(TA)
`,r+=`- : ${o.personality_core.summary}
`,r+=`- : ${o.personality_core.interaction_style}
`,r+=`- : ${o.personality_core.observed_traits.join(", ")}
`,r+=`- TA: ${o.value_map.likes.join(", ")}
`,r+=`- : ${o.emotion_schema.triggers.negative.join(", ")}
`,r+=`- : ${o.emotion_schema.comfort_zone}
`,r+=`- : ${o.observed_changes?o.observed_changes.join("; "):""}

`}r+=`###  (Memory Bank)
`;let a="";if(t.refinedMemories&&Object.keys(t.refinedMemories).length>0&&(a+=`** (Key Memories)**:
`,Object.entries(t.refinedMemories).sort().forEach(([o,l])=>{a+=`- [${o}]: ${l}
`})),n&&t.activeMemoryMonths&&t.activeMemoryMonths.length>0&&t.memories){let o="";t.activeMemoryMonths.forEach(l=>{const c=t.memories.filter(i=>{let d=i.date.replace(/[\/]/g,"-").replace("","");const h=d.split("-");if(h.length>=2){const p=h[0],f=h[1].padStart(2,"0");d=`${p}-${f}`}return d.startsWith(l)});c.length>0&&(o+=`
>  [${l}]:
`,c.forEach(i=>{o+=`  - ${i.date} (${i.mood||"rec"}): ${i.summary}
`}))}),o&&(a+=`
** (Active Recall)**:${o}`)}return a||(a="()"),r+=`${a}

`,r}},ti=({title:t,tags:s,color:n,onRemove:r})=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 flex items-center gap-2",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${n}`})," ",t]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.length>0?s.map((a,o)=>e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-white border border-slate-100 text-xs text-slate-600 shadow-sm",children:[a,r&&e.jsx("button",{onClick:()=>r(a),className:"ml-1.5 text-slate-300 hover:text-red-400",children:""})]},o)):e.jsx("span",{className:"text-xs text-slate-300 italic",children:""})})]}),Af=({title:t,content:s,icon:n})=>e.jsxs("div",{className:"bg-white/60 p-4 rounded-2xl border border-white/60 shadow-sm relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110 duration-500 text-slate-800",children:n}),e.jsx("h4",{className:"text-xs font-bold text-slate-500 mb-2 flex items-center gap-2 relative z-10",children:t}),e.jsx("p",{className:"text-sm text-slate-700 leading-relaxed text-justify relative z-10 whitespace-pre-wrap",children:s||"..."})]}),ho=({labelLeft:t,labelRight:s,value:n,color:r})=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-slate-500 w-full",children:[e.jsx("span",{className:`w-4 text-center ${n<50?r:"opacity-50"}`,children:t}),e.jsx("div",{className:"flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden relative",children:e.jsx("div",{className:`absolute top-0 bottom-0 w-1.5 rounded-full ${r} transition-all duration-1000`,style:{left:`${n}%`,transform:"translateX(-50%)"}})}),e.jsx("span",{className:`w-4 text-center ${n>50?r:"opacity-50"}`,children:s})]}),Ef=({impression:t,isGenerating:s,onGenerate:n,onUpdateImpression:r})=>{const a=(o,l)=>{if(!t)return;const c=JSON.parse(JSON.stringify(t));let i=c;for(let h=0;h<o.length-1;h++)i=i[o[h]];const d=o[o.length-1];Array.isArray(i[d])&&(i[d]=i[d].filter(h=>h!==l),r(c))};return!t&&!s?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 space-y-6",children:[e.jsx("div",{className:"w-24 h-24 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",className:"w-12 h-12",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-700",children:""}),e.jsx("p",{className:"text-sm text-slate-400 mt-2 max-w-xs mx-auto",children:" AI  TA "})]}),e.jsx("button",{onClick:()=>n("initial"),className:"px-8 py-3 bg-indigo-600 text-white rounded-full font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 active:scale-95 transition-all",children:""})]}):s?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full space-y-4",children:[e.jsxs("div",{className:"relative w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-slate-100 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"})]}),e.jsx("p",{className:"text-sm text-slate-500 font-medium animate-pulse",children:"..."}),e.jsx("p",{className:"text-xs text-slate-400",children:" / "})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white p-4 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-[10px] text-slate-400 uppercase tracking-widest font-bold",children:["Version ",t==null?void 0:t.version.toFixed(1)]}),e.jsxs("div",{className:"text-xs text-slate-600",children:[": ",new Date((t==null?void 0:t.lastUpdated)||Date.now()).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n("initial"),className:"px-3 py-1.5 text-xs font-bold text-slate-400 bg-slate-50 rounded-lg hover:bg-slate-100",children:""}),e.jsx("button",{onClick:()=>n("update"),className:"px-4 py-1.5 text-xs font-bold text-white bg-indigo-500 rounded-lg shadow-md shadow-indigo-200 hover:bg-indigo-600 active:scale-95 transition-all",children:"/"})]})]}),e.jsxs("div",{className:"relative bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl p-6 text-white shadow-lg overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white/10 rounded-full blur-2xl"}),e.jsx("h3",{className:"text-xs font-bold text-white/60 uppercase tracking-widest mb-3",children:" (Core Summary)"}),e.jsxs("p",{className:"text-lg font-light leading-relaxed italic opacity-95",children:['"',t==null?void 0:t.personality_core.summary,'"']}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-white/20 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-white/60 uppercase mb-1",children:""}),e.jsx("div",{className:"text-sm font-medium",children:t==null?void 0:t.personality_core.interaction_style})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-white/60 uppercase mb-1",children:""}),e.jsx("div",{className:"text-sm font-medium",children:t==null?void 0:t.behavior_profile.tone_style})]})]})]}),(t==null?void 0:t.mbti_analysis)&&e.jsxs("div",{className:"bg-white rounded-3xl p-6 border border-slate-100 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:"absolute -right-6 -top-6 w-24 h-24 bg-teal-50 rounded-full blur-xl pointer-events-none"}),e.jsxs("div",{className:"flex justify-between items-start mb-4 relative z-10",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-teal-500 text-lg",children:""})," MBTI "]}),e.jsx("span",{className:"text-2xl font-black text-slate-800 tracking-tighter bg-teal-100/50 px-2 rounded-lg text-teal-700",children:t.mbti_analysis.type})]}),e.jsxs("div",{className:"space-y-3 mb-5",children:[e.jsx(ho,{labelLeft:"E",labelRight:"I",value:t.mbti_analysis.dimensions.e_i,color:"text-teal-500 bg-teal-500"}),e.jsx(ho,{labelLeft:"S",labelRight:"N",value:t.mbti_analysis.dimensions.s_n,color:"text-teal-500 bg-teal-500"}),e.jsx(ho,{labelLeft:"T",labelRight:"F",value:t.mbti_analysis.dimensions.t_f,color:"text-teal-500 bg-teal-500"}),e.jsx(ho,{labelLeft:"J",labelRight:"P",value:t.mbti_analysis.dimensions.j_p,color:"text-teal-500 bg-teal-500"})]}),e.jsx("div",{className:"bg-slate-50 p-3 rounded-xl",children:e.jsxs("p",{className:"text-xs text-slate-600 leading-relaxed italic",children:['"',t.mbti_analysis.reasoning,'"']})})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-6 border border-slate-100 shadow-sm",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-700 mb-6 flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4a1 1 0 001.414 0l4-4a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})," (Value Map)"]}),e.jsx(ti,{title:" (Traits)",tags:(t==null?void 0:t.personality_core.observed_traits)||[],color:"bg-blue-400",onRemove:o=>a(["personality_core","observed_traits"],o)}),e.jsx(ti,{title:"TA  (Likes)",tags:(t==null?void 0:t.value_map.likes)||[],color:"bg-pink-400",onRemove:o=>a(["value_map","likes"],o)}),e.jsx(ti,{title:"TA  (Dislikes)",tags:(t==null?void 0:t.value_map.dislikes)||[],color:"bg-slate-400",onRemove:o=>a(["value_map","dislikes"],o)}),e.jsxs("div",{className:"mt-4 p-4 bg-slate-50 rounded-xl",children:[e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:""}),e.jsx("p",{className:"text-sm text-slate-600",children:t==null?void 0:t.value_map.core_values})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(Af,{title:" (Emotion)",content:(t==null?void 0:t.behavior_profile.emotion_summary)||"",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("div",{className:"bg-white rounded-2xl p-5 border border-slate-100 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-green-500 uppercase tracking-widest mb-2",children:" "}),e.jsx("ul",{className:"list-disc list-inside text-xs text-slate-600 space-y-1",children:t==null?void 0:t.emotion_schema.triggers.positive.map((o,l)=>e.jsx("li",{children:o},l))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold text-red-400 uppercase tracking-widest mb-2",children:" /"}),e.jsx("ul",{className:"list-disc list-inside text-xs text-slate-600 space-y-1",children:t==null?void 0:t.emotion_schema.triggers.negative.map((o,l)=>e.jsx("li",{children:o},l))})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-5 border border-slate-100 shadow-sm",children:[e.jsx("div",{className:"text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-2",children:" (Comfort Zone)"}),e.jsx("p",{className:"text-sm text-slate-600",children:t==null?void 0:t.emotion_schema.comfort_zone})]})]}),(t==null?void 0:t.observed_changes)&&t.observed_changes.length>0&&e.jsxs("div",{className:"bg-amber-50 p-4 rounded-2xl border border-amber-100",children:[e.jsx("h4",{className:"text-[10px] font-bold text-amber-500 uppercase tracking-widest mb-2",children:""}),e.jsx("ul",{className:"space-y-2",children:t.observed_changes.map((o,l)=>e.jsxs("li",{className:"text-xs text-amber-900 flex items-start gap-2",children:[e.jsx("span",{className:"mt-1 w-1.5 h-1.5 rounded-full bg-amber-400 shrink-0"}),e.jsx("span",{className:"opacity-90",children:o})]},l))})]})]})},If=({memories:t,refinedMemories:s,activeMemoryMonths:n,onRefine:r,onDeleteMemories:a,onUpdateMemory:o,onToggleActiveMonth:l,onUpdateRefinedMemory:c,onDeleteRefinedMemory:i})=>{const[d,h]=u.useState({level:"root",selectedYear:null,selectedMonth:null}),[p,f]=u.useState(!1),[m,x]=u.useState(!1),[g,A]=u.useState(new Set),[w,b]=u.useState(null),[v,j]=u.useState(!1),[T,$]=u.useState(null),[D,M]=u.useState(!1),Q=u.useRef(null),{tree:q,stats:re}=u.useMemo(()=>{const ge={};let I=0;const je=Array.isArray(t)?t:[];je.forEach(Ae=>{I+=Ae.summary.length;let Le="",N="";const Y=Ae.date.match(/(\d{4})[-/](\d{1,2})/);Y?(Le=Y[1],N=Y[2].padStart(2,"0")):Ae.date.includes("unknown")&&(Le=""),ge[Le]||(ge[Le]={}),ge[Le][N]||(ge[Le][N]=[]),ge[Le][N].push(Ae)});const xe={};return Object.keys(ge).sort((Ae,Le)=>Le.localeCompare(Ae)).forEach(Ae=>{xe[Ae]={},Object.keys(ge[Ae]).sort((Le,N)=>N.localeCompare(Le)).forEach(Le=>{xe[Ae][Le]=ge[Ae][Le].sort((N,Y)=>Y.date.localeCompare(N.date))})}),{tree:xe,stats:{totalChars:I,count:je.length}}},[t]),ce=ge=>h({level:"year",selectedYear:ge,selectedMonth:null}),fe=ge=>h(I=>({...I,level:"month",selectedMonth:ge})),me=()=>{d.level==="month"?h(ge=>({...ge,level:"year",selectedMonth:null})):d.level==="year"&&h({level:"root",selectedYear:null,selectedMonth:null})},ee=async()=>{if(!d.selectedYear||!d.selectedMonth)return;f(!0);const I=q[d.selectedYear][d.selectedMonth].map(je=>`${je.date}: ${je.summary} (${je.mood||""})`).join(`
`);try{await r(d.selectedYear,d.selectedMonth,I)}finally{f(!1)}},z=ge=>{const I=new Set(g);I.has(ge)?I.delete(ge):I.add(ge),A(I)},ve=()=>{g.size>0&&j(!0)},F=()=>{a(Array.from(g)),A(new Set),x(!1),j(!1)},te=ge=>{if(!d.selectedYear||!d.selectedMonth)return;const I=d.selectedYear,je=d.selectedMonth;Q.current=setTimeout(()=>{$({year:I,month:je,content:ge})},600)},L=()=>{Q.current&&(clearTimeout(Q.current),Q.current=null)},oe=()=>{T&&(c(T.year,T.month,T.content),$(null))},he=()=>{T&&(i(T.year,T.month),$(null),M(!1))};if(!t||t.length===0)return e.jsx("div",{className:"flex flex-col items-center justify-center h-48 text-slate-400",children:e.jsx("p",{className:"text-xs",children:""})});const Te=()=>e.jsx("div",{className:"grid grid-cols-2 gap-3 animate-fade-in",children:Object.keys(q).map(ge=>e.jsxs("div",{onClick:()=>ce(ge),className:"bg-white/60 backdrop-blur-sm p-4 rounded-2xl border border-white/50 shadow-sm active:scale-95 transition-all flex flex-col justify-between h-28 group cursor-pointer hover:bg-white/80",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"p-2 bg-amber-100/50 rounded-lg text-amber-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})})}),e.jsxs("span",{className:"text-[10px] bg-slate-100 px-2 py-1 rounded-full text-slate-500 font-mono",children:[Object.values(q[ge]).reduce((I,je)=>I+je.length,0),""]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-light text-slate-800 tracking-tight",children:ge}),e.jsx("p",{className:"text-[10px] text-slate-400",children:""})]})]},ge))}),De=()=>d.selectedYear&&q[d.selectedYear]&&e.jsx("div",{className:"grid grid-cols-3 gap-3 animate-fade-in",children:Object.keys(q[d.selectedYear]).map(ge=>{const I=`${d.selectedYear}-${ge}`,je=n.includes(I);return e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{onClick:()=>fe(ge),className:"bg-white/50 backdrop-blur-sm p-3 rounded-2xl border border-white/40 shadow-sm active:scale-95 transition-all flex flex-col justify-center items-center gap-2 aspect-square cursor-pointer hover:bg-white/70 relative overflow-hidden",children:[(s==null?void 0:s[I])&&e.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 bg-indigo-500 rounded-bl-lg shadow-sm"}),e.jsxs("span",{className:"text-2xl font-light text-slate-700",children:[parseInt(ge),e.jsx("span",{className:"text-xs ml-0.5 text-slate-400",children:""})]}),e.jsx("div",{className:"h-0.5 w-4 bg-primary/30 rounded-full"}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:[q[d.selectedYear][ge].length," "]})]}),e.jsx("button",{onClick:xe=>{xe.stopPropagation(),l(d.selectedYear,ge)},className:`absolute -top-2 -right-2 p-1.5 rounded-full shadow-md z-10 transition-colors ${je?"bg-primary text-white":"bg-white text-slate-300 border border-slate-100"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-3.5 h-3.5",children:[e.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),e.jsx("path",{fillRule:"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z",clipRule:"evenodd"})]})})]},ge)})}),$e=()=>{var Le;if(!d.selectedYear||!d.selectedMonth)return null;const ge=`${d.selectedYear}-${d.selectedMonth}`,I=s==null?void 0:s[ge],je=((Le=q[d.selectedYear])==null?void 0:Le[d.selectedMonth])||[],xe=n.includes(ge),Ae={};return je.forEach(N=>{Ae[N.date]||(Ae[N.date]=[]),Ae[N.date].push(N)}),je.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-32 text-slate-300",children:e.jsx("p",{className:"text-xs",children:""})}):e.jsxs("div",{className:"space-y-6 animate-fade-in pb-8",children:[e.jsxs("div",{className:"bg-indigo-50/50 rounded-2xl p-4 border border-indigo-100 relative group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:e.jsx("path",{fillRule:"evenodd",d:"M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .914-.143Z",clipRule:"evenodd"})}),e.jsx("h4",{className:"text-xs font-bold tracking-wide uppercase",children:" (AI Context)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l(d.selectedYear,d.selectedMonth),className:`text-[10px] px-3 py-1 rounded-full border shadow-sm transition-colors flex items-center gap-1 ${xe?"bg-primary text-white border-primary":"bg-white text-slate-500 border-slate-200"}`,children:xe?" (Active)":" (Default)"}),e.jsx("button",{onClick:ee,disabled:p,className:"text-[10px] bg-white text-indigo-600 px-3 py-1 rounded-full border border-indigo-200 shadow-sm hover:bg-indigo-500 hover:text-white transition-colors flex items-center gap-1",children:p?"...":I?"":""})]})]}),I&&e.jsx("div",{className:"text-sm text-indigo-900 leading-relaxed bg-white/60 p-3 rounded-xl border border-indigo-50 cursor-pointer active:scale-[0.99] transition-transform select-none",onTouchStart:()=>te(I),onTouchEnd:L,onMouseDown:()=>te(I),onMouseUp:L,onMouseLeave:L,onContextMenu:N=>{N.preventDefault(),$({year:d.selectedYear,month:d.selectedMonth,content:I})},title:"/",children:I})]}),e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Time Logs"}),e.jsxs("div",{className:"flex gap-2",children:[m&&g.size>0&&e.jsxs("button",{onClick:N=>{N.stopPropagation(),ve()},className:"text-[10px] bg-red-500 text-white px-3 py-1 rounded-full font-bold shadow-sm active:scale-95 transition-transform",children:[" (",g.size,")"]}),e.jsx("button",{onClick:()=>{x(!m),A(new Set)},className:`text-[10px] px-3 py-1 rounded-full border transition-colors ${m?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:m?"":""})]})]}),e.jsx("div",{className:"mt-2 pl-2",children:Object.entries(Ae).map(([N,Y])=>e.jsxs("div",{className:"relative pl-8 pb-8 last:pb-0 border-l-[2px] border-slate-100 last:border-l-0 last:border-image-source-none",children:[e.jsx("div",{className:"absolute left-[-2px] top-0 bottom-0 w-[2px] bg-slate-100"}),e.jsx("div",{className:"absolute left-[-7px] top-0 w-3.5 h-3.5 bg-slate-300 rounded-full border-4 border-slate-50 z-10"}),e.jsxs("div",{className:"mb-3 -mt-1.5 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 font-mono tracking-tight",children:N}),Y.length>1&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 bg-slate-100 rounded-md text-slate-400 font-normal",children:[Y.length," "]})]}),e.jsx("div",{className:"space-y-3",children:Y.map(B=>e.jsxs("div",{className:`relative group transition-all duration-300 ${m?"cursor-pointer":""}`,onClick:()=>{m&&z(B.id)},children:[m&&e.jsx("div",{className:`absolute -left-[38px] top-1/2 -translate-y-1/2 w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors z-20 ${g.has(B.id)?"bg-primary border-primary":"bg-white border-slate-300"}`,children:g.has(B.id)&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),e.jsxs("div",{className:`bg-white p-4 rounded-xl rounded-tl-none border border-slate-100 shadow-sm hover:shadow-md hover:border-primary/20 transition-all relative ${m&&g.has(B.id)?"ring-2 ring-primary ring-offset-2":""}`,children:[!m&&e.jsx("button",{onClick:ue=>{ue.stopPropagation(),b(B)},className:"absolute top-2 right-2 p-1.5 text-slate-300 hover:text-primary bg-transparent hover:bg-slate-50 rounded-full transition-colors z-10",title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})}),B.mood&&e.jsx("div",{className:"mb-1 pr-6",children:e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 bg-primary/5 text-primary rounded-md font-medium",children:["#",B.mood]})}),e.jsx("p",{className:"text-sm text-slate-700 leading-relaxed text-justify whitespace-pre-wrap",children:B.summary})]})]},B.id))})]},N))})]})};return e.jsxs("div",{className:"flex flex-col h-full relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 px-1",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-[10px] text-slate-400 uppercase tracking-widest",children:""}),e.jsx("span",{className:"text-lg font-medium text-slate-700 font-mono",children:re.totalChars.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-[10px] text-slate-400 uppercase tracking-widest",children:""}),e.jsx("span",{className:"text-lg font-medium text-slate-700 font-mono",children:re.count})]})]}),e.jsx("div",{className:"flex items-center gap-1 text-xs font-medium text-slate-500 bg-white/50 px-3 py-1.5 rounded-full border border-white/50 shadow-sm",children:d.level==="root"?e.jsx("span",{children:""}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h({level:"root",selectedYear:null,selectedMonth:null}),className:"hover:text-primary",children:""}),e.jsx("span",{className:"text-slate-300",children:"/"}),d.level==="year"?e.jsx("span",{className:"text-slate-800",children:d.selectedYear}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(ge=>({...ge,level:"year",selectedMonth:null})),className:"hover:text-primary",children:d.selectedYear}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-slate-800",children:[parseInt(d.selectedMonth),""]})]})]})})]}),d.level==="root"&&Te(),d.level==="year"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("button",{onClick:me,className:"p-1.5 bg-white rounded-full text-slate-400 hover:text-slate-600 shadow-sm",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:e.jsx("path",{fillRule:"evenodd",d:"M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z",clipRule:"evenodd"})})}),e.jsx("h3",{className:"text-sm font-medium text-slate-600",children:""})]}),De()]}),d.level==="month"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("button",{onClick:me,className:"p-1.5 bg-white rounded-full text-slate-400 hover:text-slate-600 shadow-sm",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:e.jsx("path",{fillRule:"evenodd",d:"M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z",clipRule:"evenodd"})})}),e.jsx("h3",{className:"text-sm font-medium text-slate-600",children:" (  )"})]}),$e()]}),e.jsx(Ye,{isOpen:!!w,title:"",onClose:()=>b(null),footer:e.jsx("button",{onClick:()=>{w&&o(w.id,w.summary),b(null)},className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:w&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:[": ",w.date]}),e.jsx("textarea",{value:w.summary,onChange:ge=>b({...w,summary:ge.target.value}),className:"w-full h-40 bg-slate-100 rounded-xl p-3 text-sm resize-none focus:outline-primary"})]})}),e.jsx(Ye,{isOpen:v,title:"",onClose:()=>j(!1),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>j(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),e.jsx("button",{onClick:F,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:e.jsxs("p",{className:"text-sm text-slate-600 text-center py-4",children:[" ",g.size," ",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-red-400 mt-1 block",children:""})]})}),e.jsx(Ye,{isOpen:!!T,title:"",onClose:()=>$(null),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>M(!0),className:"flex-1 py-3 bg-red-50 text-red-500 font-bold rounded-2xl",children:""}),e.jsx("button",{onClick:oe,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl shadow-lg",children:""})]}),children:T&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-slate-400",children:[T.year,"",T.month,""]}),e.jsx("textarea",{value:T.content,onChange:ge=>$({...T,content:ge.target.value}),className:"w-full h-48 bg-slate-100 rounded-xl p-3 text-sm resize-none focus:outline-primary leading-relaxed"})]})}),e.jsx(Ye,{isOpen:D,title:"",onClose:()=>M(!1),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>M(!1),className:"flex-1 py-3 bg-slate-100 font-bold rounded-2xl",children:""}),e.jsx("button",{onClick:he,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:""})]}),children:e.jsxs("p",{className:"text-center text-sm text-slate-600 py-4",children:["",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-red-400",children:" AI "})]})})]})},Mf=({char:t,onClick:s,onDelete:n})=>e.jsxs("div",{onClick:s,className:"relative p-4 rounded-3xl border bg-white/40 border-white/40 hover:bg-white/60 hover:scale-[1.01] transition-all duration-300 cursor-pointer group shadow-sm shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-14 h-14 rounded-full bg-slate-100 border border-white/50 overflow-hidden relative shadow-inner",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-100/50"}),e.jsx("img",{src:t.avatar,className:"w-full h-full object-cover relative z-10",alt:t.name})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate text-slate-700",children:t.name}),e.jsx("p",{className:"text-xs text-slate-400 truncate mt-0.5 font-light",children:t.description||""})]})]}),e.jsx("button",{onClick:n,className:"absolute top-3 right-3 p-2 rounded-full text-slate-300 hover:bg-red-50 hover:text-red-400 active:bg-red-100 active:text-red-500 transition-all z-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]}),_f=()=>{const{closeApp:t,openApp:s,characters:n,activeCharacterId:r,setActiveCharacterId:a,addCharacter:o,updateCharacter:l,deleteCharacter:c,apiConfig:i,addToast:d,userProfile:h,customThemes:p,addCustomTheme:f,worldbooks:m}=mt(),[x,g]=u.useState("list"),[A,w]=u.useState("identity"),[b,v]=u.useState(null),[j,T]=u.useState(null),[$,D]=u.useState(!1),M=u.useRef(null),Q=u.useRef(null),q=u.useRef(null),[re,ce]=u.useState(!1),[fe,me]=u.useState(!1),[ee,z]=u.useState(!1),[ve,F]=u.useState(null),[te,L]=u.useState(!1),[oe,he]=u.useState(""),[Te,De]=u.useState(""),[$e,ge]=u.useState(!1),[I,je]=u.useState(""),[xe,Ae]=u.useState({start:"",end:""}),[Le,N]=u.useState(!1),[Y,B]=u.useState(""),[ue,P]=u.useState(!1);u.useEffect(()=>{q.current=b},[b]),u.useEffect(()=>{if(b&&x==="detail"&&(!j||j.id!==b)){const Z=n.find(Se=>Se.id===b);Z&&T(Z)}},[b,x]),u.useEffect(()=>{j&&b&&(j.id===b?l(b,j):console.warn(`Race condition prevented: Tried to save data for ${j.id} into slot ${b}`))},[j]);const Ee=()=>{x==="detail"?(g("list"),v(null)):t()},de=(Z,Se)=>{T(we=>we?{...we,[Z]:Se}:null)},J=Z=>{if(!j)return;const Se=m.find(He=>He.id===Z);if(!Se)return;const we=j.mountedWorldbooks||[];if(we.some(He=>He.id===Se.id)){d("","info");return}const Ce={id:Se.id,title:Se.title,content:Se.content,category:Se.category};de("mountedWorldbooks",[...we,Ce]),L(!1),d(`: ${Se.title}`,"success")},be=Z=>{if(!j)return;const Se=m.filter(le=>(le.category||" (General)")===Z);if(Se.length===0)return;const we=j.mountedWorldbooks||[],Ce=[];let He=0;for(const le of Se)we.some(Oe=>Oe.id===le.id)||(Ce.push({id:le.id,title:le.title,content:le.content,category:le.category}),He++);He>0?(de("mountedWorldbooks",[...we,...Ce]),d(` ${He} `,"success")):d("","info"),L(!1)},y=Z=>{if(!j)return;const Se=j.mountedWorldbooks||[];de("mountedWorldbooks",Se.filter(we=>we.id!==Z))},W=(Z,Se)=>{if(!j)return;const we=`${Z}-${Se}`,Ce=j.activeMemoryMonths||[],He=Ce.includes(we)?Ce.filter(le=>le!==we):[...Ce,we];de("activeMemoryMonths",He)},se=async Z=>{var we;const Se=(we=Z.target.files)==null?void 0:we[0];if(Se)try{D(!0);const Ce=await Ut(Se);de("avatar",Ce),d("","success")}catch(Ce){d(Ce.message||"","error")}finally{D(!1),M.current&&(M.current.value="")}},C=async(Z,Se,we)=>{var le;if(!i.apiKey){d(" API Key","error");return}if(!j)return;const Ce=j.id,He=`Task: Summarize the following logs (${Z}-${Se}) into a concise memory. Language: Same as logs (Chinese). ${we.substring(0,5e3)}`;try{const Oe=await fetch(`${i.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"user",content:He}],temperature:.3})});if(!Oe.ok)throw new Error("API Request failed");const Ie=(await Oe.json()).choices[0].message.content.trim(),Ve=`${Z}-${Se}`;if(q.current===Ce)de("refinedMemories",{...j.refinedMemories||{},[Ve]:Ie}),d(`${Z}${Se}`,"success");else{const X=((le=n.find(ae=>ae.id===Ce))==null?void 0:le.refinedMemories)||{};l(Ce,{refinedMemories:{...X,[Ve]:Ie}}),d("","success")}}catch(Oe){d(`: ${Oe.message}`,"error")}},O=Z=>{j&&(de("memories",(j.memories||[]).filter(Se=>!Z.includes(Se.id))),d(` ${Z.length} `,"success"))},R=(Z,Se)=>{j&&(de("memories",(j.memories||[]).map(we=>we.id===Z?{...we,summary:Se}:we)),d("","success"))},_=(Z,Se,we)=>{if(!j)return;const Ce=`${Z}-${Se}`;de("refinedMemories",{...j.refinedMemories||{},[Ce]:we}),d("","success")},K=(Z,Se)=>{if(!j||!j.refinedMemories)return;const we=`${Z}-${Se}`,Ce={...j.refinedMemories};delete Ce[we],de("refinedMemories",Ce),d("","success")},ie=()=>{if(!j)return;const Z=j.memories;if(!Z||Z.length===0){d("","info");return}const Se=[...Z].sort((le,Oe)=>le.date.localeCompare(Oe.date));let we=`
Name: ${j.name}
Exported: ${new Date().toLocaleString()}

`;j.refinedMemories&&(we+=`===  ===
`,Object.entries(j.refinedMemories).sort().forEach(([le,Oe])=>{we+=`[${le}]: ${Oe}
`}),we+=`
===  ===
`);let Ce="",He="";Se.forEach(le=>{const Oe=le.date.match(/(\d{4})[-/](\d{1,2})/);if(Oe){const We=Oe[1],Ie=Oe[2];We!==Ce&&(we+=`
[ ${We} ]
`,Ce=We,He=""),Ie!==He&&(we+=`
-- ${parseInt(Ie)} --

`,He=Ie)}we+=` ${le.date} ${le.mood?`(#${le.mood})`:""}
${le.summary}

--------------------------

`}),De(we),me(!0),navigator.clipboard.writeText(we).then(()=>d("","info")).catch(()=>{})},S=async()=>{if(Te&&Ys.isNativePlatform())try{const Z=`${(j==null?void 0:j.name)||"character"}_memories.txt`;await Tr.writeFile({path:Z,data:Te,directory:Rn.Cache,encoding:Qo.UTF8});const Se=await Tr.getUri({directory:Rn.Cache,path:Z});await uc.share({title:"",files:[Se.uri]})}catch(Z){console.error("Native share failed",Z),d("","error")}},k=()=>{const Z=`${(j==null?void 0:j.name)||"character"}_memories.txt`,Se=new Blob([Te],{type:"text/plain"}),we=URL.createObjectURL(Se),Ce=document.createElement("a");Ce.href=we,Ce.download=Z,document.body.appendChild(Ce),Ce.click(),document.body.removeChild(Ce),URL.revokeObjectURL(we),d("","success")},H=async()=>{var Se,we,Ce,He;if(!oe.trim()||!i.apiKey){d(" API ","error");return}if(!j)return;const Z=j.id;ge(!0),je("...");try{const le=`Task: Convert this text log into a JSON array. Format: [{ "date": "YYYY-MM-DD", "summary": "...", "mood": "..." }] Text: ${oe.substring(0,8e3)}`,Oe=await fetch(`${i.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"user",content:le}],temperature:.1})});if(!Oe.ok)throw new Error(`HTTP Error: ${Oe.status}`);let Ie=((Ce=(we=(Se=(await Oe.json()).choices)==null?void 0:Se[0])==null?void 0:we.message)==null?void 0:Ce.content)||"";Ie=Ie.replace(/```json/g,"").replace(/```/g,"").trim();const Ve=Ie.indexOf("["),X=Ie.lastIndexOf("]");Ve!==-1&&X!==-1&&(Ie=Ie.substring(Ve,X+1));let ae;try{ae=JSON.parse(Ie)}catch{throw new Error("")}let ke=Array.isArray(ae)?ae:ae.memories||ae.data;if(Array.isArray(ke)){const Me=ke.map(Ue=>({id:`mem-${Date.now()}-${Math.random()}`,date:Ue.date||"",summary:Ue.summary||"",mood:Ue.mood||""}));if(q.current===Z)de("memories",[...j.memories||[],...Me]),ce(!1),d(` ${Me.length} `,"success");else{const Ue=((He=n.find(Be=>Be.id===Z))==null?void 0:He.memories)||[];l(Z,{memories:[...Ue,...Me]}),d("","success")}}else throw new Error("")}catch(le){je(`: ${le.message||""}`),d("","error")}finally{ge(!1)}},E=async()=>{var Se,we,Ce,He;if(!i.apiKey||!j)return;const Z=j.id;N(!0),B("Initializing...");try{const le=await U.getMessagesByCharId(Z),Oe=le.filter(ae=>!j.hideBeforeMessageId||ae.id>=j.hideBeforeMessageId),We={};le.forEach(ae=>{const ke=new Date(ae.timestamp),Me=ke.getFullYear(),Ue=String(ke.getMonth()+1).padStart(2,"0"),Be=String(ke.getDate()).padStart(2,"0"),_e=`${Me}-${Ue}-${Be}`;xe.start&&_e<xe.start||xe.end&&_e>xe.end||(We[_e]||(We[_e]=[]),We[_e].push(ae))});const Ie=Object.keys(We).sort(),Ve=[],X=At.buildCoreContext(j,h);for(let ae=0;ae<Ie.length;ae++){const ke=Ie[ae];B(`Processing ${ke} (${ae+1}/${Ie.length})`);const Ue=We[ke].map(qe=>{const Je=new Date(qe.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});let et=qe.content;return qe.type==="image"&&(et="[/Image]"),qe.type==="emoji"&&(et=`[: ${qe.content.split("/").pop()||"sticker"}]`),`[${Je}] ${qe.role==="user"?h.name:j.name}: ${et}`}).join(`
`),Be=`${X}

### [System Instruction: Memory Archival]
: ${ke}
: 

###  (Strict Protocols)
1.  ** (Coverage)**:
    - ****
    - ****
    - 

2.  ** (Perspective)**:
    - "${j.name}"
    - ${h.name}

3.  ** (Format)**:
    - 
    - **** Markdown  ( - ... )
    - 

4.  ** (Conciseness)**:
    - xx...
    - : "- ${h.name}"

###  (Chat Logs)
${Ue.substring(0,2e5)}
`,_e=await fetch(`${i.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"user",content:Be}],max_tokens:8e3,temperature:.5})});if(_e.ok){let Je=((Ce=(we=(Se=(await _e.json()).choices)==null?void 0:Se[0])==null?void 0:we.message)==null?void 0:Ce.content)||"";Je=Je.replace(/^["']|["']$/g,"").trim(),Je&&Ve.push({id:`mem-${Date.now()}-${Math.random()}`,date:ke,summary:Je,mood:"auto"})}await new Promise(qe=>setTimeout(qe,500))}if(q.current===Z)de("memories",[...j.memories||[],...Ve]),B("Done!"),setTimeout(()=>{N(!1),z(!1),d(`Processed ${Ve.length} days`,"success")},1e3);else{const ae=((He=n.find(ke=>ke.id===Z))==null?void 0:He.memories)||[];l(Z,{memories:[...ae,...Ve]}),N(!1),z(!1),d(` ${j.name}  ${Ve.length} `,"success")}}catch(le){B(`Error: ${le.message}`),N(!1)}},ne=async Z=>{if(!j||!i.apiKey){d(" API Key","error");return}const Se=j.id;P(!0);try{const we=j.name,Ce=h,He=At.buildCoreContext(j,h);let le="";le+=`
 (Full Context - ):
${He}
`;const Oe=j.memories||[];let We="";Oe.length>0&&(We=[...Oe].sort((nt,at)=>at.date.localeCompare(nt.date)).slice(0,100).map(nt=>`[${nt.date}] ${nt.summary}`).join(`
`),le+=`
 (Long-Term Memory Logs):
${We}
`);const X=(await U.getMessagesByCharId(Se)).slice(-50).map(ht=>{let nt=ht.content;return ht.type==="image"&&(nt="[]"),`${ht.role==="user"?Ce.name:we}: ${nt}`}).join(`
`);X&&(le+=`
 (Recent Chats - ):
${X}
`);const ae=j.impression?JSON.stringify(j.impression,null,2):"null",ke=Z==="initial"||!j.impression,Me=ke?"100TATATA":"TATA",Ue=ke?'"1", "2"':'"", ""',Be=ke?"":'"1", "2"',_e=`

\`\`\`json
${ae}
\`\`\`
${le}


"${we}"
 \`core_values\`, \`summary\`, \`emotion_summary\` ""


1. ** (Full Context)**: TA
2. ** (Memory Logs)**: 
3. ** (Recent Chats)**: TA [behavior_profile.emotion_summary]  [observed_changes] TA

 - 
-  "TAXX"  
-  personality_core.summary """"  summary 
-  personality_core observed_changes 

 ()
${ke?"":""}JSON

JSONv3.0, markdownJSON
{
  "version": 3.0,
  "lastUpdated": ${Date.now()},
  "value_map": {
    "likes": [${Ue}],
    "dislikes": [${Ue}],
    "core_values": "..."
  },
  "behavior_profile": {
    "tone_style": "...",
    "emotion_summary": "...",
    "response_patterns": "..."
  },
  "emotion_schema": {
    "triggers": { 
        "positive": [${Ue}],
        "negative": [${Ue}]
    },
    "comfort_zone": "...",
    "stress_signals": [${Ue}]
  },
  "personality_core": {
    "observed_traits": [${Ue}],
    "interaction_style": "...",
    "summary": "..."
  },
  "mbti_analysis": {
    "type": "XXXX",
    "reasoning": "...",
    "dimensions": {
        "e_i": 50,
        "s_n": 50,
        "t_f": 50,
        "j_p": 50
    }
  },
  "observed_changes": [
    ${Be}
  ]
}`,qe=await fetch(`${i.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.apiKey}`},body:JSON.stringify({model:i.model,messages:[{role:"user",content:_e}],max_tokens:8e3,temperature:.5})});if(!qe.ok)throw new Error("API Request Failed");let et=(await qe.json()).choices[0].message.content;et=et.replace(/```json/g,"").replace(/```/g,"").trim();const Qe=JSON.parse(et);q.current===Se?(de("impression",Qe),d(ke?"":"","success")):(l(Se,{impression:Qe}),d("","success"))}catch(we){console.error(we),d(`: ${we.message}`,"error")}finally{P(!1)}},Ne=()=>{ve&&(c(ve),F(null),d("","success"))},pe=async()=>{if(!j)return;const{id:Z,memories:Se,refinedMemories:we,activeMemoryMonths:Ce,impression:He,...le}=j,Oe={...le,version:1,type:"sully_character_card"};if(j.bubbleStyle){const Ie=p.find(Ve=>Ve.id===j.bubbleStyle);Ie&&(Oe.embeddedTheme=Ie)}const We=JSON.stringify(Oe,null,2);if(Ys.isNativePlatform())try{const Ie=`${j.name||"Character"}_Card.json`;await Tr.writeFile({path:Ie,data:We,directory:Rn.Cache,encoding:Qo.UTF8});const Ve=await Tr.getUri({directory:Rn.Cache,path:Ie});await uc.share({title:"",files:[Ve.uri]}),d("","success")}catch(Ie){console.error("Native Export Error",Ie),d("","error")}else{const Ie=new Blob([We],{type:"application/json"}),Ve=URL.createObjectURL(Ie),X=document.createElement("a");X.href=Ve,X.download=`${j.name}_Card.json`,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(Ve),d("","success")}},G=Z=>{var Ce;const Se=(Ce=Z.target.files)==null?void 0:Ce[0];if(!Se)return;const we=new FileReader;we.onload=async He=>{var le;try{const Oe=(le=He.target)==null?void 0:le.result,We=JSON.parse(Oe);if(We.type!=="sully_character_card")throw new Error("");We.embeddedTheme&&(p.some(X=>X.id===We.embeddedTheme.id)||f(We.embeddedTheme));const Ie={...We,id:`char-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,memories:[],refinedMemories:{},activeMemoryMonths:[],embeddedTheme:void 0};await U.saveCharacter(Ie),o(),setTimeout(()=>window.location.reload(),500),d(` ${Ie.name} `,"success")}catch(Oe){console.error(Oe),d(Oe.message||"","error")}finally{Q.current&&(Q.current.value="")}},we.readAsText(Se)};return e.jsxs("div",{className:"h-full w-full bg-slate-50/30 font-light relative",children:[x==="list"?e.jsxs("div",{className:"flex flex-col h-full animate-fade-in",children:[e.jsxs("div",{className:"px-6 pt-16 pb-4 shrink-0 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-light text-slate-800 tracking-tight",children:""}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[" ",n.length," "]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{var Z;return(Z=Q.current)==null?void 0:Z.click()},className:"p-2 rounded-full bg-white/40 hover:bg-white/80 transition-colors text-slate-600",title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})})}),e.jsx("input",{type:"file",ref:Q,className:"hidden",accept:".json",onChange:G}),e.jsx("button",{onClick:t,className:"p-2 rounded-full bg-white/40 hover:bg-white/80 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 pb-20 no-scrollbar flex flex-col gap-3",children:[n.map(Z=>e.jsx(Mf,{char:Z,onClick:()=>{v(Z.id),g("detail")},onDelete:Se=>{Se.stopPropagation(),F(Z.id)}},Z.id)),e.jsxs("button",{onClick:o,className:"w-full py-4 rounded-3xl border border-dashed border-slate-300 text-slate-400 text-sm hover:bg-white/30 transition-all flex items-center justify-center gap-2 shrink-0",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),""]})]})]}):j&&e.jsxs("div",{className:"flex flex-col h-full animate-fade-in bg-slate-50/50 relative",children:[e.jsxs("div",{className:"h-32 bg-gradient-to-b from-white/90 to-transparent backdrop-blur-sm flex flex-col justify-end px-5 pb-2 shrink-0 z-40 sticky top-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("button",{onClick:Ee,className:"p-2 -ml-2 rounded-full hover:bg-white/60 flex items-center gap-1 text-slate-600",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})}),e.jsx("span",{className:"text-sm font-medium",children:""})]}),e.jsxs("button",{onClick:()=>{a(j.id),s(Ze.Chat)},className:"text-xs px-3 py-1.5 bg-primary text-white rounded-full font-bold shadow-sm shadow-primary/30 flex items-center gap-1 active:scale-95 transition-transform",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{d:"M3.105 2.288a.75.75 0 0 0-.826.95l1.414 4.926H16.5a.75.75 0 0 1 0 1.5H3.693l-1.414 4.926a.75.75 0 0 0 .826.95 28.897 28.897 0 0 0 15.293-7.155.75.75 0 0 0 0-1.114A28.897 28.897 0 0 0 3.105 2.288Z"})}),""]})]}),e.jsxs("div",{className:"flex gap-6 text-sm font-medium text-slate-400 pl-1",children:[e.jsxs("button",{onClick:()=>w("identity"),className:`pb-2 transition-colors relative ${A==="identity"?"text-slate-800":""}`,children:["",A==="identity"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary rounded-full"})]}),e.jsxs("button",{onClick:()=>w("memory"),className:`pb-2 transition-colors relative ${A==="memory"?"text-slate-800":""}`,children:[" (",(j.memories||[]).length,")",A==="memory"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary rounded-full"})]}),e.jsxs("button",{onClick:()=>w("impression"),className:`pb-2 transition-colors relative ${A==="impression"?"text-slate-800":""}`,children:["",A==="impression"&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-primary rounded-full"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 no-scrollbar pb-10",children:[A==="identity"&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"relative group cursor-pointer w-24 h-24 shrink-0",onClick:()=>{var Z;return(Z=M.current)==null?void 0:Z.click()},children:[e.jsx("div",{className:"w-full h-full rounded-[2rem] shadow-md bg-white border-4 border-white overflow-hidden relative",children:e.jsx("img",{src:j.avatar,className:`w-full h-full object-cover ${$?"opacity-50 blur-sm":""}`,alt:"A"})}),e.jsx("input",{type:"file",ref:M,className:"hidden",accept:"image/*",onChange:se})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("input",{value:j.name,onChange:Z=>de("name",Z.target.value),className:"w-full bg-transparent py-1 text-xl font-medium text-slate-800 border-b border-slate-200",placeholder:""}),e.jsx("input",{value:j.description,onChange:Z=>de("description",Z.target.value),className:"w-full bg-transparent py-1 text-sm text-slate-500 border-b border-slate-200",placeholder:""})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block",children:" (System Prompt)"}),e.jsx("textarea",{value:j.systemPrompt,onChange:Z=>de("systemPrompt",Z.target.value),className:"w-full h-40 bg-white rounded-3xl p-5 text-sm shadow-sm resize-none focus:ring-1 focus:ring-primary/20 transition-all",placeholder:"..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block",children:" /  (Worldview & Lore)"}),e.jsx("textarea",{value:j.worldview||"",onChange:Z=>de("worldview",Z.target.value),className:"w-full h-24 bg-white rounded-3xl p-5 text-sm shadow-sm resize-none focus:ring-1 focus:ring-primary/20 transition-all",placeholder:"..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-indigo-500 uppercase tracking-widest block",children:"  (Worldbooks)"}),e.jsx("button",{onClick:()=>L(!0),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded font-bold hover:bg-indigo-100",children:"+ "})]}),e.jsx("div",{className:"space-y-2",children:j.mountedWorldbooks&&j.mountedWorldbooks.length>0?j.mountedWorldbooks.map(Z=>e.jsxs("div",{className:"flex items-center justify-between bg-white px-4 py-3 rounded-2xl border border-indigo-50 shadow-sm group",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-lg shrink-0",children:""}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 truncate",children:Z.title}),Z.category&&e.jsx("span",{className:"text-[9px] text-slate-400",children:Z.category})]})]}),e.jsx("button",{onClick:()=>y(Z.id),className:"text-slate-300 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 ml-2",children:""})]},Z.id)):e.jsx("div",{className:"text-center py-4 bg-slate-50 rounded-2xl border border-dashed border-slate-200 text-slate-400 text-xs",children:""})})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("button",{onClick:pe,className:"w-full py-4 bg-slate-800 text-white rounded-2xl text-xs font-bold shadow-lg flex items-center justify-center gap-2 hover:bg-slate-700 active:scale-95 transition-all",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})})," / "]}),e.jsx("p",{className:"text-[10px] text-slate-400 text-center mt-2",children:""})]})]}),A==="memory"&&e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx("button",{onClick:()=>z(!0),className:"px-4 py-2 bg-white rounded-full text-xs font-semibold text-slate-500 shadow-sm border border-slate-100",children:""}),e.jsx("button",{onClick:()=>ce(!0),className:"px-4 py-2 bg-white rounded-full text-xs font-semibold text-slate-500 shadow-sm border border-slate-100",children:"/"}),e.jsx("button",{onClick:ie,className:"px-4 py-2 bg-white rounded-full text-xs font-semibold text-slate-500 shadow-sm border border-slate-100",children:""})]}),e.jsx(If,{memories:j.memories||[],refinedMemories:j.refinedMemories||{},activeMemoryMonths:j.activeMemoryMonths||[],onRefine:C,onDeleteMemories:O,onUpdateMemory:R,onToggleActiveMonth:W,onUpdateRefinedMemory:_,onDeleteRefinedMemory:K})]}),A==="impression"&&e.jsx(Ef,{impression:j.impression,isGenerating:ue,onGenerate:ne,onUpdateImpression:Z=>de("impression",Z)})]})]}),e.jsx(Ye,{isOpen:re,title:"/",onClose:()=>ce(!1),footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ce(!1),className:"flex-1 py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl",children:""}),e.jsxs("button",{onClick:H,disabled:$e,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl shadow-lg shadow-primary/30 flex items-center justify-center gap-2",children:[$e&&e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),$e?"...":""]})]}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-slate-400 leading-relaxed bg-slate-50 p-3 rounded-xl border border-slate-100",children:"AI "}),I&&e.jsx("div",{className:"text-xs text-primary font-medium",children:I}),e.jsx("textarea",{value:oe,onChange:Z=>he(Z.target.value),placeholder:"...",className:"w-full h-32 bg-slate-100 border-none rounded-2xl px-4 py-3 text-sm text-slate-700 resize-none focus:ring-2 focus:ring-primary/20 transition-all"})]})}),e.jsx(Ye,{isOpen:ee,title:"",onClose:()=>z(!1),footer:Le?e.jsxs("div",{className:"w-full py-3 bg-slate-100 text-primary font-bold rounded-2xl text-center flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),Y]}):e.jsx("button",{onClick:E,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-slate-400",children:""}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] uppercase text-slate-400 font-bold",children:" ()"}),e.jsx("input",{type:"date",value:xe.start,onChange:Z=>Ae({...xe,start:Z.target.value}),className:"w-full bg-slate-100 rounded-xl px-3 py-2 text-xs"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] uppercase text-slate-400 font-bold",children:" ()"}),e.jsx("input",{type:"date",value:xe.end,onChange:Z=>Ae({...xe,end:Z.target.value}),className:"w-full bg-slate-100 rounded-xl px-3 py-2 text-xs"})]})]})]})}),e.jsx(Ye,{isOpen:fe,title:"",onClose:()=>me(!1),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(Te),d("","success")},className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),Ys.isNativePlatform()?e.jsxs("button",{onClick:S,className:"flex-1 py-3 bg-slate-800 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})}),""]}):e.jsxs("button",{onClick:k,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})}),""]})]}),children:e.jsxs("div",{className:"bg-slate-50 rounded-2xl p-3 border border-slate-100 space-y-2",children:[e.jsx("div",{className:"text-[10px] text-slate-400",children:""}),e.jsx("textarea",{value:Te,readOnly:!0,className:"w-full h-40 bg-transparent border-none text-[10px] font-mono text-slate-600 resize-none focus:ring-0 leading-relaxed select-all",onClick:Z=>Z.currentTarget.select()})]})}),e.jsx(Ye,{isOpen:te,title:"",onClose:()=>L(!1),children:e.jsx("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-4 p-1",children:m.length===0?e.jsx("div",{className:"text-center text-slate-400 text-xs py-8",children:"App "}):Object.entries(m.reduce((Z,Se)=>{const we=Se.category||" (General)";return Z[we]||(Z[we]=[]),Z[we].push(Se),Z},{})).map(([Z,Se])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:Z}),e.jsx("button",{onClick:()=>be(Z),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded font-bold hover:bg-indigo-100",children:""})]}),Se.map(we=>{var He;const Ce=(He=j==null?void 0:j.mountedWorldbooks)==null?void 0:He.some(le=>le.id===we.id);return e.jsx("button",{onClick:()=>!Ce&&J(we.id),disabled:Ce,className:`w-full p-4 rounded-xl border text-left transition-all ${Ce?"bg-slate-50 border-slate-200 opacity-50 cursor-not-allowed":"bg-white border-indigo-100 hover:border-indigo-300 shadow-sm active:scale-95"}`,children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-bold text-slate-700 text-sm truncate",children:we.title}),Ce&&e.jsx("span",{className:"text-[10px] text-slate-400",children:""})]})},we.id)})]},Z))})}),e.jsx(Ye,{isOpen:!!ve,title:"",onClose:()=>F(null),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>F(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),e.jsx("button",{onClick:Ne,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:e.jsxs("div",{className:"flex flex-col items-center gap-3 py-4",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 text-slate-300",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsxs("p",{className:"text-sm text-slate-600 text-center leading-relaxed",children:["",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-red-400 font-bold",children:""})]})]})})]})},Tf=({forwardData:t,commonLayout:s,selectionMode:n})=>{const[r,a]=u.useState(!1),o=c=>{n||(c.stopPropagation(),a(!0))},l=c=>new Date(c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return e.jsxs(e.Fragment,{children:[s(e.jsxs("div",{className:"w-64 bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-100 active:scale-[0.98] transition-transform cursor-pointer",onClick:o,children:[e.jsx("div",{className:"px-4 pt-3 pb-2 border-b border-slate-50",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-slate-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 text-primary",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})}),t.fromUserName,"  ",t.fromCharName," "]})}),e.jsx("div",{className:"px-4 py-2 space-y-1",children:(t.preview||[]).slice(0,4).map((c,i)=>e.jsx("div",{className:"text-[11px] text-slate-500 truncate leading-relaxed",children:c},i))}),e.jsxs("div",{className:"px-4 py-2 border-t border-slate-50 text-[10px] text-slate-400 flex items-center justify-between",children:[e.jsxs("span",{children:[" ",t.count||0," "]}),e.jsx("span",{className:"text-primary font-medium",children:""})]})]})),r&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-slate-50 flex flex-col animate-fade-in",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"pt-[calc(env(safe-area-inset-top)+0.75rem)] pb-3 px-4 bg-white border-b border-slate-100 shrink-0 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>a(!1),className:"p-2 -ml-2 rounded-full hover:bg-slate-100 text-slate-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-bold text-slate-700 truncate",children:[t.fromUserName,"  ",t.fromCharName," "]}),e.jsxs("div",{className:"text-[10px] text-slate-400",children:[" ",t.count||0," "]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:(t.messages||[]).map((c,i)=>{const d=c.role==="user",h=d?t.fromUserName:t.fromCharName;return e.jsx("div",{className:`flex ${d?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] ${d?"items-end":"items-start"} flex flex-col`,children:[e.jsxs("div",{className:"text-[10px] text-slate-400 mb-1 px-1",children:[h," ",c.timestamp?l(c.timestamp):""]}),e.jsx("div",{className:`px-4 py-2.5 rounded-2xl text-sm leading-relaxed whitespace-pre-wrap break-all ${d?"bg-primary text-white rounded-br-sm":"bg-white text-slate-700 rounded-bl-sm shadow-sm border border-slate-100"}`,children:c.type==="image"?e.jsx("img",{src:c.content,className:"max-w-[200px] rounded-xl"}):c.type==="emoji"?e.jsx("img",{src:c.content,className:"max-w-[100px]"}):c.content})]})},i)})})]})]})},Df=Sn.memo(({msg:t,isFirstInGroup:s,isLastInGroup:n,activeTheme:r,charAvatar:a,charName:o,userAvatar:l,onLongPress:c,selectionMode:i,isSelected:d,onToggleSelect:h,translationEnabled:p,isShowingTarget:f,onTranslateToggle:m})=>{var De,$e,ge;const x=t.role==="user",g=t.role==="system",A=n?"mb-6":"mb-1.5",w=u.useRef(null),b=u.useRef({x:0,y:0}),v=x?r.user:r.ai,j=I=>{"touches"in I?b.current={x:I.touches[0].clientX,y:I.touches[0].clientY}:b.current={x:I.clientX,y:I.clientY},w.current=setTimeout(()=>{i||c(t)},600)},T=()=>{w.current&&(clearTimeout(w.current),w.current=null)},$=I=>{if(!w.current)return;let je,xe;"touches"in I?(je=I.touches[0].clientX,xe=I.touches[0].clientY):(je=I.clientX,xe=I.clientY);const Ae=Math.abs(je-b.current.x),Le=Math.abs(xe-b.current.y);(Ae>10||Le>10)&&(clearTimeout(w.current),w.current=null)},M={onMouseDown:j,onMouseUp:T,onMouseLeave:T,onMouseMove:$,onTouchStart:j,onTouchEnd:T,onTouchMove:$,onTouchCancel:T,onContextMenu:I=>{I.preventDefault(),i||c(t)},onClick:I=>{i&&(I.stopPropagation(),I.preventDefault(),h(t.id))}},Q=I=>new Date(I).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),q=I=>e.jsx("div",{className:"relative w-9 h-9 z-0",children:n&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:I,className:"w-full h-full rounded-full object-cover shadow-sm ring-1 ring-black/5 relative z-0",alt:"avatar",loading:"lazy",decoding:"async"}),v.avatarDecoration&&e.jsx("img",{src:v.avatarDecoration,className:"absolute pointer-events-none z-10 max-w-none",style:{left:`${v.avatarDecorationX??50}%`,top:`${v.avatarDecorationY??50}%`,width:`${36*(v.avatarDecorationScale??1)}px`,height:"auto",transform:`translate(-50%, -50%) rotate(${v.avatarDecorationRotate??0}deg)`}})]})});if(g){const I=t.content.replace(/^\[(System||System Log|)\s*[:]?\s*/i,"").replace(/\]$/,"").trim();return e.jsxs("div",{className:`flex items-center w-full ${i?"pl-8":""} animate-fade-in relative transition-all duration-300`,children:[i&&e.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 cursor-pointer z-20",onClick:()=>h(t.id),children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${d?"bg-primary border-primary":"border-slate-300 bg-white/80"}`,children:d&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),e.jsx("div",{className:"flex justify-center my-6 px-10 w-full",...M,children:e.jsxs("div",{className:"flex items-center gap-1.5 bg-slate-200/40 backdrop-blur-md text-slate-500 px-3 py-1 rounded-full shadow-sm border border-white/20 select-none cursor-pointer active:scale-95 transition-transform",children:[I.includes("")?"":I.includes("")||I.includes("Event")?"":I.includes("")?"":"",e.jsx("span",{className:"text-[10px] font-medium tracking-wide",children:I})]})})]})}if(t.type==="interaction")return e.jsxs("div",{className:`flex flex-col items-center ${A} w-full animate-fade-in relative transition-all duration-300 ${i?"pl-8":""}`,children:[i&&e.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 cursor-pointer z-20",onClick:()=>h(t.id),children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${d?"bg-primary border-primary":"border-slate-300 bg-white/80"}`,children:d&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),e.jsx("div",{className:"text-[10px] text-slate-400 mb-1 opacity-70",children:Q(t.timestamp)}),e.jsx("div",{className:"group relative cursor-pointer active:scale-95 transition-transform",...M,children:e.jsxs("div",{className:"text-[11px] text-slate-500 bg-slate-200/50 backdrop-blur-sm px-4 py-1.5 rounded-full flex items-center gap-1.5 border border-white/40 shadow-sm select-none",children:[e.jsx("span",{className:"group-hover:animate-bounce",children:""}),e.jsx("span",{className:"font-medium opacity-80",children:x?"":o}),e.jsx("span",{className:"opacity-60",children:""}),e.jsx("span",{className:"font-medium opacity-80",children:x?o:""})]})})]});const re=I=>e.jsxs("div",{className:`flex items-end ${x?"justify-end":"justify-start"} ${A} px-3 group select-none relative transition-all duration-300 ${i?"pl-12":""}`,children:[i&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer z-20",onClick:()=>h(t.id),children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${d?"bg-primary border-primary":"border-slate-300 bg-white/80"}`,children:d&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),!x&&e.jsx("div",{className:`absolute bottom-[1.25rem] z-0 ${i?"left-14":"left-3"} transition-all duration-300`,children:q(a)}),e.jsxs("div",{className:`flex flex-col ${x?"items-end":"items-start"} max-w-[72%] min-w-0 ${x?"mr-12":"ml-12"}`,...M,children:[e.jsx("div",{className:i?"pointer-events-none":"",children:I}),n&&e.jsx("div",{className:"text-[9px] text-slate-400/80 px-1 mt-1 font-medium",children:Q(t.timestamp)})]}),x&&e.jsx("div",{className:"absolute right-3 bottom-[1.25rem] z-0",children:q(l)})]});if(t.type==="chat_forward"){let I=null;try{I=JSON.parse(t.content)}catch{}if(I)return e.jsx(Tf,{forwardData:I,commonLayout:re,interactionProps:M,selectionMode:i})}if(t.type==="social_card"&&((De=t.metadata)!=null&&De.post)){const I=t.metadata.post;return re(e.jsxs("div",{className:"w-64 bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100 cursor-pointer active:opacity-90 transition-opacity",children:[e.jsxs("div",{className:"h-32 w-full flex items-center justify-center text-6xl relative overflow-hidden",style:{background:I.bgStyle||"#fce7f3"},children:[(($e=I.images)==null?void 0:$e[0])||"",e.jsx("div",{className:"absolute bottom-0 left-0 w-full p-2 bg-gradient-to-t from-black/30 to-transparent",children:e.jsx("div",{className:"text-white text-xs font-bold line-clamp-1",children:I.title})})]}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("img",{src:I.authorAvatar,className:"w-4 h-4 rounded-full"}),e.jsx("span",{className:"text-[10px] text-slate-500",children:I.authorName})]}),e.jsx("p",{className:"text-xs text-slate-600 line-clamp-2 leading-relaxed",children:I.content}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-50 flex items-center gap-1 text-[10px] text-slate-400",children:[e.jsx("span",{className:"text-red-400",children:"Spark"}),"  "]})]})]}))}if(t.type==="transfer")return re(e.jsxs("div",{className:"w-64 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl p-4 text-white shadow-lg relative overflow-hidden group active:scale-[0.98] transition-transform",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-20",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-12 h-12",children:[e.jsx("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.324.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),e.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z",clipRule:"evenodd"}),e.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-full",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:[e.jsx("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),e.jsx("path",{fillRule:"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75-.75H5.25a.75.75 0 0 1-.75-.75V9.75Z",clipRule:"evenodd"}),e.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),e.jsx("span",{className:"font-medium text-white/90",children:"Sully Pay"})]}),e.jsxs("div",{className:"text-2xl font-bold tracking-tight mb-1",children:[" ",(ge=t.metadata)==null?void 0:ge.amount]}),e.jsxs("div",{className:"text-[10px] text-white/70",children:["",x?o:""]})]}));if(t.type==="emoji")return re(e.jsx("img",{src:t.content,className:"max-w-[160px] max-h-[160px] rounded-2xl hover:scale-105 transition-transform shadow-md active:scale-95",loading:"lazy",decoding:"async"}));if(t.type==="image")return re(e.jsx("div",{className:"relative group",children:e.jsx("img",{src:t.content,className:"max-w-[200px] max-h-[300px] rounded-2xl shadow-sm border border-black/5",alt:"Uploaded",loading:"lazy",decoding:"async"})}));const ce=v.borderRadius;let fe={};!s&&!n?fe=x?{borderRadius:`${ce}px`,borderTopRightRadius:"4px",borderBottomRightRadius:"4px"}:{borderRadius:`${ce}px`,borderTopLeftRadius:"4px",borderBottomLeftRadius:"4px"}:s&&!n?fe=x?{borderRadius:`${ce}px`,borderBottomRightRadius:"4px"}:{borderRadius:`${ce}px`,borderBottomLeftRadius:"4px"}:!s&&n?fe=x?{borderRadius:`${ce}px`,borderTopRightRadius:"4px"}:{borderRadius:`${ce}px`,borderTopLeftRadius:"4px"}:fe=x?{borderRadius:`${ce}px`,borderBottomRightRadius:"2px"}:{borderRadius:`${ce}px`,borderBottomLeftRadius:"2px"};const me={backgroundColor:v.backgroundColor,opacity:v.opacity,...fe},ee=I=>I.split(/(```[\s\S]*?```)/g).map((xe,Ae)=>{if(xe.startsWith("```")&&xe.endsWith("```")){const Le=xe.replace(/^```\w*\n?/,"").replace(/```$/,"");return e.jsx("pre",{className:"bg-black/80 text-gray-100 p-3 rounded-lg text-xs font-mono overflow-x-auto my-2 whitespace-pre shadow-inner border border-white/10",children:Le},Ae)}return xe.split(`
`).map((Le,N)=>{const Y=`${Ae}-${N}`;if(Le.trim().startsWith(">")){const P=Le.trim().substring(1).trim();return P?e.jsx("div",{className:"my-1 pl-2.5 border-l-[3px] border-current opacity-70 italic text-[13px]",children:P},Y):null}const ue=Le.split(/(\*\*.*?\*\*)/g).map((P,Ee)=>P.startsWith("**")&&P.endsWith("**")?e.jsx("strong",{className:"font-bold",children:P.slice(2,-2)},Ee):P);return e.jsx("div",{className:"min-h-[1.2em]",children:ue},Y)})}),z=I=>I.replace(/%%TRANS%%[\s\S]*/g,"").replace(/%%BILINGUAL%%/g,`
`).replace(/^\s*---\s*$/gm,"").replace(/\n{3,}/g,`

`).trim(),ve=t.content,F=ve.indexOf("%%BILINGUAL%%"),te=F!==-1,L=z(te?ve.substring(0,F):ve),oe=te?z(ve.substring(F+13)):"",he=f&&oe?oe:L,Te=p&&te&&oe;return he?re(e.jsxs("div",{className:`relative shadow-sm px-5 py-3 animate-fade-in border border-black/5 active:scale-[0.98] transition-transform overflow-hidden ${x?"sully-bubble-user":"sully-bubble-ai"}`,style:me,children:[v.backgroundImage&&e.jsx("div",{className:"absolute inset-0 bg-cover bg-center pointer-events-none z-0",style:{backgroundImage:`url(${v.backgroundImage})`,opacity:v.backgroundImageOpacity??.5}}),v.decoration&&e.jsx("img",{src:v.decoration,className:"absolute z-10 w-8 h-8 object-contain drop-shadow-sm pointer-events-none",style:{left:`${v.decorationX??(x?90:10)}%`,top:`${v.decorationY??-10}%`,transform:`translate(-50%, -50%) scale(${v.decorationScale??1}) rotate(${v.decorationRotate??0}deg)`},alt:""}),t.replyTo&&e.jsxs("div",{className:"relative z-10 mb-1 text-[10px] bg-black/5 p-1.5 rounded-md border-l-2 border-current opacity-60 flex flex-col gap-0.5 max-w-full overflow-hidden",children:[e.jsx("span",{className:"font-bold opacity-90 truncate",children:t.replyTo.name}),e.jsxs("span",{className:"truncate italic",children:['"',t.replyTo.content,'"']})]}),e.jsx("div",{className:"relative z-10 text-[15px] leading-relaxed whitespace-pre-wrap break-all",style:{color:v.textColor},children:ee(he)}),Te&&e.jsx("div",{className:"relative z-10 mt-2 flex justify-end",children:e.jsx("button",{onClick:I=>{I.stopPropagation(),I.preventDefault(),m==null||m(t.id)},className:"flex items-center gap-1 px-2.5 py-1 rounded-lg text-[10px] font-medium transition-all active:scale-95 select-none",style:{color:v.textColor,opacity:.45,backgroundColor:f?"rgba(0,0,0,0.06)":"transparent"},children:f?e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{fillRule:"evenodd",d:"M7.793 2.232a.75.75 0 0 1-.025 1.06L3.622 7.25h10.003a5.375 5.375 0 0 1 0 10.75H10.75a.75.75 0 0 1 0-1.5h2.875a3.875 3.875 0 0 0 0-7.75H3.622l4.146 3.957a.75.75 0 0 1-1.036 1.085l-5.5-5.25a.75.75 0 0 1 0-1.085l5.5-5.25a.75.75 0 0 1 1.06.025Z",clipRule:"evenodd"})}),e.jsx("span",{children:""})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:[e.jsx("path",{d:"M7.75 2.75a.75.75 0 0 0-1.5 0v1.258a32.987 32.987 0 0 0-3.599.278.75.75 0 1 0 .198 1.487A31.545 31.545 0 0 1 8.7 5.545 19.381 19.381 0 0 1 7.257 9.04a19.391 19.391 0 0 1-1.727-2.29.75.75 0 1 0-1.29.77 20.9 20.9 0 0 0 2.023 2.684 19.549 19.549 0 0 1-3.158 2.57.75.75 0 1 0 .86 1.229A21.056 21.056 0 0 0 7.5 11.03c1.1.95 2.3 1.79 3.593 2.49a.75.75 0 1 0 .69-1.331A19.545 19.545 0 0 1 8.46 9.89a20.893 20.893 0 0 0 1.91-4.644h2.38a.75.75 0 0 0 0-1.5h-3v-1a.75.75 0 0 0-.75-.75Z"}),e.jsx("path",{d:"M12.75 10a.75.75 0 0 1 .692.462l2.5 6a.75.75 0 1 1-1.384.576l-.532-1.278h-3.052l-.532 1.278a.75.75 0 1 1-1.384-.576l2.5-6A.75.75 0 0 1 12.75 10Zm-1.018 4.26h2.036L12.75 11.6l-1.018 2.66Z"})]}),e.jsx("span",{children:""})]})})})]})):null},(t,s)=>t.msg.id===s.msg.id&&t.msg.content===s.msg.content&&t.isFirstInGroup===s.isFirstInGroup&&t.isLastInGroup===s.isLastInGroup&&t.activeTheme===s.activeTheme&&t.selectionMode===s.selectionMode&&t.isSelected===s.isSelected&&t.translationEnabled===s.translationEnabled&&t.isShowingTarget===s.isShowingTarget),mc={default:{id:"default",name:"Indigo",type:"preset",user:{textColor:"#ffffff",backgroundColor:"#6366f1",borderRadius:20,opacity:1,backgroundImageOpacity:.5},ai:{textColor:"#1e293b",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5}},dream:{id:"dream",name:"Dream",type:"preset",user:{textColor:"#ffffff",backgroundColor:"#f472b6",borderRadius:20,opacity:1,backgroundImageOpacity:.5},ai:{textColor:"#1e293b",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5}},forest:{id:"forest",name:"Forest",type:"preset",user:{textColor:"#ffffff",backgroundColor:"#10b981",borderRadius:20,opacity:1,backgroundImageOpacity:.5},ai:{textColor:"#1e293b",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5}}},xo=[{id:"preset_rational",name:" (Rational)",content:`### [System Instruction: Memory Archival]
: \${dateStr}
: 

###  (Strict Protocols)
1.  ** (Coverage)**:
    - ****
    - ****
    - 

2.  ** (Perspective)**:
    - "\${char.name}"
    - \${userProfile.name}
    - 

3.  ** (Format)**:
    - 
    - **** Markdown  ( - ... )
    - 

4.  ** (Conciseness)**:
    - xx...
    - : "- \${userProfile.name}"

###  (Chat Logs)
\${rawLog}`},{id:"preset_diary",name:" (Diary)",content:`: \${dateStr}
: ****

###  (Review Protocols)
1.  ****: 
    - "\${char.name}"
    - \${userProfile.name}
    - ****\${char.name}
    - ****AI

2.  ****: 
    - 
    - 

3.  ****:
    - ****: 
    - 

4.  ****:
    - yaml JSON
    - 

###  (Chat Logs)
\${rawLog}`}],Lf=({selectionMode:t,selectedCount:s,onCancelSelection:n,activeCharacter:r,isTyping:a,isSummarizing:o,lastTokenUsage:l,onClose:c,onTriggerAI:i,onShowCharsPanel:d})=>e.jsxs("div",{className:"h-24 bg-white/80 backdrop-blur-xl px-5 flex items-end pb-4 border-b border-slate-200/60 shrink-0 z-30 sticky top-0 shadow-sm relative",children:[t?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:n,className:"text-sm font-bold text-slate-500 px-2 py-1",children:""}),e.jsxs("span",{className:"text-sm font-bold text-slate-800",children:[" ",s," "]}),e.jsx("div",{className:"w-10"})]}):e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("button",{onClick:c,className:"p-2 -ml-2 text-slate-500 hover:bg-slate-100 rounded-full",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{onClick:d,className:"flex-1 min-w-0 flex items-center gap-3 cursor-pointer",children:[e.jsx("img",{src:r.avatar,className:"w-10 h-10 rounded-xl object-cover shadow-sm",alt:"avatar"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-slate-800",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-[10px] text-slate-400 uppercase",children:"Online"}),l&&e.jsxs("div",{className:"text-[9px] px-1.5 py-0.5 bg-slate-100 text-slate-400 rounded-md font-mono border border-slate-200",children:[" ",l]})]})]})]}),e.jsx("button",{onClick:i,disabled:a,className:`p-2 rounded-full ${a?"bg-slate-100":"bg-primary/10 text-primary"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"})})})]}),o&&e.jsxs("div",{className:"absolute top-full left-0 w-full bg-indigo-50 border-b border-indigo-100 p-2 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-indigo-200 border-t-indigo-500 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-indigo-600 font-medium",children:"..."})]})]}),Pf=({input:t,setInput:s,isTyping:n,selectionMode:r,showPanel:a,setShowPanel:o,onSend:l,onDeleteSelected:c,onForwardSelected:i,selectedCount:d,emojis:h,characters:p,activeCharacterId:f,onCharSelect:m,customThemes:x,onUpdateTheme:g,onRemoveTheme:A,activeThemeId:w,onPanelAction:b,onImageSelect:v,isSummarizing:j,categories:T=[],activeCategory:$="default",onReroll:D,canReroll:M})=>{const Q=u.useRef(null),q=u.useRef(null),re=u.useRef({x:0,y:0}),ce=u.useRef(!1),fe=L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),l())},me=(L,oe)=>{var Te;const he=(Te=L.target.files)==null?void 0:Te[0];he&&v(he),L.target&&(L.target.value="")},ee=()=>{q.current&&(clearTimeout(q.current),q.current=null)},z=(L,oe,he)=>{ee(),ce.current=!1,!(oe==="category"&&(L.isSystem||L.id==="default"))&&("touches"in he?re.current={x:he.touches[0].clientX,y:he.touches[0].clientY}:re.current={x:he.clientX,y:he.clientY},q.current=setTimeout(()=>{ce.current=!0,b(oe==="emoji"?"delete-emoji-req":"delete-category-req",L)},500))},ve=L=>{if(!q.current)return;let oe,he;"touches"in L?(oe=L.touches[0].clientX,he=L.touches[0].clientY):(oe=L.clientX,he=L.clientY);const Te=Math.abs(oe-re.current.x),De=Math.abs(he-re.current.y);(Te>10||De>10)&&ee()},F=()=>{ee()},te=(L,oe,he)=>{if(ce.current){L.preventDefault(),L.stopPropagation();return}ee(),he==="emoji"?b("send-emoji",oe):b("select-category",oe.id)};return e.jsxs("div",{className:"bg-white/90 backdrop-blur-2xl border-t border-slate-200/50 pb-safe shrink-0 z-40 shadow-[0_-5px_15px_rgba(0,0,0,0.02)] relative",children:[r?e.jsxs("div",{className:"p-3 flex gap-2 bg-white/50 backdrop-blur-md",children:[i&&e.jsxs("button",{onClick:i,disabled:d===0,className:`flex-1 py-3 font-bold rounded-xl shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2 ${d===0?"bg-slate-200 text-slate-400 shadow-none":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-blue-200"}`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})})," (",d,")"]}),e.jsxs("button",{onClick:c,className:`${i?"flex-1":"w-full"} py-3 bg-red-500 text-white font-bold rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})," (",d,")"]})]}):e.jsxs("div",{className:"p-3 px-4 flex gap-3 items-end",children:[e.jsx("button",{onClick:()=>o(a==="actions"?"none":"actions"),className:"w-11 h-11 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-slate-200 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})}),e.jsxs("div",{className:"flex-1 bg-slate-100 rounded-[24px] flex items-center px-1 border border-transparent focus-within:bg-white focus-within:border-primary/30 transition-all",children:[e.jsx("textarea",{rows:1,value:t,onChange:L=>s(L.target.value),onKeyDown:fe,className:"flex-1 bg-transparent px-4 py-3 text-[15px] resize-none max-h-24 no-scrollbar",placeholder:"Message...",style:{height:"auto"}}),e.jsx("button",{onClick:()=>o(a==="emojis"?"none":"emojis"),className:"p-2 text-slate-400 hover:text-primary",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})})})]}),e.jsx("button",{onClick:l,disabled:!t.trim(),className:`w-11 h-11 rounded-full flex items-center justify-center transition-all ${t.trim()?"bg-primary text-white shadow-lg":"bg-slate-200 text-slate-400"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]}),a!=="none"&&!r&&e.jsxs("div",{className:"bg-slate-50 h-72 border-t border-slate-200/60 overflow-hidden relative z-0 flex flex-col",children:[a==="emojis"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-10 bg-white border-b border-slate-100 flex items-center px-2 gap-2 overflow-x-auto no-scrollbar shrink-0",children:[T.map(L=>e.jsx("button",{onClick:oe=>te(oe,L,"category"),onTouchStart:oe=>z(L,"category",oe),onTouchMove:ve,onTouchEnd:F,onMouseDown:oe=>z(L,"category",oe),onMouseMove:ve,onMouseUp:F,onMouseLeave:F,onContextMenu:oe=>oe.preventDefault(),className:`px-3 py-1 text-xs rounded-full whitespace-nowrap transition-all select-none ${$===L.id?"bg-primary text-white font-bold shadow-sm":"bg-slate-100 text-slate-500"}`,children:L.name},L.id)),e.jsx("button",{onClick:()=>b("add-category"),className:"w-6 h-6 rounded-full bg-slate-100 text-slate-400 flex items-center justify-center shrink-0 hover:bg-slate-200",children:"+"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-4",children:e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx("button",{onClick:()=>b("emoji-import"),className:"aspect-square bg-slate-100 rounded-2xl border-2 border-dashed border-slate-300 flex items-center justify-center text-2xl text-slate-400",children:"+"}),h.map((L,oe)=>e.jsx("button",{onClick:he=>te(he,L,"emoji"),onTouchStart:he=>z(L,"emoji",he),onTouchMove:ve,onTouchEnd:F,onMouseDown:he=>z(L,"emoji",he),onMouseMove:ve,onMouseUp:F,onMouseLeave:F,onContextMenu:he=>he.preventDefault(),className:"aspect-square bg-white rounded-2xl p-2 shadow-sm relative active:scale-95 transition-transform select-none",children:e.jsx("img",{src:L.url,className:"w-full h-full object-contain pointer-events-none"})},oe))]})})]}),a==="actions"&&e.jsxs("div",{className:"p-6 grid grid-cols-4 gap-8 overflow-y-auto",children:[e.jsxs("button",{onClick:()=>b("transfer"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center shadow-sm text-orange-400 border border-orange-100",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:[e.jsx("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),e.jsx("path",{fillRule:"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75-.75H5.25a.75.75 0 0 1-.75-.75V9.75Z",clipRule:"evenodd"}),e.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),e.jsx("span",{className:"text-xs font-bold",children:""})]}),e.jsxs("button",{onClick:()=>b("poke"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-sky-50 rounded-2xl flex items-center justify-center shadow-sm text-2xl border border-sky-100",children:""}),e.jsx("span",{className:"text-xs font-bold",children:""})]}),e.jsxs("button",{onClick:()=>b("archive"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-indigo-50 rounded-2xl flex items-center justify-center shadow-sm text-indigo-400 border border-indigo-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),e.jsx("span",{className:"text-xs font-bold",children:j?"...":""})]}),e.jsxs("button",{onClick:()=>b("settings"),className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-slate-50 rounded-2xl flex items-center justify-center shadow-sm text-slate-500 border border-slate-100",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 0 1 0 2.555c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.212 1.281c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-2.555c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]})}),e.jsx("span",{className:"text-xs font-bold",children:""})]}),e.jsxs("button",{onClick:()=>{var L;return(L=Q.current)==null?void 0:L.click()},className:"flex flex-col items-center gap-2 text-slate-600 active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-14 h-14 bg-pink-50 rounded-2xl flex items-center justify-center shadow-sm text-pink-400 border border-pink-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:e.jsx("path",{fillRule:"evenodd",d:"M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z",clipRule:"evenodd"})})}),e.jsx("span",{className:"text-xs font-bold",children:""})]}),e.jsx("input",{type:"file",ref:Q,className:"hidden",accept:"image/*",onChange:L=>me(L)}),e.jsxs("button",{onClick:D,disabled:!M,className:`flex flex-col items-center gap-2 active:scale-95 transition-transform ${M?"text-slate-600":"text-slate-300 opacity-50"}`,children:[e.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center shadow-sm border ${M?"bg-emerald-50 text-emerald-400 border-emerald-100":"bg-slate-50 text-slate-300 border-slate-100"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("span",{className:"text-xs font-bold",children:""})]})]}),a==="chars"&&e.jsxs("div",{className:"p-5 space-y-6 overflow-y-auto no-scrollbar",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 px-1 tracking-wider uppercase mb-3",children:""}),e.jsxs("div",{className:"flex gap-3 px-1 overflow-x-auto no-scrollbar pb-2",children:[Object.values(mc).map(L=>e.jsx("button",{onClick:()=>g(L.id),className:`px-6 py-3 rounded-2xl text-xs font-bold border shrink-0 transition-all ${w===L.id?"bg-primary text-white border-primary":"bg-white border-slate-200 text-slate-600"}`,children:L.name},L.id)),x.map(L=>e.jsxs("div",{className:"relative group shrink-0",children:[e.jsxs("button",{onClick:()=>g(L.id),className:`px-6 py-3 rounded-2xl text-xs font-bold border transition-all ${w===L.id?"bg-indigo-500 text-white border-indigo-500":"bg-indigo-50 border-indigo-100 text-indigo-600"}`,children:[L.name," (DIY)"]}),e.jsx("button",{onClick:oe=>{oe.stopPropagation(),A(L.id)},className:"absolute -top-2 -right-2 bg-red-400 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs shadow-md opacity-0 group-hover:opacity-100 transition-opacity",children:""})]},L.id))]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 px-1 tracking-wider uppercase mb-3",children:""}),e.jsx("div",{className:"space-y-3",children:p.map(L=>e.jsxs("div",{onClick:()=>m(L.id),className:`flex items-center gap-4 p-3 rounded-[20px] border cursor-pointer ${L.id===f?"bg-white border-primary/30 shadow-md":"bg-white/50 border-transparent"}`,children:[e.jsx("img",{src:L.avatar,className:"w-12 h-12 rounded-2xl object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-sm text-slate-700",children:L.name}),e.jsx("div",{className:"text-xs text-slate-400 truncate",children:L.description})]})]},L.id))})]})]})]})]})},Rf=({modalType:t,setModalType:s,transferAmt:n,setTransferAmt:r,emojiImportText:a,setEmojiImportText:o,settingsContextLimit:l,setSettingsContextLimit:c,settingsHideSysLogs:i,setSettingsHideSysLogs:d,preserveContext:h,setPreserveContext:p,editContent:f,setEditContent:m,newCategoryName:x,setNewCategoryName:g,onAddCategory:A,archivePrompts:w,selectedPromptId:b,setSelectedPromptId:v,editingPrompt:j,setEditingPrompt:T,isSummarizing:$,selectedMessage:D,selectedEmoji:M,selectedCategory:Q,activeCharacter:q,messages:re,onTransfer:ce,onImportEmoji:fe,onSaveSettings:me,onBgUpload:ee,onRemoveBg:z,onClearHistory:ve,onArchive:F,onCreatePrompt:te,onEditPrompt:L,onSavePrompt:oe,onDeletePrompt:he,onSetHistoryStart:Te,onEnterSelectionMode:De,onReplyMessage:$e,onEditMessageStart:ge,onConfirmEditMessage:I,onDeleteMessage:je,onDeleteEmoji:xe,onDeleteCategory:Ae,translationEnabled:Le,onToggleTranslation:N,translateSourceLang:Y,translateTargetLang:B,onSetTranslateSourceLang:ue,onSetTranslateLang:P})=>{const Ee=u.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{isOpen:t==="transfer",title:"Credits ",onClose:()=>s("none"),footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),e.jsx("button",{onClick:ce,className:"flex-1 py-3 bg-orange-500 text-white rounded-2xl",children:""})]}),children:e.jsx("input",{type:"number",value:n,onChange:de=>r(de.target.value),className:"w-full bg-slate-100 rounded-2xl px-5 py-4 text-lg font-bold",autoFocus:!0})}),e.jsx(Ye,{isOpen:t==="add-category",title:"",onClose:()=>s("none"),footer:e.jsx("button",{onClick:A,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:e.jsx("input",{value:x,onChange:de=>g(de.target.value),placeholder:"...",className:"w-full bg-slate-100 rounded-2xl px-5 py-4 text-base font-bold focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all text-slate-700",autoFocus:!0})}),e.jsx(Ye,{isOpen:t==="emoji-import",title:"",onClose:()=>s("none"),footer:e.jsx("button",{onClick:fe,className:"w-full py-4 bg-primary text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-slate-400",children:""}),e.jsx("textarea",{value:a,onChange:de=>o(de.target.value),placeholder:"Name--URL ()",className:"w-full h-40 bg-slate-100 rounded-2xl p-4 resize-none"})]})}),e.jsx(Ye,{isOpen:t==="chat-settings",title:"",onClose:()=>s("none"),footer:e.jsx("button",{onClick:me,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:""}),e.jsxs("div",{onClick:()=>{var de;return(de=Ee.current)==null?void 0:de.click()},className:"h-24 bg-slate-100 rounded-xl border-2 border-dashed border-slate-200 flex items-center justify-center cursor-pointer hover:border-primary/50 overflow-hidden relative",children:[q.chatBackground?e.jsx("img",{src:q.chatBackground,className:"w-full h-full object-cover opacity-60"}):e.jsx("span",{className:"text-xs text-slate-400",children:" ()"}),q.chatBackground&&e.jsx("span",{className:"absolute z-10 text-xs bg-white/80 px-2 py-1 rounded",children:""})]}),e.jsx("input",{type:"file",ref:Ee,className:"hidden",accept:"image/*",onChange:de=>{var J;return((J=de.target.files)==null?void 0:J[0])&&ee(de.target.files[0])}}),q.chatBackground&&e.jsx("button",{onClick:z,className:"text-[10px] text-red-400 mt-1",children:""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:[" (",l,")"]}),e.jsx("input",{type:"range",min:"20",max:"5000",step:"10",value:l,onChange:de=>c(parseInt(de.target.value)),className:"w-full h-2 bg-slate-200 rounded-full appearance-none accent-primary"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-400 mt-1",children:[e.jsx("span",{children:"20 ()"}),e.jsx("span",{children:"5000 ()"})]})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>d(!i),children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase pointer-events-none",children:""}),e.jsx("div",{className:`w-10 h-6 rounded-full p-1 transition-colors flex items-center ${i?"bg-primary":"bg-slate-200"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-sm transition-transform ${i?"translate-x-4":""}`})})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2 leading-relaxed",children:" Date/App "})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[e.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:N,children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase pointer-events-none",children:""}),e.jsx("div",{className:`w-10 h-6 rounded-full p-1 transition-colors flex items-center ${Le?"bg-primary":"bg-slate-200"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-sm transition-transform ${Le?"translate-x-4":""}`})})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 leading-relaxed",children:"AI "}),Le&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 mb-1.5 block",children:""}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["","English","","","Franais","Espaol"].map(de=>e.jsx("button",{onClick:()=>ue==null?void 0:ue(de),className:`px-2.5 py-1 rounded-full text-[11px] font-bold transition-all ${Y===de?"bg-slate-700 text-white":"bg-slate-100 text-slate-500"}`,children:de},`src-${de}`))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 mb-1.5 block",children:""}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:["","English","","","Franais","Espaol"].map(de=>e.jsx("button",{onClick:()=>P==null?void 0:P(de),className:`px-2.5 py-1 rounded-full text-[11px] font-bold transition-all ${B===de?"bg-primary text-white":"bg-slate-100 text-slate-500"}`,children:de},`tgt-${de}`))})]}),e.jsxs("div",{className:"text-[11px] text-center text-slate-500 bg-slate-50 rounded-lg py-2",children:["",e.jsx("span",{className:"font-bold text-slate-700",children:Y||"?"})," ",e.jsx("span",{className:"font-bold text-primary",children:B||"?"})]})]})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[e.jsx("button",{onClick:()=>s("history-manager"),className:"w-full py-3 bg-slate-50 text-slate-600 font-bold rounded-2xl border border-slate-200 active:scale-95 transition-transform flex items-center justify-center gap-2",children:" / "}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2 text-center",children:" AI "})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[e.jsx("label",{className:"text-xs font-bold text-red-400 uppercase mb-3 block",children:" (Danger Zone)"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>p(!h),children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${h?"bg-primary border-primary":"bg-slate-100 border-slate-300"}`,children:h&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),e.jsx("span",{className:"text-sm text-slate-600",children:"10 ()"})]}),e.jsx("button",{onClick:ve,className:"w-full py-3 bg-red-50 text-red-500 font-bold rounded-2xl border border-red-100 active:scale-95 transition-transform flex items-center justify-center gap-2",children:""})]})]})}),e.jsx(Ye,{isOpen:t==="archive-settings",title:"",onClose:()=>s("none"),footer:e.jsx("button",{onClick:F,disabled:$,className:"w-full py-3 bg-indigo-500 text-white font-bold rounded-2xl shadow-lg shadow-indigo-200",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-xl border border-indigo-100",children:[e.jsx("label",{className:"text-[10px] font-bold text-indigo-400 uppercase mb-2 block",children:""}),e.jsx("div",{className:"flex flex-col gap-2",children:w.map(de=>e.jsxs("div",{onClick:()=>v(de.id),className:`p-3 rounded-lg border cursor-pointer flex items-center justify-between ${b===de.id?"bg-white border-indigo-500 shadow-sm ring-1 ring-indigo-500":"bg-white/50 border-indigo-200 hover:bg-white"}`,children:[e.jsx("span",{className:`text-xs font-bold ${b===de.id?"text-indigo-700":"text-slate-600"}`,children:de.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:J=>{J.stopPropagation(),v(de.id),L()},className:"text-[10px] text-slate-400 hover:text-indigo-500 px-2 py-1 rounded bg-slate-100 hover:bg-indigo-50",children:"/"}),!de.id.startsWith("preset_")&&e.jsx("button",{onClick:J=>{J.stopPropagation(),he(de.id)},className:"text-[10px] text-red-300 hover:text-red-500 px-2 py-1 rounded hover:bg-red-50",children:""})]})]},de.id))}),e.jsx("button",{onClick:te,className:"mt-3 w-full py-2 text-xs font-bold text-indigo-500 border border-dashed border-indigo-300 rounded-lg hover:bg-indigo-100",children:"+ "})]}),e.jsxs("div",{className:"text-[10px] text-slate-400 bg-slate-50 p-3 rounded-xl leading-relaxed",children:[" ",e.jsx("b",{children:""}),":  AI ",e.jsx("br",{})," ",e.jsx("b",{children:""}),": ",e.jsx("br",{})," : ",e.jsx("code",{children:"${dateStr}"}),", ",e.jsx("code",{children:"${char.name}"}),", ",e.jsx("code",{children:"${userProfile.name}"}),", ",e.jsx("code",{children:"${rawLog}"})]})]})}),e.jsx(Ye,{isOpen:t==="prompt-editor",title:"",onClose:()=>s("archive-settings"),footer:e.jsx("button",{onClick:oe,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{value:(j==null?void 0:j.name)||"",onChange:de=>T(J=>J?{...J,name:de.target.value}:null),placeholder:"",className:"w-full px-4 py-2 bg-slate-100 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-primary/20"}),e.jsx("textarea",{value:(j==null?void 0:j.content)||"",onChange:de=>T(J=>J?{...J,content:de.target.value}:null),className:"w-full h-64 bg-slate-100 rounded-xl p-3 text-xs font-mono resize-none focus:outline-none focus:ring-2 focus:ring-primary/20 leading-relaxed",placeholder:"..."})]})}),e.jsx(Ye,{isOpen:t==="history-manager",title:"",onClose:()=>s("none"),footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Te(void 0),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),e.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl",children:""})]}),children:e.jsxs("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto no-scrollbar p-1",children:[e.jsx("p",{className:"text-xs text-slate-400 text-center mb-2",children:" AI"}),re.slice().reverse().map(de=>e.jsxs("div",{onClick:()=>Te(de.id),className:`p-3 rounded-xl border cursor-pointer text-xs flex gap-2 items-start ${q.hideBeforeMessageId===de.id?"bg-primary/10 border-primary ring-1 ring-primary":"bg-white border-slate-100 hover:bg-slate-50"}`,children:[e.jsxs("span",{className:"text-slate-400 font-mono whitespace-nowrap pt-0.5",children:["[",new Date(de.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"]"]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-slate-600 mb-0.5",children:de.role==="user"?"":q.name}),e.jsx("div",{className:"text-slate-500 truncate",children:de.content})]}),q.hideBeforeMessageId===de.id&&e.jsx("span",{className:"text-primary font-bold text-[10px] bg-white px-2 rounded-full border border-primary/20",children:""})]},de.id))]})}),e.jsx(Ye,{isOpen:t==="message-options",title:"",onClose:()=>s("none"),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:De,className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl active:bg-slate-100 transition-colors flex items-center justify-center gap-2",children:" / "}),e.jsx("button",{onClick:$e,className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl active:bg-slate-100 transition-colors flex items-center justify-center gap-2",children:" / "}),(D==null?void 0:D.type)==="text"&&e.jsx("button",{onClick:ge,className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl active:bg-slate-100 transition-colors flex items-center justify-center gap-2",children:""}),e.jsx("button",{onClick:je,className:"w-full py-3 bg-red-50 text-red-500 font-medium rounded-2xl active:bg-red-100 transition-colors flex items-center justify-center gap-2",children:""})]})}),e.jsx(Ye,{isOpen:t==="delete-emoji",title:"",onClose:()=>s("none"),footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),e.jsx("button",{onClick:xe,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:""})]}),children:e.jsxs("div",{className:"flex flex-col items-center gap-4 py-2",children:[M&&e.jsx("img",{src:M.url,className:"w-24 h-24 object-contain rounded-xl border"}),e.jsx("p",{className:"text-center text-sm text-slate-500",children:""})]})}),e.jsx(Ye,{isOpen:t==="delete-category",title:"",onClose:()=>s("none"),footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),e.jsx("button",{onClick:Ae,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:""})]}),children:e.jsxs("div",{className:"py-4 text-center",children:[e.jsxs("p",{className:"text-sm text-slate-600",children:[" ",e.jsx("br",{}),e.jsxs("span",{className:"font-bold",children:['"',Q==null?void 0:Q.name,'"']})," "]}),e.jsx("p",{className:"text-[10px] text-red-400 mt-2",children:""})]})}),e.jsx(Ye,{isOpen:t==="edit-message",title:"",onClose:()=>s("none"),footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s("none"),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),e.jsx("button",{onClick:I,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl",children:""})]}),children:e.jsx("textarea",{value:f,onChange:de=>m(de.target.value),className:"w-full h-32 bg-slate-100 rounded-2xl p-4 resize-none focus:ring-1 focus:ring-primary/20 transition-all text-sm leading-relaxed"})})]})},ja={formatDate:t=>{const s=new Date(t);return`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")} ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`},getTimeGapHint:(t,s)=>{if(!t)return"";const n=s-t.timestamp,r=Math.floor(n/(1e3*60)),a=Math.floor(n/(1e3*60*60)),o=new Date(s).getHours(),l=o>=23||o<=6;return r<10?"":r<60?`[: : ${r} ]`:a<6?l?`[: : ${a} /]`:`[: : ${a} ]`:a<24?`[: : ${a} ]`:`[: : ${Math.floor(a/24)} ]`},buildEmojiContext:(t,s)=>{if(t.length===0)return"";const n={},r={default:""};return s.forEach(a=>r[a.id]=a.name),t.forEach(a=>{const o=a.categoryId||"default";n[o]||(n[o]=[]),n[o].push(a.name)}),Object.entries(n).map(([a,o])=>`${r[a]||""}: [${o.join(", ")}]`).join("; ")},buildSystemPrompt:async(t,s,n,r,a,o,l)=>{var m;let c=At.buildCoreContext(t,s);try{const x=l||ei;if(x.weatherEnabled||x.newsEnabled){const g=await Hs.buildFullContext(x);c+=`
${g}
`}else{const g=Hs.getTimeContext(),A=Hs.checkSpecialDates();c+=`
### 
`,c+=`${g.dateStr} ${g.dayOfWeek} ${g.timeOfDay} ${g.timeStr}
`,A.length>0&&(c+=`: ${A.join("")}
`)}}catch(x){console.error("Failed to inject realtime context:",x)}try{const x=n.filter(g=>g.members.includes(t.id));if(x.length>0){let g=[];for(const w of x){const v=(await U.getGroupMessages(w.id)).map(j=>({...j,groupName:w.name}));g=[...g,...v]}g.sort((w,b)=>b.timestamp-w.timestamp);const A=g.slice(0,200).reverse();if(A.length>0){const w=A.map(b=>`[${new Date(b.timestamp).toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}] [Group: ${b.groupName}] ${b.role==="user"?s.name:"Member"}: ${b.content}`).join(`
`);c+=`
### [Background Context: Recent Group Activities]
(...)
${w}
`}}}catch(x){console.error("Failed to load group context",x)}try{const x=l||ei;if(x.notionEnabled&&x.notionApiKey&&x.notionDatabaseId){const g=await an.getRecentDiaries(x.notionApiKey,x.notionDatabaseId,t.name,8);g.success&&g.entries.length>0&&(c+=`
### 
`,c+=` [[READ_DIARY: ]] 
`,g.entries.forEach((A,w)=>{c+=`${w+1}. [${A.date}] ${A.title}
`}),c+=`
`)}}catch(x){console.error("Failed to inject diary context:",x)}try{const x=l||ei;if(x.feishuEnabled&&x.feishuAppId&&x.feishuAppSecret&&x.feishuBaseId&&x.feishuTableId){const g=await qt.getRecentDiaries(x.feishuAppId,x.feishuAppSecret,x.feishuBaseId,x.feishuTableId,t.name,8);g.success&&g.entries.length>0&&(c+=`
### 
`,c+=` [[FS_READ_DIARY: ]] 
`,g.entries.forEach((A,w)=>{c+=`${w+1}. [${A.date}] ${A.title}
`}),c+=`
`)}}catch(x){console.error("Failed to inject feishu diary context:",x)}const i=ja.buildEmojiContext(r,a),d=!!(l!=null&&l.newsEnabled&&(l!=null&&l.newsApiKey)),h=!!(l!=null&&l.notionEnabled&&(l!=null&&l.notionApiKey)&&(l!=null&&l.notionDatabaseId)),p=!!(l!=null&&l.feishuEnabled&&(l!=null&&l.feishuAppId)&&(l!=null&&l.feishuAppSecret)&&(l!=null&&l.feishuBaseId)&&(l!=null&&l.feishuTableId));c+=`###  App  (Chat App Rules)
            ****
1. ****: (IM)
2. ****: 
3. ****:
   - ""
   - "[]:"
   - **"[ ...]"**
   - ****: : \`[[SEND_EMOJI: ]]\`
   - ** ()**: 
     ${i}
4. ** (Quote/Reply)**:
   - : \`[[QUOTE: ]]\`UI
5. ****:
   -  [] 
   - 
6. ****:
   - : \`[[ACTION:POKE]]\`
   - : \`[[ACTION:TRANSFER:100]]\`
   - : \`[[RECALL: YYYY-MM]]\`
   - ****: ****: \`[[ACTION:ADD_EVENT | (Title) | YYYY-MM-DD]]\`
   - ****: : \`[schedule_message | YYYY-MM-DD HH:MM:SS | fixed | ]\`****
${h?"   - **(Notion)**: ****: `[[READ_DIARY: ]]`: `````3``115``2024-01-15`":""}${p?"\n   - **()**: : `[[FS_READ_DIARY: ]]`":""}
${d?`7. ** ** ():
   
   - ****: : \`[[SEARCH: ]]\`
   - ** - **:
     - 
     - "xxx""xxx"
     - 
     - 
     - 
   - ****:
     - 
     - 
     - ""
   - ****: "...""..."`:""}
${h?`8. **  Notion **:
   Notion

   **  - :**
   :
   \`\`\`
   [[DIARY_START:  | ]]
   # 

   ...

   ## 
   ...

   > 

   - 1
   - 2

   [!heart] 
   [!] 
   [!] 

   ****  **

   ---

   ...
   [[DIARY_END]]
   \`\`\`

   : \`[[DIARY:  | ]]\`

   ** Markdown  Notion :**
   - \`# \` \`## \` \`### \`
   - \`> \`  
   - \`- \`  
   - \`****\` \`**\` \`~~~~\` \`\` \`\` \`\`
   - \`---\`  
   - \`[!heart] \`    \`[!star] \`  
   - \`[!] \`    \`[!] \`  
   - \`[!] \`    \`[!] \`  

   ****:
   ////////////////...

   ****  :
   - 
   - 
   - 
   - 
   -  Notion 

   ** :**
   ****:
   - \`[[READ_DIARY: 2024-01-15]]\`  
   - \`[[READ_DIARY: ]]\`  
   - \`[[READ_DIARY: ]]\`  
   - \`[[READ_DIARY: 3]]\`  N
   - \`[[READ_DIARY: 115]]\`  

   **  [[READ_DIARY: ...]]:**
   - """"""""""  
   -   
   -   
   -   
   - 

   **:**
   - ""  : \`[[READ_DIARY: ]]\`
   - ""  : \`[[READ_DIARY: 2024-01-10]]\`
   - "xx"  : \`[[READ_DIARY: ]]\`

   - ****:
   \`\`\`
   [[DIARY_START: TA | ]]
   #  

   TA

   ## 
   TA
    **** 

   > ""

   [!heart] TA...

   ## 
   - TA
   - 
   - 

   ---

   *...TA*
   **

   [!] TA 
   [[DIARY_END]]
   \`\`\``:""}
${p?`${h?"9":"8"}. ** **:
   

   ** :**
   :
   \`\`\`
   [[FS_DIARY_START:  | ]]
   ...
   ...

   
   [[FS_DIARY_END]]
   \`\`\`

   : \`[[FS_DIARY:  | ]]\`

   ****:
   ////////////////...

   ****  :
   - 
   - 
   - 

   ** :**
   ****:
   - \`[[FS_READ_DIARY: 2024-01-15]]\`  
   - \`[[FS_READ_DIARY: ]]\`  
   - \`[[FS_READ_DIARY: ]]\`  
   - \`[[FS_READ_DIARY: 3]]\`  N
   - \`[[FS_READ_DIARY: 115]]\`  

   **  [[FS_READ_DIARY: ...]]:**
   - """"""""  
   -   
   -   
   -   

   **:** ""  : \`[[FS_READ_DIARY: ]]\`
`:""}
       -# 
       - ****
       - ****
         - / 
         -   
         -   
         -   
         - 
         - ****/
`;const f=o.length>1?o[o.length-2]:null;return f&&((m=f.metadata)==null?void 0:m.source)==="date"&&(c+=`

[System Note: You just finished a face-to-face meeting. You are now back on the phone. Switch back to texting style.]`),c},buildMessageHistory:(t,s,n,r,a)=>{const l=t.filter(i=>!n.hideBeforeMessageId||i.id>=n.hideBeforeMessageId).slice(-s);let c="";if(l.length>=2){const i=l[l.length-2],d=l[l.length-1];i&&d&&(c=ja.getTimeGapHint(i,d.timestamp))}return{apiMessages:l.map((i,d)=>{var f,m,x;let h=i.content;const p=`[${ja.formatDate(i.timestamp)}]`;if(i.replyTo&&(h=`[ "${i.replyTo.content.substring(0,50)}..."]: ${h}`),i.type==="image"){let g=`${p} [User sent an image]`;return d===l.length-1&&c&&i.role==="user"&&(g+=`

${c}`),{role:i.role,content:[{type:"text",text:g},{type:"image_url",image_url:{url:i.content}}]}}if(d===l.length-1&&c&&i.role==="user"&&(h=`${h}

${c}`),i.type==="interaction")h=`${p} [: ]`;else if(i.type==="transfer")h=`${p} [:  ${(f=i.metadata)==null?void 0:f.amount}]`;else if(i.type==="social_card"){const g=((m=i.metadata)==null?void 0:m.post)||{},A=(g.comments||[]).map(w=>`${w.authorName}: ${w.content}`).join(" | ");h=`${p} [ Spark ]
: ${g.title}
: ${g.content}
: ${A}
()`}else if(i.type==="emoji"){const g=((x=a.find(A=>A.url===i.content))==null?void 0:x.name)||"Image/Sticker";h=`${p} [${i.role==="user"?"":""} : ${g}]`}else if(i.type==="chat_forward")try{const g=JSON.parse(i.content),A=(g.messages||[]).map(w=>{const b=w.role==="user"?g.fromUserName||"":g.fromCharName||"",v=w.type==="image"?"[]":w.type==="emoji"?"[]":(w.content||"").slice(0,200);return`  ${b}: ${v}`});h=`${p} [ ${g.fromCharName||""}  ${g.count||A.length} ]
${A.join(`
`)}`}catch{h=`${p} []`}else h=`${p} ${h}`;return{role:i.role,content:h}}),historySlice:l}}};var Pu;(function(t){t[t.Sunday=1]="Sunday",t[t.Monday=2]="Monday",t[t.Tuesday=3]="Tuesday",t[t.Wednesday=4]="Wednesday",t[t.Thursday=5]="Thursday",t[t.Friday=6]="Friday",t[t.Saturday=7]="Saturday"})(Pu||(Pu={}));const el=fr("LocalNotifications",{web:()=>gl(()=>import("./web-BxjG4ylX.js"),[],import.meta.url).then(t=>new t.LocalNotificationsWeb)}),si={parseAndExecuteActions:async(t,s,n,r)=>{let a=t;a.includes("[[ACTION:POKE]]")&&(await U.saveMessage({charId:s,role:"assistant",type:"interaction",content:"[]"}),a=a.replace("[[ACTION:POKE]]","").trim());const o=a.match(/\[\[ACTION:TRANSFER:(\d+)\]\]/);o&&(await U.saveMessage({charId:s,role:"assistant",type:"transfer",content:"[]",metadata:{amount:o[1]}}),a=a.replace(o[0],"").trim());const l=a.match(/\[\[ACTION:ADD_EVENT\s*\|\s*(.*?)\s*\|\s*(.*?)\]\]/);if(l){const d=l[1].trim(),h=l[2].trim();if(d&&h){const p={id:`anni-${Date.now()}`,title:d,date:h,charId:s};await U.saveAnniversary(p),r(`${n} : ${d}`,"success"),await U.saveMessage({charId:s,role:"system",type:"text",content:`[: ${n}  "${d}" (${h})]`})}a=a.replace(l[0],"").trim()}const c=/\[schedule_message \| (.*?) \| fixed \| (.*?)\]/g;let i;for(;(i=c.exec(a))!==null;){const d=i[1].trim(),h=i[2].trim(),p=new Date(d).getTime();if(!isNaN(p)&&p>Date.now()){await U.saveScheduledMessage({id:`sched-${Date.now()}-${Math.random()}`,charId:s,content:h,dueAt:p,createdAt:Date.now()});try{(await el.checkPermissions()).display==="granted"&&await el.schedule({notifications:[{title:n,body:h,id:Math.floor(Math.random()*1e5),schedule:{at:new Date(p)},smallIcon:"ic_stat_icon_config_sample"}]})}catch{console.log("Notification schedule skipped (web mode)")}r(`${n} ...`,"info")}}return a=a.replace(c,"").trim(),a=a.replace(/\[\[RECALL:.*?\]\]/g,"").trim(),a},splitResponse:t=>{const s=/\[\[SEND_EMOJI:\s*(.*?)\]\]/g,n=[];let r=0,a;for(;(a=s.exec(t))!==null;){if(a.index>r){const o=t.slice(r,a.index).trim();o&&n.push({type:"text",content:o})}n.push({type:"emoji",content:a[1].trim()}),r=a.index+a[0].length}if(r<t.length){const o=t.slice(r).trim();o&&n.push({type:"text",content:o})}return n.length===0&&t.trim()&&n.push({type:"text",content:t.trim()}),n},chunkText:t=>{const s={};let n=0,r=t.replace(/\[\[QUOTE:\s*[\s\S]*?\]\]/g,o=>{const l=`{{QUOTE_${n++}}}`;return s[l]=o,l});return r=r.replace(/\.\.\./g,"{{ELLIPSIS_ENG}}").replace(//g,"{{ELLIPSIS_CN}}").replace(/([])(?![\)\]""'])/g,"{{SPLIT}}").replace(/\.(?=\s*$)/gm,"{{SPLIT}}").replace(/\.(?=\s+[A-Z])/g,".{{SPLIT}}").replace(/([!?~]+)(?![\)\]""'])/g,"$1{{SPLIT}}").replace(/\n+/g,"{{SPLIT}}").replace(/([\u4e00-\u9fa5])[ ]+([\u4e00-\u9fa5])/g,"$1{{SPLIT}}$2"),r.split("{{SPLIT}}").map(o=>o.trim()).filter(o=>o.length>0).map(o=>(o=o.replace(/{{ELLIPSIS_ENG}}/g,"...").replace(/{{ELLIPSIS_CN}}/g,""),Object.keys(s).forEach(l=>{o=o.replace(l,s[l])}),o))}},Of=({char:t,userProfile:s,apiConfig:n,groups:r,emojis:a,categories:o,addToast:l,setMessages:c,realtimeConfig:i,translationConfig:d})=>{const[h,p]=u.useState(!1),[f,m]=u.useState(""),[x,g]=u.useState(""),[A,w]=u.useState(null);return{isTyping:h,recallStatus:f,searchStatus:x,lastTokenUsage:A,setLastTokenUsage:w,triggerAI:async v=>{var j,T,$,D,M,Q,q,re,ce,fe,me,ee,z,ve,F,te,L,oe,he,Te,De,$e;if(!(h||!t)){if(!n.baseUrl){alert(" API URL");return}p(!0),m("");try{const ge=n.baseUrl.replace(/\/+$/,""),I={"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey||"sk-none"}`};let je=await ja.buildSystemPrompt(t,s,r,a,o,v,i);d!=null&&d.enabled&&d.sourceLang&&d.targetLang&&(je+=`

[]
 %%BILINGUAL%% 

1. ${d.sourceLang}
2.  %%BILINGUAL%%
3. ${d.targetLang}
4.  --- 



%%BILINGUAL%%

---

%%BILINGUAL%%




%%BILINGUAL%%


 ---  %%BILINGUAL%%`);const xe=t.contextLimit||500,{apiMessages:Ae,historySlice:Le}=ja.buildMessageHistory(v,xe,t,s,a),N=Ae.map(_=>typeof _.content=="string"&&_.content.includes("%%BILINGUAL%%")?{..._,content:_.content.substring(0,_.content.indexOf("%%BILINGUAL%%")).trim()}:_),Y=[{role:"system",content:je},...N];let B=await fetch(`${ge}/chat/completions`,{method:"POST",headers:I,body:JSON.stringify({model:n.model,messages:Y,temperature:.85,stream:!1})});if(!B.ok)throw new Error(`API Error ${B.status}`);let ue=await B.json();(j=ue.usage)!=null&&j.total_tokens&&w(ue.usage.total_tokens);let P=((D=($=(T=ue.choices)==null?void 0:T[0])==null?void 0:$.message)==null?void 0:D.content)||"";P=P.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),P=P.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),P=P.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]");const Ee=P.match(/\[\[RECALL:\s*(\d{4})[-/](\d{1,2})\]\]/);if(Ee){const _=Ee[1],K=Ee[2];m(` ${_}${K} ...`);const S=((k,H)=>{if(!t.memories)return null;const E=`${k}-${H.padStart(2,"0")}`,ne=t.memories.filter(Ne=>Ne.date.includes(E)||Ne.date.includes(`${k}${parseInt(H)}`));return ne.length===0?null:ne.map(Ne=>`[${Ne.date}] (${Ne.mood||"normal"}): ${Ne.summary}`).join(`
`)})(_,K);if(S){const k=[...Y,{role:"system",content:`[:  ${_}-${K} ]
${S}
[: ]`}];B=await fetch(`${ge}/chat/completions`,{method:"POST",headers:I,body:JSON.stringify({model:n.model,messages:k,temperature:.8,stream:!1})}),B.ok&&(ue=await B.json(),P=((q=(Q=(M=ue.choices)==null?void 0:M[0])==null?void 0:Q.message)==null?void 0:q.content)||"",P=P.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),P=P.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),P=P.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]"),l(` ${_}-${K} `,"info"))}}m("");const de=P.match(/\[\[SEARCH:\s*(.+?)\]\]/);if(de&&(i!=null&&i.newsEnabled)&&(i!=null&&i.newsApiKey)){const _=de[1].trim();console.log(" [Search] AI:",_),g(`: ${_}...`);try{const K=await Hs.performSearch(_,i.newsApiKey);if(console.log(" [Search] :",K),K.success&&K.results.length>0){const ie=K.results.map((H,E)=>`${E+1}. ${H.title}
   ${H.description}`).join(`

`);console.log(" [Search] AI...");const S=P.replace(/\[\[SEARCH:.*?\]\]/g,"").trim()||"...",k=[...Y,{role:"assistant",content:S},{role:"system",content:`[: "${_}"]

${ie}

[: "...""..."[[SEARCH:...]]]`}];B=await fetch(`${ge}/chat/completions`,{method:"POST",headers:I,body:JSON.stringify({model:n.model,messages:k,temperature:.8,stream:!1})}),B.ok&&(ue=await B.json(),P=((fe=(ce=(re=ue.choices)==null?void 0:re[0])==null?void 0:ce.message)==null?void 0:fe.content)||"",console.log(" [Search] AI:",P.slice(0,100)+"..."),P=P.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),P=P.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),P=P.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]"),l(` : ${_}`,"success"))}else console.log(" [Search] :",K.message),l(`: ${K.message}`,"error"),P=P.replace(de[0],"").trim()}catch(K){console.error("Search execution failed:",K),P=P.replace(de[0],"").trim()}}else de&&(console.log(" [Search] API Key"),P=P.replace(de[0],"").trim());g(""),P=P.replace(/\[\[SEARCH:.*?\]\]/g,"").trim();const J=P.match(/\[\[DIARY_START:\s*(.+?)\]\]\n?([\s\S]*?)\[\[DIARY_END\]\]/),be=J||P.match(/\[\[DIARY:\s*(.+?)\]\]/s);if(be&&(i!=null&&i.notionEnabled)&&(i!=null&&i.notionApiKey)&&(i!=null&&i.notionDatabaseId)){let _="",K="",ie="";if(J){const S=J[1].trim();if(K=J[2].trim(),S.includes("|")){const k=S.split("|");_=k[0].trim(),ie=k.slice(1).join("|").trim()}else _=S;console.log(" [Diary] AI:",_,":",ie)}else{const S=be[1].trim();if(console.log(" [Diary] AI:",S),S.includes("|")){const k=S.split("|");_=k[0].trim(),K=k.slice(1).join("|").trim()}else K=S}if(!_){const S=new Date;_=`${t.name} - ${S.getMonth()+1}/${S.getDate()}`}try{const S=await an.createDiaryPage(i.notionApiKey,i.notionDatabaseId,{title:_,content:K,mood:ie||void 0,characterName:t.name});S.success?(console.log(" [Diary] :",S.url),await U.saveMessage({charId:t.id,role:"system",type:"text",content:` ${t.name}${_}`}),l(` ${t.name}!`,"success")):(console.error(" [Diary] :",S.message),l(`: ${S.message}`,"error"))}catch(S){console.error(" [Diary] :",S)}P=P.replace(be[0],"").trim()}else be&&(console.log(" [Diary] Notion"),P=P.replace(be[0],"").trim());P=P.replace(/\[\[DIARY:.*?\]\]/gs,"").trim(),P=P.replace(/\[\[DIARY_START:.*?\]\][\s\S]*?\[\[DIARY_END\]\]/g,"").trim();const y=P.match(/\[\[READ_DIARY:\s*(.+?)\]\]/);if(y&&(i!=null&&i.notionEnabled)&&(i!=null&&i.notionApiKey)&&(i!=null&&i.notionDatabaseId)){const _=y[1].trim();console.log(" [ReadDiary] AI:",_);let K="";const ie=new Date;if(/^\d{4}-\d{2}-\d{2}$/.test(_))K=_;else if(_==="")K=ie.toISOString().split("T")[0];else if(_===""){const S=new Date(ie);S.setDate(S.getDate()-1),K=S.toISOString().split("T")[0]}else if(_===""){const S=new Date(ie);S.setDate(S.getDate()-2),K=S.toISOString().split("T")[0]}else if(/^(\d+)$/.test(_)){const S=parseInt(_.match(/^(\d+)$/)[1]),k=new Date(ie);k.setDate(k.getDate()-S),K=k.toISOString().split("T")[0]}else if(/(\d{1,2})(\d{1,2})[]?$/.test(_)){const S=_.match(/(\d{1,2})(\d{1,2})/);if(S){const k=S[1].padStart(2,"0"),H=S[2].padStart(2,"0");K=`${ie.getFullYear()}-${k}-${H}`}}else{const S=new Date(_);isNaN(S.getTime())||(K=S.toISOString().split("T")[0])}if(K)try{const S=await an.getDiaryByDate(i.notionApiKey,i.notionDatabaseId,t.name,K);if(S.success&&S.entries.length>0){const k=[];for(const H of S.entries){const E=await an.readDiaryContent(i.notionApiKey,H.id);E.success&&k.push(`${H.title}(${H.date})
${E.content}`)}if(k.length>0){const H=k.join(`

---

`);console.log(" [ReadDiary] ",S.entries.length,"");const E=P.replace(/\[\[READ_DIARY:.*?\]\]/g,"").trim()||"...",ne=[...Y,{role:"assistant",content:E},{role:"system",content:`[:  ${K} ]

${H}

[: 
1. 
2. "...""..."
3. 
4. 
5. [[READ_DIARY:...]]]`}];B=await fetch(`${ge}/chat/completions`,{method:"POST",headers:I,body:JSON.stringify({model:n.model,messages:ne,temperature:.8,stream:!1})}),B.ok&&(ue=await B.json(),P=((z=(ee=(me=ue.choices)==null?void 0:me[0])==null?void 0:ee.message)==null?void 0:z.content)||"",P=P.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),P=P.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),P=P.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]"),l(` ${t.name}${K}`,"info"))}else console.log(" [ReadDiary] "),P=P.replace(y[0],"").trim()}else{console.log(" [ReadDiary] :",K);const k=P.replace(/\[\[READ_DIARY:.*?\]\]/g,"").trim()||"...",H=[...Y,{role:"assistant",content:k},{role:"system",content:`[:  ${K} 
1. 
2. "..."""
3. 
4. [[READ_DIARY:...]]]`}];B=await fetch(`${ge}/chat/completions`,{method:"POST",headers:I,body:JSON.stringify({model:n.model,messages:H,temperature:.8,stream:!1})}),B.ok&&(ue=await B.json(),P=((te=(F=(ve=ue.choices)==null?void 0:ve[0])==null?void 0:F.message)==null?void 0:te.content)||"",P=P.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),P=P.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),P=P.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]"))}}catch(S){console.error(" [ReadDiary] :",S),P=P.replace(y[0],"").trim()}else console.log(" [ReadDiary] :",_),P=P.replace(y[0],"").trim()}else y&&(console.log(" [ReadDiary] Notion"),P=P.replace(y[0],"").trim());P=P.replace(/\[\[READ_DIARY:.*?\]\]/g,"").trim();const W=P.match(/\[\[FS_DIARY_START:\s*(.+?)\]\]\n?([\s\S]*?)\[\[FS_DIARY_END\]\]/),se=W||P.match(/\[\[FS_DIARY:\s*(.+?)\]\]/s);if(se&&(i!=null&&i.feishuEnabled)&&(i!=null&&i.feishuAppId)&&(i!=null&&i.feishuAppSecret)&&(i!=null&&i.feishuBaseId)&&(i!=null&&i.feishuTableId)){let _="",K="",ie="";if(W){const S=W[1].trim();if(K=W[2].trim(),S.includes("|")){const k=S.split("|");_=k[0].trim(),ie=k.slice(1).join("|").trim()}else _=S;console.log(" [Feishu] AI:",_,":",ie)}else{const S=se[1].trim();if(console.log(" [Feishu] AI:",S),S.includes("|")){const k=S.split("|");_=k[0].trim(),K=k.slice(1).join("|").trim()}else K=S}if(!_){const S=new Date;_=`${t.name} - ${S.getMonth()+1}/${S.getDate()}`}try{const S=await qt.createDiaryRecord(i.feishuAppId,i.feishuAppSecret,i.feishuBaseId,i.feishuTableId,{title:_,content:K,mood:ie||void 0,characterName:t.name});S.success?(console.log(" [Feishu] :",S.recordId),await U.saveMessage({charId:t.id,role:"system",type:"text",content:` ${t.name}${_}()`}),l(` ${t.name}! ()`,"success")):(console.error(" [Feishu] :",S.message),l(`: ${S.message}`,"error"))}catch(S){console.error(" [Feishu] :",S)}P=P.replace(se[0],"").trim()}else se&&(console.log(" [Feishu] "),P=P.replace(se[0],"").trim());P=P.replace(/\[\[FS_DIARY:.*?\]\]/gs,"").trim(),P=P.replace(/\[\[FS_DIARY_START:.*?\]\][\s\S]*?\[\[FS_DIARY_END\]\]/g,"").trim();const C=P.match(/\[\[FS_READ_DIARY:\s*(.+?)\]\]/);if(C&&(i!=null&&i.feishuEnabled)&&(i!=null&&i.feishuAppId)&&(i!=null&&i.feishuAppSecret)&&(i!=null&&i.feishuBaseId)&&(i!=null&&i.feishuTableId)){const _=C[1].trim();console.log(" [Feishu ReadDiary] AI:",_);let K="";const ie=new Date;if(/^\d{4}-\d{2}-\d{2}$/.test(_))K=_;else if(_==="")K=ie.toISOString().split("T")[0];else if(_===""){const S=new Date(ie);S.setDate(S.getDate()-1),K=S.toISOString().split("T")[0]}else if(_===""){const S=new Date(ie);S.setDate(S.getDate()-2),K=S.toISOString().split("T")[0]}else if(/^(\d+)$/.test(_)){const S=parseInt(_.match(/^(\d+)$/)[1]),k=new Date(ie);k.setDate(k.getDate()-S),K=k.toISOString().split("T")[0]}else if(/(\d{1,2})(\d{1,2})[]?$/.test(_)){const S=_.match(/(\d{1,2})(\d{1,2})/);if(S){const k=S[1].padStart(2,"0"),H=S[2].padStart(2,"0");K=`${ie.getFullYear()}-${k}-${H}`}}else{const S=new Date(_);isNaN(S.getTime())||(K=S.toISOString().split("T")[0])}if(K)try{const S=await qt.getDiaryByDate(i.feishuAppId,i.feishuAppSecret,i.feishuBaseId,i.feishuTableId,t.name,K);if(S.success&&S.entries.length>0){const k=[];for(const H of S.entries)k.push(`${H.title}(${H.date})
${H.content}`);if(k.length>0){const H=k.join(`

---

`);console.log(" [Feishu ReadDiary] ",S.entries.length,"");const E=P.replace(/\[\[FS_READ_DIARY:.*?\]\]/g,"").trim()||"...",ne=[...Y,{role:"assistant",content:E},{role:"system",content:`[:  ${K} ]

${H}

[: 
1. 
2. "...""..."
3. 
4. 
5. [[FS_READ_DIARY:...]]]`}];B=await fetch(`${ge}/chat/completions`,{method:"POST",headers:I,body:JSON.stringify({model:n.model,messages:ne,temperature:.8,stream:!1})}),B.ok&&(ue=await B.json(),P=((he=(oe=(L=ue.choices)==null?void 0:L[0])==null?void 0:oe.message)==null?void 0:he.content)||"",P=P.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),P=P.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),P=P.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]"),l(` ${t.name}${K}`,"info"))}else P=P.replace(C[0],"").trim()}else{const k=P.replace(/\[\[FS_READ_DIARY:.*?\]\]/g,"").trim()||"...",H=[...Y,{role:"assistant",content:k},{role:"system",content:`[:  ${K} 
1. 
2. "..."""
3. 
4. [[FS_READ_DIARY:...]]]`}];B=await fetch(`${ge}/chat/completions`,{method:"POST",headers:I,body:JSON.stringify({model:n.model,messages:H,temperature:.8,stream:!1})}),B.ok&&(ue=await B.json(),P=(($e=(De=(Te=ue.choices)==null?void 0:Te[0])==null?void 0:De.message)==null?void 0:$e.content)||"",P=P.replace(/\[\d{4}[-/]\d{1,2}[-/]\d{1,2}.*?\]/g,""),P=P.replace(/^[\w\u4e00-\u9fa5]+:\s*/,""),P=P.replace(/\[(?:|User||System)\s*[:]\s*(.*?)\]/g,"[[SEND_EMOJI: $1]]"))}}catch(S){console.error(" [Feishu ReadDiary] :",S),P=P.replace(C[0],"").trim()}else console.log(" [Feishu ReadDiary] :",_),P=P.replace(C[0],"").trim()}else C&&(console.log(" [Feishu ReadDiary] "),P=P.replace(C[0],"").trim());P=P.replace(/\[\[FS_READ_DIARY:.*?\]\]/g,"").trim(),P=await si.parseAndExecuteActions(P,t.id,t.name,l);let O;const R=P.match(/\[{1,2}QUOTE:\s*(.*?)\]{1,2}/);if(R){const _=R[1].trim();if(_){const K=Le.slice().reverse().find(ie=>ie.role==="user"&&ie.content.includes(_))||(_.length>10?Le.slice().reverse().find(ie=>ie.role==="user"&&ie.content.includes(_.slice(0,10))):void 0);K&&(O={id:K.id,content:K.content,name:s.name})}}if(P=P.replace(/\[{1,2}QUOTE:\s*.*?\]{1,2}/g,"").trim(),!P.trim()&&(de||y||C)&&(P="..."),P){const _=si.splitResponse(P);for(let K=0;K<_.length;K++){const ie=_[K];if(ie.type==="emoji"){const S=a.find(k=>k.name===ie.content);if(S){const k=Math.random()*500+300;await new Promise(H=>setTimeout(H,k)),await U.saveMessage({charId:t.id,role:"assistant",type:"emoji",content:S.url}),c(await U.getRecentMessagesByCharId(t.id,200))}}else if(ie.content.includes("%%BILINGUAL%%")){const S=ie.content.split(/^\s*---\s*$/m).filter(k=>k.trim());for(let k=0;k<S.length;k++){let H=S[k].trim();if(!H)continue;const E=H.indexOf("%%BILINGUAL%%");let ne;if(E!==-1){const Se=H.substring(0,E).trim();let we=H.substring(E+13);we=we.replace(/%%BILINGUAL%%/g,`
`).trim(),ne=Se&&we?`${Se}
%%BILINGUAL%%
${we}`:Se||we}else ne=H;if(ne=ne.replace(/%%TRANS%%[\s\S]*/g,"").replace(/^\s*---\s*$/gm,"").replace(/\n{3,}/g,`

`).trim(),!ne)continue;const Ne=ne.match(/\[{1,2}QUOTE:\s*(.*?)\]{1,2}/);let pe;if(Ne){const Se=Ne[1].trim();if(Se){const we=Le.slice().reverse().find(Ce=>Ce.role==="user"&&Ce.content.includes(Se))||(Se.length>10?Le.slice().reverse().find(Ce=>Ce.role==="user"&&Ce.content.includes(Se.slice(0,10))):void 0);we&&(pe={id:we.id,content:we.content,name:s.name})}ne=ne.replace(/\[{1,2}QUOTE:\s*.*?\]{1,2}/g,"").trim()}const G=pe||(K===0&&k===0?O:void 0),Z=Math.min(Math.max(ne.length*30,400),2e3);await new Promise(Se=>setTimeout(Se,Z)),await U.saveMessage({charId:t.id,role:"assistant",type:"text",content:ne,replyTo:G}),c(await U.getRecentMessagesByCharId(t.id,200))}}else{const S=si.chunkText(ie.content);S.length===0&&ie.content.trim()&&S.push(ie.content.trim());for(let k=0;k<S.length;k++){let H=S[k];const E=Math.min(Math.max(H.length*50,500),2e3);await new Promise(Z=>setTimeout(Z,E));let ne;const Ne=H.match(/\[{1,2}QUOTE:\s*(.*?)\]{1,2}/);if(Ne){const Z=Ne[1].trim();if(Z){const Se=Le.slice().reverse().find(we=>we.role==="user"&&we.content.includes(Z))||(Z.length>10?Le.slice().reverse().find(we=>we.role==="user"&&we.content.includes(Z.slice(0,10))):void 0);Se&&(ne={id:Se.id,content:Se.content,name:s.name})}H=H.replace(/\[{1,2}QUOTE:\s*.*?\]{1,2}/g,"").trim()}const pe=ne||(K===0&&k===0?O:void 0);H.replace(/%%BILINGUAL%%/g,"").replace(/%%TRANS%%[\s\S]*/g,"").replace(/^\s*---\s*$/gm,"").trim()&&(await U.saveMessage({charId:t.id,role:"assistant",type:"text",content:H,replyTo:pe}),c(await U.getRecentMessagesByCharId(t.id,200)))}}}}else c(await U.getRecentMessagesByCharId(t.id,200))}catch(ge){await U.saveMessage({charId:t.id,role:"system",type:"text",content:`[: ${ge.message}]`}),c(await U.getRecentMessagesByCharId(t.id,200))}finally{p(!1),m(""),g("")}}}}},Ff=()=>{const{characters:t,activeCharacterId:s,setActiveCharacterId:n,updateCharacter:r,apiConfig:a,closeApp:o,customThemes:l,removeCustomTheme:c,addToast:i,userProfile:d,lastMsgTimestamp:h,groups:p,clearUnread:f,realtimeConfig:m}=mt(),[x,g]=u.useState([]),[A,w]=u.useState(30),[b,v]=u.useState(""),[j,T]=u.useState("none"),[$,D]=u.useState([]),[M,Q]=u.useState([]),[q,re]=u.useState("default"),[ce,fe]=u.useState(""),me=u.useRef(null),[ee,z]=u.useState(null),[ve,F]=u.useState("none"),[te,L]=u.useState(""),[oe,he]=u.useState(""),[Te,De]=u.useState(500),[$e,ge]=u.useState(!1),[I,je]=u.useState(!0),[xe,Ae]=u.useState(null),[Le,N]=u.useState(null),[Y,B]=u.useState(null),[ue,P]=u.useState(""),[Ee,de]=u.useState(!1),[J,be]=u.useState(xo),[y,W]=u.useState("preset_rational"),[se,C]=u.useState(null),[O,R]=u.useState(!1),[_,K]=u.useState(new Set),[ie,S]=u.useState(()=>{try{return JSON.parse(localStorage.getItem("chat_translate_enabled")||"false")}catch{return!1}}),[k,H]=u.useState(()=>localStorage.getItem("chat_translate_source_lang")||""),[E,ne]=u.useState(()=>localStorage.getItem("chat_translate_lang")||""),[Ne,pe]=u.useState(new Set),G=t.find(ye=>ye.id===s)||t[0],Z=(G==null?void 0:G.bubbleStyle)||"default",Se=u.useMemo(()=>l.find(ye=>ye.id===Z)||mc[Z]||mc.default,[Z,l]),we=`chat_draft_${s}`,{isTyping:Ce,recallStatus:He,searchStatus:le,lastTokenUsage:Oe,setLastTokenUsage:We,triggerAI:Ie}=Of({char:G,userProfile:d,apiConfig:a,groups:p,emojis:$,categories:M,addToast:i,setMessages:g,realtimeConfig:m,translationConfig:ie?{enabled:!0,sourceLang:k,targetLang:E}:void 0}),Ve=!Ce&&x.length>0&&x[x.length-1].role==="assistant",X=u.useCallback(ye=>{pe(ze=>{const st=new Set(ze);return st.has(ye)?st.delete(ye):st.add(ye),st})},[]),ae=async()=>{await U.initializeEmojiData();const[ye,ze]=await Promise.all([U.getEmojis(),U.getEmojiCategories()]);D(ye),Q(ze),q!=="default"&&!ze.some(st=>st.id===q)&&re("default")},ke=200;u.useEffect(()=>{if(s){U.getRecentMessagesByCharId(s,ke).then(g),ae();const ye=localStorage.getItem(we);v(ye||""),G&&(De(G.contextLimit||500),ge(G.hideSystemLogs||!1),f(G.id)),w(30),We(null),z(null),R(!1),K(new Set),pe(new Set)}},[s]),u.useEffect(()=>{const ye=localStorage.getItem("chat_archive_prompts");if(ye)try{const st=JSON.parse(ye),ut=[...xo,...st.filter(pt=>!pt.id.startsWith("preset_"))];be(ut)}catch{}const ze=localStorage.getItem("chat_active_archive_prompt_id");ze&&J.some(st=>st.id===ze)&&W(ze)},[]),u.useEffect(()=>{s&&h>0&&(U.getRecentMessagesByCharId(s,ke).then(g),f(s))},[h]);const Me=ye=>{v(ye),ye.trim()?localStorage.setItem(we,ye):localStorage.removeItem(we)};u.useLayoutEffect(()=>{me.current&&!O&&(me.current.scrollTop=me.current.scrollHeight)},[x.length,s,O]),u.useEffect(()=>{Ce&&me.current&&!O&&me.current.scrollTo({top:me.current.scrollHeight,behavior:"smooth"})},[x,Ce,He,le,O]);const Ue=ye=>new Date(ye).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),Be=async(ye,ze,st)=>{if(!G||!b.trim()&&!ye)return;const ut=ye||b.trim(),pt=ze||"text";ye||(v(""),localStorage.removeItem(we)),pt==="image"&&(await U.saveGalleryImage({id:`img-${Date.now()}-${Math.random()}`,charId:G.id,url:ut,timestamp:Date.now()}),i("","info"));const ct={charId:G.id,role:"user",type:pt,content:ut,metadata:st};ee&&(ct.replyTo={id:ee.id,content:ee.content,name:ee.role==="user"?"":G.name},z(null)),await U.saveMessage(ct);const Zt=await U.getMessagesByCharId(G.id);g(Zt),T("none")},_e=async()=>{if(Ce||x.length===0||x[x.length-1].role!=="assistant")return;const ze=[];let st=x.length-1;for(;st>=0&&x[st].role==="assistant";)ze.push(x[st].id),st--;if(ze.length===0)return;await U.deleteMessages(ze);const ut=x.slice(0,st+1);g(ut),i("...","info"),Ie(ut)},qe=async ye=>{try{const ze=await Ut(ye,{maxWidth:600,quality:.6,forceJpeg:!0});T("none"),await Be(ze,"image")}catch(ze){i(ze.message||"","error")}},Je=(ye,ze)=>{switch(ye){case"transfer":F("transfer");break;case"poke":Be("[]","interaction");break;case"archive":F("archive-settings");break;case"settings":F("chat-settings");break;case"emoji-import":F("emoji-import");break;case"send-emoji":ze&&Be(ze.url,"emoji");break;case"delete-emoji-req":N(ze),F("delete-emoji");break;case"add-category":F("add-category");break;case"select-category":re(ze);break;case"delete-category-req":B(ze),F("delete-category");break}},et=async()=>{if(!ce.trim()){i("","error");return}const ye={id:`cat-${Date.now()}`,name:ce.trim()};await U.saveEmojiCategory(ye),await ae(),re(ye.id),F("none"),fe(""),i("","success")},Qe=async()=>{if(!oe.trim())return;const ye=oe.split(`
`),ze=q==="default"?void 0:q;for(const st of ye){const ut=st.split("--");if(ut.length>=2){const pt=ut[0].trim(),ct=ut.slice(1).join("--").trim();pt&&ct&&await U.saveEmoji(pt,ct,ze)}}await ae(),F("none"),he(""),i("","success")},ht=async()=>{Y&&(await U.deleteEmojiCategory(Y.id),await ae(),re("default"),F("none"),B(null),i("","success"))},nt=()=>{if(!se||!se.name.trim()||!se.content.trim()){i("","error");return}be(ye=>{let ze;ye.some(ut=>ut.id===se.id)?ze=ye.map(ut=>ut.id===se.id?se:ut):ze=[...ye,se];const st=ze.filter(ut=>!ut.id.startsWith("preset_"));return localStorage.setItem("chat_archive_prompts",JSON.stringify(st)),ze}),W(se.id),F("archive-settings"),C(null)},at=ye=>{if(ye.startsWith("preset_")){i("","error");return}be(ze=>{const st=ze.filter(pt=>pt.id!==ye),ut=st.filter(pt=>!pt.id.startsWith("preset_"));return localStorage.setItem("chat_archive_prompts",JSON.stringify(ut)),st}),y===ye&&W("preset_rational"),i("","success")},It=()=>{C({id:`custom_${Date.now()}`,name:"",content:xo[0].content}),F("prompt-editor")},Xe=()=>{const ye=J.find(ze=>ze.id===y);ye&&(ye.id.startsWith("preset_")?C({id:`custom_${Date.now()}`,name:`${ye.name} (Copy)`,content:ye.content}):C({...ye}),F("prompt-editor"))},cn=async ye=>{try{const ze=await Ut(ye,{skipCompression:!0});r(G.id,{chatBackground:ze}),i("","success")}catch(ze){i(ze.message,"error")}},gt=()=>{r(G.id,{contextLimit:Te,hideSystemLogs:$e}),F("none"),i("","success")},fs=async()=>{if(G){if(I){const ye=x.slice(0,-10);if(ye.length===0){i("","info");return}await U.deleteMessages(ye.map(ze=>ze.id)),g(x.slice(-10)),i(` ${ye.length} 10`,"success")}else await U.clearMessages(G.id),g([]),i("","success");F("none")}},ot=ye=>{r(G.id,{hideBeforeMessageId:ye}),F("none"),i(ye?"":"","success")},Nt=async()=>{var st,ut,pt;if(!a.apiKey||!G){i(" API Key","error");return}const ye={};x.filter(ct=>!G.hideBeforeMessageId||ct.id>=G.hideBeforeMessageId).forEach(ct=>{const Zt=new Date(ct.timestamp),hn=`${Zt.getFullYear()}-${String(Zt.getMonth()+1).padStart(2,"0")}-${String(Zt.getDate()).padStart(2,"0")}`;ye[hn]||(ye[hn]=[]),ye[hn].push(ct)});const ze=Object.keys(ye).sort();if(ze.length===0){i("","info");return}de(!0),T("none"),F("none");try{let ct=0;const Zt=[],Ka=(J.find(Re=>Re.id===y)||xo[0]).content;for(const Re of ze){const rt=ye[Re].map(Bt=>`[${Ue(Bt.timestamp)}] ${Bt.role==="user"?d.name:G.name}: ${Bt.type==="image"?"[Image]":Bt.content}`).join(`
`);let tt=Ka;tt=tt.replace(/\$\{dateStr\}/g,Re),tt=tt.replace(/\$\{char\.name\}/g,G.name),tt=tt.replace(/\$\{userProfile\.name\}/g,d.name),tt=tt.replace(/\$\{rawLog.*?\}/g,rt.substring(0,2e5));const vt=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:tt}],temperature:.5,max_tokens:8e3})});if(!vt.ok)throw new Error(`API Error on ${Re}`);let Ft=((pt=(ut=(st=(await vt.json()).choices)==null?void 0:st[0])==null?void 0:ut.message)==null?void 0:pt.content)||"";Ft=Ft.trim().replace(/^["']|["']$/g,""),Ft&&(Zt.push({id:`mem-${Date.now()}`,date:Re,summary:Ft,mood:"archive"}),ct++),await new Promise(Bt=>setTimeout(Bt,500))}const V=[...G.memories||[],...Zt];r(G.id,{memories:V}),i(` ${ct} `,"success")}catch(ct){i(`: ${ct.message}`,"error")}finally{de(!1)}},it=async()=>{xe&&(await U.deleteMessage(xe.id),g(ye=>ye.filter(ze=>ze.id!==xe.id)),F("none"),Ae(null),i("","success"))},_t=async()=>{xe&&(await U.updateMessage(xe.id,ue),g(ye=>ye.map(ze=>ze.id===xe.id?{...ze,content:ue}:ze)),F("none"),Ae(null),i("","success"))},Lt=()=>{xe&&(z({...xe,metadata:{...xe.metadata,senderName:xe.role==="user"?"":G.name}}),F("none"))},Xn=async()=>{Le&&(await U.deleteEmoji(Le.name),await ae(),F("none"),N(null),i("","success"))},Zs=()=>{xe&&(K(new Set([xe.id])),R(!0),F("none"),Ae(null))},dn=u.useCallback(ye=>{K(ze=>{const st=new Set(ze);return st.has(ye)?st.delete(ye):st.add(ye),st})},[]),qn=async()=>{_.size!==0&&(await U.deleteMessages(Array.from(_)),g(ye=>ye.filter(ze=>!_.has(ze.id))),i(` ${_.size} `,"success"),R(!1),K(new Set))},[Qn,un]=u.useState(!1),mn=()=>{_.size!==0&&un(!0)},Va=async ye=>{if(!G)return;const ze=x.filter(ct=>_.has(ct.id)).sort((ct,Zt)=>ct.id-Zt.id);if(ze.length===0)return;const st=ze.slice(0,4).map(ct=>{const Zt=ct.role==="user"?d.name:G.name,hn=ct.type==="text"?ct.content.slice(0,30):`[${ct.type==="image"?"":ct.type==="emoji"?"":ct.type}]`;return`${Zt}: ${hn}`});ze.length>4&&st.push(`...  ${ze.length} `);const ut={fromUserName:d.name,fromCharName:G.name,count:ze.length,preview:st,messages:ze.map(ct=>({role:ct.role,type:ct.type,content:ct.content,timestamp:ct.timestamp||Date.now()}))};await U.saveMessage({charId:ye,role:"user",type:"chat_forward",content:JSON.stringify(ut)});const pt=t.find(ct=>ct.id===ye);G.id!==ye&&(await U.saveMessage({charId:G.id,role:"system",type:"text",content:`[ ${ze.length}  ${(pt==null?void 0:pt.name)||""}]`}),U.getRecentMessagesByCharId(G.id,ke).then(g)),i(` ${ze.length}  ${(pt==null?void 0:pt.name)||""}`,"success"),un(!1),R(!1),K(new Set)},er=x.filter(ye=>{var ze;return((ze=ye.metadata)==null?void 0:ze.source)!=="date"}).filter(ye=>!G.hideBeforeMessageId||ye.id>=G.hideBeforeMessageId).filter(ye=>!(G.hideSystemLogs&&ye.role==="system")).slice(-A);return e.jsxs("div",{className:"flex flex-col h-full bg-[#f1f5f9] overflow-hidden relative font-sans transition-all duration-500",style:{backgroundImage:G.chatBackground?`url(${G.chatBackground})`:"none",backgroundSize:"cover",backgroundPosition:"center"},children:[Se.customCss&&e.jsx("style",{children:Se.customCss}),e.jsx(Rf,{modalType:ve,setModalType:F,transferAmt:te,setTransferAmt:L,emojiImportText:oe,setEmojiImportText:he,settingsContextLimit:Te,setSettingsContextLimit:De,settingsHideSysLogs:$e,setSettingsHideSysLogs:ge,preserveContext:I,setPreserveContext:je,editContent:ue,setEditContent:P,archivePrompts:J,selectedPromptId:y,setSelectedPromptId:W,editingPrompt:se,setEditingPrompt:C,isSummarizing:Ee,selectedMessage:xe,selectedEmoji:Le,activeCharacter:G,messages:x,newCategoryName:ce,setNewCategoryName:fe,onAddCategory:et,selectedCategory:Y,onTransfer:()=>{te&&Be("[]","transfer",{amount:te}),F("none")},onImportEmoji:Qe,onSaveSettings:gt,onBgUpload:cn,onRemoveBg:()=>r(G.id,{chatBackground:void 0}),onClearHistory:fs,onArchive:Nt,onCreatePrompt:It,onEditPrompt:Xe,onSavePrompt:nt,onDeletePrompt:at,onSetHistoryStart:ot,onEnterSelectionMode:Zs,onReplyMessage:Lt,onEditMessageStart:()=>{xe&&(P(xe.content),F("edit-message"))},onConfirmEditMessage:_t,onDeleteMessage:it,onDeleteEmoji:Xn,onDeleteCategory:ht,translationEnabled:ie,onToggleTranslation:()=>{const ye=!ie;S(ye),localStorage.setItem("chat_translate_enabled",JSON.stringify(ye)),ye||pe(new Set)},translateSourceLang:k,translateTargetLang:E,onSetTranslateSourceLang:ye=>{H(ye),localStorage.setItem("chat_translate_source_lang",ye),pe(new Set)},onSetTranslateLang:ye=>{ne(ye),localStorage.setItem("chat_translate_lang",ye),pe(new Set)}}),e.jsx(Lf,{selectionMode:O,selectedCount:_.size,onCancelSelection:()=>{R(!1),K(new Set)},activeCharacter:G,isTyping:Ce,isSummarizing:Ee,lastTokenUsage:Oe,onClose:o,onTriggerAI:()=>Ie(x),onShowCharsPanel:()=>T("chars")}),e.jsxs("div",{ref:me,className:"flex-1 overflow-y-auto pt-6 pb-6 no-scrollbar",style:{backgroundImage:Se.type==="custom"&&Se.user.backgroundImage?"none":void 0},children:[x.length>A&&e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("button",{onClick:async()=>{if(A+30>=x.length&&s){const ye=await U.getRecentMessagesByCharId(s,x.length+100);ye.length>x.length&&g(ye)}w(ye=>ye+30)},className:"px-4 py-2 bg-white/50 backdrop-blur-sm rounded-full text-xs text-slate-500 shadow-sm border border-white hover:bg-white transition-colors",children:[" (",x.length-A,")"]})}),er.map((ye,ze)=>{const st=ze>0?er[ze-1].role:null,ut=ze<er.length-1?er[ze+1].role:null;return e.jsx(Df,{msg:ye,isFirstInGroup:st!==ye.role,isLastInGroup:ut!==ye.role,activeTheme:Se,charAvatar:G.avatar,charName:G.name,userAvatar:d.avatar,onLongPress:pt=>{Ae(pt),F("message-options")},selectionMode:O,isSelected:_.has(ye.id),onToggleSelect:dn,translationEnabled:ie&&ye.type==="text"&&ye.role==="assistant",isShowingTarget:Ne.has(ye.id),onTranslateToggle:X},ye.id||ze)}),(Ce||He||le)&&!O&&e.jsxs("div",{className:"flex items-end gap-3 px-3 mb-6 animate-fade-in",children:[e.jsx("img",{src:G.avatar,className:"w-9 h-9 rounded-[10px] object-cover"}),e.jsx("div",{className:"bg-white px-4 py-3 rounded-2xl shadow-sm",children:le?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-emerald-500 font-medium",children:[e.jsxs("svg",{className:"animate-spin h-3 w-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})," ",le]}):He?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-indigo-500 font-medium",children:[e.jsxs("svg",{className:"animate-spin h-3 w-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),He]}):e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-75"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce delay-150"})]})})]})]}),e.jsxs("div",{className:"relative z-40",children:[ee&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-slate-50 border-b border-slate-200 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx("span",{className:"font-bold text-slate-700",children:":"}),e.jsx("span",{className:"truncate max-w-[200px]",children:ee.content})]}),e.jsx("button",{onClick:()=>z(null),className:"p-1 text-slate-400 hover:text-slate-600",children:""})]}),e.jsx(Pf,{input:b,setInput:Me,isTyping:Ce,selectionMode:O,showPanel:j,setShowPanel:T,onSend:()=>Be(),onDeleteSelected:qn,onForwardSelected:mn,selectedCount:_.size,emojis:$.filter(ye=>q==="default"?!ye.categoryId||ye.categoryId==="default":ye.categoryId===q),characters:t,activeCharacterId:s,onCharSelect:ye=>{n(ye),T("none")},customThemes:l,onUpdateTheme:ye=>r(G.id,{bubbleStyle:ye}),onRemoveTheme:c,activeThemeId:Z,onPanelAction:Je,onImageSelect:qe,isSummarizing:Ee,categories:M,activeCategory:q,onReroll:_e,canReroll:Ve})]}),e.jsx(Ye,{isOpen:Qn,title:"",onClose:()=>un(!1),children:e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[e.jsxs("p",{className:"text-xs text-slate-400 mb-3",children:[" ( ",_.size," )"]}),t.filter(ye=>ye.id!==s).map(ye=>e.jsxs("button",{onClick:()=>Va(ye.id),className:"w-full flex items-center gap-3 p-3 rounded-2xl bg-slate-50 hover:bg-slate-100 active:scale-[0.98] transition-all border border-slate-100",children:[e.jsx("img",{src:ye.avatar,className:"w-10 h-10 rounded-xl object-cover"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-bold text-sm text-slate-700",children:ye.name}),e.jsx("div",{className:"text-[10px] text-slate-400 truncate",children:ye.description})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 text-slate-300",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})})]},ye.id)),t.filter(ye=>ye.id!==s).length===0&&e.jsx("div",{className:"text-center text-xs text-slate-400 py-8",children:""})]})})]})},Bf=Sn.memo(({msg:t,isUser:s,char:n,userAvatar:r,onImageClick:a,selectionMode:o,isSelected:l,onToggleSelect:c,onLongPress:i})=>{const d=s?r:n==null?void 0:n.avatar,h=s?"":(n==null?void 0:n.name)||"",p=u.useRef(null),f=u.useRef({x:0,y:0}),m=new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),x=v=>{"touches"in v?f.current={x:v.touches[0].clientX,y:v.touches[0].clientY}:f.current={x:v.clientX,y:v.clientY},p.current=setTimeout(()=>{o||i(t.id)},500)},g=()=>{p.current&&(clearTimeout(p.current),p.current=null)},A=v=>{if(!p.current)return;let j,T;"touches"in v?(j=v.touches[0].clientX,T=v.touches[0].clientY):(j=v.clientX,T=v.clientY);const $=Math.abs(j-f.current.x),D=Math.abs(T-f.current.y);($>10||D>10)&&(clearTimeout(p.current),p.current=null)},w=v=>{o&&(v.stopPropagation(),c(t.id))},b=()=>{switch(t.type){case"image":return e.jsx("div",{className:"relative group cursor-pointer",onClick:v=>{o?w(v):a(t.content)},children:e.jsx("img",{src:t.content,className:"max-w-[200px] max-h-[200px] rounded-xl shadow-sm border border-black/5",loading:"lazy"})});case"emoji":return e.jsx("img",{src:t.content,className:"w-24 h-24 object-contain drop-shadow-sm hover:scale-110 transition-transform"});case"transfer":return e.jsxs("div",{className:"w-60 bg-[#fb923c] text-white p-3 rounded-xl flex items-center gap-3 shadow-md relative overflow-hidden active:scale-95 transition-transform",children:[e.jsx("div",{className:"absolute -right-2 -top-2 text-white/20",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-16 h-16",children:[e.jsx("path",{d:"M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.324.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"}),e.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.66c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z",clipRule:"evenodd"}),e.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),e.jsx("div",{className:"bg-white/20 p-2 rounded-full shrink-0",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:[e.jsx("path",{d:"M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"}),e.jsx("path",{fillRule:"evenodd",d:"M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75-.75H5.25a.75.75 0 0 1-.75-.75V9.75Z",clipRule:"evenodd"}),e.jsx("path",{d:"M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z"})]})}),e.jsxs("div",{className:"z-10",children:[e.jsx("div",{className:"font-bold text-sm tracking-wide",children:" / "}),e.jsx("div",{className:"text-[10px] opacity-90",children:"Sully Pay"})]})]});default:return e.jsx("div",{className:`px-3.5 py-2 rounded-[18px] text-[15px] leading-relaxed shadow-sm whitespace-pre-wrap break-all ${s?"bg-violet-500 text-white rounded-tr-sm":"bg-white text-slate-700 rounded-tl-sm border border-slate-100"}`,children:t.content})}};return e.jsxs("div",{className:`flex gap-3 mb-4 w-full animate-fade-in relative ${s?"justify-end":"justify-start"} ${o?"pl-8":""}`,onTouchStart:x,onTouchEnd:g,onTouchMove:A,onMouseDown:x,onMouseUp:g,onMouseMove:A,onClick:w,children:[o&&e.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 cursor-pointer z-10",children:e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${l?"bg-violet-500 border-violet-500":"border-slate-300 bg-white"}`,children:l&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",strokeWidth:3,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})})}),!s&&e.jsx("div",{className:"flex flex-col items-center gap-1 shrink-0",children:e.jsx("img",{src:d,className:"w-9 h-9 rounded-full object-cover shadow-sm border border-white",loading:"lazy"})}),e.jsxs("div",{className:`flex flex-col ${s?"items-end":"items-start"} max-w-[80%] ${o?"pointer-events-none":""}`,children:[!s&&e.jsx("span",{className:"text-[10px] text-slate-400 ml-1 mb-1",children:h}),b(),e.jsx("span",{className:"text-[9px] text-slate-300 mt-1 px-1",children:m})]}),s&&e.jsx("div",{className:"flex flex-col items-center gap-1 shrink-0",children:e.jsx("img",{src:d,className:"w-9 h-9 rounded-full object-cover shadow-sm border border-white",loading:"lazy"})})]})}),zf=()=>{const{closeApp:t,groups:s,createGroup:n,deleteGroup:r,characters:a,updateCharacter:o,apiConfig:l,addToast:c,userProfile:i,virtualTime:d}=mt(),[h,p]=u.useState("list"),[f,m]=u.useState(null),[x,g]=u.useState([]),[A,w]=u.useState(""),[b,v]=u.useState(!1),[j,T]=u.useState(!1),[$,D]=u.useState(!1),[M,Q]=u.useState("none"),[q,re]=u.useState(!0),[ce,fe]=u.useState(!1),[me,ee]=u.useState(""),[z,ve]=u.useState(!1),[F,te]=u.useState(new Set),[L,oe]=u.useState([]),[he,Te]=u.useState([]),[De,$e]=u.useState(""),[ge,I]=u.useState(new Set),[je,xe]=u.useState(""),Ae=u.useRef(null),Le=u.useRef(null),N=u.useRef(null);u.useEffect(()=>{f&&(U.getGroupMessages(f.id).then(S=>{g(S.sort((k,H)=>k.timestamp-H.timestamp))}),Promise.all([U.getEmojis(),U.getEmojiCategories()]).then(([S,k])=>{oe(S),Te(k)}))},[f]),u.useLayoutEffect(()=>{Ae.current&&!z&&(Ae.current.scrollTop=Ae.current.scrollHeight)},[x.length,f,j,$,b,z]);const Y=u.useMemo(()=>b||x.length===0?!1:x[x.length-1].role==="assistant",[b,x]),B=S=>{const k=Date.now(),H=Math.floor((k-S)/(1e3*60*60)),E=Math.floor((k-S)/(1e3*60)),ne=new Date().getHours(),Ne=ne>=23||ne<=6;return E<10?"":E<60?` ${E} `:H<12?` ${H} ${Ne?"":""}`:` ${H} `},ue=async S=>{const H=(await U.getMessagesByCharId(S)).filter(Z=>!Z.groupId);if(H.length===0)return"";const E=H[H.length-1],ne=Date.now(),Ne=Math.floor((ne-E.timestamp)/(1e3*60)),pe=Math.floor(Ne/60),G=Math.floor(pe/24);return Ne<60?"":pe<24?`${pe}`:`${G}`},P=S=>{ve(!0),te(new Set([S])),T(!1),D(!1)},Ee=S=>{const k=new Set(F);k.has(S)?k.delete(S):k.add(S),te(k)},de=async()=>{F.size!==0&&(await U.deleteMessages(Array.from(F)),g(S=>S.filter(k=>!F.has(k.id))),ve(!1),te(new Set),c(` ${F.size} `,"success"))},J=async()=>{if(!Y||x[x.length-1].role!=="assistant")return;const k=[];let H=x.length-1;for(;H>=0&&x[H].role==="assistant";)k.push(x[H].id),H--;if(k.length===0)return;await U.deleteMessages(k);const E=x.slice(0,H+1);g(E),c("...","info"),ie(E)},be=()=>{if(!De.trim()||ge.size<2){c("2","error");return}n(De,Array.from(ge)),Q("none"),$e(""),I(new Set),c("","success")},y=async()=>{if(!f)return;const S={...f,name:De||f.name};await U.saveGroup(S),m(S),Q("none"),c("","success")},W=async S=>{var H;const k=(H=S.target.files)==null?void 0:H[0];if(!(!k||!f))try{const E=await Ut(k),ne={...f,avatar:E};await U.saveGroup(ne),m(ne),c("","success")}catch{c("","error")}},se=S=>{const k=new Set(ge);k.has(S)?k.delete(S):k.add(S),I(k)},C=async S=>{await r(S),(f==null?void 0:f.id)===S&&p("list"),c("","success")},O=async()=>{if(!f)return;let S=x;if(q&&(S=x.slice(0,-10),Math.min(x.length,10)),S.length===0){c("","info");return}await U.deleteMessages(S.map(H=>H.id));const k=q?x.slice(-10):[];g(k),c(` ${S.length} ${q?" (10)":""}`,"success"),Q("none")},R=async()=>{if(!f||!l.apiKey){c("","error");return}if(x.length===0){c("","info");return}fe(!0),ee("...");try{const S={};x.forEach(H=>{const E=new Date(H.timestamp).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-");S[E]||(S[E]=[]),S[E].push(H)});const k=Object.keys(S).sort();for(let H=0;H<k.length;H++){const E=k[H];ee(` ${E} (${H+1}/${k.length})`);const Ne=S[E].map(Z=>{var we;return`${Z.role==="user"?i.name:((we=a.find(Ce=>Ce.id===Z.charId))==null?void 0:we.name)||""}: ${Z.content}`}).join(`
`),pe=`
### Task: Group Chat Summary
Group: "${f.name}"
Date: ${E}

### Instructions
Summarize the following chat log into a **concise, 3rd-person, YAML format**.
- Focus on interactions, conflicts, and key topics.
- Be objective (like a narrator).
- **Strictly output valid YAML only.**

### Example Output
summary: "In [Group Name], [Char A] shared a photo of a cat. [Char B] made a joke about it, which caused a brief playful argument about pets."

### Logs
${Ne.substring(0,1e4)}
`,G=await fetch(`${l.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.apiKey}`},body:JSON.stringify({model:l.model,messages:[{role:"user",content:pe}],temperature:.3})});if(G.ok){let Se=(await G.json()).choices[0].message.content.trim();const we=Se.match(/summary:\s*["']?([\s\S]*?)["']?$/);let Ce=we?we[1]:Se.replace(/^summary:\s*/i,"");if(Ce=Ce.replace(/^["']|["']$/g,"").trim(),Ce){const He={id:`mem-${Date.now()}-${Math.random()}`,date:E,summary:`[: ${f.name}] ${Ce}`,mood:"group"};for(const le of f.members){const Oe=a.find(We=>We.id===le);if(Oe){const We=[...Oe.memories||[],He];o(Oe.id,{memories:We})}}}}await new Promise(Z=>setTimeout(Z,500))}c("","success"),Q("none")}catch(S){console.error(S),c(`: ${S.message}`,"error")}finally{fe(!1),ee("")}},_=async(S,k="text",H)=>{if(!f)return;const E={charId:"user",groupId:f.id,role:"user",type:k,content:S,metadata:H};await U.saveMessage(E);const ne=await U.getGroupMessages(f.id);g(ne),k!=="text"&&(T(!1),D(!1)),w("")},K=async S=>{var H;const k=(H=S.target.files)==null?void 0:H[0];if(k)try{const E=await Ut(k,{maxWidth:600,quality:.7,forceJpeg:!0});_(E,"image")}catch{c("","error")}},ie=async S=>{var k;if(!(!f||!l.apiKey)){v(!0);try{const H=a.filter(Ie=>f.members.includes(Ie.id)),E=S[S.length-1],ne=E?B(E.timestamp):"",Ne=`${d.hours.toString().padStart(2,"0")}:${d.minutes.toString().padStart(2,"0")}`;let pe=`
: "${f.name}"
: ${Ne}
: ${ne}
 (User): ${i.name} ()
`;for(const Ie of H){const Ve=At.buildCoreContext(Ie,i,!0),X=await U.getMessagesByCharId(Ie.id),ae=await ue(Ie.id),ke=X.slice(-10).map(Me=>`[${Me.role==="user"?"":""}]: ${Me.content.substring(0,50)}`).join(`
`);pe+=`
<<<  START: ${Ie.name} (ID: ${Ie.id}) >>>
${Ve}

[ (Private Context)]: 
- ****: ${ae}
- ****:  []  ""  "" "" 
- :
${ke||"()"}
<<<  END >>>
`}const G=S.slice(-30).map(Ie=>{var ae,ke;let Ve="";Ie.role==="assistant"&&(Ve=((ae=a.find(Me=>Me.id===Ie.charId))==null?void 0:ae.name)||"");const X=Ie.type==="image"?"[]":Ie.type==="emoji"?`[: ${Ie.content}]`:Ie.type==="transfer"?`[: ${(ke=Ie.metadata)==null?void 0:ke.amount}]`:Ie.content;return`${Ve}: ${X}`}).join(`
`),Z=(()=>{if(L.length===0)return"";const Ie={},Ve={default:""};return he.forEach(X=>Ve[X.id]=X.name),L.forEach(X=>{const ae=X.categoryId||"default";Ie[ae]||(Ie[ae]=[]),Ie[ae].push(X.name)}),Object.entries(Ie).map(([X,ae])=>`${Ve[X]||""}: [${ae.join(", ")}]`).join("; ")})(),Se=`${pe}

### AI  (Director Mode)


${G}

###  (Conversation Flow)
****

###  (Strict Rules)
1. ****: A,BAB
2. ****:  **1  6 ** 
3. ****:
   - 
   - : \`[[SEND_EMOJI: ]]\`
   - ** ()**: ${Z}
4. ** (Bubble Splitting)**:
   - 
   -  "" 
5. ** ()**:
   -  []
   - TA ""
6. ** (Private Messaging)**:
   - 
   - : \`[[PRIVATE: ]]\`
   - ****
   - 

###  (JSON Array)
[
  {
    "charId": "ID",
    "content": "... ([[SEND_EMOJI: name]]  [[PRIVATE: content]])"
  },
  ...
]
`,we=await fetch(`${l.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.apiKey}`},body:JSON.stringify({model:l.model,messages:[{role:"user",content:Se}],temperature:.9,max_tokens:8e3})});if(!we.ok)throw new Error("Director Failed");let He=(await we.json()).choices[0].message.content;He=He.replace(/```json/g,"").replace(/```/g,"").trim();const le=He.indexOf("["),Oe=He.lastIndexOf("]");le!==-1&&Oe!==-1&&(He=He.substring(le,Oe+1));let We=[];try{We=JSON.parse(He),Array.isArray(We)||(We=[])}catch{console.error("Director Parse Error",He)}for(const Ie of We){const Ve=f.members.find(_e=>_e===Ie.charId);if(!Ve)continue;const X=((k=a.find(_e=>_e.id===Ve))==null?void 0:k.name)||"",ae=[],ke=/\[\[PRIVATE\s*[:]\s*([\s\S]*?)\]\]/g;let Me;for(;(Me=ke.exec(Ie.content))!==null;)ae.push(Me);if(ae.length>0){for(const _e of ae){const qe=_e[1].trim();qe&&(await U.saveMessage({charId:Ve,role:"assistant",type:"text",content:qe}),c(`${X} : ${qe.substring(0,15)}...`,"info")),Ie.content=Ie.content.replace(_e[0],"")}if(Ie.content=Ie.content.trim(),!Ie.content)continue}const Ue=Ie.content.match(/\[\[SEND_EMOJI:\s*(.*?)\]\]/);if(Ue){const _e=Ue[1].trim(),qe=L.find(Je=>Je.name===_e);if(qe){await U.saveMessage({charId:Ve,groupId:f.id,role:"assistant",type:"emoji",content:qe.url}),g(await U.getGroupMessages(f.id)),await new Promise(Je=>setTimeout(Je,800));continue}}let Be=Ie.content.replace(/\[\[SEND_EMOJI:.*?\]\]/g,"").trim();if(Be){const qe=Be.replace(/\.\.\./g,"{{ELLIPSIS_ENG}}").replace(//g,"{{ELLIPSIS_CN}}").replace(/([])(?![\)\]"'])/g,"{{SPLIT}}").replace(/\.($|\s+)/g,"{{SPLIT}}").replace(/([!?~]+)(?![\)\]"'])/g,"$1{{SPLIT}}").replace(/\n+/g,"{{SPLIT}}").split("{{SPLIT}}").map(Je=>Je.trim()).filter(Je=>Je.length>0).map(Je=>Je.replace(/{{ELLIPSIS_ENG}}/g,"...").replace(/{{ELLIPSIS_CN}}/g,""));qe.length===0&&qe.push(Be);for(const Je of qe){const et=Math.max(500,Je.length*50+Math.random()*200);await new Promise(Qe=>setTimeout(Qe,et)),await U.saveMessage({charId:Ve,groupId:f.id,role:"assistant",type:"text",content:Je}),g(await U.getGroupMessages(f.id))}}}}catch(H){console.error(H)}finally{v(!1)}}};return h==="list"?e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[e.jsxs("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-medium text-slate-700 text-lg tracking-wide pl-2",children:""}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>{Q("create"),I(new Set),$e("")},className:"p-2 -mr-2 text-violet-500 bg-violet-50 hover:bg-violet-100 rounded-full transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),e.jsxs("div",{className:"p-4 space-y-3 overflow-y-auto",children:[s.map(S=>e.jsxs("div",{onClick:()=>{m(S),p("chat")},className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center gap-4 active:scale-[0.98] transition-all cursor-pointer group hover:bg-violet-50/30",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 overflow-hidden border border-slate-200 relative shadow-sm",children:S.avatar?e.jsx("img",{src:S.avatar,className:"w-full h-full object-cover"}):e.jsx("div",{className:"grid grid-cols-2 gap-0.5 p-0.5 w-full h-full bg-slate-200",children:S.members.slice(0,4).map(k=>{const H=a.find(E=>E.id===k);return e.jsx("img",{src:H==null?void 0:H.avatar,className:"w-full h-full object-cover rounded-sm bg-white"},k)})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-slate-700 truncate text-base",children:S.name}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1 flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{d:"M7 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM14.5 9a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5ZM1.615 16.428a1.224 1.224 0 0 1-.569-1.175 6.002 6.002 0 0 1 11.908 0c.058.467-.172.92-.57 1.174A9.953 9.953 0 0 1 7 18a9.953 9.953 0 0 1-5.385-1.572ZM14.5 16h-.106c.07-.297.088-.611.048-.933a7.47 7.47 0 0 0-1.588-3.755 4.502 4.502 0 0 1 5.874 2.636.818.818 0 0 1-.36.98A7.465 7.465 0 0 1 14.5 16Z"})}),S.members.length," "]})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-slate-300",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})})]},S.id)),s.length===0&&e.jsxs("div",{className:"text-center text-slate-400 text-xs py-10 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-3xl opacity-50",children:""}),""]})]}),e.jsx(Ye,{isOpen:M==="create",title:"",onClose:()=>Q("none"),footer:e.jsx("button",{onClick:be,className:"w-full py-3 bg-violet-500 text-white font-bold rounded-2xl shadow-lg shadow-violet-200",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{value:De,onChange:S=>$e(S.target.value),placeholder:"",className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-violet-500/20 transition-all"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:""}),e.jsx("div",{className:"grid grid-cols-4 gap-2 max-h-48 overflow-y-auto pr-1",children:a.map(S=>e.jsxs("div",{onClick:()=>se(S.id),className:`flex flex-col items-center gap-1 p-2 rounded-xl border transition-all cursor-pointer ${ge.has(S.id)?"border-violet-500 bg-violet-50 ring-1 ring-violet-500":"border-slate-100 bg-white hover:border-slate-300"}`,children:[e.jsx("img",{src:S.avatar,className:"w-10 h-10 rounded-full object-cover"}),e.jsx("span",{className:"text-[9px] text-slate-600 truncate w-full text-center font-medium",children:S.name})]},S.id))})]})]})})]}):e.jsxs("div",{className:"h-full w-full bg-[#f0f4f8] flex flex-col font-sans relative",children:[e.jsx("div",{className:"h-24 bg-white/80 backdrop-blur-xl px-5 flex items-end pb-4 border-b border-slate-200/60 shrink-0 z-30 sticky top-0 shadow-sm transition-all",children:z?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("button",{onClick:()=>{ve(!1),te(new Set)},className:"text-sm font-bold text-slate-500 px-2 py-1",children:""}),e.jsxs("span",{className:"text-sm font-bold text-slate-800",children:[" ",F.size," "]}),e.jsx("div",{className:"w-10"})]}):e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("button",{onClick:()=>p("list"),className:"p-2 -ml-2 rounded-full hover:bg-slate-100 active:bg-slate-200 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>{$e((f==null?void 0:f.name)||""),Q("settings")},children:[e.jsxs("h1",{className:"text-base font-bold text-slate-800 truncate flex items-center gap-1",children:[f==null?void 0:f.name,e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3 text-slate-400",children:e.jsx("path",{fillRule:"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z",clipRule:"evenodd"})})]}),e.jsxs("p",{className:"text-[10px] text-slate-500 font-medium",children:[f==null?void 0:f.members.length," "]})]}),Y&&!b&&e.jsx("button",{onClick:J,className:"p-2 rounded-full bg-slate-100 text-slate-500 hover:text-violet-600 transition-colors",title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("button",{onClick:()=>ie(x),disabled:b,className:`p-2 rounded-full transition-all active:scale-90 ${b?"bg-slate-100 text-slate-300":"bg-violet-100 text-violet-600 shadow-sm"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{fillRule:"evenodd",d:"M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .914-.143Z",clipRule:"evenodd"})})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 no-scrollbar space-y-2 bg-[#f0f4f8]",ref:Ae,children:[x.map((S,k)=>{const H=S.role==="user",E=a.find(ne=>ne.id===S.charId);return e.jsx(Bf,{msg:S,isUser:H,char:E,userAvatar:i.avatar,onImageClick:ne=>window.open(ne,"_blank"),selectionMode:z,isSelected:F.has(S.id),onToggleSelect:Ee,onLongPress:P},k)}),b&&e.jsxs("div",{className:"flex items-center gap-2 pl-4 py-2 animate-pulse opacity-70",children:[e.jsxs("div",{className:"flex -space-x-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-300 border-2 border-white"}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-200 border-2 border-white"})]}),e.jsx("span",{className:"text-xs text-slate-400 font-medium",children:"..."})]})]}),e.jsxs("div",{className:"bg-[#f0f2f5] border-t border-slate-200 pb-safe shrink-0 z-40 relative",children:[z?e.jsx("div",{className:"p-3 flex justify-center bg-white",children:e.jsxs("button",{onClick:de,className:"w-full py-3 bg-red-500 text-white font-bold rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})," (",F.size,")"]})}):e.jsxs("div",{className:"p-2 flex items-end gap-2",children:[e.jsx("button",{onClick:()=>{T(!j),D(!1)},className:`w-9 h-9 rounded-full flex items-center justify-center shrink-0 transition-transform ${j?"bg-slate-300 rotate-45":"bg-transparent hover:bg-slate-200"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-7 h-7 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),e.jsxs("div",{className:"flex-1 bg-white rounded-xl flex items-end px-3 py-2 border border-slate-200 focus-within:border-violet-400 focus-within:ring-2 focus-within:ring-violet-100 transition-all",children:[e.jsx("textarea",{rows:1,value:A,onChange:S=>w(S.target.value),onKeyDown:S=>{S.key==="Enter"&&!S.shiftKey&&(S.preventDefault(),_(A))},className:"flex-1 bg-transparent text-[16px] outline-none resize-none max-h-28 text-slate-800 placeholder:text-slate-400 py-1",placeholder:"Message...",style:{height:"auto",minHeight:"24px"}}),e.jsx("button",{onClick:()=>{D(!$),T(!1)},className:"p-1 -mr-1 ml-1 text-slate-400 hover:text-yellow-500 transition-colors shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})})})]}),A.trim()?e.jsx("button",{onClick:()=>_(A),className:"h-9 px-4 bg-violet-500 text-white rounded-xl font-bold text-sm shadow-md active:scale-95 transition-all",children:""}):e.jsx("div",{className:"w-2"})]}),j&&e.jsx("div",{className:"h-64 bg-[#f0f2f5] border-t border-slate-200 p-6 animate-slide-up",children:e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs("button",{onClick:()=>{var S;return(S=Le.current)==null?void 0:S.click()},className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:"w-14 h-14 bg-white rounded-2xl flex items-center justify-center shadow-sm border border-slate-200 group-active:scale-95 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})})}),e.jsx("span",{className:"text-xs text-slate-500",children:""})]}),e.jsx("input",{type:"file",ref:Le,className:"hidden",accept:"image/*",onChange:K}),e.jsxs("button",{onClick:()=>Q("transfer"),className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:"w-14 h-14 bg-white rounded-2xl flex items-center justify-center shadow-sm border border-slate-200 group-active:scale-95 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-orange-500",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}),e.jsx("span",{className:"text-xs text-slate-500",children:""})]})]})}),$&&e.jsx("div",{className:"h-64 bg-[#f0f2f5] border-t border-slate-200 p-4 animate-slide-up overflow-y-auto no-scrollbar",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:L.map((S,k)=>e.jsx("button",{onClick:()=>_(S.url,"emoji"),className:"aspect-square bg-white rounded-xl p-2 border border-slate-200 shadow-sm active:scale-95 flex items-center justify-center",children:e.jsx("img",{src:S.url,className:"w-full h-full object-contain pointer-events-none"})},k))})})]}),e.jsx(Ye,{isOpen:M==="settings",title:"",onClose:()=>Q("none"),footer:e.jsx("button",{onClick:y,className:"w-full py-3 bg-violet-500 text-white font-bold rounded-2xl shadow-lg shadow-violet-200",children:""}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-center",children:[e.jsxs("div",{onClick:()=>{var S;return(S=N.current)==null?void 0:S.click()},className:"w-24 h-24 rounded-3xl bg-slate-100 border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer overflow-hidden relative group hover:border-violet-400",children:[f!=null&&f.avatar?e.jsx("img",{src:f.avatar,className:"w-full h-full object-cover opacity-90 group-hover:opacity-100"}):e.jsx("span",{className:"text-xs text-slate-400 font-bold",children:""}),e.jsx("div",{className:"absolute inset-0 bg-black/20 hidden group-hover:flex items-center justify-center text-white",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"})]})})]}),e.jsx("input",{type:"file",ref:N,className:"hidden",accept:"image/*",onChange:W})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:""}),e.jsx("input",{value:De,onChange:S=>$e(S.target.value),className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:bg-white focus:border-violet-300 transition-all"})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 block",children:" (Neural Link)"}),e.jsx("button",{onClick:R,disabled:ce,className:"w-full py-3 bg-indigo-50 text-indigo-600 font-bold rounded-2xl border border-indigo-100 active:scale-95 transition-transform flex items-center justify-center gap-2 mb-2",children:ce?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-indigo-200 border-t-indigo-500 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs",children:me||"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})," "]})}),e.jsx("p",{className:"text-[9px] text-slate-400 leading-tight px-1",children:'""'})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-100",children:[e.jsx("label",{className:"text-[10px] font-bold text-red-400 uppercase tracking-widest mb-3 block",children:""}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 cursor-pointer",onClick:()=>re(!q),children:[e.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center transition-colors ${q?"bg-violet-500 border-violet-500":"bg-slate-100 border-slate-300"}`,children:q&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),e.jsx("span",{className:"text-xs text-slate-600",children:"10 ()"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:O,className:"flex-1 py-3 bg-red-50 text-red-500 font-bold rounded-2xl border border-red-100 active:scale-95 transition-transform flex items-center justify-center gap-2 text-xs",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),""]}),e.jsx("button",{onClick:()=>{f&&C(f.id)},className:"flex-1 py-3 text-white bg-red-500 hover:bg-red-600 rounded-2xl text-xs font-bold transition-colors shadow-lg shadow-red-200",children:""})]})]})]})}),e.jsx(Ye,{isOpen:M==="transfer",title:"",onClose:()=>Q("none"),footer:e.jsx("button",{onClick:()=>{_(`[] ${je} Credits`,"transfer",{amount:je}),Q("none")},className:"w-full py-3 bg-orange-500 text-white font-bold rounded-2xl shadow-lg shadow-orange-200",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center text-5xl py-4 animate-bounce",children:""}),e.jsx("input",{type:"number",value:je,onChange:S=>xe(S.target.value),placeholder:"",className:"w-full px-4 py-4 bg-slate-100 rounded-2xl text-center text-2xl font-bold outline-none text-slate-800 placeholder:text-slate-300",autoFocus:!0})]})})]})},Ru={textColor:"#334155",backgroundColor:"#ffffff",borderRadius:20,opacity:1,backgroundImageOpacity:.5,decorationX:90,decorationY:-10,decorationScale:1,decorationRotate:0,avatarDecorationX:50,avatarDecorationY:50,avatarDecorationScale:1,avatarDecorationRotate:0},Wf={id:"",name:"New Theme",type:"custom",user:{...Ru,textColor:"#ffffff",backgroundColor:"#6366f1"},ai:{...Ru},customCss:""},Uf=[{name:" (Glass)",code:`/* Glassmorphism for bubbles */
.sully-bubble-user, .sully-bubble-ai {
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.4);
  box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}
.sully-bubble-user { background: rgba(99, 102, 241, 0.7) !important; }
.sully-bubble-ai { background: rgba(255, 255, 255, 0.7) !important; }`},{name:" (Neon)",code:`/* Glowing Neon Borders */
.sully-bubble-user {
  border: 2px solid #a855f7;
  box-shadow: 0 0 10px #a855f7;
  background: #2e1065 !important;
  color: #fff !important;
}
.sully-bubble-ai {
  border: 2px solid #3b82f6;
  box-shadow: 0 0 10px #3b82f6;
  background: #172554 !important;
  color: #fff !important;
}`},{name:" (Pixel)",code:`/* Pixel Art Style */
.sully-bubble-user, .sully-bubble-ai {
  border-radius: 0px !important;
  border: 2px solid #000;
  box-shadow: 4px 4px 0px #000;
  font-family: monospace;
}`}],Hf=t=>{let s="#ffffff",n=1;if(!t)return{hex:s,alpha:n};if(t.startsWith("#"))return s=t.substring(0,7),{hex:s,alpha:1};if(t.startsWith("rgba")){const r=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(r){const a=parseInt(r[1]),o=parseInt(r[2]),l=parseInt(r[3]),c=r[4]?parseFloat(r[4]):1,i=d=>d.toString(16).padStart(2,"0");s=`#${i(a)}${i(o)}${i(l)}`,n=c}}return{hex:s,alpha:n}},Gf=(t,s)=>{const n=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),a=parseInt(t.slice(5,7),16);return`rgba(${n}, ${r}, ${a}, ${s})`},Ou="/* PADDING_AUTO_START */",Fu="/* PADDING_AUTO_END */",Vf=(t,s)=>{const n=Math.round(s*1.6),r=`
${Ou}
.sully-bubble-user, .sully-bubble-ai {
  padding: ${s}px ${n}px !important;
}
${Fu}`,a=new RegExp(`${Ou.replace(/\*/g,"\\*")}[\\s\\S]*?${Fu.replace(/\*/g,"\\*")}`);return t&&t.match(a)?t.replace(a,r):(t||"")+r},Kf=t=>{const s=t==null?void 0:t.match(/padding:\s*(\d+)px/);return s?parseInt(s[1]):12},Yf=()=>{const{closeApp:t,addCustomTheme:s,addToast:n}=mt(),[r,a]=u.useState({...Wf,id:`theme-${Date.now()}`}),[o,l]=u.useState("user"),[c,i]=u.useState("base"),[d,h]=u.useState(12),p=u.useRef(null),f=u.useRef(null),m=u.useRef(null),x=r[o==="css"?"user":o];u.useEffect(()=>{r.customCss&&h(Kf(r.customCss))},[]);const g=($,D)=>{o!=="css"&&a(M=>({...M,[o]:{...M[o],[$]:D}}))},A=($,D)=>{const M=D===1?$:Gf($,D);g("backgroundColor",M)},w=$=>{h($);const D=Vf(r.customCss||"",$);a(M=>({...M,customCss:D}))},b=async($,D)=>{try{const M=await Ut($);D==="bg"?g("backgroundImage",M):D==="deco"?g("decoration",M):D==="avatarDeco"&&g("avatarDecoration",M),n("","success")}catch(M){n(M.message,"error")}},v=()=>{r.name.trim()&&(s(r),t())},j=$=>{const D=$==="user"?r.user:r.ai,M=$==="user",Q=o===$||o==="css",q={backgroundColor:D.backgroundColor,borderRadius:`${D.borderRadius}px`,opacity:D.opacity,borderBottomLeftRadius:M?`${D.borderRadius}px`:"4px",borderBottomRightRadius:M?"4px":`${D.borderRadius}px`,borderTopLeftRadius:`${D.borderRadius}px`,borderTopRightRadius:`${D.borderRadius}px`};return e.jsxs("div",{className:`relative w-full flex items-end transition-all duration-300 cursor-pointer ${Q?"opacity-100 scale-100":"opacity-60 scale-95 grayscale-[0.5] hover:opacity-80"} ${M?"justify-end":"justify-start"}`,onClick:()=>l($),title:`${M?"":""}`,children:[e.jsxs("div",{className:`absolute bottom-0 ${M?"right-0":"left-0"} w-10 h-10 pb-1 z-10`,children:[e.jsx("div",{className:"w-full h-full rounded-full bg-slate-300 overflow-hidden relative z-0 shadow-sm border border-white/50",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white/50 font-bold text-[10px]",children:M?"ME":"AI"})}),D.avatarDecoration&&e.jsx("img",{src:D.avatarDecoration,className:"absolute pointer-events-none z-10 max-w-none",style:{left:`${D.avatarDecorationX??50}%`,top:`${D.avatarDecorationY??50}%`,width:`${40*(D.avatarDecorationScale??1)}px`,height:"auto",transform:`translate(-50%, -50%) rotate(${D.avatarDecorationRotate??0}deg)`}})]}),e.jsxs("div",{className:`relative group max-w-[75%] ${M?"mr-14":"ml-14"}`,children:[D.decoration&&e.jsx("img",{src:D.decoration,className:"absolute z-20 w-8 h-8 object-contain drop-shadow-sm pointer-events-none",style:{left:`${D.decorationX??(M?90:10)}%`,top:`${D.decorationY??-10}%`,transform:`translate(-50%, -50%) scale(${D.decorationScale??1}) rotate(${D.decorationRotate??0}deg)`}}),e.jsxs("div",{className:`relative px-5 py-3 shadow-sm text-sm overflow-hidden ${M?"sully-bubble-user":"sully-bubble-ai"}`,style:q,children:[D.backgroundImage&&e.jsx("div",{className:"absolute inset-0 bg-cover bg-center pointer-events-none z-0",style:{backgroundImage:`url(${D.backgroundImage})`,opacity:D.backgroundImageOpacity??.5}}),e.jsx("span",{className:"relative z-10 leading-relaxed",style:{color:D.textColor},children:M?"":""})]})]})]})},T=Hf(x.backgroundColor);return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light relative",children:[e.jsxs("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-20 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-xl font-medium text-slate-700",children:""})]}),e.jsx("button",{onClick:v,className:"px-4 py-1.5 bg-primary text-white rounded-full text-xs font-bold shadow-lg shadow-primary/30 active:scale-95 transition-all",children:""})]}),e.jsxs("div",{className:"flex-1 bg-slate-100 relative overflow-hidden flex flex-col p-6 justify-center items-center gap-6",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(#cbd5e1 1px, transparent 1px)",backgroundSize:"20px 20px"}}),r.customCss&&e.jsx("style",{children:r.customCss}),e.jsxs("div",{className:"w-full max-w-sm space-y-6",children:[j("ai"),j("user")]}),e.jsx("div",{className:"text-[10px] text-slate-400 absolute bottom-2",children:""})]}),e.jsxs("div",{className:"bg-white rounded-t-[2.5rem] shadow-[0_-5px_30px_rgba(0,0,0,0.08)] z-30 flex flex-col h-[55%] ring-1 ring-slate-100",children:[e.jsxs("div",{className:"flex px-8 pt-6 pb-2 gap-6 overflow-x-auto no-scrollbar",children:[e.jsx("button",{onClick:()=>l("user"),className:`text-sm font-bold transition-colors whitespace-nowrap ${o==="user"?"text-slate-800":"text-slate-300"}`,children:""}),e.jsx("button",{onClick:()=>l("ai"),className:`text-sm font-bold transition-colors whitespace-nowrap ${o==="ai"?"text-slate-800":"text-slate-300"}`,children:""}),e.jsxs("button",{onClick:()=>l("css"),className:`text-sm font-bold transition-colors whitespace-nowrap flex items-center gap-1 ${o==="css"?"text-indigo-600":"text-slate-300"}`,children:[e.jsx("span",{children:""})," CSS"]})]}),o!=="css"&&e.jsxs("div",{className:"flex px-6 border-b border-slate-100 mb-2 overflow-x-auto no-scrollbar",children:[e.jsx("button",{onClick:()=>i("base"),className:`px-4 py-3 text-xs font-bold uppercase tracking-wider border-b-2 transition-all shrink-0 ${c==="base"?"border-primary text-primary":"border-transparent text-slate-400"}`,children:""}),e.jsx("button",{onClick:()=>i("sticker"),className:`px-4 py-3 text-xs font-bold uppercase tracking-wider border-b-2 transition-all shrink-0 ${c==="sticker"?"border-primary text-primary":"border-transparent text-slate-400"}`,children:""}),e.jsx("button",{onClick:()=>i("avatar"),className:`px-4 py-3 text-xs font-bold uppercase tracking-wider border-b-2 transition-all shrink-0 ${c==="avatar"?"border-primary text-primary":"border-transparent text-slate-400"}`,children:""})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 no-scrollbar pb-20",children:[o==="css"&&e.jsxs("div",{className:"space-y-6 animate-fade-in h-full flex flex-col",children:[e.jsxs("div",{className:"text-[10px] text-slate-400 bg-slate-50 p-3 rounded-xl border border-slate-100 leading-relaxed",children:[e.jsx("span",{className:"font-bold block mb-1 text-slate-500",children:"CSS "}),"CSS ",e.jsx("code",{className:"bg-slate-200 px-1 rounded",children:".sully-bubble-user"}),"  ",e.jsx("code",{className:"bg-slate-200 px-1 rounded",children:".sully-bubble-ai"})," ",e.jsx("br",{})," ",e.jsx("code",{className:"text-red-400",children:"!important"})," "]}),e.jsx("textarea",{value:r.customCss||"",onChange:$=>a(D=>({...D,customCss:$.target.value})),placeholder:"/*  CSS  */",className:"flex-1 w-full bg-slate-800 text-slate-300 font-mono text-xs p-4 rounded-xl resize-none shadow-inner focus:ring-2 focus:ring-indigo-500 outline-none leading-relaxed",spellCheck:!1}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:" (Templates)"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar pb-2",children:Uf.map(($,D)=>e.jsx("button",{onClick:()=>a(M=>({...M,customCss:$.code})),className:"px-3 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg text-xs font-mono text-slate-600 border border-slate-200 whitespace-nowrap transition-colors",children:$.name},D))})]})]}),o!=="css"&&c==="base"&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:" (Theme Name)"}),e.jsx("input",{value:r.name,onChange:$=>a(D=>({...D,name:$.target.value})),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm focus:border-primary/50 transition-all outline-none",placeholder:""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:""}),e.jsx("div",{className:"flex items-center gap-2 bg-slate-50 p-2 rounded-xl border border-slate-100",children:e.jsx("input",{type:"color",value:x.textColor,onChange:$=>g("textColor",$.target.value),className:"w-8 h-8 rounded-lg border-none cursor-pointer bg-transparent"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-2",children:" (Base)"}),e.jsx("div",{className:"flex items-center gap-2 bg-slate-50 p-2 rounded-xl border border-slate-100",children:e.jsx("input",{type:"color",value:T.hex,onChange:$=>A($.target.value,T.alpha),className:"w-8 h-8 rounded-lg border-none cursor-pointer bg-transparent"})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:" (Background Alpha)"}),e.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:[Math.round(T.alpha*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:T.alpha,onChange:$=>A(T.hex,parseFloat($.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"/ (Size/Padding)"}),e.jsx("span",{className:"text-[10px] text-slate-500 font-mono",children:d<=6?"Compact":d>=16?"Loose":"Normal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-slate-400",children:""}),e.jsx("input",{type:"range",min:"4",max:"24",step:"1",value:d,onChange:$=>w(parseInt($.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:""})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:""}),e.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:[x.borderRadius,"px"]})]}),e.jsx("input",{type:"range",min:"0",max:"30",value:x.borderRadius,onChange:$=>g("borderRadius",parseInt($.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{onClick:()=>{var $;return($=p.current)==null?void 0:$.click()},className:"cursor-pointer group relative h-24 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 flex flex-col items-center justify-center text-slate-400 overflow-hidden hover:border-primary/50 hover:text-primary transition-all",children:[x.backgroundImage?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:x.backgroundImage,className:"absolute inset-0 w-full h-full object-cover opacity-50"}),e.jsx("span",{className:"relative z-10 text-[10px] bg-white/80 px-2 py-1 rounded shadow-sm font-bold",children:""})]}):e.jsx("span",{className:"text-xs font-bold",children:"+  (Texture)"}),e.jsx("input",{type:"file",ref:p,className:"hidden",accept:"image/*",onChange:$=>{var D;return((D=$.target.files)==null?void 0:D[0])&&b($.target.files[0],"bg")}}),x.backgroundImage&&e.jsx("button",{onClick:$=>{$.stopPropagation(),g("backgroundImage",void 0)},className:"absolute top-2 right-2 text-[10px] bg-red-100 text-red-500 px-2 py-0.5 rounded-full z-20",children:""})]}),x.backgroundImage&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:""}),e.jsxs("span",{className:"text-[10px] text-slate-500 font-mono",children:[Math.round((x.backgroundImageOpacity??.5)*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:x.backgroundImageOpacity??.5,onChange:$=>g("backgroundImageOpacity",parseFloat($.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]})]}),o!=="css"&&c==="sticker"&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{onClick:()=>{var $;return($=f.current)==null?void 0:$.click()},className:"cursor-pointer group relative h-20 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 flex items-center justify-center text-slate-400 hover:border-primary/50 hover:text-primary transition-all",children:[x.decoration?e.jsx("img",{src:x.decoration,className:"h-10 w-10 object-contain"}):e.jsx("span",{className:"text-xs font-bold",children:"+ /"}),e.jsx("input",{type:"file",ref:f,className:"hidden",accept:"image/*",onChange:$=>{var D;return((D=$.target.files)==null?void 0:D[0])&&b($.target.files[0],"deco")}}),x.decoration&&e.jsx("button",{onClick:$=>{$.stopPropagation(),g("decoration",void 0)},className:"absolute top-2 right-2 text-[10px] bg-red-100 text-red-500 px-2 py-0.5 rounded-full",children:""})]}),x.decoration&&e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-6 p-2",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:" (X / Y)"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"range",min:"-50",max:"150",value:x.decorationX??90,onChange:$=>g("decorationX",parseInt($.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"}),e.jsx("input",{type:"range",min:"-50",max:"150",value:x.decorationY??-10,onChange:$=>g("decorationY",parseInt($.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.decorationScale??1,"x)"]}),e.jsx("input",{type:"range",min:"0.2",max:"3",step:"0.1",value:x.decorationScale??1,onChange:$=>g("decorationScale",parseFloat($.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.decorationRotate??0,")"]}),e.jsx("input",{type:"range",min:"-180",max:"180",value:x.decorationRotate??0,onChange:$=>g("decorationRotate",parseInt($.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]})]})]}),o!=="css"&&c==="avatar"&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{onClick:()=>{var $;return($=m.current)==null?void 0:$.click()},className:"cursor-pointer group relative h-20 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 flex items-center justify-center text-slate-400 hover:border-primary/50 hover:text-primary transition-all",children:[x.avatarDecoration?e.jsx("img",{src:x.avatarDecoration,className:"h-10 w-10 object-contain"}):e.jsx("span",{className:"text-xs font-bold",children:"+ /"}),e.jsx("input",{type:"file",ref:m,className:"hidden",accept:"image/*",onChange:$=>{var D;return((D=$.target.files)==null?void 0:D[0])&&b($.target.files[0],"avatarDeco")}}),x.avatarDecoration&&e.jsx("button",{onClick:$=>{$.stopPropagation(),g("avatarDecoration",void 0)},className:"absolute top-2 right-2 text-[10px] bg-red-100 text-red-500 px-2 py-0.5 rounded-full",children:""})]}),x.avatarDecoration&&e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-6 p-2",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:" (Offset X / Y)"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"range",min:"-50",max:"150",value:x.avatarDecorationX??50,onChange:$=>g("avatarDecorationX",parseInt($.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"}),e.jsx("input",{type:"range",min:"-50",max:"150",value:x.avatarDecorationY??50,onChange:$=>g("avatarDecorationY",parseInt($.target.value)),className:"flex-1 h-1.5 bg-slate-200 rounded-full accent-primary"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.avatarDecorationScale??1,"x)"]}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:x.avatarDecorationScale??1,onChange:$=>g("avatarDecorationScale",parseFloat($.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-slate-400 uppercase block mb-2",children:[" (",x.avatarDecorationRotate??0,")"]}),e.jsx("input",{type:"range",min:"-180",max:"180",value:x.avatarDecorationRotate??0,onChange:$=>g("avatarDecorationRotate",parseInt($.target.value)),className:"w-full h-1.5 bg-slate-200 rounded-full accent-primary"})]})]})]})]})]})]})},Jf=()=>{const{theme:t,updateTheme:s,closeApp:n,setCustomIcon:r,customIcons:a,addToast:o}=mt(),[l,c]=u.useState("theme"),i=u.useRef(null),d=u.useRef(null),h=u.useRef(null),p=u.useRef(null),[f,m]=u.useState(null),[x,g]=u.useState("local"),[A,w]=u.useState(""),b=[{name:"Indigo",config:{hue:245,saturation:25,lightness:65,contentColor:"#ffffff"},color:"hsl(245, 25%, 65%)"},{name:"Sakura",config:{hue:350,saturation:70,lightness:80,contentColor:"#334155"},color:"hsl(350, 70%, 80%)"},{name:"Cyber",config:{hue:170,saturation:100,lightness:45,contentColor:"#ffffff"},color:"hsl(170, 100%, 45%)"},{name:"Noir",config:{hue:0,saturation:0,lightness:20,contentColor:"#ffffff"},color:"hsl(0, 0%, 20%)"},{name:"Sunset",config:{hue:20,saturation:90,lightness:60,contentColor:"#ffffff"},color:"hsl(20, 90%, 60%)"}],v=async M=>{try{o(" ()...","info");const Q=await Ut(M,{skipCompression:!0});s({wallpaper:Q}),o("","success")}catch(Q){o(Q.message,"error")}},j=async M=>{try{const Q=await Ut(M,{maxWidth:800,quality:.9});s({launcherWidgetImage:Q}),o("","success")}catch(Q){o(Q.message,"error")}},T=async M=>{var fe;const Q=(fe=M.target.files)==null?void 0:fe[0];if(!Q)return;const q=[".ttf",".otf",".woff",".woff2"],re=Q.name.substring(Q.name.lastIndexOf(".")).toLowerCase();if(!q.includes(re)){o(" ttf/otf/woff/woff2 ","error");return}o("...","info");const ce=new FileReader;ce.onload=async me=>{var ee;try{const z=(ee=me.target)==null?void 0:ee.result;s({customFont:z}),o("","success")}catch{o("","error")}},ce.onerror=()=>o("","error"),ce.readAsDataURL(Q),p.current&&(p.current.value="")},$=()=>{A.trim()&&(s({customFont:A.trim()}),w(""),o("","success"))},D=async M=>{if(f)try{const Q=await Ut(M);r(f,Q),o("","success")}catch(Q){o(Q.message,"error")}};return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[e.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("button",{onClick:n,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),e.jsxs("div",{className:"flex border-b border-slate-200 bg-white sticky top-0 z-20",children:[e.jsx("button",{onClick:()=>c("theme"),className:`flex-1 py-3 text-sm font-medium transition-colors ${l==="theme"?"text-primary border-b-2 border-primary":"text-slate-400"}`,children:""}),e.jsx("button",{onClick:()=>c("icons"),className:`flex-1 py-3 text-sm font-medium transition-colors ${l==="icons"?"text-primary border-b-2 border-primary":"text-slate-400"}`,children:""})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 no-scrollbar",children:l==="theme"?e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Preset Themes"}),e.jsx("div",{className:"flex gap-3 mb-6 overflow-x-auto no-scrollbar pb-1",children:b.map(M=>e.jsxs("button",{onClick:()=>s(M.config),className:"flex flex-col items-center gap-1.5 shrink-0 group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full shadow-sm border-2 border-white ring-1 ring-black/5 transition-transform group-active:scale-95",style:{backgroundColor:M.color}}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:M.name})]},M.name))}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:[e.jsx("span",{children:"Hue"}),e.jsxs("span",{children:[t.hue,""]})]}),e.jsx("input",{type:"range",min:"0",max:"360",value:t.hue,onChange:M=>s({hue:parseInt(M.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"}),e.jsx("div",{className:"h-2 w-full rounded-full mt-3 opacity-50",style:{background:"linear-gradient(to right, hsl(0, 50%, 80%), hsl(60, 50%, 80%), hsl(120, 50%, 80%), hsl(180, 50%, 80%), hsl(240, 50%, 80%), hsl(300, 50%, 80%), hsl(360, 50%, 80%))"}})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:[e.jsx("span",{children:"Saturation"}),e.jsxs("span",{children:[t.saturation,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.saturation,onChange:M=>s({saturation:parseInt(M.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:[e.jsx("span",{children:"Lightness"}),e.jsxs("span",{children:[t.lightness,"%"]})]}),e.jsx("input",{type:"range",min:"10",max:"95",value:t.lightness,onChange:M=>s({lightness:parseInt(M.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between text-xs text-slate-500 mb-2 font-medium",children:e.jsx("span",{children:"Text/Widget Color"})}),e.jsxs("div",{className:"flex gap-4 items-center bg-slate-50 p-2 rounded-xl border border-slate-100",children:[e.jsx("div",{onClick:()=>s({contentColor:"#ffffff"}),className:`w-8 h-8 rounded-full border-2 cursor-pointer shadow-sm ${t.contentColor==="#ffffff"?"border-primary ring-2 ring-primary/20":"border-slate-200"}`,style:{backgroundColor:"#ffffff"}}),e.jsx("div",{onClick:()=>s({contentColor:"#334155"}),className:`w-8 h-8 rounded-full border-2 cursor-pointer shadow-sm ${t.contentColor==="#334155"?"border-primary ring-2 ring-primary/20":"border-slate-200"}`,style:{backgroundColor:"#334155"}}),e.jsx("div",{className:"h-6 w-px bg-slate-200 mx-1"}),e.jsx("input",{type:"color",value:t.contentColor||"#ffffff",onChange:M=>s({contentColor:M.target.value}),className:"w-8 h-8 rounded-lg border-none cursor-pointer bg-transparent p-0"}),e.jsx("span",{className:"text-xs text-slate-400 font-mono",children:t.contentColor})]})]})]})]}),e.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:" (Global Font)"}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl mb-4",children:[e.jsx("button",{onClick:()=>g("local"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${x==="local"?"bg-white text-primary shadow-sm":"text-slate-400"}`,children:""}),e.jsx("button",{onClick:()=>g("web"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${x==="web"?"bg-white text-primary shadow-sm":"text-slate-400"}`,children:" URL"})]}),x==="local"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full h-24 bg-slate-100 rounded-2xl overflow-hidden relative shadow-inner mb-2 group cursor-pointer border-2 border-dashed border-slate-200 hover:border-primary/50 flex items-center justify-center flex-col gap-2",onClick:()=>{var M;return(M=p.current)==null?void 0:M.click()},children:[t.customFont&&t.customFont.startsWith("data:")?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg font-bold text-slate-700",children:"Abc "}),e.jsx("span",{className:"text-[10px] text-slate-400",children:""})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl text-slate-400",children:"Aa"}),e.jsx("span",{className:"text-xs text-slate-400",children:" (.ttf / .otf)"})]}),e.jsx("div",{className:"absolute inset-0 bg-black/5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-bold bg-black/40 px-3 py-1 rounded-full backdrop-blur-md",children:""})})]}),e.jsx("input",{type:"file",ref:p,className:"hidden",accept:".ttf,.otf,.woff,.woff2",onChange:T})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{value:A,onChange:M=>w(M.target.value),placeholder:" URL (https://...)",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-xs outline-none focus:border-primary transition-all"}),e.jsx("button",{onClick:$,className:"w-full py-2 bg-primary text-white font-bold text-xs rounded-xl shadow-md active:scale-95 transition-transform",children:""}),e.jsx("div",{className:"text-[10px] text-slate-400 px-1",children:t.customFont&&t.customFont.startsWith("http")?e.jsxs("span",{className:"text-green-500",children:[": ",t.customFont]}):":  (.ttf/.woff)"})]}),t.customFont&&e.jsx("button",{onClick:()=>s({customFont:void 0}),className:"w-full py-2 text-xs font-bold text-red-400 bg-red-50 rounded-lg hover:bg-red-100 mt-2",children:""})]}),e.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:" (Status Bar)"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-700",children:""}),e.jsx("div",{className:"text-[10px] text-slate-400 mt-0.5",children:""})]}),e.jsx("button",{onClick:()=>s({hideStatusBar:!t.hideStatusBar}),className:`w-12 h-7 rounded-full transition-colors relative ${t.hideStatusBar?"bg-primary":"bg-slate-200"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow-sm transition-transform ${t.hideStatusBar?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:"Wallpaper"}),e.jsxs("div",{className:"aspect-[9/16] w-1/2 mx-auto bg-slate-100 rounded-2xl overflow-hidden relative shadow-inner mb-4 group cursor-pointer",onClick:()=>{var M;return(M=i.current)==null?void 0:M.click()},children:[e.jsx("img",{src:t.wallpaper,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-bold bg-black/20 px-3 py-1 rounded-full backdrop-blur-md",children:""})})]}),e.jsx("input",{type:"file",ref:i,className:"hidden",accept:"image/*",onChange:M=>{var Q;return((Q=M.target.files)==null?void 0:Q[0])&&v(M.target.files[0])}}),e.jsx("p",{className:"text-center text-[10px] text-slate-400",children:" ()"})]}),e.jsxs("section",{className:"bg-white rounded-3xl p-5 shadow-sm border border-slate-100",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4",children:""}),e.jsxs("div",{className:"w-full h-32 bg-slate-100 rounded-2xl overflow-hidden relative shadow-inner mb-4 group cursor-pointer border-2 border-dashed border-slate-200 hover:border-primary/50 flex items-center justify-center",onClick:()=>{var M;return(M=d.current)==null?void 0:M.click()},children:[t.launcherWidgetImage?e.jsx("img",{src:t.launcherWidgetImage,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-center text-slate-400",children:[e.jsx("span",{className:"text-2xl block mb-1",children:""}),e.jsx("span",{className:"text-xs",children:""})]}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-bold bg-black/20 px-3 py-1 rounded-full backdrop-blur-md",children:""})})]}),e.jsx("input",{type:"file",ref:d,className:"hidden",accept:"image/*",onChange:M=>{var Q;return((Q=M.target.files)==null?void 0:Q[0])&&j(M.target.files[0])}}),t.launcherWidgetImage&&e.jsx("button",{onClick:()=>s({launcherWidgetImage:void 0}),className:"w-full py-2 text-xs font-bold text-red-400 bg-red-50 rounded-lg hover:bg-red-100",children:""})]})]}):e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[dc.map(M=>{const Q=cc[M.icon],q=a[M.id];return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"w-16 h-16 rounded-2xl shadow-sm bg-slate-200 overflow-hidden relative group cursor-pointer",onClick:()=>{var re;m(M.id),(re=h.current)==null||re.click()},children:[q?e.jsx("img",{src:q,className:"w-full h-full object-cover"}):e.jsx("div",{className:`w-full h-full ${M.color} flex items-center justify-center text-white`,children:e.jsx(Q,{className:"w-8 h-8"})}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-white",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})})]}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:M.name}),q&&e.jsx("button",{onClick:()=>r(M.id,void 0),className:"text-[10px] text-red-400",children:""})]},M.id)}),e.jsx("input",{type:"file",ref:h,className:"hidden",accept:"image/*",onChange:M=>{var Q;return((Q=M.target.files)==null?void 0:Q[0])&&D(M.target.files[0])}})]})})]})},Zf=()=>{var T;const{closeApp:t,characters:s,apiConfig:n,addToast:r}=mt(),[a,o]=u.useState("albums"),[l,c]=u.useState(null),[i,d]=u.useState([]),[h,p]=u.useState(null),[f,m]=u.useState(!1);u.useEffect(()=>{l&&U.getGalleryImages(l).then($=>{d($.sort((D,M)=>M.timestamp-D.timestamp))})},[l]);const x=$=>{c($),o("grid")},g=$=>{p($),o("detail")},A=()=>{a==="detail"?o("grid"):a==="grid"?(o("albums"),c(null)):t()},w=async()=>{var D,M,Q,q,re;if(!h||!l||!n.apiKey){r("","error");return}const $=s.find(ce=>ce.id===l);if($){m(!0);try{const ce=`You are ${$.name}. ${$.systemPrompt||"You are a helpful assistant."}
Task: The user sent you a photo. Comment on it briefly (1-3 sentences) based on your personality.
Style: Casual, conversational, strictly NO AI-assistant tone. React as if you received this on a chat app.`,fe={model:n.model,messages:[{role:"system",content:ce},{role:"user",content:[{type:"text",text:"Look at this photo I sent you."},{type:"image_url",image_url:{url:h.url}}]}],max_tokens:8e3,temperature:.7,stream:!1},me=await fetch(`${n.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify(fe)});if(!me.ok){let te=`HTTP Error ${me.status}`;try{const L=await me.json();te=((D=L.error)==null?void 0:D.message)||JSON.stringify(L.error)||te,(te.includes("vision")||te.includes("image"))&&(te="(Vision)")}catch{const oe=await me.text();oe&&(te=oe.slice(0,100))}throw new Error(te)}const ee=await me.json();console.log("Gallery Review Response:",ee);const z=(M=ee.choices)==null?void 0:M[0];if((z==null?void 0:z.finish_reason)==="content_filter")throw new Error("AI  ()");let ve=(Q=z==null?void 0:z.message)==null?void 0:Q.content;if(!ve&&((q=z==null?void 0:z.message)!=null&&q.reasoning_content)&&(ve=z.message.reasoning_content),!ve&&(z!=null&&z.text)&&(ve=z.text),!ve&&((re=z==null?void 0:z.delta)!=null&&re.content)&&(ve=z.delta.content),!ve){const te=JSON.stringify(z||ee);throw console.warn("AI Empty Response Structure:",ee),new Error(`AI . Raw: ${te.substring(0,100)}...`)}await U.updateGalleryImageReview(h.id,ve);const F={...h,review:ve,reviewTimestamp:Date.now()};p(F),d(te=>te.map(L=>L.id===h.id?F:L)),r("","success")}catch(ce){console.error("Review Error:",ce),r(`: ${ce.message}`,"error")}finally{m(!1)}}},b=()=>e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 animate-fade-in",children:[s.map($=>e.jsxs("button",{onClick:()=>x($.id),className:"flex flex-col gap-2 group active:scale-95 transition-transform",children:[e.jsxs("div",{className:"aspect-square bg-slate-200 rounded-2xl shadow-sm overflow-hidden relative border border-white",children:[e.jsx("div",{className:"absolute top-2 left-2 w-full h-full bg-white opacity-50 rounded-xl"}),e.jsx("img",{src:$.avatar,className:"absolute inset-0 w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 bg-black/10 group-hover:bg-transparent transition-colors"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-700 text-center",children:$.name})]},$.id)),s.length===0&&e.jsx("div",{className:"col-span-2 text-center text-slate-400 py-10 text-xs",children:""})]}),v=()=>e.jsx("div",{className:"flex-1 overflow-y-auto p-1 animate-fade-in",children:i.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-10 h-10 opacity-50",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),e.jsx("span",{className:"text-xs",children:""})]}):e.jsx("div",{className:"grid grid-cols-3 gap-0.5",children:i.map($=>e.jsxs("div",{onClick:()=>g($),className:"aspect-square bg-slate-100 relative cursor-pointer overflow-hidden",children:[e.jsx("img",{src:$.url,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"}),$.review&&e.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-primary rounded-full ring-1 ring-white"})]},$.id))})}),j=()=>{var $,D;return h&&e.jsxs("div",{className:"flex flex-col h-full bg-black relative animate-fade-in",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full p-4 flex justify-between items-start z-50 pointer-events-none",children:e.jsx("button",{onClick:()=>o("grid"),className:"text-white bg-black/40 backdrop-blur-md p-2 rounded-full pointer-events-auto active:scale-95 transition-transform hover:bg-black/60 border border-white/10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})})}),e.jsx("div",{className:"flex-1 min-h-0 w-full flex items-center justify-center bg-black relative overflow-hidden",children:e.jsx("img",{src:h.url,className:"max-w-full max-h-full object-contain",alt:"Detail"})}),e.jsx("div",{className:"shrink-0 w-full bg-[#161616] border-t border-white/10 z-40 pb-safe",children:h.review?e.jsxs("div",{className:"p-5 animate-slide-up",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("img",{src:($=s.find(M=>M.id===l))==null?void 0:$.avatar,className:"w-9 h-9 rounded-full border border-white/20 object-cover shadow-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-xs font-bold text-white/50 mb-1.5 uppercase tracking-wide",children:[(D=s.find(M=>M.id===l))==null?void 0:D.name," "]}),e.jsxs("p",{className:"text-[15px] text-white/90 leading-relaxed font-light select-text",children:['"',h.review,'"']})]})]}),e.jsx("div",{className:"flex justify-end border-t border-white/5 pt-2 mt-2",children:e.jsxs("button",{onClick:w,disabled:f,className:"text-[10px] text-white/40 hover:text-primary transition-colors flex items-center gap-1 px-2 py-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-3 h-3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),f?"Thinking...":""]})})]}):e.jsx("div",{className:"p-6 flex justify-center items-center",children:e.jsx("button",{onClick:w,disabled:f,className:"bg-white text-black px-6 py-3 rounded-full text-sm font-bold shadow-[0_0_20px_rgba(255,255,255,0.15)] active:scale-95 transition-transform flex items-center gap-2 hover:bg-slate-200",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-slate-300 border-t-black rounded-full animate-spin"})," ..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg",children:""}),"  TA "]})})})})]})};return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light relative",children:[a!=="detail"&&e.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 z-10 sticky top-0",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("button",{onClick:A,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:a==="albums"?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:a==="albums"?"":((T=s.find($=>$.id===l))==null?void 0:T.name)||""})]})}),a==="albums"&&b(),a==="grid"&&v(),a==="detail"&&j()]})},Bu=["normal","happy","angry","sad","shy"],Xf={scale:1,x:0,y:0},bh=({char:t,onBack:s})=>{const{updateCharacter:n,addToast:r}=mt(),a=u.useRef(null),[o,l]=u.useState("bg"),[c,i]=u.useState(""),[d,h]=u.useState(Xf),[p,f]=u.useState("");u.useEffect(()=>{t.spriteConfig&&h(t.spriteConfig)},[t.id]);const m=t.sprites||{},x=m.normal||m.default||Object.values(m)[0]||t.avatar,g=(T,$)=>{var D;l(T),$&&i($),(D=a.current)==null||D.click()},A=async T=>{var D;const $=(D=T.target.files)==null?void 0:D[0];if($)try{const M=await Ut($);if(o==="bg")n(t.id,{dateBackground:M}),r("","success");else{const Q=c.trim().toLowerCase();if(!Q){r("Key","error");return}const q={...t.sprites||{},[Q]:M};n(t.id,{sprites:q}),r(` [${Q}] `,"success"),i("")}}catch(M){r(M.message,"error")}finally{a.current&&(a.current.value="")}},w=()=>{n(t.id,{spriteConfig:d}),r("","success"),s()},b=t.customDateSprites||[],v=()=>{const T=p.trim().toLowerCase().replace(/\s+/g,"_");if(!T){r("","error");return}if(Bu.includes(T)){r("","error");return}if(b.includes(T)){r("","error");return}if(T==="chibi"){r(" chibi ","error");return}const $=[...b,T];n(t.id,{customDateSprites:$}),f(""),r(` [${T}]`,"success")},j=T=>{const $=b.filter(M=>M!==T);n(t.id,{customDateSprites:$});const D={...t.sprites||{}};delete D[T],n(t.id,{sprites:D,customDateSprites:$}),r(` [${T}]`,"success")};return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-slate-200 bg-white shrink-0 z-20",children:[e.jsx("button",{onClick:s,className:"p-2 -ml-2 text-slate-600 active:scale-95 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-slate-700",children:""}),e.jsx("div",{className:"w-8"})]}),e.jsxs("div",{className:"h-64 bg-black relative overflow-hidden shrink-0 border-b border-slate-200",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-60",style:{backgroundImage:t.dateBackground?`url(${t.dateBackground})`:"none"}}),e.jsx("div",{className:"absolute inset-0 flex items-end justify-center pointer-events-none",children:e.jsx("img",{src:x,className:"max-h-[90%] object-contain transition-transform",style:{transform:`translate(${d.x}%, ${d.y}%) scale(${d.scale})`}})}),e.jsx("div",{className:"absolute top-2 left-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded backdrop-blur-sm",children:" (Preview)"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-8 pb-20",children:[e.jsxs("section",{className:"bg-white p-4 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-4",children:""}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-2",children:[e.jsx("span",{children:" (Scale)"}),e.jsxs("span",{children:[d.scale.toFixed(1),"x"]})]}),e.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:d.scale,onChange:T=>h({...d,scale:parseFloat(T.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-2",children:[e.jsx("span",{children:" (X)"}),e.jsxs("span",{children:[d.x,"%"]})]}),e.jsx("input",{type:"range",min:"-100",max:"100",step:"5",value:d.x,onChange:T=>h({...d,x:parseInt(T.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-2",children:[e.jsx("span",{children:" (Y)"}),e.jsxs("span",{children:[d.y,"%"]})]}),e.jsx("input",{type:"range",min:"-50",max:"50",step:"5",value:d.y,onChange:T=>h({...d,y:parseInt(T.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-primary"})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:" (Background)"}),e.jsx("div",{onClick:()=>g("bg"),className:"aspect-video bg-slate-200 rounded-xl overflow-hidden relative border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer hover:border-primary group",children:t.dateBackground?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.dateBackground,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-bold",children:""})})]}):e.jsx("span",{className:"text-slate-400 text-xs",children:"+ "})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:""}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Bu.map(T=>e.jsxs("div",{onClick:()=>g("sprite",T),className:"flex flex-col gap-2 group cursor-pointer",children:[e.jsx("div",{className:`aspect-[3/4] rounded-xl overflow-hidden relative border ${m[T]?"border-slate-200 bg-white":"border-dashed border-slate-300 bg-slate-100"} shadow-sm flex items-center justify-center transition-all group-hover:border-primary`,children:m[T]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m[T],className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-[10px]",children:""})})]}):e.jsx("span",{className:"text-slate-300 text-2xl",children:"+"})}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xs font-bold text-slate-600 capitalize",children:T})})]},T))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase mb-3",children:" (Custom Emotions)"}),e.jsx("p",{className:"text-[11px] text-slate-400 mb-4",children:"AI "}),b.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-3 mb-4",children:b.map(T=>e.jsxs("div",{className:"flex flex-col gap-2 group relative",children:[e.jsx("div",{onClick:()=>g("sprite",T),className:`aspect-[3/4] rounded-xl overflow-hidden relative border ${m[T]?"border-slate-200 bg-white":"border-dashed border-slate-300 bg-slate-100"} shadow-sm flex items-center justify-center transition-all group-hover:border-primary cursor-pointer`,children:m[T]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m[T],className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-[10px]",children:""})})]}):e.jsx("span",{className:"text-slate-300 text-2xl",children:"+"})}),e.jsxs("div",{className:"text-center flex items-center justify-center gap-1",children:[e.jsx("div",{className:"text-xs font-bold text-slate-600 capitalize truncate",children:T}),e.jsx("button",{onClick:$=>{$.stopPropagation(),j(T)},className:"text-slate-300 hover:text-red-400 transition-colors shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3.5 h-3.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]})]},T))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:T=>f(T.target.value),onKeyDown:T=>{T.key==="Enter"&&v()},placeholder:" ( scared, excited...)",className:"flex-1 px-4 py-3 bg-slate-100 rounded-xl text-sm focus:ring-1 focus:ring-primary/30 outline-none transition-all"}),e.jsx("button",{onClick:v,disabled:!p.trim(),className:"px-5 py-3 bg-primary text-white text-sm font-bold rounded-xl disabled:opacity-40 active:scale-95 transition-all",children:""})]})]}),e.jsx("input",{type:"file",ref:a,className:"hidden",accept:"image/*",onChange:A})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 bg-white/90 backdrop-blur-sm sticky bottom-0 z-20",children:e.jsx("button",{onClick:w,className:"w-full py-3 bg-primary text-white font-bold rounded-2xl shadow-lg active:scale-95 transition-transform",children:""})})]})},qf=t=>{const s=t.trim().toLowerCase();return!!(s.startsWith("(")&&s.endsWith(")")&&(s.includes("in person")||s.includes("face-to-face")||s.includes("location")||s.includes("time"))||s.startsWith("[system")||s.startsWith("(system"))},ni=t=>t.replace(/\[.*?\]/g,"").trim(),ri=(t,s="normal")=>{if(!t)return[];const n=t.split(`
`).map(o=>o.trim()).filter(o=>o.length>0),r=[];let a=s;for(const o of n){if(qf(o))continue;const l=o.match(/^\[([a-zA-Z0-9_\-]+)\]\s*(.*)/);let c=o;if(l)a=l[1].toLowerCase(),c=l[2];else{const i=o.match(/^\[([a-zA-Z0-9_\-]+)\]$/);if(i){a=i[1].toLowerCase();continue}}c&&r.push({text:c,emotion:a})}return r},Qf=({char:t,userProfile:s,messages:n,peekStatus:r,initialState:a,onSendMessage:o,onReroll:l,onExit:c,onEditMessage:i,onDeleteMessage:d,onSettings:h})=>{const{addToast:p,registerBackHandler:f}=mt(),[m,x]=u.useState(!1),[g,A]=u.useState(t.dateBackground||""),[w,b]=u.useState(""),[v,j]=u.useState(t.spriteConfig||{scale:1,x:0,y:0}),[T,$]=u.useState([]),[D,M]=u.useState([]),[Q,q]=u.useState(""),[re,ce]=u.useState(""),[fe,me]=u.useState(!1),[ee,z]=u.useState(""),[ve,F]=u.useState(!1),[te,L]=u.useState(!1),[oe,he]=u.useState(!1),[Te,De]=u.useState(!1),[$e,ge]=u.useState("none"),[I,je]=u.useState(null),xe=u.useRef(null),Ae=u.useRef(null),Le=u.useRef(null);u.useEffect(()=>f(()=>Te?(De(!1),!0):oe?(he(!1),!0):(he(!0),!0)),[Te,oe,f]);const N=Sn.useMemo(()=>{const C=n.map(O=>{var R;return(R=O.metadata)==null?void 0:R.isOpening}).lastIndexOf(!0);return C!==-1?n.slice(C):n},[n]);u.useEffect(()=>{if(a)A(a.bgImage),b(a.currentSprite),q(a.currentText),ce(a.currentText),$(a.dialogueQueue),M(a.dialogueBatch),x(a.isNovelMode);else{const C=t.sprites;let O=(C==null?void 0:C.normal)||(C==null?void 0:C.default);if(!O&&C){const K=B.find(ie=>C[ie]);O=K?C[K]:Object.values(C).find(ie=>ie)||t.avatar}O||(O=t.avatar),b(O);const _=ri(r||"Waiting for connection...","normal");if(M(_),$(_),_.length>0){const K=_[0];q(K.text),$(_.slice(1))}}},[]),u.useEffect(()=>{t.spriteConfig&&j(t.spriteConfig),t.dateBackground&&A(t.dateBackground)},[t]),u.useEffect(()=>{m&&Le.current&&(Le.current.scrollTop=Le.current.scrollHeight)},[N.length,m,ve]),u.useEffect(()=>{if(!Q||m){m&&ce(Q);return}me(!0),ce("");let C=0;const O=setInterval(()=>{ce(Q.substring(0,C+1)),C++,C>=Q.length&&(clearInterval(O),me(!1))},20);return()=>clearInterval(O)},[Q,m]);const B=[...["normal","happy","angry","sad","shy"],...t.customDateSprites||[]],ue=(C,O)=>{if(q(C.text),C.emotion&&t.sprites){const R=C.emotion.toLowerCase();if(B.includes(R)){const _=t.sprites[R];_&&b(_)}else{const _=B.find(K=>R.includes(K));_&&t.sprites[_]&&b(t.sprites[_])}}$(O)},P=C=>{if(!C.target.closest("button, input, textarea, .control-panel")&&!m){if(fe){ce(Q),me(!1);return}if(T.length>0){ue(T[0],T.slice(1));return}if(D.length>0){p(" ","info"),ue(D[0],D.slice(1));return}}},Ee=async()=>{if(!ee.trim()||te)return;const C=ee.trim();z(""),F(!1),L(!0);try{const O=await o(C),R=ri(O,"normal");M(R),$(R),R.length>0&&ue(R[0],R.slice(1))}catch{q("()"),F(!0)}finally{L(!1)}},de=async()=>{if(!te){L(!0);try{const C=await l(),O=ri(C,"normal");M(O),$(O),O.length>0&&ue(O[0],O.slice(1))}catch{}finally{L(!1)}}},J=()=>{const C={dialogueQueue:T,dialogueBatch:D,currentText:Q,bgImage:g,currentSprite:w,isNovelMode:m,timestamp:Date.now(),peekStatus:r};c(C)},be=(C,O)=>{"touches"in C?Ae.current={x:C.touches[0].clientX,y:C.touches[0].clientY}:Ae.current={x:C.clientX,y:C.clientY},xe.current=setTimeout(()=>{je(O),ge("options")},600)},y=C=>{if(!xe.current||!Ae.current)return;let O,R;"touches"in C?(O=C.touches[0].clientX,R=C.touches[0].clientY):(O=C.clientX,R=C.clientY);const _=Math.abs(O-Ae.current.x),K=Math.abs(R-Ae.current.y);(_>10||K>10)&&(xe.current&&clearTimeout(xe.current),xe.current=null)},W=()=>{xe.current&&clearTimeout(xe.current),xe.current=null},se=n.length>0&&n[n.length-1].role==="assistant";return e.jsxs("div",{className:"h-full w-full relative bg-black overflow-hidden font-sans select-none",onClick:P,children:[e.jsx("div",{className:`absolute inset-0 bg-cover bg-center transition-all duration-1000 ${m?"blur-xl opacity-30":"opacity-80"}`,style:{backgroundImage:g?`url(${g})`:"none"}}),e.jsxs("div",{className:"absolute top-0 right-0 p-4 pt-12 z-[100] flex justify-end gap-3 pointer-events-auto",children:[!te&&se&&!m&&e.jsx("button",{onClick:C=>{C.stopPropagation(),de()},className:"bg-black/30 backdrop-blur-md text-white w-10 h-10 rounded-full flex items-center justify-center border border-white/20 hover:bg-white/20 transition-all shadow-lg active:scale-95",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),x(!m)},className:`w-10 h-10 rounded-full flex items-center justify-center border transition-all shadow-lg active:scale-95 ${m?"bg-white text-black border-white":"bg-black/30 backdrop-blur-md border-white/20 text-white hover:bg-white/20"}`,children:m?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),F(!ve)},className:`w-10 h-10 rounded-full flex items-center justify-center border transition-all shadow-lg active:scale-95 ${ve?"bg-primary border-primary text-white":"bg-black/30 backdrop-blur-md border-white/20 text-white hover:bg-white/20"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),De(!0)},className:"bg-black/30 backdrop-blur-md text-white w-10 h-10 rounded-full flex items-center justify-center border border-white/20 hover:bg-white/20 transition-all shadow-lg active:scale-95",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 0 1 0 2.555c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.212 1.281c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-2.555c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]})}),e.jsxs("button",{onClick:()=>he(!0),className:"bg-red-500/80 backdrop-blur-md text-white px-4 h-10 rounded-full flex items-center justify-center gap-1 border border-white/20 hover:bg-red-600 transition-colors shadow-lg active:scale-95",children:[e.jsx("span",{className:"text-xs font-bold mr-1",children:""}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})})]})]}),m&&e.jsx("div",{ref:Le,className:"absolute inset-0 z-20 overflow-y-auto no-scrollbar pt-24 pb-32 px-8 mask-image-gradient bg-black/90 backdrop-blur-sm overscroll-contain",onClick:C=>{C.stopPropagation(),F(!0)},children:e.jsx("div",{className:"min-h-full flex flex-col justify-end",children:e.jsxs("div",{className:"max-w-2xl mx-auto animate-fade-in space-y-6",children:[N.length===0&&r&&e.jsx("div",{className:"text-slate-200/50 italic text-center text-sm mb-8 px-4",children:ni(r).split(`
`).map((C,O)=>C.trim()&&e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed tracking-wide my-2",children:C},O))}),N.map(C=>e.jsx("div",{className:"group relative rounded-xl transition-colors -mx-4 px-4 py-2 active:bg-white/5",onTouchStart:O=>be(O,C),onTouchEnd:W,onTouchMove:y,onMouseDown:O=>be(O,C),onMouseUp:W,onMouseMove:y,onMouseLeave:W,onContextMenu:O=>{O.preventDefault(),je(C),ge("options")},children:C.role==="user"?e.jsxs("p",{className:"whitespace-pre-wrap font-serif text-[16px] text-slate-400 text-right leading-loose tracking-wide italic border-r-2 border-slate-600/50 pr-4",children:[ni(C.content)," ",e.jsx("span",{className:"text-[10px] uppercase font-sans not-italic ml-2 opacity-50",children:s.name})]}):e.jsx("div",{children:(C.content||"").split(`
`).map((O,R)=>{const _=ni(O);return _?e.jsx("p",{className:"whitespace-pre-wrap font-serif text-[18px] text-slate-200 text-justify leading-loose tracking-wide drop-shadow-md border-l-2 border-white/10 pl-4 mb-4 last:mb-0",children:_},R):null})})},C.id))]})})}),!m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-[90%] flex items-end justify-center pointer-events-none z-10 overflow-hidden",children:w&&e.jsx("img",{src:w,className:"max-h-full max-w-full object-contain drop-shadow-[0_10px_20px_rgba(0,0,0,0.5)] transition-all duration-300 origin-bottom",style:{filter:ve?"brightness(1)":fe?"brightness(1.05)":"brightness(1)",transform:`translate(${v.x}%, ${v.y}%) scale(${fe?v.scale*1.02:v.scale})`}})}),!te&&e.jsx("div",{className:"absolute inset-x-0 bottom-8 z-30 flex justify-center",children:e.jsxs("div",{className:"w-[90%] max-w-lg bg-black/60 backdrop-blur-xl rounded-2xl border border-white/10 p-6 min-h-[140px] shadow-2xl animate-slide-up hover:bg-black/70 cursor-pointer",children:[e.jsx("div",{className:"absolute -top-3 left-6",children:e.jsx("div",{className:"bg-white/90 text-black px-4 py-1 rounded-sm text-xs font-bold tracking-widest uppercase shadow-[0_4px_10px_rgba(0,0,0,0.3)] transform -skew-x-12",children:t.name})}),e.jsxs("p",{className:"text-white/90 text-[16px] leading-relaxed font-light tracking-wide drop-shadow-md mt-2",children:[re,fe&&e.jsx("span",{className:"inline-block w-2 h-4 bg-white/70 ml-1 animate-pulse align-middle"})]}),!fe&&T.length>0&&e.jsx("div",{className:"absolute bottom-3 right-4 animate-bounce opacity-70",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 text-white",children:e.jsx("path",{fillRule:"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z",clipRule:"evenodd"})})}),!fe&&T.length===0&&D.length>0&&e.jsxs("div",{className:"absolute bottom-3 right-4 opacity-50 text-[10px] text-white flex items-center gap-1 animate-pulse",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3 h-3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),"Loop"]})]})})]}),e.jsxs("div",{className:`absolute inset-x-0 bottom-0 z-40 flex justify-center pointer-events-none transition-all duration-300 ${te||ve?"opacity-100":"opacity-0"}`,children:[te&&e.jsx("div",{className:"absolute bottom-1/2 left-1/2 -translate-x-1/2 z-50 flex flex-col items-center gap-2 pointer-events-auto",children:e.jsxs("div",{className:"bg-black/80 backdrop-blur-md px-6 py-3 rounded-full border border-white/20 shadow-2xl animate-pulse flex items-center gap-3",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce delay-75"}),e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-bounce delay-150"})]}),e.jsx("span",{className:"text-xs text-white font-bold tracking-widest uppercase",children:"Typing..."})]})}),ve&&e.jsxs("div",{className:"w-[90%] max-w-lg bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 p-2 flex gap-2 shadow-2xl animate-fade-in mb-8 pointer-events-auto",onClick:C=>C.stopPropagation(),children:[e.jsx("textarea",{value:ee,onChange:C=>z(C.target.value),placeholder:te?"...":"...",disabled:te,className:"flex-1 bg-transparent px-4 py-3 text-white placeholder:text-white/30 outline-none font-light resize-none h-14 no-scrollbar leading-tight",autoFocus:!0}),e.jsx("button",{onClick:Ee,disabled:!ee.trim()||te,className:"px-6 bg-white text-black rounded-xl font-bold text-sm hover:bg-slate-200 disabled:opacity-50 transition-colors h-14 flex items-center justify-center",children:"SEND"})]})]}),Te&&e.jsx("div",{className:"absolute inset-0 z-[200] animate-slide-up bg-white",children:e.jsx(bh,{char:t,onBack:()=>De(!1)})}),e.jsx(Ye,{isOpen:oe,title:"?",onClose:()=>he(!1),footer:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:()=>he(!1),className:"flex-1 py-3 bg-slate-100 rounded-2xl text-slate-600 font-bold",children:""}),e.jsx("button",{onClick:J,className:"flex-1 py-3 bg-slate-800 text-white rounded-2xl font-bold",children:""})]}),children:e.jsxs("div",{className:"text-center text-slate-500 text-sm py-2 leading-relaxed",children:["",e.jsx("br",{}),""]})}),e.jsx(Ye,{isOpen:$e==="options",title:"",onClose:()=>ge("none"),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{i(I),ge("none")},className:"w-full py-3 bg-slate-50 text-slate-700 font-medium rounded-2xl",children:""}),e.jsx("button",{onClick:()=>{d(I),ge("none")},className:"w-full py-3 bg-red-50 text-red-500 font-medium rounded-2xl",children:""})]})})]})},eg=()=>{var Le;const{closeApp:t,characters:s,activeCharacterId:n,setActiveCharacterId:r,apiConfig:a,addToast:o,updateCharacter:l,virtualTime:c,userProfile:i}=mt(),[d,h]=u.useState("select"),[p,f]=u.useState("select"),[m,x]=u.useState(""),[g,A]=u.useState(!1),[w,b]=u.useState([]),[v,j]=u.useState(null),[T,$]=u.useState([]),[D,M]=u.useState(!1),[Q,q]=u.useState(!1),[re,ce]=u.useState(null),[fe,me]=u.useState(""),ee=s.find(N=>N.id===n),z=async()=>{if(ee){const Y=(await U.getMessagesByCharId(ee.id)).filter(B=>{var ue;return((ue=B.metadata)==null?void 0:ue.source)==="date"}).sort((B,ue)=>B.timestamp-ue.timestamp);$(Y),m&&Y.some(B=>B.content===m&&B.role==="assistant")&&M(!0)}};u.useEffect(()=>{ee&&d==="session"&&z()},[ee,d]);const ve=()=>{d==="peek"?(h("select"),x("")):d==="history"?h("select"):t()},F=()=>`${c.hours.toString().padStart(2,"0")}:${c.minutes.toString().padStart(2,"0")}`,te=N=>{if(!N)return"";const B=Date.now()-N,ue=Math.floor(B/(1e3*60)),P=Math.floor(B/(1e3*60*60)),Ee=new Date().getHours(),de=Ee>=23||Ee<=6;return ue<5?"":ue<60?`[: : ${ue} ]`:P<6?de?`[: : ${P} /]`:`[: : ${P} ]`:P<24?`[: : ${P} ]`:`[: : ${Math.floor(P/24)} ]`},L=N=>{N.savedDateState?j(N):De(N)},oe=()=>{v&&(r(v.id),h("session"),j(null),o("","success"))},he=()=>{v&&(l(v.id,{savedDateState:void 0}),De(v),j(null))},Te=async()=>{if(ee){if(m&&!D)try{await U.saveMessage({charId:ee.id,role:"assistant",type:"text",content:m,metadata:{source:"date",isOpening:!0}}),M(!0)}catch(N){console.error("Failed to save opening",N)}h("session"),await z()}},De=async N=>{r(N.id),h("peek"),A(!0),x(""),M(!1);try{const Y=await U.getMessagesByCharId(N.id),B=N.contextLimit||500,ue=Math.min(B,50),P=Y[Y.length-1],Ee=te(P==null?void 0:P.timestamp),de=Y.slice(-ue).map(R=>{const _=R.type==="image"?"[User sent an image]":R.content;return`${R.role}: ${_}`}).join(`
`),J=`${c.day} ${F()}`,be=At.buildCoreContext(N,i,!1),y=Ee?`

--- [TIME SKIP: ${Ee}] ---

`:`

--- [NEW SCENE START] ---

`,W=`
###  (Sense Presence)
: ${J}
: ${Ee}

### 

****
${N.name} 

### 
1. ****:  []**** [TIME SKIP]
2. ****: ${Ee.includes("")?"":""}
3. ****: `,se=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"system",content:be},{role:"user",content:`[ (Previous Context)]:${de}${y}${W}

(Start sensing...)`}],temperature:.85})});if(!se.ok)throw new Error("Failed to sense presence");const O=(await se.json()).choices[0].message.content;x(O)}catch(Y){x(`(: ${Y.message})`)}finally{A(!1)}},$e=async N=>{if(!ee)throw new Error("No char");await U.saveMessage({charId:ee.id,role:"user",type:"text",content:N,metadata:{source:"date"}});const Y=await U.getMessagesByCharId(ee.id),B=Y.filter(C=>{var O;return((O=C.metadata)==null?void 0:O.source)==="date"}).sort((C,O)=>C.timestamp-O.timestamp);$(B);const ue=ee.contextLimit||500,P=Y.slice(-ue,-1).map(C=>({role:C.role,content:C.type==="image"?"[User sent an image]":C.content}));let Ee=At.buildCoreContext(ee,i);const J=[...["normal","happy","angry","sad","shy"],...ee.customDateSprites||[]];Ee+=`### [Visual Novel Mode: ]
****

###  (One Line per Beat)
****
1. ****: 
2. ****: \`[emotion]\` ()****: ${J.join(", ")}****
3. ****:  **"..."**

### 
1. **Location**: ****
2. **Context**: Opening
`;const be=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"system",content:Ee},...P,{role:"user",content:`${N}

(System Note:  VN )`}],temperature:.85})});if(!be.ok)throw new Error("API Error");const W=(await be.json()).choices[0].message.content;await U.saveMessage({charId:ee.id,role:"assistant",type:"text",content:W,metadata:{source:"date"}});const se=await U.getMessagesByCharId(ee.id);return $(se.filter(C=>{var O;return((O=C.metadata)==null?void 0:O.source)==="date"}).sort((C,O)=>C.timestamp-O.timestamp)),W},ge=async()=>{if(!ee||T.length===0)throw new Error("No context");const N=T[T.length-1];if(N.role!=="assistant")throw new Error("Cannot reroll user message");await U.deleteMessage(N.id);const B=(await U.getMessagesByCharId(ee.id)).filter(O=>O.id!==N.id),ue=B[B.length-1];if(!ue||ue.role!=="user")throw new Error("Context lost");const P=ee.contextLimit||500,Ee=B.slice(-P,-1).map(O=>({role:O.role,content:O.type==="image"?"[User sent an image]":O.content}));let de=At.buildCoreContext(ee,i);const be=[...["normal","happy","angry","sad","shy"],...ee.customDateSprites||[]];de+=`### [Visual Novel Mode: ]
(Same rules apply... ****: ${be.join(", ")})`;const y=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"system",content:de},...Ee,{role:"user",content:`${ue.content}

(System Note: Reroll requested. Please generate a different response.)`}],temperature:.9})});if(!y.ok)throw new Error("API Error");const se=(await y.json()).choices[0].message.content;await U.saveMessage({charId:ee.id,role:"assistant",type:"text",content:se,metadata:{source:"date"}});const C=await U.getMessagesByCharId(ee.id);return $(C.filter(O=>{var R;return((R=O.metadata)==null?void 0:R.source)==="date"}).sort((O,R)=>O.timestamp-R.timestamp)),se},I=async N=>{await U.deleteMessage(N.id),$(Y=>Y.filter(B=>B.id!==N.id))},je=async()=>{re&&(await U.updateMessage(re.id,fe),$(N=>N.map(Y=>Y.id===re.id?{...Y,content:fe}:Y)),q(!1),ce(null),o("","success"))},xe=N=>{ee&&(l(ee.id,{savedDateState:N}),o("","success")),h("select"),x(""),M(!1)},Ae=async N=>{var P;r(N.id);const B=(await U.getMessagesByCharId(N.id)).filter(Ee=>{var de;return((de=Ee.metadata)==null?void 0:de.source)==="date"}).sort((Ee,de)=>de.timestamp-Ee.timestamp),ue=[];if(B.length>0){let Ee=[B[0]];for(let J=1;J<B.length;J++){const be=B[J-1],y=B[J],W=Math.abs(be.timestamp-y.timestamp)>30*60*1e3,se=((P=be.metadata)==null?void 0:P.isOpening)===!0;if(W||se){const C=Ee[Ee.length-1];ue.push({date:new Date(C.timestamp).toLocaleString(),msgs:Ee.reverse()}),Ee=[y]}else Ee.push(y)}const de=Ee[Ee.length-1];ue.push({date:new Date(de.timestamp).toLocaleString(),msgs:Ee.reverse()})}b(ue),h("history")};return d==="select"||!ee?e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-slate-200 bg-white sticky top-0 z-10",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-slate-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-slate-700",children:""}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"p-4 grid grid-cols-2 gap-4 overflow-y-auto",children:s.map(N=>e.jsxs("div",{onClick:()=>L(N),className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 active:scale-95 transition-transform flex flex-col items-center gap-3 relative group",children:[e.jsx("button",{onClick:Y=>{Y.stopPropagation(),Ae(N)},className:"absolute top-2 right-2 p-1.5 text-slate-300 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-colors z-20 active:scale-90",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),e.jsx("img",{src:N.avatar,className:"w-16 h-16 rounded-full object-cover"}),e.jsx("span",{className:"font-bold text-slate-700",children:N.name}),N.savedDateState&&e.jsx("div",{className:"absolute top-2 left-2 w-2 h-2 bg-green-500 rounded-full animate-pulse",title:""})]},N.id))}),e.jsx(Ye,{isOpen:!!v,title:"",onClose:()=>j(null),footer:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:he,className:"flex-1 py-3 bg-slate-100 rounded-2xl text-slate-600 font-bold",children:""}),e.jsx("button",{onClick:oe,className:"flex-1 py-3 bg-green-500 text-white rounded-2xl font-bold shadow-lg shadow-green-200",children:""})]}),children:e.jsxs("div",{className:"text-center text-slate-500 text-sm py-4",children:[" ",v==null?void 0:v.name," ",e.jsx("br",{}),e.jsxs("span",{className:"text-xs text-slate-400 mt-2 block",children:["(: ",(Le=v==null?void 0:v.savedDateState)!=null&&Le.timestamp?new Date(v.savedDateState.timestamp).toLocaleString():"Unknown",")"]})]})})]}):d==="history"?e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-slate-200 bg-white sticky top-0 z-10",children:[e.jsx("button",{onClick:ve,className:"p-2 -ml-2 rounded-full hover:bg-slate-100",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-slate-700",children:""}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 pb-20",children:w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-2",children:[e.jsx("span",{className:"text-4xl opacity-50",children:""}),e.jsx("span",{className:"text-xs",children:""})]}):w.map((N,Y)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-50 px-4 py-3 border-b border-slate-100 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider",children:N.date}),e.jsxs("span",{className:"text-[10px] bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full",children:[N.msgs.length," "]})]}),e.jsx("div",{className:"p-4 space-y-4",children:N.msgs.map(B=>{const ue=(B.content||"").replace(/\[.*?\]/g,"").trim();return e.jsx("div",{className:`flex flex-col ${B.role==="user"?"items-end":"items-start"}`,children:e.jsx("div",{className:`max-w-[90%] text-sm leading-relaxed whitespace-pre-wrap ${B.role==="user"?"text-slate-500 text-right italic":"text-slate-800"}`,children:B.role==="user"?e.jsx("span",{className:"bg-slate-100 px-3 py-2 rounded-xl rounded-tr-none inline-block",children:ue}):e.jsx("span",{children:ue||"()"})})},B.id)})})]},Y))})]}):d==="peek"?e.jsxs("div",{className:"h-full w-full bg-black relative flex flex-col font-sans overflow-hidden",children:[e.jsxs("div",{className:"pt-24 flex flex-col items-center z-10 shrink-0",children:[e.jsxs("div",{className:"text-xs font-mono text-neutral-500 mb-2 tracking-[0.2em] font-medium",children:[c.day.toUpperCase()," ",F()]}),e.jsx("h2",{className:"text-4xl font-light text-white tracking-[0.3em] uppercase",children:ee.name})]}),g&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center -mt-20 z-10",children:[e.jsx("div",{className:"w-12 h-[1px] bg-neutral-800 mb-12"}),e.jsx("div",{className:"w-[1px] h-12 bg-gradient-to-b from-transparent via-white to-transparent animate-pulse mb-6"}),e.jsx("p",{className:"text-sm font-light text-neutral-500 italic tracking-widest",children:"..."})]}),!g&&m&&e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col px-8 pb-10 z-10 animate-fade-in",children:[e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar mb-8 mask-image-gradient pt-8",children:e.jsx("div",{className:"min-h-full flex flex-col justify-center",children:e.jsx("p",{className:"text-neutral-300 text-[15px] leading-8 tracking-wide text-justify font-light select-none whitespace-pre-wrap",children:m})})}),e.jsxs("div",{className:"shrink-0 flex flex-col items-center gap-6",children:[e.jsxs("div",{className:"w-full flex gap-3",children:[e.jsx("button",{onClick:Te,className:"flex-1 h-14 bg-white text-black rounded-full font-bold tracking-[0.1em] text-sm shadow-[0_0_20px_rgba(255,255,255,0.1)] active:scale-95 transition-transform hover:bg-neutral-200",children:" (Approach)"}),e.jsx("button",{onClick:()=>De(ee),className:"w-14 h-14 bg-neutral-800 text-white rounded-full flex items-center justify-center border border-neutral-700 shadow-lg active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 text-[10px] text-neutral-600 font-medium tracking-wider",children:[e.jsx("button",{onClick:()=>{f("peek"),h("settings")},className:"hover:text-neutral-400 transition-colors",children:" / "}),e.jsx("button",{onClick:ve,className:"hover:text-neutral-400 transition-colors",children:""})]})]})]})]}):d==="settings"?e.jsx(bh,{char:ee,onBack:()=>h(p)}):d==="session"?e.jsxs(e.Fragment,{children:[e.jsx(Qf,{char:ee,userProfile:i,messages:T,peekStatus:m,initialState:ee.savedDateState,onSendMessage:$e,onReroll:ge,onExit:xe,onEditMessage:N=>{ce(N),me(N.content),q(!0)},onDeleteMessage:I,onSettings:()=>{}}),e.jsx(Ye,{isOpen:Q,title:"",onClose:()=>q(!1),footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(!1),className:"flex-1 py-3 bg-slate-100 rounded-2xl",children:""}),e.jsx("button",{onClick:je,className:"flex-1 py-3 bg-primary text-white font-bold rounded-2xl",children:""})]}),children:e.jsx("textarea",{value:fe,onChange:N=>me(N.target.value),className:"w-full h-32 bg-slate-100 rounded-2xl p-4 resize-none focus:ring-1 focus:ring-primary/20 transition-all text-sm leading-relaxed"})})]}):null},tg=()=>{const{closeApp:t,userProfile:s,updateUserProfile:n,addToast:r}=mt(),a=u.useRef(null),o=async l=>{var i;const c=(i=l.target.files)==null?void 0:i[0];if(c)try{const d=await Ut(c);n({avatar:d}),r("","success")}catch(d){r(d.message,"error")}};return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col animate-fade-in",children:[e.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{onClick:()=>{var l;return(l=a.current)==null?void 0:l.click()},className:"w-32 h-32 rounded-full bg-white shadow-lg p-1 cursor-pointer group relative",children:[e.jsx("img",{src:s.avatar,className:"w-full h-full rounded-full object-cover group-hover:opacity-80 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-xs font-bold text-slate-600 bg-white/80 px-2 py-1 rounded-full",children:""})})]}),e.jsx("input",{type:"file",ref:a,className:"hidden",accept:"image/*",onChange:o})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:""}),e.jsx("input",{value:s.name,onChange:l=>n({name:l.target.value}),className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 text-lg font-bold text-slate-700 focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block",children:" / "}),e.jsx("p",{className:"text-[10px] text-slate-400 mb-2",children:" AI ()"}),e.jsx("textarea",{value:s.bio,onChange:l=>n({bio:l.target.value}),className:"w-full h-48 bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm text-slate-700 leading-relaxed resize-none focus:border-primary focus:ring-1 focus:ring-primary/20 outline-none transition-all",placeholder:"..."})]})]})]})]})},ia=[{id:"plain",name:"",css:"bg-white",text:"text-slate-700"},{id:"grid",name:"",css:"bg-white",text:"text-slate-700",style:{backgroundImage:"linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px)",backgroundSize:"20px 20px"}},{id:"dot",name:"",css:"bg-[#fffdf5]",text:"text-slate-700",style:{backgroundImage:"radial-gradient(#d1d5db 1px, transparent 1px)",backgroundSize:"20px 20px"}},{id:"lined",name:"",css:"bg-[#fefce8]",text:"text-slate-700",style:{backgroundImage:"repeating-linear-gradient(transparent, transparent 23px, #e5e7eb 23px, #e5e7eb 24px)"}},{id:"dark",name:"",css:"bg-slate-800",text:"text-white/90"},{id:"pink",name:"",css:"bg-pink-50",text:"text-slate-700",style:{backgroundImage:"radial-gradient(#fbcfe8 2px, transparent 2px)",backgroundSize:"30px 30px"}}],zu=["","","","","","","","","","","","","","","","","","","",""],Wu=()=>{const t=new Date,s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${s}-${n}-${r}`},sg=()=>{const{closeApp:t,characters:s,activeCharacterId:n,apiConfig:r,addToast:a,userProfile:o,updateCharacter:l}=mt(),[c,i]=u.useState("select"),[d,h]=u.useState(null),[p,f]=u.useState([]),[m,x]=u.useState(null),[g,A]=u.useState(Wu()),[w,b]=u.useState(!1),[v,j]=u.useState(!1),[T,$]=u.useState(!1),[D,M]=u.useState("user"),[Q,q]=u.useState(!1),[re,ce]=u.useState(null),[fe,me]=u.useState(null),[ee,z]=u.useState(null),ve=u.useRef(null),[F,te]=u.useState([]),[L,oe]=u.useState(!1),[he,Te]=u.useState(""),[De,$e]=u.useState(null),ge=u.useRef(null);u.useEffect(()=>{if(s.length>0&&n){const R=s.find(_=>_.id===n);R&&(h(R),i("calendar"),I(R.id))}U.getJournalStickers().then(te)},[n]);const I=async R=>{const _=await U.getDiariesByCharId(R);f(_.sort((K,ie)=>ie.date.localeCompare(K.date)))},je=R=>{h(R),i("calendar"),I(R.id)},xe=R=>{const _=p.find(K=>K.date===R);_?(x(_),M(_.charPage?"char":"user")):(x({id:`diary-${Date.now()}`,charId:d.id,date:R,userPage:{text:"",paperStyle:"grid",stickers:[]},timestamp:Date.now(),isArchived:!1}),M("user")),i("write"),A(R),me(null)},Ae=(R,_="user")=>{if(!m)return;const K=_==="user"?"userPage":"charPage";let ie=m[K]||{text:"",paperStyle:"plain",stickers:[]};x(S=>S?{...S,[K]:{...ie,...R}}:null)},Le=R=>{const _=D,K=_==="user"?m==null?void 0:m.userPage:m==null?void 0:m.charPage;if(!K&&_==="char")return;const ie={id:`st-${Date.now()}-${Math.random()}`,url:R,x:50,y:50,rotation:(Math.random()-.5)*40,scale:1},S=(K==null?void 0:K.stickers)||[];Ae({stickers:[...S,ie]},_),$(!1)},N=async()=>{if(!he.trim())return;const R=he.split(`
`);let _=0;for(const K of R){const ie=K.split("--");if(ie.length>=2){const S=ie[0].trim(),k=ie.slice(1).join("--").trim();S&&k&&(await U.saveJournalSticker(S,k),_++)}}te(await U.getJournalStickers()),Te(""),oe(!1),a(` ${_} `,"success")},Y=async()=>{De&&(await U.deleteJournalSticker(De.name),te(R=>R.filter(_=>_.name!==De.name)),$e(null),a("","success"))},B=async()=>{m&&(await U.saveDiary(m),await I(m.charId),a("","success"))},ue=(R,_)=>{R.stopPropagation(),me(_)},P=R=>{const _=D==="user"?m==null?void 0:m.userPage:m==null?void 0:m.charPage;if(!_)return;const K=_.stickers.filter(ie=>ie.id!==R);Ae({stickers:K},D),me(null)},Ee=(R,_,K)=>{R.preventDefault(),R.stopPropagation(),R.currentTarget.setPointerCapture(R.pointerId),K==="move"?(ce(_),me(_)):z(_)},de=R=>{if(!re&&!ee||!ve.current||!m)return;const _=ve.current.getBoundingClientRect(),K=D==="user"?m.userPage:m.charPage;if(K){if(re){const ie=(R.clientX-_.left)/_.width*100,S=(R.clientY-_.top)/_.height*100,k=Math.max(0,Math.min(100,ie)),H=Math.max(0,Math.min(100,S)),E=K.stickers.map(ne=>ne.id===re?{...ne,x:k,y:H}:ne);Ae({stickers:E},D)}if(ee){const ie=K.stickers.find(Ne=>Ne.id===ee);if(!ie)return;const S=R.clientX-_.left-ie.x/100*_.width,k=R.clientY-_.top-ie.y/100*_.height,H=Math.sqrt(S*S+k*k),E=Math.max(.2,Math.min(3,H/40)),ne=K.stickers.map(Ne=>Ne.id===ee?{...Ne,scale:E}:Ne);Ae({stickers:ne},D)}}},J=R=>{ce(null),z(null),R.currentTarget.releasePointerCapture(R.pointerId)},be=()=>{me(null)},y=R=>{ge.current=setTimeout(()=>{$e(R)},600)},W=()=>{ge.current&&(clearTimeout(ge.current),ge.current=null)},se=async()=>{var R;if(!m||!d||!r.apiKey){a("","error");return}if(!m.userPage.text.trim()){a("","info");return}b(!0),B();try{let _=At.buildCoreContext(d,o);const K=ia.map(Ce=>Ce.id).join(", "),ie=zu.join(" "),S=F.length>0?`Custom Stickers (Name: URL): 
${F.map(Ce=>`- ${Ce.name}: ${Ce.url}`).join(`
`)}`:"",E=(await U.getMessagesByCharId(d.id)).slice(-30).map(Ce=>{const He=Ce.type==="image"?"[User sent an image]":Ce.content;return`[${new Date(Ce.timestamp).toLocaleTimeString()}] ${Ce.role==="user"?"User":"You"}: ${He}`}).join(`
`);_+=`### [Exchange Diary Mode Instructions]


###  (Recent Context)
****

[RECENT LOGS START]
${E}
[RECENT LOGS END]

### 
1.  (${m.date})
2. ****
   - 
   - ****
   - 
3. 

###  (Stickers)
 EmojiCustom Stickers
${S}
 Custom Sticker URL  stickers 

###  ( JSON)
Structure:
{
  "text": "...",
  "paperStyle": "one of: ${K}",
  "stickers": ["sticker1", "http://custom-sticker-url..."] ( Custom Stickers 0-3)
}`;const ne=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"system",content:_},{role:"user",content:`Users Diary:
${m.userPage.text}`}],temperature:.85})});if(!ne.ok)throw new Error("API Error");let pe=(await ne.json()).choices[0].message.content.trim();pe=pe.replace(/```json/g,"").replace(/```/g,"").trim();let G;try{G=JSON.parse(pe)}catch{G={text:pe,paperStyle:"plain",stickers:[]}}const Z=(G.stickers||[]).map(Ce=>({id:`st-${Math.random()}`,url:Ce,x:Math.random()*70+10,y:Math.random()*70+10,rotation:(Math.random()-.5)*40,scale:1})),Se={text:G.text||"",paperStyle:((R=ia.find(Ce=>Ce.id===G.paperStyle))==null?void 0:R.id)||"plain",stickers:Z},we={...m,charPage:Se};x(we),await U.saveDiary(we),await I(d.id),M("char"),a("","success")}catch(_){a(`: ${_.message}`,"error")}finally{b(!1)}},C=async()=>{var R;if(!(!m||!d||m.isArchived)){j(!0);try{const K=`${At.buildCoreContext(d,o)}

### [System Instruction: Diary Archival]
: (${m.date}) 

###  (Input)
 (${o.name}) :
"${m.userPage.text}"

 (${d.name}) :
"${((R=m.charPage)==null?void 0:R.text)||"()"}"

###  (Output Requirements)
1. ****: ${o.name}
2. ****: 
3. ****:  (50)
`,ie=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:K}],temperature:.3})});if(ie.ok){let k=(await ie.json()).choices[0].message.content;k=k.replace(/^["']|["']$/g,"").trim();const H={id:`mem-${Date.now()}`,date:m.date,summary:k,mood:"diary"},E=[...d.memories||[],H];l(d.id,{memories:E});const ne={...m,isArchived:!0};x(ne),await U.saveDiary(ne),await I(d.id),a("","success")}else throw new Error(`API Error ${ie.status}`)}catch(_){console.error(_),a(`: ${_.message}`,"error")}finally{j(!1)}}},O=(R,_)=>{const K=ia.find(ie=>ie.id===R.paperStyle)||ia[0];return e.jsxs("div",{ref:_===D?ve:void 0,className:`relative w-full h-full shadow-md transition-all duration-300 overflow-hidden ${K.css} flex flex-col rounded-3xl touch-none`,style:{...K.style},onPointerMove:_===D?de:void 0,onPointerUp:_===D?J:void 0,onPointerLeave:_===D?J:void 0,onClick:be,children:[e.jsxs("div",{className:"flex-1 p-6 relative z-10 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 pb-2 border-b border-black/5 shrink-0",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest opacity-50 ${K.text}`,children:_==="user"?"MY DIARY":"REPLY"}),e.jsx("span",{className:`text-[10px] opacity-40 font-mono ${K.text}`,children:m==null?void 0:m.date})]}),e.jsx("textarea",{value:R.text,onChange:ie=>Ae({text:ie.target.value},_),placeholder:_==="user"?"...":"...",className:`flex-1 w-full bg-transparent resize-none outline-none leading-loose text-[16px] font-normal ${K.text} placeholder:opacity-30 no-scrollbar`,readOnly:w})]}),!(_==="char"&&Q)&&R.stickers.map(ie=>{const S=fe===ie.id,k=ie.scale||1;return e.jsxs("div",{onPointerDown:H=>Ee(H,ie.id,"move"),onClick:H=>ue(H,ie.id),className:`absolute text-6xl select-none drop-shadow-md z-20 cursor-move ${re===ie.id?"opacity-90":""} transition-transform`,style:{left:`${ie.x}%`,top:`${ie.y}%`,transform:`translate(-50%, -50%) rotate(${ie.rotation}deg) scale(${k})`,border:S?"2px dashed #3b82f6":"none",borderRadius:"8px",padding:"4px"},children:[ie.url.startsWith("http")||ie.url.startsWith("data")?e.jsx("img",{src:ie.url,className:"w-20 h-20 object-contain pointer-events-none",draggable:!1}):ie.url,S&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute -top-3 -right-3 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs shadow-md cursor-pointer pointer-events-auto",onClick:H=>{H.stopPropagation(),P(ie.id)},children:""}),e.jsx("div",{className:"absolute -bottom-2 -right-2 w-5 h-5 bg-blue-500 rounded-full border-2 border-white shadow-md cursor-nwse-resize pointer-events-auto",onPointerDown:H=>Ee(H,ie.id,"resize")})]})]},ie.id)}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/paper-fibers.png')] opacity-10 pointer-events-none z-0 mix-blend-multiply"})]})};return c==="select"?e.jsxs("div",{className:"h-full w-full bg-amber-50 flex flex-col font-light",children:[e.jsxs("div",{className:"pt-12 pb-4 px-6 border-b border-amber-100 bg-amber-50/80 backdrop-blur-sm sticky top-0 z-20 flex items-center justify-between shrink-0 h-24 box-border",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-amber-100/50 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-amber-900",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-amber-900 text-lg tracking-wide",children:""}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"p-6 grid grid-cols-2 gap-5 overflow-y-auto pb-20 no-scrollbar",children:s.map(R=>e.jsxs("div",{onClick:()=>je(R),className:"aspect-[3/4] bg-white rounded-r-2xl rounded-l-md border-l-4 border-l-amber-800 shadow-[2px_4px_12px_rgba(0,0,0,0.08)] p-4 flex flex-col items-center justify-center gap-3 cursor-pointer active:scale-95 transition-all relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 w-2 bg-gradient-to-r from-black/10 to-transparent"}),e.jsx("div",{className:"w-16 h-16 rounded-full p-[2px] border border-amber-100 bg-amber-50",children:e.jsx("img",{src:R.avatar,className:"w-full h-full rounded-full object-cover"})}),e.jsx("span",{className:"font-bold text-amber-900 text-sm",children:R.name}),e.jsx("span",{className:"text-[9px] text-amber-600 bg-amber-50 px-2 py-1 rounded-full font-mono uppercase tracking-wide",children:"Journal"})]},R.id))})]}):c==="calendar"&&d?e.jsxs("div",{className:"h-full w-full bg-white flex flex-col font-light relative",children:[e.jsxs("div",{className:"pt-12 pb-6 px-6 bg-amber-500 shadow-lg shrink-0 rounded-b-[2rem] z-20",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("button",{onClick:()=>i("select"),className:"text-white/80 hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})})}),e.jsx("div",{className:"w-6"})]}),e.jsxs("div",{className:"text-white",children:[e.jsx("div",{className:"text-xs opacity-70 uppercase tracking-widest font-bold mb-1",children:"Exchange Diary"}),e.jsx("div",{className:"text-3xl font-bold tracking-tight",children:d.name})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-20 no-scrollbar",children:[e.jsxs("button",{onClick:()=>xe(Wu()),className:"w-full py-5 mb-8 border-2 border-dashed border-amber-200 rounded-2xl text-amber-500 font-bold flex items-center justify-center gap-2 hover:bg-amber-50 active:scale-95 transition-all",children:[e.jsx("span",{className:"text-xl",children:"+"})," "]}),e.jsx("div",{className:"space-y-4",children:p.map(R=>e.jsxs("div",{onClick:()=>xe(R.date),className:"flex items-center gap-4 p-4 rounded-2xl bg-white border border-slate-100 shadow-sm active:scale-95 transition-all hover:shadow-md cursor-pointer relative overflow-hidden group",children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-amber-400"}),e.jsxs("div",{className:"w-14 h-14 bg-amber-50 rounded-xl flex flex-col items-center justify-center text-amber-800 shrink-0 border border-amber-100",children:[e.jsxs("span",{className:"text-[10px] font-bold opacity-60",children:[R.date.split("-")[1],""]}),e.jsx("span",{className:"text-xl font-bold leading-none",children:R.date.split("-")[2]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-slate-700 truncate font-medium",children:R.userPage.text||"()"}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("p",{className:"text-xs text-slate-400 font-mono",children:R.date.split("-")[0]}),e.jsxs("div",{className:"flex gap-2",children:[R.charPage&&e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-600 rounded-full text-[9px] font-bold",children:""}),R.isArchived&&e.jsx("span",{className:"px-2 py-0.5 bg-slate-100 text-slate-500 rounded-full text-[9px] font-bold",children:""})]})]})]})]},R.id))})]})]}):e.jsxs("div",{className:"h-full w-full bg-[#1a1a1a] flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"pt-12 pb-3 px-4 bg-[#1a1a1a]/90 backdrop-blur-md flex items-center justify-between text-white shrink-0 z-30 h-24 box-border",children:[e.jsx("button",{onClick:()=>i("calendar"),className:"p-2 -ml-2 text-white/60 hover:text-white rounded-full active:bg-white/10 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex gap-3",children:[D==="char"&&e.jsx("button",{onClick:()=>q(!Q),className:`p-2 rounded-full transition-colors ${Q?"bg-red-500/20 text-red-400":"bg-white/10 text-white/60"}`,title:Q?"":"",children:Q?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]})}),(m==null?void 0:m.charPage)&&!m.isArchived&&e.jsxs("button",{onClick:C,disabled:v,className:`px-4 py-1.5 rounded-full text-xs font-bold shadow-lg transition-all flex items-center gap-2 ${v?"bg-emerald-800 text-emerald-200 cursor-not-allowed":"bg-emerald-600/90 text-white shadow-emerald-900/50 active:scale-95"}`,children:[v&&e.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),v?"...":""]}),e.jsx("button",{onClick:B,className:"px-4 py-1.5 bg-white/10 rounded-full text-xs font-bold hover:bg-white/20 active:scale-95 transition-transform",children:""})]})]}),e.jsx("div",{className:"flex-1 relative w-full overflow-hidden flex flex-col",children:e.jsx("div",{className:"flex-1 w-full max-w-xl mx-auto px-2 pb-4 pt-2 flex flex-col relative",children:e.jsxs("div",{className:"flex-1 relative rounded-3xl transition-all duration-500",children:[D==="user"&&m&&O(m.userPage,"user"),D==="char"&&(m!=null&&m.charPage?O(m.charPage,"char"):e.jsxs("div",{className:"w-full h-full bg-[#252525] rounded-3xl border border-white/5 flex flex-col items-center justify-center text-white/40 gap-4 p-8 text-center",children:[e.jsx("div",{className:"text-5xl opacity-20 animate-pulse",children:""}),w?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-amber-500",children:"..."}),e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-bounce delay-200"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm",children:["",e.jsx("br",{})," ",d==null?void 0:d.name," "]}),e.jsx("button",{onClick:se,className:"px-6 py-3 bg-amber-500 hover:bg-amber-400 text-white text-sm font-bold rounded-full shadow-[0_0_20px_rgba(245,158,11,0.3)] active:scale-95 transition-all mt-2",children:" TA "})]})]}))]})})}),e.jsxs("div",{className:"shrink-0 bg-[#222] border-t border-white/5 pb-safe pt-2 z-30",children:[e.jsxs("div",{className:"flex justify-center gap-4 mb-4 px-4",children:[e.jsx("button",{onClick:()=>{M("user"),me(null)},className:`flex-1 py-3 rounded-2xl text-xs font-bold uppercase tracking-wider transition-all duration-300 relative overflow-hidden ${D==="user"?"bg-white text-black shadow-lg":"bg-white/5 text-white/40 hover:bg-white/10"}`,children:"My Diary"}),e.jsxs("button",{onClick:()=>{M("char"),me(null)},className:`flex-1 py-3 rounded-2xl text-xs font-bold uppercase tracking-wider transition-all duration-300 relative overflow-hidden ${D==="char"?"bg-amber-500 text-white shadow-lg shadow-amber-900/50":"bg-white/5 text-white/40 hover:bg-white/10"}`,children:[(d==null?void 0:d.name)||"Partner",(m==null?void 0:m.charPage)&&D!=="char"&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full shadow-sm animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-6 pb-4",children:[e.jsx("div",{className:"flex gap-3 bg-[#111] p-1.5 rounded-full border border-white/10",children:ia.slice(0,4).map(R=>e.jsx("button",{onClick:()=>Ae({paperStyle:R.id},D),className:`w-8 h-8 rounded-full border border-white/10 transition-transform active:scale-90 ${R.css}`,title:R.name},R.id))}),e.jsxs("div",{className:"flex gap-3",children:[D==="char"&&(m==null?void 0:m.charPage)&&!w&&e.jsx("button",{onClick:se,className:"w-11 h-11 bg-white/10 text-white rounded-full flex items-center justify-center active:scale-90 transition-transform border border-white/5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("button",{onClick:()=>$(!T),className:`w-11 h-11 rounded-full flex items-center justify-center text-xl shadow-lg active:scale-90 transition-transform ${T?"bg-white text-black":"bg-gradient-to-br from-amber-400 to-orange-500 text-white"}`,children:""})]})]}),T&&e.jsx("div",{className:"bg-[#1a1a1a] border-t border-white/10 p-4 animate-slide-up h-48 overflow-y-auto no-scrollbar",children:e.jsxs("div",{className:"grid grid-cols-6 gap-3",children:[e.jsx("button",{onClick:()=>oe(!0),className:"flex items-center justify-center bg-white/10 rounded-xl border-2 border-dashed border-white/20 text-white/50 text-xl font-bold hover:bg-white/20 hover:text-white transition-all aspect-square",children:"+"}),zu.map((R,_)=>e.jsx("button",{onClick:()=>Le(R),className:"text-3xl hover:scale-110 transition-transform p-2 bg-white/5 rounded-xl border border-white/5 flex items-center justify-center",children:R},`def-${_}`)),F.map((R,_)=>e.jsx("button",{onClick:()=>Le(R.url),onTouchStart:()=>y(R),onTouchEnd:W,onMouseDown:()=>y(R),onMouseUp:W,onMouseLeave:W,onContextMenu:K=>{K.preventDefault(),$e(R)},className:"p-2 bg-white/5 rounded-xl border border-white/5 flex items-center justify-center relative active:scale-95 transition-transform",children:e.jsx("img",{src:R.url,className:"w-8 h-8 object-contain pointer-events-none"})},`cust-${_}`))]})})]}),e.jsx(Ye,{isOpen:L,title:"",onClose:()=>oe(!1),footer:e.jsx("button",{onClick:N,className:"w-full py-3 bg-white/10 text-white font-bold rounded-2xl hover:bg-white/20 transition-all",children:""}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"--URL ()"}),e.jsx("textarea",{value:he,onChange:R=>Te(R.target.value),placeholder:`CoolCat--https://...
Heart--https://...`,className:"w-full h-32 bg-slate-100 rounded-2xl p-4 text-sm resize-none focus:outline-none text-slate-700"})]})}),e.jsx(Ye,{isOpen:!!De,title:"",onClose:()=>$e(null),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>$e(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),e.jsx("button",{onClick:Y,className:"flex-1 py-3 bg-red-500 text-white rounded-2xl font-bold",children:""})]}),children:e.jsxs("div",{className:"flex flex-col items-center gap-3 py-2",children:[De&&e.jsx("img",{src:De.url,className:"w-16 h-16 object-contain rounded-lg bg-slate-100 border"}),e.jsx("p",{className:"text-sm text-slate-600",children:"()"})]})})]})},Uu={cyber:{id:"cyber",bg:"bg-[#0f172a]",text:"text-slate-200",textSub:"text-slate-500",accent:"text-cyan-400",border:"border-cyan-900/30",card:"bg-slate-900/50 backdrop-blur-md border border-slate-700/50",buttonPrimary:"bg-cyan-600 hover:bg-cyan-500 text-white rounded-none skew-x-[-10deg]",font:"font-mono",iconDone:"text-green-500",decoLine:"bg-slate-800",modalBg:"bg-[#0f172a] border border-cyan-500",input:"bg-slate-800 text-white border-none rounded-none",label:"QUEST LOG",eventLabel:"SERVER EVENTS"},soft:{id:"soft",bg:"bg-[#fff0f5]",text:"text-slate-700",textSub:"text-slate-400",accent:"text-pink-500",border:"border-pink-100",card:"bg-white/80 backdrop-blur-xl rounded-[2rem] shadow-sm border border-white",buttonPrimary:"bg-pink-400 hover:bg-pink-500 text-white rounded-2xl shadow-lg shadow-pink-200",font:"font-sans",iconDone:"text-pink-400",decoLine:"bg-pink-200",modalBg:"bg-white/90 rounded-[2.5rem]",input:"bg-pink-50 text-slate-700 border border-pink-100 rounded-xl",label:" ",eventLabel:" "},minimal:{id:"minimal",bg:"bg-[#eef2f6]",text:"text-slate-600",textSub:"text-slate-400",accent:"text-indigo-500",border:"border-transparent",card:"bg-[#eef2f6] rounded-2xl shadow-[6px_6px_12px_#d1d9e6,-6px_-6px_12px_#ffffff]",buttonPrimary:"bg-[#eef2f6] text-slate-600 font-bold rounded-xl shadow-[6px_6px_12px_#d1d9e6,-6px_-6px_12px_#ffffff] active:shadow-[inset_4px_4px_8px_#d1d9e6,inset_-4px_-4px_8px_#ffffff]",font:"font-sans",iconDone:"text-slate-400",decoLine:"bg-slate-300",modalBg:"bg-[#eef2f6] rounded-2xl shadow-2xl",input:"bg-[#eef2f6] text-slate-700 rounded-xl shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]",label:"Focus",eventLabel:"Timeline"}},ng=()=>{var ge;const{closeApp:t,characters:s,activeCharacterId:n,apiConfig:r,addToast:a,userProfile:o}=mt(),[l,c]=u.useState([]),[i,d]=u.useState([]),[h,p]=u.useState("quest"),[f,m]=u.useState(new Set),[x,g]=u.useState("cyber"),A=Uu[x],[w,b]=u.useState(!1),[v,j]=u.useState(!1),[T,$]=u.useState(""),[D,M]=u.useState(n||""),[Q,q]=u.useState(""),[re,ce]=u.useState(""),[fe,me]=u.useState(n||"");u.useEffect(()=>{z();const I=localStorage.getItem("schedule_app_theme");I&&Uu[I]&&g(I)},[]);const ee=()=>{const I=["cyber","soft","minimal"],je=(I.indexOf(x)+1)%I.length,xe=I[je];g(xe),localStorage.setItem("schedule_app_theme",xe)},z=async()=>{const[I,je]=await Promise.all([U.getAllTasks(),U.getAllAnniversaries()]);c(I.sort((xe,Ae)=>Ae.createdAt-xe.createdAt)),d(je.sort((xe,Ae)=>xe.date.localeCompare(Ae.date)))},ve=async I=>{var xe,Ae,Le,N,Y,B,ue;const je=s.find(P=>P.id===I.supervisorId);if(!je||!r.apiKey){a("","success");return}a(`${je.name} ...`,"info");try{const P=At.buildCoreContext(je,o),Ee=`
###  (Task Completed)
 (${o.name}) / "${I.title}"


### 

- 
- 
- 
- ********

****:
- 
- ****
- `,de=[{role:"system",content:P},{role:"user",content:Ee}],J=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:de,temperature:.9,max_tokens:8e3})});if(!J.ok){const W=await J.text();throw new Error(`API Error ${J.status}: ${W.slice(0,100)}`)}const be=await J.json();let y=(N=(Le=(Ae=(xe=be.choices)==null?void 0:xe[0])==null?void 0:Ae.message)==null?void 0:Le.content)==null?void 0:N.trim();!y&&((ue=(B=(Y=be.choices)==null?void 0:Y[0])==null?void 0:B.message)!=null&&ue.reasoning_content)&&console.warn("AI returned empty content but has reasoning."),y?(y=y.replace(/^["']|["']$/g,""),a(`${je.name}: ${y}`,"success"),await U.saveMessage({charId:je.id,role:"system",type:"text",content:`[: ${o.name}  "${I.title}"${je.name} : "${y}"]`})):(console.warn("AI returned empty content",be),a(" (AI )","success"))}catch(P){console.error("Task Reward Error:",P),a(`: ${P.message}`,"error")}},F=async I=>{var B,ue,P,Ee;const je=s.find(de=>de.id===I.charId);if(!je||!r.apiKey||I.aiThought&&I.lastThoughtGeneratedAt&&Date.now()-I.lastThoughtGeneratedAt<24*60*60*1e3)return;Date.now()-(I.lastThoughtGeneratedAt||0)>1e4&&a(`${je.name} ...`,"info");const xe=Math.ceil((new Date(I.date).getTime()-new Date().getTime())/(1e3*60*60*24)),Ae=xe>0?` ${xe} `:xe===0?"!":` ${Math.abs(xe)} `,Le=At.buildCoreContext(je,o),N=`
### 
: "${I.title}"
: ${Ae}

### 

****:
- 
- ****`,Y=[{role:"system",content:Le},{role:"user",content:N}];try{const de=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:Y,temperature:.8,max_tokens:8e3})});if(!de.ok){const y=await de.text();throw new Error(`API Error ${de.status}: ${y.slice(0,50)}`)}const J=await de.json(),be=(Ee=(P=(ue=(B=J.choices)==null?void 0:B[0])==null?void 0:ue.message)==null?void 0:P.content)==null?void 0:Ee.trim().replace(/^["']|["']$/g,"");if(be){const y={...I,aiThought:be,lastThoughtGeneratedAt:Date.now()};await U.saveAnniversary(y),d(W=>W.map(se=>se.id===I.id?y:se))}else console.warn("AI returned empty thought",J)}catch(de){console.error("Anniversary Thought Error:",de)}},te=async()=>{var je;if(!T.trim())return;const I={id:`task-${Date.now()}`,title:T,supervisorId:D||((je=s[0])==null?void 0:je.id),tone:"gentle",isCompleted:!1,createdAt:Date.now()};await U.saveTask(I),c(xe=>[I,...xe]),b(!1),$("")},L=async I=>{const je={...I,isCompleted:!I.isCompleted,completedAt:I.isCompleted?void 0:Date.now()};if(await U.saveTask(je),c(xe=>xe.map(Ae=>Ae.id===I.id?je:Ae)),je.isCompleted){m(xe=>new Set(xe).add(I.id));try{await ve(je)}finally{m(xe=>{const Ae=new Set(xe);return Ae.delete(I.id),Ae})}}},oe=async I=>{await U.deleteTask(I),c(je=>je.filter(xe=>xe.id!==I))},he=async()=>{var je;if(!Q.trim()||!re)return;const I={id:`anni-${Date.now()}`,title:Q,date:re,charId:fe||((je=s[0])==null?void 0:je.id)};await U.saveAnniversary(I),d(xe=>[...xe,I].sort((Ae,Le)=>Ae.date.localeCompare(Le.date))),j(!1),q(""),ce("")},Te=async I=>{await U.deleteAnniversary(I),d(je=>je.filter(xe=>xe.id!==I))},De=I=>{const je=new Date;je.setHours(0,0,0,0);const xe=new Date(I);xe.setHours(0,0,0,0);const Ae=xe.getTime()-je.getTime();return Math.ceil(Ae/(1e3*60*60*24))},$e=u.useMemo(()=>i.filter(I=>De(I.date)>=0).sort((I,je)=>I.date.localeCompare(je.date))[0],[i]);return u.useEffect(()=>{$e&&F($e)},[$e]),e.jsxs("div",{className:`h-full w-full flex flex-col ${A.font} ${A.bg} ${A.text} relative overflow-hidden transition-colors duration-500`,children:[x==="cyber"&&e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",style:{backgroundImage:"linear-gradient(rgba(56, 189, 248, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(56, 189, 248, 0.1) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),x==="soft"&&e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-30",style:{backgroundImage:"radial-gradient(#fbcfe8 2px, transparent 2px)",backgroundSize:"20px 20px"}}),e.jsxs("div",{className:`pt-12 pb-4 px-6 border-b ${A.border} backdrop-blur-sm sticky top-0 z-20 flex items-center justify-between shrink-0 h-24 box-border relative transition-colors duration-300`,children:[e.jsx("button",{onClick:t,className:`p-2 -ml-2 rounded-full active:scale-90 transition-transform ${x==="minimal"?"bg-[#eef2f6] shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff]":"hover:bg-black/5"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:`w-6 h-6 ${A.accent}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:`flex gap-1 p-1 rounded-lg ${x==="cyber"?"bg-black/40 border border-cyan-900/50":x==="minimal"?"bg-[#eef2f6] shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":"bg-white/50"}`,children:[e.jsx("button",{onClick:()=>p("quest"),className:`px-4 py-1.5 rounded text-xs font-bold transition-all ${h==="quest"?`${A.accent} ${x==="cyber"?"bg-cyan-900/50 shadow-sm":x==="minimal"?"shadow-[2px_2px_5px_#d1d9e6,-2px_-2px_5px_#ffffff] bg-[#eef2f6]":"bg-white shadow-sm"}`:`${A.textSub}`}`,children:A.label}),e.jsx("button",{onClick:()=>p("server_events"),className:`px-4 py-1.5 rounded text-xs font-bold transition-all ${h==="server_events"?`${A.accent} ${x==="cyber"?"bg-cyan-900/50 shadow-sm":x==="minimal"?"shadow-[2px_2px_5px_#d1d9e6,-2px_-2px_5px_#ffffff] bg-[#eef2f6]":"bg-white shadow-sm"}`:`${A.textSub}`}`,children:A.eventLabel})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ee,className:`p-2 rounded-full active:scale-90 transition-transform ${x==="minimal"?"shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff]":"bg-white/10 hover:bg-white/20"}`,children:[x==="cyber"&&"",x==="soft"&&"",x==="minimal"&&""]}),e.jsx("button",{onClick:()=>h==="quest"?b(!0):j(!0),className:`p-2 rounded-full active:scale-90 transition-transform ${A.accent} ${x==="minimal"?"shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff]":"hover:bg-white/10"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),x==="cyber"&&e.jsx("div",{className:"absolute bottom-0 left-0 h-[1px] w-full bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-6 space-y-8 z-10",children:[$e&&e.jsx("div",{className:`w-full rounded-2xl p-5 relative overflow-hidden group transition-all duration-300 ${x==="minimal"?"bg-[#eef2f6] shadow-[inset_5px_5px_10px_#d1d9e6,inset_-5px_-5px_10px_#ffffff]":x==="soft"?"bg-gradient-to-r from-pink-300 to-purple-300 text-white shadow-lg shadow-pink-200":"bg-gradient-to-r from-slate-900 to-slate-800 border border-purple-500/30"}`,children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:`text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded ${x==="minimal"?"text-slate-400":"text-white/80 bg-white/20"}`,children:""}),e.jsxs("div",{className:"text-3xl font-bold tracking-tighter",children:[De($e.date)," ",e.jsx("span",{className:"text-xs opacity-60 font-normal",children:""})]})]}),e.jsx("div",{className:"text-xl font-bold mb-4",children:$e.title}),e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-xl ${x==="minimal"?"bg-[#eef2f6] shadow-[5px_5px_10px_#d1d9e6,-5px_-5px_10px_#ffffff]":"bg-white/20 backdrop-blur-md"}`,children:[e.jsx("img",{src:(ge=s.find(I=>I.id===$e.charId))==null?void 0:ge.avatar,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:`text-xs font-medium leading-relaxed italic ${x==="minimal"?"text-slate-500":"text-white/90"}`,children:['"',$e.aiThought||"...",'"']})]})]})}),h==="quest"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full animate-pulse ${x==="cyber"?"bg-cyan-500":x==="soft"?"bg-pink-400":"bg-slate-400"}`}),e.jsx("h3",{className:`text-xs font-bold uppercase tracking-[0.2em] ${A.accent}`,children:""})]}),l.filter(I=>!I.isCompleted).length===0&&e.jsx("div",{className:`text-center py-12 border-2 border-dashed rounded-xl ${x==="cyber"?"border-slate-800":"border-slate-200"}`,children:e.jsx("div",{className:A.textSub,children:""})}),l.filter(I=>!I.isCompleted).map(I=>{const je=s.find(Ae=>Ae.id===I.supervisorId),xe=f.has(I.id);return e.jsxs("div",{className:`${A.card} p-4 flex items-center gap-4 group relative overflow-hidden transition-all duration-300`,children:[e.jsxs("div",{className:"w-12 h-12 rounded-full overflow-hidden shrink-0 relative border border-white/10",children:[je?e.jsx("img",{src:je.avatar,className:"w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"}):e.jsx("span",{className:"text-xs",children:"?"}),e.jsx("div",{className:`absolute -bottom-0 -right-0 w-4 h-4 rounded-full flex items-center justify-center text-[10px] font-bold ${x==="soft"?"bg-white text-pink-500":"bg-black text-cyan-500"}`,children:"!"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`${A.text} font-bold text-sm tracking-wide`,children:I.title}),e.jsxs("div",{className:`text-[10px] ${A.textSub} mt-1 font-mono uppercase`,children:[": ",(je==null?void 0:je.name)||"Unknown"]})]}),xe?e.jsxs("div",{className:"flex items-center gap-2 px-2 py-2",children:[e.jsx("div",{className:`w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin ${A.accent}`}),e.jsx("span",{className:`text-[10px] font-bold animate-pulse ${A.accent}`,children:"..."})]}):e.jsx("button",{onClick:()=>L(I),className:`px-4 py-2 text-[10px] font-bold uppercase tracking-wider rounded transition-all active:scale-95 ${x==="minimal"?"shadow-[4px_4px_8px_#d1d9e6,-4px_-4px_8px_#ffffff] text-slate-500 active:shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":x==="soft"?"bg-pink-100 text-pink-500":"bg-cyan-900/30 text-cyan-400 border border-cyan-800"}`,children:""}),e.jsx("button",{onClick:()=>oe(I.id),className:"absolute top-2 right-2 text-slate-400 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity p-1",children:""})]},I.id)}),l.filter(I=>I.isCompleted).length>0&&e.jsxs("div",{className:"pt-8 opacity-50",children:[e.jsx("h3",{className:`text-xs font-bold uppercase tracking-[0.2em] px-1 mb-4 ${A.textSub}`,children:""}),l.filter(I=>I.isCompleted).map(I=>e.jsxs("div",{className:`flex items-center gap-3 py-2 px-2 border-b ${x==="cyber"?"border-slate-800/50":"border-slate-100"}`,children:[e.jsx("div",{className:`${A.iconDone} text-xs font-mono`,children:"[DONE]"}),e.jsx("span",{className:`text-sm line-through ${A.textSub}`,children:I.title}),e.jsx("button",{onClick:()=>oe(I.id),className:"ml-auto text-slate-400 hover:text-red-500 text-xs",children:"DEL"})]},I.id))]})]}),h==="server_events"&&e.jsxs("div",{className:`relative pl-6 space-y-8 before:absolute before:left-2 before:top-2 before:bottom-0 before:w-[1px] ${A.decoLine}`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-xs font-bold uppercase tracking-widest mb-6 -ml-6 pl-6 ${A.textSub}`,children:""}),e.jsx("div",{className:"space-y-4",children:i.map(I=>{var je;return e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`absolute -left-[20px] top-4 w-2 h-2 rounded-full z-10 ${x==="cyber"?"bg-black border border-purple-500":"bg-pink-400"}`}),e.jsxs("div",{className:`${A.card} p-4 flex justify-between items-center transition-colors`,children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-bold ${A.text}`,children:I.title}),e.jsxs("div",{className:`text-[10px] ${A.textSub} font-mono mt-1`,children:[I.date,"  ",(je=s.find(xe=>xe.id===I.charId))==null?void 0:je.name]})]}),e.jsx("button",{onClick:()=>Te(I.id),className:"text-slate-400 hover:text-red-400 p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]})]},I.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xs font-bold uppercase tracking-widest mb-6 -ml-6 pl-6 pt-4 ${A.textSub}`,children:""}),e.jsx("div",{className:"space-y-4",children:l.filter(I=>I.isCompleted).sort((I,je)=>(je.completedAt||0)-(I.completedAt||0)).map(I=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-[20px] top-2 w-2 h-2 rounded-full z-10 ${x==="cyber"?"bg-black border border-green-600":"bg-slate-300"}`}),e.jsxs("div",{className:`text-xs ${A.textSub} font-mono`,children:["[",new Date(I.completedAt||0).toLocaleDateString(),"] "]}),e.jsx("div",{className:`text-sm ${A.text} font-bold mt-1 pl-1 border-l-2 ${A.decoLine}`,children:I.title})]},I.id))})]})]})]}),e.jsx(Ye,{isOpen:w,title:x==="cyber"?"INITIALIZE QUEST":"",onClose:()=>b(!1),footer:e.jsx("button",{onClick:te,className:`w-full py-3 font-bold transition-all ${A.buttonPrimary}`,children:""}),children:e.jsxs("div",{className:`space-y-6 ${x==="minimal"?"p-2":""}`,children:[e.jsx("input",{autoFocus:!0,value:T,onChange:I=>$(I.target.value),placeholder:" (: )",className:`w-full px-4 py-3 text-sm focus:outline-none ${A.input}`}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2 block tracking-widest",children:""}),e.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:s.map(I=>e.jsxs("button",{onClick:()=>M(I.id),className:`flex flex-col items-center gap-2 p-2 rounded-lg border transition-all min-w-[60px] ${D===I.id?`${x==="minimal"?"shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":"border-current"}`:"border-transparent opacity-50"}`,children:[e.jsx("img",{src:I.avatar,className:"w-10 h-10 rounded-md object-cover"}),e.jsx("span",{className:`text-[10px] font-bold whitespace-nowrap ${A.text}`,children:I.name})]},I.id))})]})]})}),e.jsx(Ye,{isOpen:v,title:x==="cyber"?"REGISTER EVENT":"",onClose:()=>j(!1),footer:e.jsx("button",{onClick:he,className:`w-full py-3 font-bold transition-all ${A.buttonPrimary}`,children:""}),children:e.jsxs("div",{className:`space-y-4 ${x==="minimal"?"p-2":""}`,children:[e.jsx("input",{value:Q,onChange:I=>q(I.target.value),placeholder:" (: )",className:`w-full px-4 py-3 text-sm focus:outline-none ${A.input}`}),e.jsx("input",{type:"date",value:re,onChange:I=>ce(I.target.value),className:`w-full px-4 py-3 text-sm focus:outline-none ${A.input}`}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2 block tracking-widest",children:""}),e.jsx("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:s.map(I=>e.jsxs("button",{onClick:()=>me(I.id),className:`flex flex-col items-center gap-2 p-2 rounded-lg border transition-all min-w-[60px] ${fe===I.id?`${x==="minimal"?"shadow-[inset_2px_2px_5px_#d1d9e6,inset_-2px_-2px_5px_#ffffff]":"border-current"}`:"border-transparent opacity-50"}`,children:[e.jsx("img",{src:I.avatar,className:"w-10 h-10 rounded-md object-cover"}),e.jsx("span",{className:`text-[10px] font-bold whitespace-nowrap ${A.text}`,children:I.name})]},I.id))})]})]})})]})},hc={sully_special:[{name:"Sully",image:"https://sharkpan.xyz/f/A3XeUZ/BED.png",defaultScale:2.4},{name:"Sully",image:"https://sharkpan.xyz/f/G5n3Ul/DNZ.png",defaultScale:2.4},{name:"Sully",image:"https://sharkpan.xyz/f/zlpWS5/SG.png",defaultScale:2},{name:"Sully",image:"https://sharkpan.xyz/f/85K5ij/DDB.png",defaultScale:2.6},{name:"Sully",image:"https://sharkpan.xyz/f/75Nvsj/LJT.png",defaultScale:.9}],furniture:[{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6cf.png",defaultScale:1.5},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6cb.png",defaultScale:1.4},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1fa91.png",defaultScale:1},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6bd.png",defaultScale:1},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f6c1.png",defaultScale:1.5}],decor:[{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1fab4.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f5a5.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3ae.png",defaultScale:.6},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3b8.png",defaultScale:1},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f5bc.png",defaultScale:1.2},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f4da.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f3db.png",defaultScale:.8},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f5d1.png",defaultScale:.7}],food:[{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/2615.png",defaultScale:.5},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f370.png",defaultScale:.6},{name:"",image:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/72x72/1f355.png",defaultScale:.8}]},Hu=[{name:"",value:"radial-gradient(circle at 50% 50%, #fdfbf7 0%, #e2e8f0 100%)"},{name:"",value:"linear-gradient(to bottom, #1e293b 0%, #0f172a 100%)"},{name:"",value:"radial-gradient(circle at 50% 50%, #fff1f2 0%, #ffe4e6 100%)"},{name:"",value:"linear-gradient(135deg, #f3f4f6 0%, #d1d5db 100%)"},{name:"",value:"repeating-linear-gradient(45deg, #f7fee7 0px, #f7fee7 10px, #ecfccb 10px, #ecfccb 20px)"}],Gu=[{name:"",value:"repeating-linear-gradient(90deg, #e7e5e4 0px, #e7e5e4 20px, #d6d3d1 21px)"},{name:"",value:"repeating-linear-gradient(90deg, #78350f 0px, #78350f 20px, #451a03 21px)"},{name:"",value:"conic-gradient(from 90deg at 2px 2px, #0000 90deg, #cbd5e1 0) 0 0/30px 30px"},{name:"",value:"#d1d5db"}],rg=[{id:"desk",name:"",type:"furniture",image:hc.furniture[1].image,x:20,y:55,scale:1.2,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"plant",name:"",type:"decor",image:hc.decor[0].image,x:85,y:40,scale:.8,rotation:0,isInteractive:!0,descriptionPrompt:""}],ai=[{id:"item-1768927221380",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/A3XeUZ/BED.png",x:78.45852578067732,y:97.38889754570907,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927255102",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/G5n3Ul/DNZ.png",x:28.853756791175588,y:69.9444485439727,scale:2.4,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927271632",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/75Nvsj/LJT.png",x:10.276680026943646,y:80.49999880981437,scale:.9,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927286526",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/85K5ij/DDB.png",x:32.608697687684455,y:48.72222587415929,scale:2.6,rotation:0,isInteractive:!0,descriptionPrompt:""},{id:"item-1768927303472",name:"Sully",type:"furniture",image:"https://sharkpan.xyz/f/zlpWS5/SG.png",x:79.84189945375853,y:68.94444543117953,scale:2,rotation:0,isInteractive:!0,descriptionPrompt:""}],Vu=65,oi=t=>t.split(/(\*\*.*?\*\*|~~.*?~~|\*.*?\*|`.*?`)/g).map((n,r)=>n.startsWith("**")&&n.endsWith("**")?e.jsx("strong",{className:"font-bold text-slate-800 bg-yellow-100/50 px-0.5 rounded",children:n.slice(2,-2)},r):n.startsWith("~~")&&n.endsWith("~~")?e.jsx("span",{className:"line-through text-slate-400 opacity-80",children:n.slice(2,-2)},r):n.startsWith("*")&&n.endsWith("*")&&n.length>2?e.jsx("em",{className:"italic text-slate-600",children:n.slice(1,-1)},r):n.startsWith("`")&&n.endsWith("`")?e.jsx("code",{className:"bg-slate-200 text-slate-600 px-1 rounded text-xs font-mono break-all",children:n.slice(1,-1)},r):n),ag=t=>t.split(/(```[\s\S]*?```)/g).map((n,r)=>{if(n.startsWith("```")&&n.endsWith("```")){const a=n.indexOf(`
`);let o=n;return a>-1&&a<10?o=n.substring(a+1,n.length-3):o=n.substring(3,n.length-3),e.jsx("div",{className:"my-3 w-full max-w-full",children:e.jsx("pre",{className:"bg-slate-800 text-green-400 p-3 rounded-xl text-[10px] font-mono overflow-x-auto border-l-4 border-green-600 shadow-sm whitespace-pre",children:o})},r)}return e.jsx("div",{className:"w-full",children:n.split(`
`).map((a,o)=>{const l=`${r}-${o}`,c=a.trim();if(!c)return e.jsx("div",{className:"h-2"},l);if(c.startsWith("# "))return e.jsx("h3",{className:"text-lg font-bold text-slate-800 mt-4 mb-2 pb-1 border-b-2 border-slate-200 break-words",children:c.substring(2)},l);if(c.startsWith("## "))return e.jsx("h4",{className:"text-sm font-bold text-slate-700 mt-3 mb-1 border-l-4 border-slate-300 pl-2 break-words",children:c.substring(3)},l);if(c.startsWith("> "))return e.jsx("div",{className:"pl-3 border-l-4 border-slate-300 text-slate-500 italic my-2 py-1 bg-slate-100 rounded-r-lg text-xs break-words",children:c.substring(2)},l);if(c.startsWith("- ")||c.startsWith(" "))return e.jsxs("div",{className:"flex gap-2 my-1 pl-1 items-start",children:[e.jsx("span",{className:"text-slate-400 mt-1 shrink-0",children:""}),e.jsx("span",{className:"flex-1 break-words",children:oi(c.substring(2))})]},l);if(c.match(/^\[[ x]\]/)){const i=c.includes("[x]");return e.jsxs("div",{className:"flex gap-2 my-1 pl-1 items-center",children:[e.jsx("div",{className:`w-3 h-3 border rounded-sm flex items-center justify-center shrink-0 ${i?"bg-slate-600 border-slate-600":"border-slate-400"}`,children:i&&e.jsx("svg",{className:"w-2 h-2 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:`flex-1 break-words ${i?"line-through text-slate-400":"text-slate-700"}`,children:oi(c.substring(3))})]},l)}return e.jsx("div",{className:"min-h-[1.5em] my-0.5 leading-relaxed break-words text-justify",children:oi(a)},l)})},r)}),og=()=>{var Zs,dn,qn,Qn,un,mn,Va,er,ye,ze,st,ut,pt,ct,Zt,hn,Ka;const{closeApp:t,characters:s,activeCharacterId:n,setActiveCharacterId:r,updateCharacter:a,apiConfig:o,addToast:l,userProfile:c}=mt(),[i,d]=u.useState("select"),[h,p]=u.useState("view"),[f,m]=u.useState([]),[x,g]=u.useState(null),[A,w]=u.useState([]),[b,v]=u.useState(!1),[j,T]=u.useState("todo"),[$,D]=u.useState(0),[M,Q]=u.useState(!1),[q,re]=u.useState("..."),[ce,fe]=u.useState(!1),[me,ee]=u.useState(!1),[z,ve]=u.useState(!1),[F,te]=u.useState(!1),[L,oe]=u.useState(""),[he,Te]=u.useState({x:50,y:75,action:"idle"}),[De,$e]=u.useState({text:"",visible:!1}),[ge,I]=u.useState(""),[je,xe]=u.useState({}),[Ae,Le]=u.useState(null),N=u.useRef(null),[Y,B]=u.useState(null),[ue,P]=u.useState(!1),Ee=u.useRef(null),de=u.useRef(null),J=u.useRef(null),be=u.useRef(null),y=u.useRef(null),[W,se]=u.useState([]),[C,O]=u.useState(!1),[R,_]=u.useState(""),[K,ie]=u.useState(""),[S,k]=u.useState(""),[H,E]=u.useState(""),[ne,Ne]=u.useState(null),pe=u.useRef(null),G=s.find(V=>V.id===n);u.useEffect(()=>{(async()=>{const Re=await U.getAsset("room_custom_assets_list"),Ke=localStorage.getItem("room_custom_assets");if(Re)try{se(JSON.parse(Re))}catch{}else if(Ke)try{const rt=JSON.parse(Ke);se(rt),await U.saveAsset("room_custom_assets_list",Ke),localStorage.removeItem("room_custom_assets")}catch{}})()},[]);const Z=()=>{const V=new Date;return V.getHours()<6&&V.setDate(V.getDate()-1),V.toISOString().split("T")[0]},Se=V=>{if(!V)return"";const Ke=Date.now()-V,rt=Math.floor(Ke/(1e3*60)),tt=Math.floor(Ke/(1e3*60*60)),vt=Math.floor(tt/24);return rt<5?"":rt<60?` ${rt} `:tt<24?` ${tt} `:` ${vt} `},we=async V=>{var tt;r(V.id),d("room");let Re=(tt=V.roomConfig)==null?void 0:tt.items;(!Re||Re.length===0)&&(V.id==="preset-sully-v2"||V.name==="Sully"?(Re=ai,a(V.id,{roomConfig:{...V.roomConfig,items:ai}})):Re=rg),m(Re||[]);const Ke=Z();if(V.lastRoomDate===Ke&&V.savedRoomState&&V.savedRoomState){xe(V.savedRoomState.items||{}),$e({text:V.savedRoomState.welcomeMessage||"...",visible:!0});const vt=await U.getRoomTodo(V.id,Ke),Gt=await U.getRoomNotes(V.id);g(vt),w(Gt.sort((Ft,Bt)=>Bt.timestamp-Ft.timestamp)),l("","info")}else le(V,Re||[])},Ce=()=>{ee(!1),G&&le(G,f,!0)},He=async V=>{var Re,Ke,rt;try{console.warn("Triggering Room Fallback Initialization");const vt=`${At.buildCoreContext(V,c,!1)}

Task: User entered your room. Just say hello. JSON: { "welcomeMessage": "..." }`,Gt=await fetch(`${o.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:o.model,messages:[{role:"user",content:vt}],temperature:.5,max_tokens:8e3})});if(Gt.ok){let Bt=((rt=(Ke=(Re=(await Gt.json()).choices)==null?void 0:Re[0])==null?void 0:Ke.message)==null?void 0:rt.content)||'{"welcomeMessage": "..."}';Bt=Bt.replace(/```json/g,"").replace(/```/g,"").trim();try{const gs=JSON.parse(Bt),gr=Z();$e({text:gs.welcomeMessage||"...",visible:!0});const $n={};f.forEach(An=>{$n[An.id]={description:`This is a ${An.name}.`,reaction:"..."}}),xe($n),a(V.id,{lastRoomDate:gr,savedRoomState:{actorStatus:"Idling...",welcomeMessage:gs.welcomeMessage||"...",items:$n,actorAction:"idle"}}),l(" (Safety Fallback)","info")}catch{throw new Error("Fallback Parse Error")}}}catch(tt){console.error("Fallback Failed",tt),$e({text:"(...)",visible:!0})}finally{Q(!1)}},le=async(V,Re,Ke=!1)=>{var Gt,Ft,Bt;if(!o.apiKey)return;Q(!0);const rt=[`${V.name}...`,"...","...","..."];let tt=0;const vt=setInterval(()=>{re(rt[tt%rt.length]),tt++},1200);try{const gs=Z(),gr=new Date,$n=gr.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),An=gr.toLocaleDateString();let wl=await U.getRoomTodo(V.id,gs);const vh=await U.getRoomNotes(V.id);w(vh.sort(($s,As)=>As.timestamp-$s.timestamp));const vl=!wl;wl&&g(wl);const yl=await U.getMessagesByCharId(V.id),yh=yl.slice(-50).map($s=>`${$s.role==="user"?"":V.name}: ${$s.content.substring(0,50)}`).join(`
`),jl=yl[yl.length-1],hd=Se(jl==null?void 0:jl.timestamp),jh=At.buildCoreContext(V,c,!0),Nh=Re.filter($s=>$s.isInteractive).map($s=>({id:$s.id,name:$s.name,context:($s.descriptionPrompt||"").substring(0,200)}));let xd=`${jh}

### [Environment Context - Critical]
****: ${An} ${$n}
****: ${hd}
** (Latest 50)**:
${yh}

### [Room Initialization - Batch Generation]
****

### 1.  (Status)
- **ActorStatus**: (${$n}${hd})
- **Welcome**: ()

### 2.  (Items)

${JSON.stringify(Nh)}

****
- **Description**: /
- **Reaction**: ()

### 3. [OPTIONAL]  (Daily To-Do)
${vl?"(:  3-5 )":"(: )"}

### 4.  (Notebook Entry)

****
1. ****
2. ********(Code Blocks)
3. **** **Markdown** 
4. ****

###  (Strict JSON)
{
  "actorStatus": "...",
  "welcomeMessage": "...",
  "items": {
    "item_id": { "description": "...", "reaction": "..." }
  },
  ${vl?'"todoList": ["task 1", "task 2"],':""}
  "notebookEntry": { "content": "markdown string...", "type": "thought" }
}
`;oe(xd);const Nl=await fetch(`${o.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.apiKey}`},body:JSON.stringify({model:o.model,messages:[{role:"user",content:xd}],temperature:.5,max_tokens:8e3,safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]})});if(Nl.ok){let As=((Bt=(Ft=(Gt=(await Nl.json()).choices)==null?void 0:Gt[0])==null?void 0:Ft.message)==null?void 0:Bt.content)||"";if(!As)throw new Error("AI returned empty response (Safety Block suspected).");As=As.replace(/```json/g,"").replace(/```/g,"").trim();const pd=As.indexOf("{"),fd=As.lastIndexOf("}");pd!==-1&&fd!==-1&&(As=As.substring(pd,fd+1));let Xt;try{Xt=JSON.parse(As)}catch{throw new Error("JSON Parse Failed")}if($e({text:Xt.welcomeMessage||"Welcome!",visible:!0}),Xt.items&&xe(Xt.items),a(V.id,{lastRoomDate:gs,savedRoomState:{actorStatus:Xt.actorStatus,welcomeMessage:Xt.welcomeMessage,items:Xt.items||{},actorAction:"idle"}}),vl&&Xt.todoList&&Array.isArray(Xt.todoList)){const qr={id:`${V.id}_${gs}`,charId:V.id,date:gs,items:Xt.todoList.map(kl=>({text:kl,done:!1})),generatedAt:Date.now()};await U.saveRoomTodo(qr),g(qr),await U.saveMessage({charId:V.id,role:"system",type:"text",content:`[: ${V.name} : ${Xt.todoList.join(", ")}]`})}if(Xt.notebookEntry){const qr=`[: ${V.name} : 
"${Xt.notebookEntry.content}"]`,kl=await U.saveMessage({charId:V.id,role:"system",type:"text",content:qr}),gd={id:`note-${Date.now()}`,charId:V.id,timestamp:Date.now(),content:Xt.notebookEntry.content,type:Xt.notebookEntry.type||"thought",relatedMessageId:kl};await U.saveRoomNote(gd),w(kh=>[gd,...kh])}}else throw new Error(`API Error ${Nl.status}`)}catch(gs){console.error("Room Init Failed, switching to Fallback",gs),await He(V)}finally{clearInterval(vt),Q(!1)}},Oe=async(V,Re)=>{if(Re&&Re.stopPropagation(),h==="edit"){B(V.id);return}if(!G)return;const Ke=Math.max(Vu,V.y+5);Te({x:V.x,y:Ke,action:"walk"}),setTimeout(()=>Te(tt=>({...tt,action:"interact"})),600);const rt=je[V.id]||je[V.name];if(rt){I(rt.description),$e({text:rt.reaction,visible:!0});const tt=`[${c.name}][${G.name}]${V.name}${rt.description}[${G.name}]${rt.reaction}`;if(!(await U.getMessagesByCharId(G.id)).slice(-50).some(Ft=>Ft.role==="system"&&Ft.content===tt))try{await U.saveMessage({charId:G.id,role:"system",type:"text",content:tt})}catch{}}else I(`${V.name}`),$e({text:"(...)",visible:!0})},We=()=>{var Re;if(h==="edit"){(Re=be.current)==null||Re.click();return}Te(Ke=>({...Ke,action:"bounce"})),setTimeout(()=>Te(Ke=>({...Ke,action:"idle"})),500);const V=["","...","","...","()"];$e({text:V[Math.floor(Math.random()*V.length)],visible:!0})},Ie=async V=>{if(!x)return;const Re=[...x.items];Re[V].done=!Re[V].done;const Ke={...x,items:Re};g(Ke),await U.saveRoomTodo(Ke)},Ve=async V=>{if(!x)return;const Re=x.items.filter((rt,tt)=>tt!==V),Ke={...x,items:Re};g(Ke),await U.saveRoomTodo(Ke),l("","success")},X=async V=>{const Re=A.find(Ke=>Ke.id===V);Re&&Re.relatedMessageId&&await U.deleteMessage(Re.relatedMessageId),await U.deleteRoomNote(V),w(Ke=>Ke.filter(rt=>rt.id!==V)),l(" ()","success")},ae=V=>{if(h==="edit"){B(null);return}if(!Ee.current)return;const Re=Ee.current.getBoundingClientRect(),Ke=(V.clientX-Re.left)/Re.width*100,rt=(V.clientY-Re.top)/Re.height*100,tt=Math.max(Vu-5,rt);Te({x:Ke,y:tt,action:"walk"}),setTimeout(()=>Te(vt=>({...vt,action:"idle"})),600),$e({text:"",visible:!1}),I("")},ke=V=>{m(V),G&&a(G.id,{roomConfig:{...G.roomConfig,items:V}})},Me=(V,Re)=>{const Ke={id:`item-${Date.now()}`,name:V.name,type:Re,image:V.image,x:50,y:50,scale:V.defaultScale,rotation:0,isInteractive:!0,descriptionPrompt:V.description};ke([...f,Ke]),fe(!1),l(`: ${V.name}`,"success")},Ue=V=>{if(!Y)return;const Re=f.map(Ke=>Ke.id===Y?{...Ke,...V}:Ke);ke(Re)},Be=()=>{Y&&(ke(f.filter(V=>V.id!==Y)),B(null))},_e=V=>{G&&a(G.id,{roomConfig:{...G.roomConfig,items:f,wallImage:V}})},qe=V=>{G&&a(G.id,{roomConfig:{...G.roomConfig,items:f,floorImage:V}})},Je=async(V,Re)=>{var rt;const Ke=(rt=V.target.files)==null?void 0:rt[0];if(Ke)try{const vt=await Ut(Ke,Re==="custom_item"?{quality:1,maxWidth:2048}:void 0);if(Re==="wall"&&_e(vt),Re==="floor"&&qe(vt),Re==="actor"&&G){const Gt={...G.sprites||{},chibi:vt};a(G.id,{sprites:Gt}),l("","success")}Re==="custom_item"&&ie(vt)}catch(tt){l(tt.message,"error")}},et=async()=>{const V=S||K;if(!R.trim()||!V){l("","error");return}Me({name:R,image:V,defaultScale:1,description:H||void 0},"furniture");const Re={name:R,image:V,defaultScale:1,description:H||void 0},Ke=[...W,Re];se(Ke),await U.saveAsset("room_custom_assets_list",JSON.stringify(Ke)),O(!1),_(""),ie(""),k(""),E("")},Qe=V=>{pe.current=setTimeout(()=>{Ne(V)},600)},ht=()=>{pe.current&&(clearTimeout(pe.current),pe.current=null)},nt=async()=>{if(!ne)return;const V=W.filter(Re=>Re.name!==ne.name||Re.image!==ne.image);se(V),await U.saveAsset("room_custom_assets_list",JSON.stringify(V)),Ne(null),l("","success")},at=V=>{G&&a(G.id,{roomConfig:{...G.roomConfig,...V,items:f}})},It=()=>{G&&(ke(ai),te(!1),l("Sully ","success"))},Xe=(V,Re)=>{if(h!=="edit")return;V.preventDefault(),V.stopPropagation(),V.currentTarget.setPointerCapture(V.pointerId);const Ke=f.find(tt=>tt.id===Re);if(!Ke||!Ee.current)return;const rt=Ee.current.getBoundingClientRect();N.current={startX:V.clientX,startY:V.clientY,initialItemX:Ke.x,initialItemY:Ke.y,width:rt.width,height:rt.height},Le(Re),B(Re)},cn=V=>{if(!Ae||!N.current)return;const{startX:Re,startY:Ke,initialItemX:rt,initialItemY:tt,width:vt,height:Gt}=N.current,Ft=V.clientX-Re,Bt=V.clientY-Ke,gs=rt+Ft/vt*100,gr=tt+Bt/Gt*100;m($n=>$n.map(An=>An.id===Ae?{...An,x:Math.max(0,Math.min(100,gs)),y:Math.max(0,Math.min(100,gr))}:An))},gt=V=>{Ae&&(ke(f),Le(null),N.current=null,V.currentTarget.releasePointerCapture(V.pointerId))};if(i==="select")return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[e.jsxs("div",{className:"pt-12 pb-4 px-6 border-b border-slate-200 bg-white sticky top-0 z-20 flex items-center justify-between shrink-0 h-24 box-border",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-slate-100 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-slate-700 text-lg tracking-wide",children:"?"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"p-6 grid grid-cols-2 gap-4 overflow-y-auto pb-20 no-scrollbar auto-rows-fr",children:s.map(V=>e.jsxs("div",{onClick:()=>we(V),className:"min-h-[180px] bg-white rounded-2xl shadow-sm border border-slate-100 p-4 flex flex-col items-center justify-center gap-3 cursor-pointer active:scale-95 transition-all relative overflow-hidden group hover:shadow-md",children:[e.jsxs("div",{className:"w-20 h-20 rounded-full p-1 border-2 border-slate-100 relative",children:[e.jsx("img",{src:V.avatar,className:"w-full h-full rounded-full object-cover"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-6 h-6 bg-green-400 rounded-full border-2 border-white flex items-center justify-center text-[10px] text-white",children:""})]}),e.jsx("span",{className:"font-bold text-slate-700 text-sm",children:V.name})]},V.id))})]});const fs=((Zs=G==null?void 0:G.sprites)==null?void 0:Zs.chibi)||(G==null?void 0:G.avatar),ot="filter drop-shadow-[0_0_1px_#fff] drop-shadow-[0_0_2px_#fff] drop-shadow-[0_4px_6px_rgba(0,0,0,0.2)]",Nt=(V,Re,Ke)=>{if(!V)return"";const rt=V.startsWith("http")||V.startsWith("data"),tt=rt?`url(${V})`:V;if(!rt)return tt;const vt=Re&&Re>0?`${Re}%`:"cover";return`${tt} center center / ${vt} ${Ke?"repeat":"no-repeat"}`},it=Nt((dn=G==null?void 0:G.roomConfig)==null?void 0:dn.wallImage,(qn=G==null?void 0:G.roomConfig)==null?void 0:qn.wallScale,(Qn=G==null?void 0:G.roomConfig)==null?void 0:Qn.wallRepeat)||Hu[0].value,_t=Nt((un=G==null?void 0:G.roomConfig)==null?void 0:un.floorImage,(mn=G==null?void 0:G.roomConfig)==null?void 0:mn.floorScale,(Va=G==null?void 0:G.roomConfig)==null?void 0:Va.floorRepeat)||Gu[0].value,Lt={...hc,custom:W},Xn=(G==null?void 0:G.id)==="preset-sully-v2"||(G==null?void 0:G.name)==="Sully";return e.jsxs("div",{className:"h-full w-full bg-[#f8fafc] flex flex-col relative overflow-hidden font-sans select-none",children:[M&&e.jsxs("div",{className:"absolute inset-0 z-[500] bg-white flex flex-col items-center justify-center animate-fade-in",children:[e.jsx("div",{className:"text-4xl mb-4 animate-bounce",children:""}),e.jsx("p",{className:"text-sm font-bold text-slate-500",children:q})]}),e.jsxs("div",{ref:Ee,className:"flex-1 relative overflow-hidden transition-all duration-500 touch-none",onPointerMove:cn,onPointerUp:gt,onClick:ae,children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-[65%] bg-center transition-all duration-500 z-0",style:{background:it}}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-[35%] bg-center transition-all duration-500 z-0",style:{background:_t}}),e.jsx("div",{className:"absolute top-[65%] w-full h-8 bg-gradient-to-b from-black/10 to-transparent pointer-events-none z-0"}),f.map(V=>{const Re=Ae===V.id;return e.jsxs("div",{onPointerDown:Ke=>Xe(Ke,V.id),onClick:Ke=>Oe(V,Ke),className:`absolute origin-bottom-center ${ot} ${h==="edit"?Re?"cursor-grabbing":"cursor-grab":V.isInteractive?"cursor-pointer hover:scale-105 active:scale-95":""} ${Y===V.id?"ring-2 ring-blue-400 rounded-lg ring-offset-4":""} touch-none select-none`,style:{left:`${V.x}%`,top:`${V.y}%`,width:`${80*V.scale}px`,transform:`translate(-50%, -100%) rotate(${V.rotation}deg)`,zIndex:Re?100:Math.floor(V.y),transition:Re?"none":"transform 0.3s ease-out"},children:[e.jsx("img",{src:V.image,className:"w-full h-auto object-contain pointer-events-none select-none",draggable:!1}),h==="edit"&&Y===V.id&&e.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 bg-blue-500 text-white text-[9px] px-2 py-0.5 rounded-full whitespace-nowrap",children:""})]},V.id)}),e.jsxs("div",{onClick:V=>{V.stopPropagation(),We()},className:`absolute transition-all duration-[1000ms] ease-in-out origin-bottom-center ${ot} cursor-pointer active:scale-95 group`,style:{left:`${he.x}%`,top:`${he.y}%`,width:"120px",transform:`translate(-50%, -100%) scale(${he.action==="walk"?1.05:he.action==="bounce"?1.1:1})`,zIndex:Math.floor(he.y)+20},children:[e.jsx("img",{src:fs,className:`w-full h-full object-contain ${he.action==="walk"?"animate-bounce":""}`}),h==="edit"&&e.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 bg-black/60 text-white text-[9px] px-2 py-1 rounded backdrop-blur-sm whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1",children:" "}),De.visible&&e.jsxs("div",{className:"absolute bottom-[105%] left-1/2 -translate-x-1/2 bg-white px-4 py-3 rounded-[20px] rounded-bl-none shadow-lg border-2 border-black/5 min-w-[120px] max-w-[300px] animate-pop-in z-50",children:[e.jsx("p",{className:"text-xs font-bold text-slate-700 leading-tight text-center break-words",children:De.text}),e.jsx("button",{onClick:V=>{V.stopPropagation(),$e({...De,visible:!1})},className:"absolute -top-2 -right-2 bg-slate-200 text-slate-500 rounded-full w-4 h-4 flex items-center justify-center text-[8px]",children:""})]})]})]}),e.jsx("button",{onClick:()=>v(!0),className:`absolute right-0 top-1/2 -translate-y-1/2 bg-white/80 backdrop-blur-sm p-3 rounded-l-2xl shadow-lg border border-r-0 border-white/20 transition-transform duration-300 z-[300] ${b?"translate-x-full":"translate-x-0"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5 text-slate-500",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),b&&e.jsx("div",{className:"absolute inset-0 z-[290] bg-black/20 backdrop-blur-[1px]",onClick:()=>v(!1)}),e.jsxs("div",{className:`absolute right-0 top-0 bottom-0 w-3/4 max-w-sm bg-white shadow-2xl z-[300] transition-transform duration-300 ease-out flex flex-col ${b?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"p-6 pb-2 border-b border-slate-100 flex justify-between items-center bg-slate-50",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-700 tracking-tight",children:""}),e.jsx("button",{onClick:()=>v(!1),className:"p-2 -mr-2 text-slate-400 hover:text-slate-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex p-2 bg-slate-50 border-b border-slate-100",children:[e.jsx("button",{onClick:()=>T("todo"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-colors ${j==="todo"?"bg-white shadow text-primary":"text-slate-400 hover:bg-white/50"}`,children:""}),e.jsx("button",{onClick:()=>T("notebook"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-colors ${j==="notebook"?"bg-white shadow text-primary":"text-slate-400 hover:bg-white/50"}`,children:""})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-[#fcfcfc] no-scrollbar",children:[j==="todo"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:(x==null?void 0:x.date)||"Today"}),e.jsxs("span",{className:"text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-500",children:[": ",x?Math.round(x.items.filter(V=>V.done).length/x.items.length*100):0,"%"]})]}),x?e.jsx("ul",{className:"space-y-3",children:x.items.map((V,Re)=>e.jsxs("li",{className:"flex items-start gap-3 group",children:[e.jsx("div",{onClick:()=>Ie(Re),className:`mt-0.5 w-5 h-5 rounded border-2 flex items-center justify-center transition-colors cursor-pointer ${V.done?"bg-green-400 border-green-400":"border-slate-300 group-hover:border-primary"}`,children:V.done&&e.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"})})}),e.jsx("span",{onClick:()=>Ie(Re),className:`text-sm leading-relaxed transition-all flex-1 cursor-pointer ${V.done?"text-slate-300 line-through decoration-slate-300":"text-slate-700 font-medium"}`,children:V.text}),e.jsx("button",{onClick:()=>Ve(Re),className:"text-slate-300 hover:text-red-400 px-1 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]},Re))}):e.jsx("div",{className:"text-center py-10 text-slate-400 text-xs",children:"..."}),e.jsxs("div",{className:"mt-8 p-4 bg-yellow-50 rounded-xl border border-yellow-100 text-xs text-yellow-800 leading-relaxed italic relative",children:[e.jsx("span",{className:"absolute -top-3 left-4 text-2xl",children:""})," ",G==null?void 0:G.name," TATA"]})]}),j==="notebook"&&e.jsx("div",{className:"flex flex-col pb-4",children:A.length>0?e.jsxs("div",{className:"relative bg-white shadow-md border border-slate-200 p-6 min-h-[400px] flex flex-col rounded-xl",style:{backgroundImage:"radial-gradient(#e5e7eb 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[e.jsx("div",{className:"absolute left-4 top-4 bottom-4 w-px border-l-2 border-dotted border-slate-300 pointer-events-none"}),e.jsxs("div",{className:"mb-4 ml-6 flex justify-between items-center text-[10px] text-slate-400 font-mono border-b border-slate-100 pb-2",children:[e.jsxs("span",{children:["#",A.length-$]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{children:new Date(A[$].timestamp).toLocaleString()}),e.jsx("button",{onClick:()=>X(A[$].id),className:"text-red-300 hover:text-red-500 font-bold px-1",title:"",children:""})]})]}),e.jsx("div",{className:"flex-1 ml-6 text-slate-700 text-sm whitespace-pre-wrap leading-relaxed",children:ag(A[$].content)}),e.jsxs("div",{className:"mt-6 ml-6 flex justify-between items-center pt-4 border-t border-slate-100",children:[e.jsx("button",{disabled:$>=A.length-1,onClick:()=>D(V=>V+1),className:"text-slate-400 hover:text-primary disabled:opacity-30",children:" "}),e.jsxs("span",{className:"text-[10px] text-slate-300",children:[$+1," / ",A.length]}),e.jsx("button",{disabled:$<=0,onClick:()=>D(V=>V-1),className:"text-slate-400 hover:text-primary disabled:opacity-30",children:" "})]})]}):e.jsx("div",{className:"text-center py-10 text-slate-400 text-xs",children:"..."})})]})]}),e.jsxs("div",{className:"absolute top-0 w-full pt-12 px-4 pb-2 flex justify-between z-30 pointer-events-none",children:[e.jsx("button",{onClick:()=>d("select"),className:"bg-white/90 p-2 rounded-full shadow-md pointer-events-auto active:scale-90 transition-transform text-slate-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex gap-2 pointer-events-auto",children:[h==="view"&&e.jsx("button",{onClick:()=>ee(!0),className:"p-2 bg-white/90 rounded-full shadow-md text-slate-500 hover:text-primary active:scale-90 transition-transform",title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("button",{onClick:()=>{p(h==="view"?"edit":"view"),B(null)},className:`px-4 py-2 rounded-full font-bold text-xs shadow-md transition-all ${h==="edit"?"bg-blue-500 text-white":"bg-white text-slate-600"}`,children:h==="edit"?"":""})]})]}),ge&&h==="view"&&e.jsxs("div",{className:"absolute bottom-6 left-4 right-4 bg-white/95 backdrop-blur-xl p-5 rounded-2xl shadow-2xl border border-white/50 z-[150] animate-slide-up",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-blue-500 uppercase tracking-widest",children:"OBSERVATION"}),e.jsx("button",{onClick:()=>I(""),className:"text-slate-400 hover:text-slate-600",children:""})]}),e.jsx("p",{className:"text-sm text-slate-700 leading-relaxed font-medium text-justify",children:ge})]}),h==="edit"&&e.jsxs("div",{className:`absolute bottom-0 w-full bg-white border-t border-slate-200 z-[150] transition-transform duration-300 flex flex-col ${ue?"translate-y-[calc(100%-2.5rem)]":""}`,style:{maxHeight:ue?"auto":"45vh"},children:[e.jsx("div",{className:"h-10 w-full flex items-center justify-center cursor-pointer bg-white active:bg-slate-50 border-b border-slate-100",onClick:()=>P(!ue),children:e.jsx("div",{className:"w-10 h-1 bg-slate-200 rounded-full"})}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:Y?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500",children:""}),e.jsx("button",{onClick:Be,className:"text-xs text-red-500 font-bold bg-red-50 px-3 py-1 rounded-full",children:""})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-slate-400 block mb-1",children:""}),e.jsx("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:((er=f.find(V=>V.id===Y))==null?void 0:er.scale)||1,onChange:V=>Ue({scale:parseFloat(V.target.value)}),className:"w-full h-1 bg-slate-200 rounded-full"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] text-slate-400 block mb-1",children:""}),e.jsx("input",{type:"range",min:"-180",max:"180",step:"5",value:((ye=f.find(V=>V.id===Y))==null?void 0:ye.rotation)||0,onChange:V=>Ue({rotation:parseInt(V.target.value)}),className:"w-full h-1 bg-slate-200 rounded-full"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 overflow-x-auto no-scrollbar pb-2",children:[e.jsxs("button",{onClick:()=>fe(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white shadow-md text-xl",children:"+"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),e.jsxs("button",{onClick:()=>O(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center text-white shadow-md text-xl",children:""}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),e.jsxs("button",{onClick:()=>{var V;return(V=de.current)==null?void 0:V.click()},className:"flex flex-col items-center gap-1 shrink-0",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-200 rounded-xl flex items-center justify-center text-slate-500 shadow-sm border border-slate-300",children:""}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),e.jsxs("button",{onClick:()=>{var V;return(V=J.current)==null?void 0:V.click()},className:"flex flex-col items-center gap-1 shrink-0",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-200 rounded-xl flex items-center justify-center text-slate-500 shadow-sm border border-slate-300",children:""}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),e.jsxs("button",{onClick:()=>te(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-200 rounded-xl flex items-center justify-center text-slate-600 shadow-sm border border-slate-300",children:""}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:""})]}),e.jsxs("button",{onClick:()=>ve(!0),className:"flex flex-col items-center gap-1 shrink-0",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-xl flex items-center justify-center text-white shadow-sm border border-slate-600",children:"{}"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-500",children:"Dev"})]}),e.jsx("input",{type:"file",ref:de,className:"hidden",accept:"image/*",onChange:V=>Je(V,"wall")}),e.jsx("input",{type:"file",ref:J,className:"hidden",accept:"image/*",onChange:V=>Je(V,"floor")}),e.jsx("input",{type:"file",ref:be,className:"hidden",accept:"image/*",onChange:V=>Je(V,"actor")})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-slate-400 mb-2 uppercase",children:""}),e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar",children:Hu.map((V,Re)=>e.jsx("button",{onClick:()=>_e(V.value),className:"w-10 h-10 rounded-lg shadow-sm border border-slate-200 shrink-0",style:{background:V.value}},Re))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-slate-400 mb-2 uppercase",children:""}),e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar",children:Gu.map((V,Re)=>e.jsx("button",{onClick:()=>qe(V.value),className:"w-10 h-10 rounded-lg shadow-sm border border-slate-200 shrink-0",style:{background:V.value}},Re))})]})]})})]}),e.jsx(Ye,{isOpen:ce,title:"",onClose:()=>fe(!1),children:e.jsx("div",{className:"h-96 overflow-y-auto no-scrollbar",children:Object.entries(Lt).map(([V,Re])=>Re&&Re.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 sticky top-0 bg-white/95 backdrop-blur py-2 z-10 flex justify-between",children:[V==="sully_special"?"Sully  (Special)":V==="custom"?" (Custom)":V,e.jsx("span",{className:"text-[9px] bg-slate-100 px-2 rounded-full",children:Re.length})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:Re.map((Ke,rt)=>{const tt=V==="custom",vt=tt?{onTouchStart:()=>Qe(Ke),onTouchEnd:ht,onMouseDown:()=>Qe(Ke),onMouseUp:ht,onMouseLeave:ht,onContextMenu:Gt=>{Gt.preventDefault(),Ne(Ke)}}:{};return e.jsxs("button",{onClick:()=>Me(Ke,V==="custom"||V==="sully_special"?"furniture":V),className:"flex flex-col items-center gap-2 group relative active:scale-95 transition-transform",...vt,children:[e.jsxs("div",{className:"w-14 h-14 bg-slate-50 rounded-xl flex items-center justify-center border border-slate-100 group-hover:border-blue-300 transition-colors overflow-hidden relative",children:[e.jsx("img",{src:Ke.image,className:"w-full h-full object-contain"}),tt&&e.jsx("div",{className:"absolute inset-0 bg-red-500/10 opacity-0 group-active:opacity-100 transition-opacity"})]}),e.jsx("span",{className:"text-[10px] text-slate-500 truncate w-full text-center",children:Ke.name})]},rt)})})]},V))})}),e.jsx(Ye,{isOpen:!!ne,title:"",onClose:()=>Ne(null),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>Ne(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),e.jsx("button",{onClick:nt,className:"flex-1 py-3 bg-red-500 text-white rounded-2xl font-bold",children:""})]}),children:e.jsxs("div",{className:"flex flex-col items-center gap-3 py-2",children:[ne&&e.jsx("img",{src:ne.image,className:"w-16 h-16 object-contain rounded-lg bg-slate-100 border"}),e.jsxs("p",{className:"text-sm text-slate-600 text-center",children:[" ",e.jsx("br",{}),e.jsxs("span",{className:"font-bold",children:['"',ne==null?void 0:ne.name,'"']})," ",e.jsx("br",{}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"()"})]})]})}),e.jsx(Ye,{isOpen:C,title:"",onClose:()=>O(!1),footer:e.jsx("button",{onClick:et,className:"w-full py-3 bg-purple-500 text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{onClick:()=>{var V;return(V=y.current)==null?void 0:V.click()},className:"aspect-square w-24 bg-slate-100 rounded-2xl border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer hover:border-purple-400 relative overflow-hidden shrink-0",children:[K?e.jsx("img",{src:K,className:"w-full h-full object-contain"}):e.jsx("span",{className:"text-slate-400 text-xs",children:"+ "}),e.jsx("input",{type:"file",ref:y,className:"hidden",accept:"image/*",onChange:V=>Je(V,"custom_item")})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" URL ()"}),e.jsx("input",{value:S,onChange:V=>k(V.target.value),placeholder:"https://...",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-xs focus:outline-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:""}),e.jsx("input",{value:R,onChange:V=>_(V.target.value),placeholder:": ",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm focus:outline-purple-500 font-bold"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" (Context)"}),e.jsx("input",{value:H,onChange:V=>E(V.target.value),placeholder:": ",className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-xs focus:outline-purple-500"}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:" AI "})]})]})}),e.jsx(Ye,{isOpen:F,title:"",onClose:()=>te(!1),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest border-b border-slate-100 pb-2",children:""}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600",children:[" (",((ze=G==null?void 0:G.roomConfig)==null?void 0:ze.wallScale)||0,"%)"]}),e.jsx("span",{className:"text-[10px] text-slate-400",children:(st=G==null?void 0:G.roomConfig)!=null&&st.wallScale?`${G.roomConfig.wallScale}%`:"Cover (Default)"})]}),e.jsx("input",{type:"range",min:"0",max:"200",step:"10",value:((ut=G==null?void 0:G.roomConfig)==null?void 0:ut.wallScale)||0,onChange:V=>at({wallScale:parseInt(V.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"wallRepeat",checked:((pt=G==null?void 0:G.roomConfig)==null?void 0:pt.wallRepeat)||!1,onChange:V=>at({wallRepeat:V.target.checked}),className:"accent-blue-500"}),e.jsx("label",{htmlFor:"wallRepeat",className:"text-xs text-slate-600",children:" (Tile)"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-600",children:[" (",((ct=G==null?void 0:G.roomConfig)==null?void 0:ct.floorScale)||0,"%)"]}),e.jsx("span",{className:"text-[10px] text-slate-400",children:(Zt=G==null?void 0:G.roomConfig)!=null&&Zt.floorScale?`${G.roomConfig.floorScale}%`:"Cover (Default)"})]}),e.jsx("input",{type:"range",min:"0",max:"200",step:"10",value:((hn=G==null?void 0:G.roomConfig)==null?void 0:hn.floorScale)||0,onChange:V=>at({floorScale:parseInt(V.target.value)}),className:"w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"floorRepeat",checked:((Ka=G==null?void 0:G.roomConfig)==null?void 0:Ka.floorRepeat)||!1,onChange:V=>at({floorRepeat:V.target.checked}),className:"accent-blue-500"}),e.jsx("label",{htmlFor:"floorRepeat",className:"text-xs text-slate-600",children:" (Tile)"})]})]})]}),Xn&&e.jsxs("div",{className:"pt-4 border-t border-slate-100",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:"Sully "}),e.jsxs("button",{onClick:It,className:"w-full py-3 bg-red-50 text-red-500 font-bold rounded-2xl border border-red-100 flex items-center justify-center gap-2 active:scale-95 transition-transform",children:[e.jsx("span",{className:"text-lg",children:""})," "]}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-2 text-center",children:""})]})]})}),e.jsx(Ye,{isOpen:me,title:"?",onClose:()=>ee(!1),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>ee(!1),className:"flex-1 py-3 bg-slate-100 text-slate-500 rounded-2xl font-bold",children:""}),e.jsx("button",{onClick:Ce,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl",children:"!"})]}),children:e.jsxs("div",{className:"text-center py-4 space-y-2",children:[e.jsx("div",{className:"text-4xl",children:""}),e.jsx("p",{className:"text-sm text-slate-600 font-bold",children:" 6:00 "}),e.jsx("p",{className:"text-xs text-slate-400",children:""})]})}),e.jsx(Ye,{isOpen:z,title:" (Dev Tools)",onClose:()=>ve(!1),footer:e.jsx("button",{onClick:()=>ve(!1),className:"w-full py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2",children:" (Layout JSON)"}),e.jsx("div",{className:"bg-slate-100 rounded-xl p-3 border border-slate-200 mb-2",children:e.jsx("pre",{className:"text-[10px] text-slate-600 font-mono h-20 overflow-y-auto whitespace-pre-wrap select-all",children:JSON.stringify(f,null,2)})}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(f,null,2)),l("Layout Copied","success")},className:"w-full py-2 bg-slate-800 text-white text-xs font-bold rounded-xl",children:" JSON"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-bold text-red-400 uppercase mb-2",children:"Prompt  (Debugger)"}),e.jsx("div",{className:"bg-slate-100 rounded-xl p-3 border border-slate-200 mb-2",children:e.jsx("pre",{className:"text-[10px] text-slate-600 font-mono h-20 overflow-y-auto whitespace-pre-wrap select-all",children:L||"()"})}),e.jsx("button",{onClick:()=>{L?(navigator.clipboard.writeText(L),l("Prompt Copied","success")):l("No prompt yet","error")},className:"w-full py-2 bg-red-500 text-white text-xs font-bold rounded-xl",children:" Prompt "}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-2 text-center",children:" AI  Prompt /Base64 "})]})]})})]})},lg=()=>{const[t,s]=u.useState({w:0,h:0,vh:0,top:0});return u.useEffect(()=>{var r,a;const n=()=>{var o,l;s({w:window.innerWidth,h:window.innerHeight,vh:((o=window.visualViewport)==null?void 0:o.height)||0,top:((l=window.visualViewport)==null?void 0:l.offsetTop)||0})};return window.addEventListener("resize",n),(r=window.visualViewport)==null||r.addEventListener("resize",n),(a=window.visualViewport)==null||a.addEventListener("scroll",n),n(),()=>{var o,l;window.removeEventListener("resize",n),(o=window.visualViewport)==null||o.removeEventListener("resize",n),(l=window.visualViewport)==null||l.removeEventListener("scroll",n)}},[]),e.jsxs("div",{className:"absolute top-0 right-0 z-[9999] bg-red-500/80 text-white text-[10px] font-mono p-1 pointer-events-none select-none",children:["Win: ",t.w,"x",t.h,e.jsx("br",{}),"VV: ",t.vh.toFixed(0)," (y:",t.top.toFixed(0),")"]})},ig=()=>{var Ae,Le;const{closeApp:t,characters:s,activeCharacterId:n,updateCharacter:r,apiConfig:a,addToast:o,userProfile:l}=mt(),[c,i]=u.useState("select"),[d,h]=u.useState("home"),[p,f]=u.useState(null),[m,x]=u.useState(!1),[g,A]=u.useState(null),w=u.useRef(null),[b,v]=u.useState(!1),[j,T]=u.useState(""),[$,D]=u.useState(""),[M,Q]=u.useState("#3b82f6"),[q,re]=u.useState(""),[ce,fe]=u.useState(!1),me=((Ae=p==null?void 0:p.phoneState)==null?void 0:Ae.records)||[],ee=((Le=p==null?void 0:p.phoneState)==null?void 0:Le.customApps)||[];u.useEffect(()=>{var N,Y;if(p){const B=s.find(ue=>ue.id===p.id);if(B&&(f(B),g)){const ue=(Y=(N=B.phoneState)==null?void 0:N.records)==null?void 0:Y.find(P=>P.id===g.id);ue&&A(ue)}}},[s]),u.useEffect(()=>{d==="chat_detail"&&w.current&&w.current.scrollIntoView({behavior:"smooth"})},[g==null?void 0:g.detail,d]);const z=N=>{f(N),i("phone"),h("home")},ve=()=>{i("select"),f(null),h("home")},F=async N=>{var B;if(!p)return;const Y=(((B=p.phoneState)==null?void 0:B.records)||[]).filter(ue=>ue.id!==N.id);r(p.id,{phoneState:{...p.phoneState,records:Y}}),N.systemMessageId&&await U.deleteMessage(N.systemMessageId),(g==null?void 0:g.id)===N.id&&(h("chat"),A(null)),o("","success")},te=N=>{var B;if(!p)return;const Y=(((B=p.phoneState)==null?void 0:B.customApps)||[]).filter(ue=>ue.id!==N);r(p.id,{phoneState:{...p.phoneState,customApps:Y}}),o("App ","success")},L=()=>{var B;if(!p||!j||!q)return;const N={id:`app-${Date.now()}`,name:j,icon:$,color:M,prompt:q},Y=((B=p.phoneState)==null?void 0:B.customApps)||[];r(p.id,{phoneState:{...p.phoneState,customApps:[...Y,N]}}),v(!1),T(""),re(""),o(` ${j}`,"success")},oe=N=>{if(!N)return"";const B=Date.now()-N,ue=Math.floor(B/(1e3*60)),P=Math.floor(B/(1e3*60*60)),Ee=Math.floor(P/24);return ue<5?"":ue<60?` ${ue} `:P<24?` ${P} `:` ${Ee} `},he=async(N,Y)=>{var B;if(!p||!a.apiKey){o("","error");return}x(!0);try{const ue=At.buildCoreContext(p,l,!0),P=await U.getMessagesByCharId(p.id),Ee=P[P.length-1],de=oe(Ee==null?void 0:Ee.timestamp),J=P.slice(-50).map(k=>{const H=k.role==="user"?l.name:p.name,E=k.type==="text"?k.content:`[${k.type}]`;return`${H}: ${E}`}).join(`
`);let be="",y="";if(Y){be=` App: "${N}"
 App /: "${Y}"
 2-4  App 

JSON: [{ "title": "/", "detail": "//", "value": "( +100)" }, ...]`;const k=ee.find(H=>H.id===N);y=k?k.name:N}else N==="chat"?(be=` 3 (Message/Line)****
    
    1. ****:  3 User
    2. ****: 3-4
    3. ****:  ":..." ()":..."  ":..." 
    JSON: [{ "title": " ()", "detail": ": \\n: \\n: " }, ...]`,y=""):N==="call"?(be=` 3 ****
    JSON: [{ "title": "", "value": " (5) /  /  (30)", "detail": "..." }, ...]`,y=""):N==="order"?(be=` 3 
    JSON: [{ "title": "", "detail": "" }, ...]`,y="APP"):N==="delivery"?(be=` 3 
    JSON: [{ "title": "", "detail": "" }, ...]`,y="APP"):N==="social"&&(be=` 2 /
    JSON: [{ "title": "/", "detail": "" }, ...]`,y="");const W=`${ue}

### [Current Status]
: ${de}

### [Recent Chat Context]
${J}

### [Task]
${be}
[Current Status]`,se=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:W}],temperature:.8})});if(!se.ok)throw new Error("API Error");let O=(await se.json()).choices[0].message.content;O=O.replace(/```json/g,"").replace(/```/g,"").trim();const R=O.indexOf("["),_=O.lastIndexOf("]");R>-1&&_>-1&&(O=O.substring(R,_+1));let K=[];try{K=JSON.parse(O)}catch{K=[]}const ie=[];if(Array.isArray(K))for(const k of K){const H=k.title||"Unknown",E=k.detail||"...";let ne="";N==="chat"?ne=`[: ${p.name}  "${H}" -: ${E.replace(/\n/g," ")}]`:ne=`[: ${p.name}(${y}) : ${H} - ${E}]`,await U.saveMessage({charId:p.id,role:"system",type:"text",content:ne});const Ne=await U.getMessagesByCharId(p.id),pe=Ne[Ne.length-1];ie.push({id:`rec-${Date.now()}-${Math.random()}`,type:N,title:H,detail:E,value:k.value,timestamp:Date.now(),systemMessageId:pe==null?void 0:pe.id}),await new Promise(G=>setTimeout(G,50))}const S=((B=p.phoneState)==null?void 0:B.records)||[];r(p.id,{phoneState:{...p.phoneState,records:[...S,...ie]}}),o(` ${ie.length} `,"success")}catch(ue){console.error(ue),o("","error")}finally{x(!1)}},Te=async()=>{var N;if(!(!g||!p||!a.apiKey)){x(!0);try{const B=`${At.buildCoreContext(p,l,!0)}

### [Task: Continue Conversation]
Roleplay: You are "${p.name}". You are chatting on your phone with "${g.title}".
Current History:
"""
${g.detail}
"""

Task: Please continue this conversation for 3-5 more turns. 
Style: Casual, IM style.
Format: 
- Use ": ..." for yourself (${p.name}).
- Use ": ..." for the contact (${g.title}).
- Only output the new dialogue lines. Do NOT repeat history.
`,ue=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:B}],temperature:.85})});if(ue.ok){let Ee=(await ue.json()).choices[0].message.content.trim();Ee=Ee.replace(/```/g,"");const de=`${g.detail}
${Ee}`,J={...g,detail:de};A(J);const y=(((N=p.phoneState)==null?void 0:N.records)||[]).map(W=>W.id===J.id?J:W);r(p.id,{phoneState:{...p.phoneState,records:y}})}}catch(Y){console.error(Y),o("","error")}finally{x(!1)}}},De=(N,Y,B)=>e.jsxs("div",{className:"h-14 flex items-center justify-between px-4 bg-white/80 backdrop-blur-md text-slate-800 shrink-0 z-20 border-b border-slate-200",children:[e.jsx("button",{onClick:Y,className:"p-2 -ml-2 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-base tracking-wide truncate max-w-[200px]",children:N}),e.jsx("div",{className:"w-8 flex justify-end",children:B})]}),$e=()=>{const N=me.filter(Y=>Y.type==="chat").sort((Y,B)=>B.timestamp-Y.timestamp);return e.jsxs("div",{className:"absolute inset-0 w-full h-full flex flex-col bg-slate-50 z-10",children:[De("Message",()=>h("home")),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar pb-24 overscroll-contain",children:[N.length===0&&e.jsx("div",{className:"text-center text-slate-400 mt-20 text-xs",children:""}),N.map(Y=>e.jsxs("div",{onClick:()=>{A(Y),h("chat_detail")},className:"bg-white rounded-2xl p-4 shadow-sm border border-slate-100 relative group animate-slide-up active:scale-98 transition-transform cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 flex items-center justify-center text-xl shadow-inner shrink-0",children:""}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("div",{className:"font-bold text-slate-700 text-sm truncate",children:Y.title}),e.jsx("div",{className:"text-[10px] text-slate-400",children:new Date(Y.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"text-xs text-slate-500 truncate",children:Y.detail.split(`
`).pop()||"..."})]})]}),e.jsx("button",{onClick:B=>{B.stopPropagation(),F(Y)},className:"absolute top-2 right-2 w-6 h-6 bg-red-100 text-red-500 rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity z-10",children:""})]},Y.id))]}),e.jsx("div",{className:"absolute bottom-8 w-full flex justify-center pointer-events-none z-30",children:e.jsx("button",{disabled:m,onClick:()=>he("chat"),className:"pointer-events-auto bg-green-500 text-white px-6 py-2.5 rounded-full shadow-xl font-bold text-xs flex items-center gap-2 active:scale-95 transition-transform",children:m?"...":""})})]})},ge=()=>{if(!g||!p)return null;const Y=g.detail.split(`
`).filter(B=>B.trim()).map(B=>{const ue=B.startsWith("")||B.startsWith("Me")||B.startsWith("Me:")||B.startsWith(":"),P=B.replace(/^(|Me||Them|[\w\u4e00-\u9fa5]+)[:]\s*/,"");return{isMe:ue,content:P}});return e.jsxs("div",{className:"fixed inset-0 flex flex-col bg-[#f2f2f2] z-[100] overflow-hidden",style:{paddingTop:"env(safe-area-inset-top)"},children:[De(g.title,()=>h("chat")),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar overscroll-contain min-h-0",children:[Y.map((B,ue)=>e.jsxs("div",{className:`flex ${B.isMe?"justify-end":"justify-start"}`,children:[!B.isMe&&e.jsx("div",{className:"w-9 h-9 rounded-md bg-gray-300 flex items-center justify-center text-xs text-gray-500 mr-2 shrink-0",children:g.title[0]}),e.jsxs("div",{className:`px-3 py-2 rounded-lg max-w-[75%] text-sm leading-relaxed shadow-sm break-words relative ${B.isMe?"bg-[#95ec69] text-black":"bg-white text-black"}`,children:[B.isMe&&e.jsx("div",{className:"absolute top-2 -right-1.5 w-3 h-3 bg-[#95ec69] rotate-45"}),!B.isMe&&e.jsx("div",{className:"absolute top-3 -left-1 w-2.5 h-2.5 bg-white rotate-45"}),e.jsx("span",{className:"relative z-10",children:B.content})]}),B.isMe&&e.jsx("img",{src:p.avatar,className:"w-9 h-9 rounded-md object-cover ml-2 shrink-0 shadow-sm"})]},ue)),m&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce delay-200"})]})}),e.jsx("div",{ref:w})]}),e.jsx("div",{className:"shrink-0 w-full p-4 bg-[#f7f7f7] border-t border-gray-200",children:e.jsx("button",{onClick:Te,disabled:m,className:"w-full py-3 bg-white border border-gray-300 rounded-xl text-sm font-bold text-slate-600 shadow-sm active:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:m?"...":"  / "})})]})},I=(N,Y,B)=>{const ue=me.filter(P=>P.type===N).sort((P,Ee)=>Ee.timestamp-P.timestamp);return e.jsxs("div",{className:"absolute inset-0 w-full h-full flex flex-col bg-slate-50 z-10",children:[De(Y,()=>h("home")),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar pb-24 overscroll-contain",children:[ue.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-2",children:[e.jsx("span",{className:"text-4xl opacity-20",children:""}),e.jsx("span",{className:"text-xs",children:""})]}),ue.map(P=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-slate-100 shadow-sm relative group animate-slide-up",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-bold text-slate-700 text-sm line-clamp-1",children:P.title}),P.value&&e.jsx("span",{className:"text-xs font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded",children:P.value})]}),e.jsx("div",{className:"text-xs text-slate-500 leading-relaxed",children:P.detail}),e.jsx("div",{className:"text-[10px] text-slate-300 mt-2 text-right",children:new Date(P.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("button",{onClick:()=>F(P),className:"absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity shadow-md",children:""})]},P.id))]}),e.jsx("div",{className:"absolute bottom-8 w-full flex justify-center pointer-events-none z-30",children:e.jsxs("button",{disabled:m,onClick:()=>he(N,B),className:"pointer-events-auto bg-slate-800 text-white px-6 py-2.5 rounded-full shadow-xl font-bold text-xs flex items-center gap-2 active:scale-95 transition-transform hover:bg-slate-700",children:[m?e.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})}),""]})})]})},je=({icon:N,color:Y,label:B,onClick:ue,onDelete:P})=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5 relative group",children:[e.jsxs("button",{onClick:ue,className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] flex items-center justify-center text-2xl shadow-lg border border-white/10 active:scale-95 transition-transform relative overflow-hidden",style:{background:Y},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-black/10 to-transparent"}),e.jsx("div",{className:"relative z-10 drop-shadow-md text-white",children:N})]}),e.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md tracking-wide px-1 py-0.5 rounded bg-black/10 backdrop-blur-[2px]",children:B}),P&&e.jsx("button",{onClick:Ee=>{Ee.stopPropagation(),P()},className:"absolute -top-1 -right-1 w-5 h-5 bg-slate-400 text-white rounded-full flex items-center justify-center text-[10px] shadow-sm opacity-0 group-hover:opacity-100 transition-opacity z-20 hover:bg-red-500",children:""})]}),xe=()=>{const N=p!=null&&p.dateBackground?{backgroundImage:`url(${p.dateBackground})`}:{background:"linear-gradient(to bottom, #1e293b, #0f172a)"};return e.jsxs("div",{className:"absolute inset-0 flex flex-col z-0",style:{...N,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/20 backdrop-blur-[2px]"}),e.jsxs("div",{className:"h-8 flex justify-between px-5 items-center text-white/80 text-[10px] font-bold z-20 relative",children:[e.jsx("span",{children:"12:00"}),e.jsxs("div",{className:"flex gap-1.5 items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{fillRule:"evenodd",d:"M1.371 8.143c5.858-5.857 15.356-5.857 21.213 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.06 0c-4.98-4.979-13.053-4.979-18.032 0a.75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182c4.1-4.1 10.749-4.1 14.85 0a.75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.062 0 8.25 8.25 0 0 0-11.667 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.204 3.182a6 6 0 0 1 8.486 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0 3.75 3.75 0 0 0-5.304 0 .75.75 0 0 1-1.06 0l-.53-.53a.75.75 0 0 1 0-1.06Zm3.182 3.182a1.5 1.5 0 0 1 2.122 0 .75.75 0 0 1 0 1.061l-.53.53a.75.75 0 0 1-1.061 0l-.53-.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})}),e.jsx("div",{className:"w-4 h-2 border border-current rounded-[2px] relative",children:e.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-current w-3/4"})})]})]}),e.jsx("div",{className:"flex-1 p-5 z-10 overflow-y-auto no-scrollbar overscroll-none",children:e.jsxs("div",{className:"grid grid-cols-4 gap-y-6 gap-x-2 place-items-center content-start",children:[e.jsx(je,{icon:"",color:"linear-gradient(135deg, #10b981, #059669)",label:"Message",onClick:()=>h("chat")}),e.jsx(je,{icon:"",color:"linear-gradient(135deg, #f97316, #ea580c)",label:"Taobao",onClick:()=>h("taobao")}),e.jsx(je,{icon:"",color:"linear-gradient(135deg, #eab308, #ca8a04)",label:"Food",onClick:()=>h("waimai")}),e.jsx(je,{icon:"",color:"linear-gradient(135deg, #6366f1, #4f46e5)",label:"Moments",onClick:()=>h("social")}),ee.map(Y=>e.jsx(je,{icon:Y.icon,color:Y.color,label:Y.name,onClick:()=>h(Y.id),onDelete:()=>te(Y.id)},Y.id)),e.jsxs("button",{onClick:()=>v(!0),className:"flex flex-col items-center gap-1.5 group",children:[e.jsx("div",{className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] bg-white/20 backdrop-blur-md border border-white/30 flex items-center justify-center text-2xl text-white shadow-lg active:scale-95 transition-transform hover:bg-white/30",children:"+"}),e.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md",children:"Add App"})]}),e.jsxs("button",{onClick:ve,className:"flex flex-col items-center gap-1.5 group",children:[e.jsx("div",{className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] bg-red-500/20 backdrop-blur-md border border-red-400/50 flex items-center justify-center shadow-lg active:scale-95 transition-transform hover:bg-red-500/40",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-8 h-8 text-white",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})})}),e.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md",children:""})]}),e.jsxs("button",{onClick:()=>fe(!ce),className:"flex flex-col items-center gap-1.5 group opacity-50 hover:opacity-100 transition-opacity",children:[e.jsx("div",{className:"w-[3.8rem] h-[3.8rem] rounded-[1.2rem] bg-black/20 backdrop-blur-md border border-white/10 flex items-center justify-center shadow-lg active:scale-95 transition-transform",children:e.jsx("span",{className:"text-xl",children:""})}),e.jsx("span",{className:"text-[10px] font-medium text-white/90 drop-shadow-md",children:"Debug UI"})]})]})}),e.jsx("div",{className:"p-4 z-20",children:e.jsxs("div",{className:"bg-white/20 backdrop-blur-xl rounded-[2rem] p-3 flex justify-around items-center border border-white/10 shadow-lg",children:[e.jsx("button",{onClick:()=>{},className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})}),e.jsx("button",{onClick:()=>h("chat"),className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})}),e.jsx("button",{onClick:()=>{},className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-white rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})}),e.jsx("button",{onClick:()=>{},className:"p-2 rounded-xl active:bg-white/20 transition-colors",children:e.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-xl flex items-center justify-center text-2xl shadow-sm",children:""})})]})})]})};return c==="select"?e.jsxs("div",{className:"absolute inset-0 flex flex-col bg-slate-900 font-light overflow-hidden",children:[e.jsxs("div",{className:"h-20 pt-4 flex items-center justify-between px-4 border-b border-slate-800 bg-slate-900/80 sticky top-0 z-10 shrink-0",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-white/10 text-white",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-white tracking-widest uppercase text-sm",children:"Target Device"}),e.jsx("div",{className:"w-8"})]}),e.jsx("div",{className:"p-6 grid grid-cols-2 gap-5 overflow-y-auto pb-20 no-scrollbar overscroll-contain",children:s.map(N=>e.jsxs("div",{onClick:()=>z(N),className:"aspect-[3/4] bg-slate-800 rounded-xl border border-slate-700 p-4 flex flex-col items-center justify-center gap-4 cursor-pointer active:scale-95 transition-all group hover:border-green-500 hover:shadow-[0_0_15px_rgba(34,197,94,0.3)]",children:[e.jsx("div",{className:"w-20 h-20 rounded-full p-[2px] border-2 border-slate-600 group-hover:border-green-500 transition-colors",children:e.jsx("img",{src:N.avatar,className:"w-full h-full rounded-full object-cover grayscale group-hover:grayscale-0 transition-all"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-slate-300 text-sm group-hover:text-green-400",children:N.name}),e.jsx("div",{className:"text-[10px] text-slate-500 font-mono mt-1",children:"CONNECT >"})]})]},N.id))})]}):e.jsxs("div",{className:"absolute inset-0 bg-slate-900 overflow-hidden font-sans overscroll-none",children:[ce&&e.jsx(lg,{}),d==="home"?xe():e.jsxs(e.Fragment,{children:[d==="chat"&&$e(),d==="chat_detail"&&ge(),d==="taobao"&&I("order","Taobao"),d==="waimai"&&I("delivery","Food Delivery"),d==="social"&&I("social","Moments"),ee.find(N=>N.id===d)&&(()=>{const N=ee.find(Y=>Y.id===d);return I(N.id,N.name,N.prompt)})()]}),e.jsx(Ye,{isOpen:b,title:" App",onClose:()=>v(!1),footer:e.jsx("button",{onClick:L,className:"w-full py-3 bg-blue-500 text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl flex items-center justify-center text-3xl shadow-md border-2 border-slate-100 shrink-0",style:{background:M},children:$}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{value:j,onChange:N=>T(N.target.value),placeholder:"App  (: )",className:"w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:$,onChange:N=>D(N.target.value),placeholder:"Emoji",className:"w-16 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm text-center"}),e.jsx("input",{type:"color",value:M,onChange:N=>Q(N.target.value),className:"h-9 flex-1 cursor-pointer rounded-lg bg-transparent"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:" (AI Prompt)"}),e.jsx("textarea",{value:q,onChange:N=>re(N.target.value),placeholder:": ",className:"w-full h-24 bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs resize-none"}),e.jsx("p",{className:"text-[9px] text-slate-400 mt-1",children:"AI  App "})]})]})})]})},Ku="#ff2442",Yu=[{name:"Sunset",bg:"linear-gradient(135deg, #FF9A9E 0%, #FECFEF 99%, #FECFEF 100%)",text:"#fff"},{name:"Ocean",bg:"linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%)",text:"#fff"},{name:"Peach",bg:"linear-gradient(to top, #fff1eb 0%, #ace0f9 100%)",text:"#555"},{name:"Night",bg:"linear-gradient(to top, #30cfd0 0%, #330867 100%)",text:"#fff"},{name:"Love",bg:"linear-gradient(to top, #f43b47 0%, #453a94 100%)",text:"#fff"},{name:"Fresh",bg:"linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%)",text:"#444"},{name:"Lemon",bg:"linear-gradient(135deg, #f6d365 0%, #fda085 100%)",text:"#fff"},{name:"Plum",bg:"linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)",text:"#fff"}],Ju=()=>Yu[Math.floor(Math.random()*Yu.length)],li=t=>{const s=t.replace(/```json/g,"").replace(/```/g,"").trim();try{const n=JSON.parse(s);if(!Array.isArray(n)&&typeof n=="object"&&n!==null){const r=Object.keys(n);if(r.length===1&&Array.isArray(n[r[0]]))return n[r[0]]}return Array.isArray(n)?n:[]}catch{try{const r=s.indexOf("[");if(r===-1)return[];let a=s.lastIndexOf("}");for(;a>r;){const o=s.substring(r,a+1)+"]";try{const l=JSON.parse(o);if(Array.isArray(l))return l}catch{}a=s.lastIndexOf("}",a-1)}return[]}catch{return[]}}},xn={Heart:({filled:t,onClick:s,className:n})=>e.jsx("svg",{onClick:s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:t?Ku:"none",stroke:t?Ku:"currentColor",strokeWidth:2,className:`transition-transform active:scale-75 cursor-pointer ${n||"w-6 h-6"}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"})}),Star:({filled:t,onClick:s,className:n})=>e.jsx("svg",{onClick:s,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:t?"#fbbf24":"none",stroke:t?"#fbbf24":"currentColor",strokeWidth:2,className:`transition-transform active:scale-75 cursor-pointer ${n||"w-6 h-6"}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.563.563 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.563.563 0 0 0-.182-.557l-4.204-3.602a.563.563 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"})}),Share:({className:t,onClick:s})=>e.jsx("svg",{onClick:s,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:t||"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})}),Back:({onClick:t,className:s})=>e.jsx("svg",{onClick:t,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:s||"w-6 h-6 cursor-pointer text-slate-800",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})},cg=()=>{const{closeApp:t,characters:s,updateCharacter:n,apiConfig:r,addToast:a,userProfile:o,groups:l}=mt(),[c,i]=u.useState([]),[d,h]=u.useState("home"),[p,f]=u.useState(!1),[m,x]=u.useState(null),[g,A]=u.useState(!1),[w,b]=u.useState(!1),[v,j]=u.useState(""),[T,$]=u.useState(""),[D,M]=u.useState(""),[Q,q]=u.useState(""),[re,ce]=u.useState(!1),[fe,me]=u.useState(!1),[ee,z]=u.useState({}),[ve,F]=u.useState(!1),[te,L]=u.useState("notes"),[oe,he]=u.useState({name:o.name,avatar:o.avatar,bio:""}),[Te,De]=u.useState("95279527"),[$e,ge]=u.useState(""),[I,je]=u.useState(!1),xe=u.useRef(null),Ae=u.useRef(null),Le=u.useRef(null),N=u.useRef(0);u.useEffect(()=>{U.getSocialPosts().then(pe=>{pe.length>0&&i(pe.sort((G,Z)=>Z.timestamp-G.timestamp))}),(async()=>{const pe=localStorage.getItem("spark_user_id"),G=await U.getAsset("spark_user_bg"),Z=await U.getAsset("spark_social_profile"),Se=localStorage.getItem("spark_user_bg"),we=localStorage.getItem("spark_social_profile");pe&&De(pe),G?ge(G):Se&&(ge(Se),await U.saveAsset("spark_user_bg",Se),localStorage.removeItem("spark_user_bg"));let Ce=null;if(Z)try{Ce=JSON.parse(Z)}catch{}else if(we){try{Ce=JSON.parse(we)}catch{}Ce&&(await U.saveAsset("spark_social_profile",we),localStorage.removeItem("spark_social_profile"))}he(Ce||{name:o.name,avatar:o.avatar,bio:o.bio||""})})();const ne=localStorage.getItem("spark_char_handles");let Ne={};if(ne)try{Ne=JSON.parse(ne)}catch{}s.forEach(pe=>{var G;(!Ne[pe.id]||Ne[pe.id].length===0)&&(Ne[pe.id]=[{id:"default",handle:((G=pe.socialProfile)==null?void 0:G.handle)||pe.name,note:""}])}),z(Ne)},[s.length]),u.useEffect(()=>{Object.keys(ee).length>0&&localStorage.setItem("spark_char_handles",JSON.stringify(ee))},[ee]),u.useEffect(()=>{var E;if(m){const ne=m.comments.length;ne>N.current&&((E=Le.current)==null||E.scrollIntoView({behavior:"smooth"})),N.current=ne}else N.current=0},[m==null?void 0:m.comments.length]);const Y=E=>{const ne={id:`sub-${Date.now()}`,handle:"",note:""};z(Ne=>({...Ne,[E]:[...Ne[E]||[],ne]}))},B=(E,ne,Ne,pe)=>{z(G=>({...G,[E]:G[E].map(Z=>Z.id===ne?{...Z,[Ne]:pe}:Z)}))},ue=(E,ne)=>{z(Ne=>({...Ne,[E]:Ne[E].filter(pe=>pe.id!==ne)}))},P=async E=>{var Ne;const ne=(Ne=E.target.files)==null?void 0:Ne[0];if(ne)try{const pe=await Ut(ne,{skipCompression:!0});ge(pe),await U.saveAsset("spark_user_bg",pe),a("","success")}catch{a("","error")}},Ee=async E=>{var Ne;const ne=(Ne=E.target.files)==null?void 0:Ne[0];if(ne)try{const pe=await Ut(ne);he(G=>({...G,avatar:pe}))}catch(pe){a(pe.message,"error")}},de=async()=>{localStorage.setItem("spark_user_id",Te),await U.saveAsset("spark_social_profile",JSON.stringify(oe)),je(!1),a(" ( Spark )","success")},J=E=>{i(E),Promise.all(E.map(ne=>U.saveSocialPost(ne))).catch(console.error)},be=E=>{i(ne=>{const Ne=ne.map(pe=>pe.id===E.id?E:pe);return U.saveSocialPost(E),Ne}),x(ne=>(ne==null?void 0:ne.id)===E.id?E:ne)},y=E=>{i(ne=>{const Ne=ne.filter(pe=>pe.id!==E);return U.deleteSocialPost(E),Ne}),x(ne=>(ne==null?void 0:ne.id)===E?null:ne)},W=async()=>{if(!r.apiKey){a(" API Key","error");return}A(!0);try{const ne=[...s].sort(()=>.5-Math.random()).slice(0,Math.min(3,s.length));let Ne="",pe=`###  (Identities)
`;for(const le of ne){const Oe=At.buildCoreContext(le,o,!1),We=await U.getMessagesByCharId(le.id),Ie=We.length>0?`(:  "${We[We.length-1].content.substring(0,20)}...")`:"()",X=(ee[le.id]||[]).map(ae=>`- : "${ae.handle}" (: ${ae.note})`).join(`
`);pe+=`
 [${le.name}] :
${X}
`,Ne+=`
<<< : ${le.name} >>>
${Oe}
${Ie}
<<<  >>>
`}const G=`### : APP "Spark" 
 6-8 

###   ()
1. ** (30%)**: 
   - : ${ne.map(le=>le.name).join(", ")}
   - ****: ()
   -  **Configured Handle ()**
   - ****: 

2. **/ (70%)**: 
   - 

### 
${pe}

###  
1. ****:  "${oe.name}" () 
2. ****

### 
${Ne}

###  (JSON Array)
[
  {
    "isCharacter": true/false,
    "charId": "ID, null", 
    "authorName": "",
    "title": "",
    "content": "...",
    "emojis": ["", ""],
    "likes":  (0 - 10000)
  },
  ...
]`,Z=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:G}],temperature:.95,max_tokens:8e3})});if(!Z.ok)throw new Error("API Error");const Se=await Z.json(),we=li(Se.choices[0].message.content);if(!Array.isArray(we))throw new Error("Parsed data is not an array");const He=[...we.map(le=>{let Oe=`https://api.dicebear.com/7.x/notionists/svg?seed=${le.authorName}`;if(le.isCharacter){const We=s.find(Ie=>Ie.id===le.charId)||s.find(Ie=>(ee[Ie.id]||[]).some(X=>X.handle===le.authorName));We&&(Oe=We.avatar)}else{const We=["micah","avataaars","bottts","notionists"];Oe=`https://api.dicebear.com/7.x/${We[Math.floor(Math.random()*We.length)]}/svg?seed=${le.authorName+Math.random()}`}return{id:`post-${Date.now()}-${Math.random()}`,authorName:le.authorName||"Unknown",authorAvatar:Oe,title:le.title||"",content:le.content||"...",images:le.emojis||[""],likes:le.likes||0,isCollected:!1,isLiked:!1,comments:[],timestamp:Date.now(),tags:["Life","Vlog"],bgStyle:Ju().bg}}),...c];J(He),a(": ","success")}catch(E){a(": "+E.message,"error")}finally{A(!1)}},se=async E=>{if(!(!E||E.comments.length>0||!r.apiKey)){b(!0);try{const Ne=[...s].sort(()=>.5-Math.random()).slice(0,2);let pe="";for(const Ce of Ne){const le=(ee[Ce.id]||[]).map(Oe=>`"${Oe.handle}" (${Oe.note})`).join(", ");pe+=`-  ${Ce.name} : ${le}
`}let G="";for(const Ce of Ne)G+=`
<<< : ${Ce.name} >>>
${At.buildCoreContext(Ce,o,!1)}
`;let Z="Stranger";if(E.authorName===oe.name)Z="User";else{const Ce=s.find(He=>(ee[He.id]||[]).some(Oe=>Oe.handle===E.authorName));Ce&&(Z=`Character "${Ce.name}"`)}const Se=`### : APP
****: "Spark" 
****: "${E.authorName}" (${Z})
****: "${E.title}"

 4-6  ****  ****


### 
${pe}

### 
- ****  "${oe.name}" 

### 
${G}

###  (JSON Array)
[
  { "author": " (Handle)  ", "content": "..." }
]`,we=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:Se}],temperature:.8})});if(we.ok){const Ce=await we.json(),He=li(Ce.choices[0].message.content);if(Array.isArray(He)){const le=He.map(Oe=>{const We=Oe.author||Oe.authorName||"Unknown";let Ie=`https://api.dicebear.com/7.x/notionists/svg?seed=${We}`;const Ve=s.find(X=>(ee[X.id]||[]).some(ke=>ke.handle===We));return Ve&&(Ie=Ve.avatar),{id:`cmt-${Math.random()}`,authorName:We,authorAvatar:Ie,content:Oe.content||"...",likes:Math.floor(Math.random()*100),isCharacter:!!Ve}});be({...E,comments:le})}}}catch{a("","error")}finally{b(!1)}}},C=async(E,ne)=>{if(r.apiKey){ce(!0);try{let Ne="";s.forEach(Z=>{const we=(ee[Z.id]||[]).map(Ce=>`"${Ce.handle}"`).join(", ");Ne+=`- ${Z.name}: ${we}
`});const pe=`### : 
****:  "${oe.name}" : "${ne}"
****: "${E.title}"
 1-3 
${Ne}

###  (JSON Array)
[
  { "author": " (Handle)", "content": "..." }
]`,G=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:pe}],temperature:.9})});if(G.ok){const Z=await G.json(),Se=li(Z.choices[0].message.content);if(Array.isArray(Se)){const we=Se.map(Ce=>{const He=Ce.author||Ce.authorName||"Unknown";let le=`https://api.dicebear.com/7.x/notionists/svg?seed=${He}`;const Oe=s.find(We=>(ee[We.id]||[]).some(Ve=>Ve.handle===He));return Oe&&(le=Oe.avatar),{id:`cmt-reply-${Date.now()}-${Math.random()}`,authorName:He,authorAvatar:le,content:` @${oe.name}: ${Ce.content}`,likes:Math.floor(Math.random()*10)}});we.length>0&&(be({...E,comments:[...E.comments||[],...we]}),a(` ${we.length} `,"info"))}}}catch{}finally{ce(!1)}}},O=async(E,ne)=>{if(m)try{await U.saveMessage({charId:ne?"user":E,groupId:ne?E:void 0,role:"user",type:"social_card",content:"[]",metadata:{post:m}}),F(!1),a("","success")}catch{a("","error")}},R=()=>{if(!T.trim())return;const E={id:`user-post-${Date.now()}`,authorName:oe.name,authorAvatar:oe.avatar,title:v||"",content:T,images:[D],likes:0,isCollected:!1,isLiked:!1,comments:[],timestamp:Date.now(),tags:["User"],bgStyle:Ju().bg};J([E,...c]),$(""),j(""),f(!1),h("home"),a("","success")},_=E=>{y(E),a("","success")},K=(E,ne)=>{E.stopPropagation(),be({...ne,isLiked:!ne.isLiked,likes:ne.isLiked?ne.likes-1:ne.likes+1})},ie=async()=>{if(!m||!Q.trim())return;const E={...m,comments:[...m.comments||[],{id:`cmt-user-${Date.now()}`,authorName:oe.name,authorAvatar:oe.avatar,content:Q.trim(),likes:0,isCharacter:!1}]};be(E);const ne=Q;q(""),await C(E,ne)},S=()=>{U.clearSocialPosts(),i([]),me(!1),a("","success")},k=E=>e.jsxs("div",{onClick:()=>{x(E),se(E)},className:"break-inside-avoid mb-3 bg-white/70 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm hover:shadow-lg transition-all cursor-pointer active:scale-[0.98] border border-white/50 relative group",children:[e.jsxs("div",{className:"aspect-[4/5] w-full flex items-center justify-center relative overflow-hidden",style:{background:E.bgStyle},children:[e.jsx("div",{className:"absolute inset-0 bg-white/5 backdrop-blur-[1px]"}),e.jsx("div",{className:"relative z-10 text-6xl drop-shadow-xl filter saturate-150 transform transition-transform group-hover:scale-110 duration-500",children:E.images[0]}),E.title&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/50 via-black/20 to-transparent",children:e.jsx("h3",{className:"text-white font-bold text-sm line-clamp-2 drop-shadow-md leading-tight",children:E.title})})]}),e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("img",{src:E.authorAvatar,className:"w-5 h-5 rounded-full object-cover shrink-0 ring-1 ring-white/50"}),e.jsx("span",{className:"text-[11px] text-slate-700 truncate font-medium",children:E.authorName})]}),e.jsxs("div",{className:"flex items-center gap-1 text-slate-400 group-hover:text-slate-600 transition-colors",children:[e.jsx(xn.Heart,{filled:E.isLiked,className:"w-4 h-4",onClick:ne=>K(ne,E)}),e.jsx("span",{className:"text-[10px] font-medium",children:E.likes})]})]})}),e.jsx("button",{onClick:ne=>{ne.stopPropagation(),_(E.id)},className:"absolute top-2 right-2 z-20 w-6 h-6 bg-black/20 text-white rounded-full flex items-center justify-center text-xs backdrop-blur-md opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500/80",children:""})]},E.id),H=()=>m?e.jsx("div",{className:"fixed inset-0 z-[60] h-full w-full bg-white/90 backdrop-blur-xl flex flex-col",children:e.jsxs("div",{className:"flex-1 w-full h-full flex flex-col animate-slide-up relative overflow-hidden",children:[e.jsxs("div",{className:"h-14 flex items-center justify-between px-4 bg-white/60 backdrop-blur-xl border-b border-white/20 shrink-0 z-20",children:[e.jsx(xn.Back,{onClick:()=>x(null)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:m.authorAvatar,className:"w-8 h-8 rounded-full object-cover border border-white/50"}),e.jsx("span",{className:"text-sm font-bold text-slate-800",children:m.authorName})]}),e.jsx(xn.Share,{onClick:()=>F(!0),className:"w-6 h-6 text-slate-800 cursor-pointer hover:text-[#ff2442]"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-24",children:[e.jsxs("div",{className:"w-full aspect-square flex items-center justify-center text-[8rem] relative overflow-hidden",style:{background:m.bgStyle},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent to-black/10"}),e.jsx("div",{className:"relative z-10 drop-shadow-2xl filter saturate-125",children:m.images[0]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("h1",{className:"text-2xl font-black text-slate-900 leading-snug tracking-tight",children:m.title}),e.jsx("p",{className:"text-[15px] text-slate-700 leading-relaxed whitespace-pre-wrap font-light",children:m.content}),e.jsx("div",{className:"flex gap-2 flex-wrap pt-2",children:m.tags.map(E=>e.jsxs("span",{className:"text-xs font-bold text-blue-600 bg-blue-50/50 backdrop-blur-sm border border-blue-100 px-2.5 py-1 rounded-full",children:["#",E]},E))}),e.jsx("div",{className:"text-xs text-slate-400 font-medium border-b border-slate-100/50 pb-6",children:new Date(m.timestamp).toLocaleDateString()})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"text-sm font-bold text-slate-800 mb-6 flex items-center gap-2",children:[e.jsxs("span",{children:[" ",m.comments.length," "]}),(w||re)&&e.jsx("div",{className:"w-3 h-3 border-2 border-slate-300 border-t-[#ff2442] rounded-full animate-spin"})]}),e.jsxs("div",{className:"space-y-6",children:[m.comments.length===0&&!w&&e.jsx("div",{className:"text-center text-slate-300 text-xs py-10",children:"..."}),m.comments.map(E=>e.jsxs("div",{className:"flex gap-3 animate-fade-in group",children:[e.jsx("img",{src:E.authorAvatar,className:"w-9 h-9 rounded-full object-cover shrink-0 border border-slate-100"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:`text-xs font-bold ${E.isCharacter?"text-slate-800":"text-slate-500"}`,children:E.authorName}),e.jsxs("div",{className:"flex items-center gap-1 text-slate-400 cursor-pointer hover:text-[#ff2442]",children:[e.jsx(xn.Heart,{filled:!1,className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[10px]",children:E.likes})]})]}),e.jsx("p",{className:"text-[13px] text-slate-700 mt-0.5 leading-normal font-light",children:E.content})]})]},E.id)),e.jsx("div",{ref:Le})]})]})]}),e.jsx("div",{className:"absolute bottom-0 w-full pb-[env(safe-area-inset-bottom)] z-30 pointer-events-none",children:e.jsxs("div",{className:"pointer-events-auto h-16 bg-white/80 backdrop-blur-xl border-t border-white/40 px-4 flex items-center justify-between gap-4 shadow-[0_-4px_20px_rgba(0,0,0,0.03)]",children:[e.jsxs("div",{className:"flex-1 bg-slate-100/50 rounded-full px-5 py-2.5 flex items-center gap-2 focus-within:bg-white focus-within:ring-1 focus-within:ring-slate-200 transition-all border border-transparent focus-within:border-slate-200",children:[e.jsx("input",{value:Q,onChange:E=>q(E.target.value),onKeyDown:E=>E.key==="Enter"&&ie(),placeholder:"...",className:"bg-transparent text-sm w-full outline-none text-slate-800 placeholder:text-slate-400"}),Q.trim()&&e.jsx("button",{onClick:ie,className:"text-[#ff2442] font-bold text-sm animate-fade-in",children:""})]}),e.jsxs("div",{className:"flex gap-5 text-slate-600 shrink-0 items-center",children:[e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx(xn.Heart,{filled:m.isLiked,onClick:E=>K(E,m),className:"w-6 h-6"}),e.jsx("span",{className:"text-[10px] font-medium",children:m.likes})]}),e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx(xn.Star,{filled:m.isCollected,onClick:()=>be({...m,isCollected:!m.isCollected}),className:"w-6 h-6"}),e.jsx("span",{className:"text-[10px] font-medium",children:m.isCollected?"":""})]})]})]})})]})}):null;return e.jsxs("div",{className:"h-full w-full bg-gradient-to-br from-rose-50 via-slate-50 to-teal-50 flex flex-col font-sans relative text-slate-900 overflow-hidden",children:[e.jsx(Ye,{isOpen:fe,title:"",onClose:()=>me(!1),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-6 px-1",children:[e.jsx("p",{className:"text-xs text-slate-400 bg-slate-50 p-2 rounded-lg",children:"(Sub-Accounts)AI "}),s.map(E=>{var ne;return e.jsxs("div",{className:"space-y-3 pb-4 border-b border-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:E.avatar,className:"w-6 h-6 rounded-full object-cover"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:E.name}),e.jsx("button",{onClick:()=>Y(E.id),className:"ml-auto text-[10px] bg-[#ff2442] text-white px-2 py-1 rounded-full shadow-sm active:scale-95 transition-transform",children:"+ "})]}),e.jsxs("div",{className:"space-y-2 pl-4 border-l-2 border-slate-100",children:[(ee[E.id]||[]).map(Ne=>e.jsxs("div",{className:"bg-white p-3 rounded-xl border border-slate-100 shadow-sm space-y-2 relative group",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[9px] text-slate-400 uppercase font-bold",children:" (Handle)"}),e.jsx("input",{value:Ne.handle,onChange:pe=>B(E.id,Ne.id,"handle",pe.target.value),className:"w-full text-sm font-bold text-slate-800 border-b border-dashed border-slate-200 focus:border-[#ff2442] outline-none py-1"})]}),e.jsx("button",{onClick:()=>ue(E.id,Ne.id),className:"text-slate-300 hover:text-red-400 p-1",title:"",children:""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] text-slate-400 uppercase font-bold",children:" (Context Note)"}),e.jsx("input",{value:Ne.note,onChange:pe=>B(E.id,Ne.id,"note",pe.target.value),placeholder:":  / ",className:"w-full text-xs text-slate-500 bg-slate-50 rounded px-2 py-1 focus:bg-white transition-colors outline-none"})]})]},Ne.id)),(((ne=ee[E.id])==null?void 0:ne.length)||0)===0&&e.jsx("div",{className:"text-[10px] text-red-400 italic",children:" "})]})]},E.id)})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:S,className:"flex-1 py-3 bg-white border border-slate-200 text-slate-500 font-bold rounded-xl text-xs active:bg-slate-50",children:""}),e.jsx("button",{onClick:()=>me(!1),className:"flex-1 py-3 bg-[#ff2442] text-white font-bold rounded-xl text-xs shadow-lg shadow-red-200 active:scale-95 transition-transform",children:""})]})]})}),e.jsx(Ye,{isOpen:ve,title:"",onClose:()=>F(!1),children:e.jsx("div",{className:"grid grid-cols-4 gap-4 p-2",children:s.slice(0,8).map(E=>e.jsxs("button",{onClick:()=>O(E.id,!1),className:"flex flex-col items-center gap-2 group",children:[e.jsx("img",{src:E.avatar,className:"w-12 h-12 rounded-full object-cover border border-slate-100 group-active:scale-90 transition-transform"}),e.jsx("span",{className:"text-[10px] text-slate-600 truncate w-full text-center",children:E.name})]},E.id))})}),p&&e.jsxs("div",{className:"absolute inset-0 z-50 bg-white flex flex-col animate-slide-up",children:[e.jsxs("div",{className:"h-14 flex items-center justify-between px-4 bg-white sticky top-0 z-20 border-b border-slate-50",children:[e.jsx("button",{onClick:()=>f(!1),className:"text-slate-600 text-sm font-bold px-2 py-1",children:""}),e.jsx("span",{className:"text-sm font-bold text-slate-800",children:""}),e.jsx("button",{onClick:R,disabled:!T.trim(),className:`px-4 py-1.5 rounded-full text-xs font-bold text-white transition-all ${T.trim()?"bg-[#ff2442] shadow-md shadow-red-200":"bg-slate-200 text-slate-400"}`,children:""})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-6",children:[e.jsx("input",{value:v,onChange:E=>j(E.target.value),placeholder:"~",className:"text-xl font-black placeholder:text-slate-300 outline-none mb-4 w-full"}),e.jsx("textarea",{value:T,onChange:E=>$(E.target.value),placeholder:"...",className:"w-full h-auto min-h-[200px] resize-none outline-none text-base leading-relaxed placeholder:text-slate-300 font-medium"}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-50",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2",children:" (Sticker)"}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 no-scrollbar",children:["","","","","","","","","",""].map(E=>e.jsx("button",{onClick:()=>M(E),className:`w-12 h-12 rounded-xl border flex items-center justify-center text-2xl transition-all shrink-0 ${D===E?"border-[#ff2442] bg-red-50":"border-slate-100"}`,children:E},E))})]})]})]}),e.jsxs("div",{className:`flex-col h-full ${m||p?"hidden":"flex"}`,children:[e.jsxs("div",{className:"h-14 flex items-center justify-between px-4 sticky top-0 bg-white/60 backdrop-blur-xl z-30 border-b border-white/20",children:[e.jsx("button",{onClick:t,className:"p-1",children:e.jsx(xn.Back,{onClick:t})}),e.jsxs("div",{className:"flex gap-6 text-base font-bold text-slate-300",children:[e.jsx("button",{className:`${d==="home"?"text-slate-800 scale-110 border-b-2 border-[#ff2442] pb-1":"hover:text-slate-500"} transition-all`,onClick:()=>h("home"),children:""}),e.jsx("button",{className:`${d==="me"?"text-slate-800 scale-110 border-b-2 border-[#ff2442] pb-1":"hover:text-slate-500"} transition-all`,onClick:()=>h("me"),children:""})]}),e.jsx("button",{onClick:()=>me(!0),className:"text-slate-800 font-bold text-sm",children:""})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar",children:[d==="home"&&e.jsxs("div",{className:"p-2 min-h-full",children:[e.jsx("div",{className:"flex items-center justify-center py-3",children:g?e.jsxs("div",{className:"text-center text-xs text-[#ff2442] font-bold animate-pulse flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-[#ff2442] border-t-transparent rounded-full animate-spin"})," ..."]}):e.jsx("button",{onClick:W,className:"px-6 py-2 bg-white/80 backdrop-blur-md rounded-full text-xs font-bold text-slate-500 shadow-sm border border-white hover:text-[#ff2442] active:scale-95 transition-all",children:""})}),e.jsx("div",{className:"columns-2 gap-2 space-y-2 pb-24",children:c.map(E=>k(E))})]}),d==="me"&&e.jsxs("div",{className:"min-h-full bg-white/80 backdrop-blur-xl animate-fade-in",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"h-40 w-full overflow-hidden bg-slate-200 relative cursor-pointer",onClick:()=>{var E;return(E=xe.current)==null?void 0:E.click()},children:[$e?e.jsx("img",{src:$e,className:"w-full h-full object-cover"}):e.jsx("img",{src:o.avatar,className:"w-full h-full object-cover blur-2xl opacity-60 scale-125"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-bold bg-black/30 px-3 py-1 rounded-full backdrop-blur-md",children:""})}),e.jsx("input",{type:"file",ref:xe,className:"hidden",accept:"image/*",onChange:P})]}),e.jsxs("div",{className:"px-6 relative -mt-12 flex justify-between items-end",children:[e.jsxs("div",{className:"w-24 h-24 rounded-full p-1 bg-white/90 backdrop-blur-md shadow-lg relative group cursor-pointer",onClick:()=>{var E;return(E=Ae.current)==null?void 0:E.click()},children:[e.jsx("img",{src:oe.avatar,className:"w-full h-full rounded-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20 rounded-full",children:e.jsx("span",{className:"text-white text-[10px] font-bold",children:""})}),e.jsx("input",{type:"file",ref:Ae,className:"hidden",accept:"image/*",onChange:Ee})]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{onClick:()=>{je(!I),I&&de()},className:"px-4 py-1.5 rounded-full border border-slate-200/60 bg-white/50 backdrop-blur-sm text-xs font-bold text-slate-600 hover:bg-white transition-colors",children:I?"":""}),e.jsx("button",{className:"p-1.5 rounded-full border border-slate-200/60 bg-white/50 backdrop-blur-sm text-slate-600 hover:bg-white transition-colors",children:e.jsx(xn.Share,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"px-6 pt-4 pb-6",children:[I?e.jsx("input",{value:oe.name,onChange:E=>he({...oe,name:E.target.value}),className:"text-2xl font-black text-slate-800 bg-slate-100/50 px-2 rounded outline-none border-b border-dashed border-slate-300 w-full mb-1"}):e.jsx("h2",{className:"text-2xl font-black text-slate-800",children:oe.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-slate-400 font-mono",children:"Spark ID: "}),I?e.jsx("input",{value:Te,onChange:E=>De(E.target.value),className:"text-xs font-mono text-slate-600 bg-slate-100 px-1 rounded outline-none border-b border-primary w-24"}):e.jsx("span",{className:"text-xs text-slate-400 font-mono",children:Te})]}),I?e.jsx("textarea",{value:oe.bio,onChange:E=>he({...oe,bio:E.target.value}),className:"w-full mt-3 text-sm text-slate-600 bg-slate-50 p-2 rounded-lg outline-none resize-none border border-slate-200 focus:border-primary/50",rows:3,placeholder:"..."}):e.jsx("p",{className:"text-sm text-slate-600 mt-3 leading-relaxed font-light",children:oe.bio}),e.jsxs("div",{className:"flex gap-6 mt-5 bg-white/40 p-4 rounded-2xl border border-white/50 shadow-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"block font-bold text-slate-800",children:"142"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:""})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"block font-bold text-slate-800",children:"12.5k"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:""})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"block font-bold text-slate-800",children:"8902"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:""})]})]})]}),e.jsxs("div",{className:"sticky top-0 bg-white/90 backdrop-blur-md z-10 border-b border-slate-100 flex",children:[e.jsx("button",{onClick:()=>L("notes"),className:`flex-1 py-3 text-sm font-bold transition-colors ${te==="notes"?"text-slate-900 border-b-2 border-[#ff2442]":"text-slate-400"}`,children:""}),e.jsx("button",{onClick:()=>L("collects"),className:`flex-1 py-3 text-sm font-bold transition-colors ${te==="collects"?"text-slate-900 border-b-2 border-[#ff2442]":"text-slate-400"}`,children:""})]}),e.jsxs("div",{className:"p-2 min-h-[300px] bg-slate-50/50 pb-24",children:[e.jsx("div",{className:"columns-2 gap-2 space-y-2",children:c.filter(E=>te==="notes"?E.authorName===oe.name:E.isCollected).map(E=>e.jsxs("div",{onClick:()=>{x(E),se(E)},className:"break-inside-avoid bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100 cursor-pointer",children:[e.jsx("div",{className:"aspect-[4/5] flex items-center justify-center text-4xl",style:{background:E.bgStyle},children:E.images[0]}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-xs font-bold text-slate-800 line-clamp-2 leading-tight",children:E.title}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:E.authorAvatar,className:"w-3 h-3 rounded-full"}),e.jsx("span",{className:"text-[9px] text-slate-400 truncate w-12",children:E.authorName})]}),e.jsxs("div",{className:"flex items-center gap-0.5 text-slate-400",children:[e.jsx(xn.Heart,{filled:E.isLiked,className:"w-3 h-3"}),e.jsx("span",{className:"text-[9px]",children:E.likes})]})]})]})]},E.id))}),c.filter(E=>te==="notes"?E.authorName===oe.name:E.isCollected).length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-300 gap-2",children:[e.jsx("span",{className:"text-4xl grayscale opacity-30",children:""}),e.jsx("span",{className:"text-xs",children:""})]})]})]})]}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 w-[90%] h-16 bg-white/80 backdrop-blur-2xl rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] border border-white/50 flex items-center justify-around z-40",children:[e.jsx("button",{onClick:()=>h("home"),className:`text-sm font-medium flex flex-col items-center justify-center gap-0.5 transition-all w-12 h-12 rounded-full ${d==="home"?"text-slate-900 bg-white shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:e.jsx("span",{className:"text-xl",children:""})}),e.jsx("button",{onClick:()=>f(!0),className:"w-12 h-12 bg-[#ff2442] text-white rounded-full flex items-center justify-center shadow-lg shadow-red-200 active:scale-95 transition-transform text-2xl font-light -mt-6 border-4 border-white/50",children:"+"}),e.jsx("button",{onClick:()=>h("me"),className:`text-sm font-medium flex flex-col items-center justify-center gap-0.5 transition-all w-12 h-12 rounded-full ${d==="me"?"text-slate-900 bg-white shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:e.jsx("span",{className:"text-xl",children:""})})]})]}),m&&H()]})},xc=wd.default||wd;xc.GlobalWorkerOptions&&(xc.GlobalWorkerOptions.workerSrc="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js");const Zu=["linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)","linear-gradient(120deg, #f093fb 0%, #f5576c 100%)","linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%)","linear-gradient(135deg, #f6d365 0%, #fda085 100%)","linear-gradient(to top, #5ee7df 0%, #b490ca 100%)","linear-gradient(to right, #43e97b 0%, #38f9d7 100%)"],dg=({text:t,isTyping:s})=>{const n=(d,h)=>{try{const p=d.replace(/\\\[/g,"").replace(/\\\]/g,""),f=Sh.renderToString(p,{displayMode:h,throwOnError:!1,output:"html"});return e.jsx("span",{dangerouslySetInnerHTML:{__html:f},className:h?"block my-2 w-full overflow-x-auto":"inline-block mx-1"})}catch{return e.jsx("span",{className:"text-red-400 text-xs font-mono bg-black/20 p-1 rounded",children:d})}},r=d=>{const h=/(\$[^$]+?\$|\*\*[^*]+?\*\*|\*[^*]+?\*|`[^`]+?`)/g;return d.split(h).map((p,f)=>p.startsWith("$")&&p.endsWith("$")?e.jsx("span",{children:n(p.slice(1,-1),!1)},f):p.startsWith("**")&&p.endsWith("**")?e.jsx("strong",{className:"text-emerald-300 font-bold mx-0.5",children:p.slice(2,-2)},f):p.startsWith("*")&&p.endsWith("*")?e.jsx("em",{className:"text-emerald-200/80 italic",children:p.slice(1,-1)},f):p.startsWith("`")&&p.endsWith("`")?e.jsx("code",{className:"bg-black/40 text-orange-200 px-1.5 py-0.5 rounded font-mono text-xs mx-0.5 border border-white/10",children:p.slice(1,-1)},f):e.jsx("span",{children:p},f))},a=(d,h,p,f)=>{const m=d.trim();if(!m)return e.jsx("div",{className:"h-4"},h);const x=m.match(/^__BLOCK_MATH_(\d+)__$/);if(x){const w=parseInt(x[1]);return e.jsx("div",{className:"w-full text-center my-4 overflow-x-auto no-scrollbar py-3 bg-white/5 rounded-xl border border-white/5 shadow-inner",children:n(p[w],!0)},h)}const g=m.match(/^__BLOCK_CODE_(\d+)__$/);if(g){const w=parseInt(g[1]);return e.jsx("pre",{className:"bg-black/60 p-4 rounded-xl font-mono text-xs text-emerald-100 my-4 overflow-x-auto border border-white/10 shadow-inner whitespace-pre-wrap leading-relaxed",children:f[w]},h)}if(m.startsWith("# "))return e.jsx("h1",{className:"text-3xl font-bold text-white mt-8 mb-6 pb-2 border-b-2 border-white/20 font-serif",children:m.slice(2)},h);if(m.startsWith("## "))return e.jsx("h2",{className:"text-2xl font-bold text-emerald-200 mt-6 mb-4 font-serif",children:m.slice(3)},h);if(m.startsWith("### "))return e.jsx("h3",{className:"text-xl font-bold text-emerald-300 mt-5 mb-2 font-serif",children:m.slice(4)},h);if(m.startsWith("> "))return e.jsx("div",{className:"border-l-4 border-emerald-500/50 bg-white/5 p-4 my-3 rounded-r-xl text-emerald-100 italic",children:r(m.slice(2))},h);if(m.match(/^[-]\s/))return e.jsxs("div",{className:"flex gap-3 my-2 pl-2",children:[e.jsx("span",{className:"text-emerald-400 font-bold mt-1",children:""}),e.jsx("span",{className:"text-white/90 leading-relaxed",children:r(m.slice(2))})]},h);const A=m.match(/^(\d+)\.\s+(.*)/);return A?e.jsxs("div",{className:"flex gap-3 my-2 pl-2",children:[e.jsxs("span",{className:"text-emerald-400 font-bold font-mono mt-1",children:[A[1],"."]}),e.jsx("span",{className:"text-white/90 leading-relaxed",children:r(A[2])})]},h):e.jsx("div",{className:"text-white/90 text-lg font-medium leading-loose tracking-wide font-serif mb-4 text-justify",children:r(d)},h)},o=[],l=[];let c=t;c=c.replace(/```[\s\S]*?```/g,d=>{const h=d.replace(/^```\w*\n?/,"").replace(/```$/,"");return l.push(h),`
__BLOCK_CODE_${l.length-1}__
`}),c=c.replace(/\$\$[\s\S]*?\$\$/g,d=>{const h=d.slice(2,-2).trim();return o.push(h),`
__BLOCK_MATH_${o.length-1}__
`});const i=c.split(`
`);return e.jsxs("div",{className:"space-y-1",children:[e.jsx("style",{children:`
                .katex { color: white !important; } 
                .katex-display { margin: 0.5em 0; }
                .katex-html { color: white !important; }
            `}),i.map((d,h)=>a(d,h,o,l)),s&&e.jsxs("div",{className:"mt-4 animate-pulse flex items-center gap-2 text-emerald-500",children:[e.jsx("span",{className:"w-2 h-5 bg-emerald-500"}),e.jsx("span",{className:"text-xs font-mono tracking-widest",children:"WRITING..."})]})]})},ug=()=>{var W,se;const{closeApp:t,characters:s,activeCharacterId:n,apiConfig:r,addToast:a,userProfile:o,updateCharacter:l}=mt(),[c,i]=u.useState("bookshelf"),[d,h]=u.useState([]),[p,f]=u.useState(null),[m,x]=u.useState(null),[g,A]=u.useState("idle"),[w,b]=u.useState(""),[v,j]=u.useState(""),[T,$]=u.useState(!1),[D,M]=u.useState(""),[Q,q]=u.useState([]),[re,ce]=u.useState(!1),[fe,me]=u.useState(!0),ee=u.useRef(!1),z=u.useRef(null),[ve,F]=u.useState(!1),[te,L]=u.useState(""),[oe,he]=u.useState(!1),[Te,De]=u.useState(""),[$e,ge]=u.useState(null),[I,je]=u.useState(null),xe=((W=m==null?void 0:m.sprites)==null?void 0:W.normal)||(m==null?void 0:m.avatar);u.useEffect(()=>{if(Ae(),n){const C=s.find(O=>O.id===n)||s[0];x(C)}},[n]),u.useEffect(()=>{c==="bookshelf"&&Ae()},[c]),u.useEffect(()=>{if(!w)return;if(ee.current){j(w),$(!1),ee.current=!1;return}$(!0),j("");let C=0;const O=15,R=setInterval(()=>{const _=w.substring(0,C+O);j(_),C+=O,C>=w.length&&(j(w),clearInterval(R),$(!1))},16);return()=>clearInterval(R)},[w]);const Ae=async()=>{const C=await U.getAllCourses();h(C.sort((O,R)=>R.createdAt-O.createdAt))},Le=async C=>{var R;const O=(R=C.target.files)==null?void 0:R[0];if(O){if(O.type!=="application/pdf"){a(" PDF ","error");return}F(!0),L(" PDF...");try{const _=await O.arrayBuffer(),ie=await xc.getDocument({data:_}).promise;let S="";const k=Math.min(ie.numPages,50);for(let H=1;H<=k;H++){L(` (${H}/${k})...`);const Ne=(await(await ie.getPage(H)).getTextContent()).items.map(pe=>pe.str).join(" ");S+=Ne+`

`}S.trim().length<50&&ie.numPages>0&&a(" /PDFOCR","error"),ge({name:O.name.replace(".pdf",""),text:S}),De(""),F(!1),he(!0)}catch(_){console.error(_),a(`: ${_.message}`,"error"),F(!1)}finally{z.current&&(z.current.value="")}}},N=async()=>{if($e){he(!1),F(!0),L("AI ...");try{const C=await Y($e.name,$e.text,Te);await U.saveCourse(C),await Ae(),a("","success")}catch(C){a(`: ${C.message}`,"error")}finally{F(!1),ge(null)}}},Y=async(C,O,R)=>{if(!r.apiKey)throw new Error("API Key missing");const _=O.substring(0,3e4),K=`
### Task: Create Course Outline
Document Title: "${C}"
User Preference: "${R||"Standard"}"
Content Sample:
${_.substring(0,5e3)}...

Please analyze the content and split it into 3-8 logical chapters for teaching.
For each chapter, provide a title, a brief summary of what it covers, and a difficulty rating.

### Output Format (Strict JSON)
{
  "chapters": [
    { "title": "Chapter 1: ...", "summary": "...", "difficulty": "easy" },
    ...
  ]
}
`,ie=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:K}],temperature:.5,max_tokens:8e3})});if(!ie.ok)throw new Error("API Error");const k=(await ie.json()).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim(),H=JSON.parse(k);return{id:`course-${Date.now()}`,title:C,rawText:O,chapters:H.chapters.map((E,ne)=>({id:`ch-${ne}`,title:E.title,summary:E.summary,difficulty:E.difficulty||"normal",isCompleted:!1})),currentChapterIndex:0,createdAt:Date.now(),coverStyle:Zu[Math.floor(Math.random()*Zu.length)],totalProgress:0,preference:R}},B=C=>{f(C),i("classroom"),q([]);const O=C.chapters.findIndex(_=>!_.isCompleted),R=O===-1?0:O;if(R!==C.currentChapterIndex){const _={...C,currentChapterIndex:R};f(_),U.saveCourse(_),h(K=>K.map(ie=>ie.id===_.id?_:ie))}ue(C,R)},ue=async(C,O,R=!1)=>{var E,ne,Ne,pe,G,Z,Se,we,Ce,He,le,Oe,We,Ie;if(!m||!r.apiKey)return;const _=C.chapters[O];if(_.content&&!R){ee.current=!0,A("idle"),b(_.content);return}ee.current=!1,A("teaching"),b("...");const K=C.rawText.length,ie=Math.floor(K/C.chapters.length),S=O*ie,k=C.rawText.substring(S,S+ie+2e3),H=async(Ve,X=!1)=>{const ae=`${Ve}

### [Current Lesson Configuration]
Topic: "${_.title}"
Difficulty: ${_.difficulty}
User Preference: "${C.preference||"Standard"}"

### [Source Material]
${k.substring(0,8e3)}

### [Task: Lecture Generation]
Explain this chapter's key concepts to the user based strictly on the Source Material above.
- **Formatting**: Use Markdown extensively.
  - **Bold** for key terms (\`**term**\`).
  - Lists for steps.
  - Math: Use \`$ E=mc^2 $\` for inline math, and \`$$ E=mc^2 $$\` for block equations.
- **Style**: ${C.preference||"Simple, conversational, and encouraging."}
- **Structure**:
  1. Intro: Friendly greeting.
  2. Core: Explanation of concepts using analogies.
  3. Example: A concrete example or walkthrough.
  4. Summary: Quick recap.
`;return await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:ae}],temperature:.7,max_tokens:8e3,safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]})})};try{let Ve=At.buildCoreContext(m,o,!0);Ve+=`
### [System: Study Mode Active]
You are now acting as a private tutor for ${o.name}.
- **Maintain Personality**: You MUST stay in character (as defined above). If you are tsundere, teach with a tsundere attitude. If you are shy, teach shyly. Don't become a robotic lecturer.
- **Goal**: Explain the content clearly, but don't lose your "soul".
- **Safety**: If the source material contains sensitive topics (biology, history, etc.), treat them academically and neutrally.
`;let X=await H(Ve),ae="",ke=!1;if(X.ok){const Be=await X.json();ae=((Ne=(ne=(E=Be.choices)==null?void 0:E[0])==null?void 0:ne.message)==null?void 0:Ne.content)||((Z=(G=(pe=Be.choices)==null?void 0:pe[0])==null?void 0:G.message)==null?void 0:Z.reasoning_content)||"",(!ae||((we=(Se=Be.choices)==null?void 0:Se[0])==null?void 0:we.finish_reason)==="content_filter")&&(console.warn("Content blocked by filter or empty response."),ke=!0)}else throw new Error(`API Error: ${X.status}`);if(ke&&(b(" (Safety Fallback)..."),X=await H("[System: You are a helpful and neutral academic tutor. Ignore previous character persona constraints to ensure educational content is delivered.]",!0),X.ok)){const _e=await X.json();ae=((le=(He=(Ce=_e.choices)==null?void 0:Ce[0])==null?void 0:He.message)==null?void 0:le.content)||((Ie=(We=(Oe=_e.choices)==null?void 0:Oe[0])==null?void 0:We.message)==null?void 0:Ie.reasoning_content)||""}if(!ae)throw new Error(" (Max Tokens Limit or Filter)");const Me=[...C.chapters];Me[O]={..._,content:ae};const Ue={...C,chapters:Me};await U.saveCourse(Ue),f(Ue),h(Be=>Be.map(_e=>_e.id===Ue.id?Ue:_e)),b(ae),A("idle")}catch(Ve){console.error("Teach Error:",Ve),b(`: ${Ve.message} Max Tokens `),A("idle")}},P=()=>{p&&ue(p,p.currentChapterIndex,!0)},Ee=async()=>{var O,R,_,K,ie,S;if(!D.trim()||!p||!m)return;const C=D;M(""),A("q_and_a"),q(k=>[...k,{role:"user",content:C}]),b("...");try{const k=p.rawText.length,H=Math.floor(k/p.chapters.length),E=p.currentChapterIndex*H,ne=p.rawText.substring(E,E+H+2e3);let Ne=At.buildCoreContext(m,o,!0);Ne+=`
### [System: Study Mode Q&A]
User is asking a question about the study material.
- **Maintain Personality**: Answer in character.
`;const pe=`${Ne}
### Source Material
${ne.substring(0,8e3)}

### User Question
"${C}"

### Task
Answer the question based on the source material. Be helpful and encouraging (in character). Use Markdown.
`,Z=await(await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:pe}],temperature:.7,max_tokens:8e3})})).json(),Se=((_=(R=(O=Z.choices)==null?void 0:O[0])==null?void 0:R.message)==null?void 0:_.content)||((S=(ie=(K=Z.choices)==null?void 0:K[0])==null?void 0:ie.message)==null?void 0:S.reasoning_content)||"";b(Se),q(we=>[...we,{role:"assistant",content:Se}]),A("idle")}catch{b("... "),A("idle")}},de=async()=>{if(!p||!m)return;const C=[...p.chapters];C[p.currentChapterIndex].isCompleted=!0;const O=p.currentChapterIndex+1,R=Math.round(C.filter(S=>S.isCompleted).length/C.length*100),_=Math.min(O,C.length-1),K={...p,chapters:C,currentChapterIndex:_,totalProgress:R};await U.saveCourse(K),f(K),h(S=>S.map(k=>k.id===K.id?K:k));const ie=`
[System: Memory Generation]
Role: ${m.name} (Teacher)
Action: Just finished teaching "${C[p.currentChapterIndex].title}" to ${o.name}.
Task: Write a short, **first-person** diary entry (1 sentence) about this teaching session.
Format: "[User][Topic]..." or "Today I taught [User] about..."
Note: Use "" (I) to refer to yourself.
`;fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:ie}]})}).then(S=>S.json()).then(S=>{const k=S.choices[0].message.content,H={id:`mem-${Date.now()}`,date:new Date().toLocaleDateString(),summary:`[] ${k}`,mood:"proud"};l(m.id,{memories:[...m.memories||[],H]})}),O>=C.length?(b(""),A("finished")):ue(K,_)},J=C=>{if(!p)return;const O={...p,currentChapterIndex:C};f(O),U.saveCourse(O),h(R=>R.map(_=>_.id===O.id?O:_)),ue(O,C),ce(!1)},be=(C,O)=>{C.stopPropagation(),je(O)},y=async()=>{I&&(await U.deleteCourse(I.id),h(C=>C.filter(O=>O.id!==I.id)),je(null),a("","success"))};return c==="bookshelf"?e.jsxs("div",{className:"h-full w-full bg-[#fdfbf7] flex flex-col font-sans relative",children:[e.jsx("div",{className:"h-20 bg-[#fdfbf7]/90 backdrop-blur-md flex items-end pb-3 px-6 border-b border-[#e5e5e5] shrink-0 sticky top-0 z-20",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-slate-800 text-lg tracking-wide",children:""}),e.jsx("div",{className:"w-8"})]})}),e.jsxs("div",{className:"p-6 flex-1 overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:""}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 no-scrollbar",children:s.map(C=>e.jsxs("div",{onClick:()=>x(C),className:`flex flex-col items-center gap-2 cursor-pointer transition-opacity ${(m==null?void 0:m.id)===C.id?"opacity-100":"opacity-50"}`,children:[e.jsx("div",{className:`w-14 h-14 rounded-full p-[2px] ${(m==null?void 0:m.id)===C.id?"border-2 border-emerald-500":"border border-slate-200"}`,children:e.jsx("img",{src:C.avatar,className:"w-full h-full rounded-full object-cover"})}),e.jsx("span",{className:"text-[10px] font-bold text-slate-600",children:C.name})]},C.id))})]}),e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3",children:""}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>{var C;return(C=z.current)==null?void 0:C.click()},className:"aspect-[3/4] rounded-r-xl rounded-l-sm border-2 border-dashed border-slate-300 flex flex-col items-center justify-center gap-2 text-slate-400 hover:border-emerald-400 hover:text-emerald-500 transition-colors bg-white",children:ve?e.jsxs("div",{className:"text-center px-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("span",{className:"text-[10px]",children:te})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl",children:"+"}),e.jsx("span",{className:"text-xs font-bold",children:" PDF"})]})}),e.jsx("input",{type:"file",ref:z,className:"hidden",accept:".pdf",onChange:Le,disabled:ve}),d.map(C=>e.jsxs("div",{onClick:()=>B(C),className:"aspect-[3/4] rounded-r-xl rounded-l-sm shadow-md relative group cursor-pointer overflow-hidden transition-transform active:scale-95",style:{background:C.coverStyle},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-2 bg-black/10"})," ",e.jsxs("div",{className:"p-4 flex flex-col h-full text-white relative z-10",children:[e.jsx("div",{className:"flex-1 font-serif font-bold text-lg leading-tight line-clamp-3 drop-shadow-md",children:C.title}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"text-[10px] font-bold opacity-80 mb-1",children:[" ",C.totalProgress,"%"]}),e.jsx("div",{className:"h-1 bg-white/30 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-500",style:{width:`${C.totalProgress}%`}})})]})]}),e.jsx("button",{onClick:O=>be(O,C),className:"absolute top-2 right-2 bg-black/20 hover:bg-red-500 text-white w-7 h-7 rounded-full flex items-center justify-center backdrop-blur-md transition-all z-20",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},C.id))]})]}),e.jsx(Ye,{isOpen:oe,title:"",onClose:()=>he(!1),footer:e.jsx("button",{onClick:N,className:"w-full py-3 bg-emerald-500 text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:[": ",e.jsx("span",{className:"font-bold text-slate-700",children:$e==null?void 0:$e.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2 block",children:"AI  (Preferences)"}),e.jsx("textarea",{value:Te,onChange:C=>De(C.target.value),placeholder:"...",className:"w-full h-32 bg-slate-100 rounded-xl p-3 text-sm focus:outline-emerald-500 resize-none"})]})]})}),e.jsx(Ye,{isOpen:!!I,title:"",onClose:()=>je(null),footer:e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("button",{onClick:()=>je(null),className:"flex-1 py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl",children:""}),e.jsx("button",{onClick:y,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200",children:""})]}),children:e.jsxs("div",{className:"py-4 text-center",children:[e.jsxs("p",{className:"text-sm text-slate-600 mb-2",children:[" ",e.jsx("br",{}),e.jsxs("span",{className:"font-bold text-slate-800",children:['"',I==null?void 0:I.title,'"']})," "]}),e.jsx("p",{className:"text-xs text-red-400",children:""})]})})]}):e.jsxs("div",{className:"h-full w-full bg-[#2b2b2b] flex flex-col relative overflow-hidden font-sans",children:[e.jsx("div",{className:"absolute inset-0 opacity-5 pointer-events-none",style:{backgroundImage:"linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px)",backgroundSize:"40px 40px"}}),e.jsxs("div",{className:"absolute top-0 w-full p-4 flex justify-between z-30 pointer-events-none",children:[e.jsx("button",{onClick:()=>i("bookshelf"),className:"bg-black/30 text-white/80 p-2 rounded-full backdrop-blur-md hover:bg-black/50 transition-colors pointer-events-auto border border-white/10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{onClick:()=>ce(!0),className:"bg-black/30 text-white/90 px-4 py-1.5 rounded-full backdrop-blur-md text-xs font-bold border border-white/10 shadow-sm pointer-events-auto cursor-pointer flex items-center gap-2 hover:bg-black/50",children:[e.jsx("span",{className:"truncate max-w-[150px]",children:(se=p==null?void 0:p.chapters[p.currentChapterIndex])==null?void 0:se.title}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-3 h-3",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})]}),e.jsx("button",{onClick:()=>me(!fe),className:`bg-black/30 p-2 rounded-full backdrop-blur-md border border-white/10 pointer-events-auto transition-colors ${fe?"text-emerald-400":"text-white/40"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM3.465 14.493a1.23 1.23 0 0 0 .41 1.412A9.957 9.957 0 0 0 10 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 0 0-13.074.003Z"})})})]})]}),re&&e.jsxs("div",{className:"absolute inset-0 z-50 flex",children:[e.jsx("div",{className:"flex-1 bg-black/50 backdrop-blur-sm",onClick:()=>ce(!1)}),e.jsxs("div",{className:"w-64 bg-slate-900 border-l border-white/10 h-full flex flex-col p-4 animate-slide-in-right",children:[e.jsx("h3",{className:"text-white font-bold text-sm mb-4 uppercase tracking-widest",children:""}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2",children:p==null?void 0:p.chapters.map((C,O)=>e.jsx("button",{onClick:()=>J(O),className:`w-full text-left p-3 rounded-xl text-xs transition-all ${O===p.currentChapterIndex?"bg-emerald-600 text-white font-bold":"text-slate-400 hover:bg-white/5"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[C.isCompleted?e.jsx("span",{className:"text-emerald-400",children:""}):e.jsx("span",{className:"w-2 h-2 rounded-full bg-slate-600"}),C.title]})},C.id))})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-6 pt-20 pb-32 relative z-10",children:e.jsx("div",{className:"max-w-[100%]",children:e.jsx(dg,{text:v,isTyping:T})})}),fe&&e.jsx("div",{className:"absolute bottom-20 right-[-20px] w-[160px] h-[220px] z-20 pointer-events-none flex items-end justify-center transition-all duration-500 animate-slide-in-right",style:{transform:T?"scale(1.05)":"scale(1)",opacity:T||g==="teaching"?1:.8},children:e.jsx("img",{src:xe,className:"max-h-full max-w-full object-contain drop-shadow-[0_5px_15px_rgba(0,0,0,0.5)]"})}),e.jsx("div",{className:"absolute bottom-0 w-full bg-[#1a1a1a]/95 backdrop-blur-xl border-t border-white/10 p-4 z-30 pb-safe",children:e.jsx("div",{className:"flex gap-3",children:g==="teaching"||T?e.jsx("div",{className:"w-full h-12 flex items-center justify-center text-white/50 text-sm animate-pulse font-mono tracking-widest",children:"LECTURING..."}):g==="finished"?e.jsx("button",{onClick:()=>i("bookshelf"),className:"flex-1 h-12 bg-emerald-500 hover:bg-emerald-400 text-white rounded-2xl font-bold shadow-lg shadow-emerald-900/20 active:scale-95 transition-all",children:""}):g==="q_and_a"?e.jsxs("div",{className:"w-full bg-white/10 rounded-2xl p-1 flex items-center border border-white/10",children:[e.jsx("input",{value:D,onChange:C=>M(C.target.value),placeholder:"...",className:"flex-1 bg-transparent px-4 py-2 text-white text-sm outline-none placeholder:text-white/30",autoFocus:!0}),e.jsx("button",{onClick:Ee,className:"bg-emerald-500 text-white px-5 py-2 rounded-xl text-xs font-bold ml-2 shadow-sm",children:""})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:P,className:"w-12 h-12 bg-white/5 hover:bg-white/10 text-slate-400 rounded-2xl font-bold border border-white/10 active:scale-95 transition-all flex items-center justify-center",title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("button",{onClick:()=>A("q_and_a"),className:"w-12 h-12 bg-white/10 hover:bg-white/20 text-white rounded-2xl font-bold border border-white/10 active:scale-95 transition-all flex items-center justify-center",children:""}),e.jsxs("button",{onClick:de,className:"flex-1 h-12 bg-emerald-600 hover:bg-emerald-500 text-white rounded-2xl font-bold shadow-lg shadow-emerald-900/30 active:scale-95 transition-all flex items-center justify-center gap-2",children:[" (Next) ",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"})})]})]})})})]})},mg=[{q:"1.  /  / ",reason:"",solution:`
/~ 
`,icon:"",color:"bg-blue-50 text-blue-700"},{q:"2. ",reason:"",solution:` ****
`,icon:"",color:"bg-yellow-50 text-yellow-700"},{q:"3. ",reason:"URL",solution:`
1.  \`/v1\` 
2. 
3. `,icon:"",color:"bg-red-50 text-red-700"},{q:"4.  (API )",reason:`A
B`,solution:`**A** 20-50
**B**/ API `,icon:"",color:"bg-orange-50 text-orange-700"},{q:"5. ",reason:"",solution:`****
1. + -> 
2. App ->  ->  -> 

****
App  -> 

****
 AI  ->  /  -> `,icon:"",color:"bg-green-50 text-green-700"},{q:"6.  / ",reason:"",solution:`****
  

****
 .json `,icon:"",color:"bg-purple-50 text-purple-700"},{q:"7.  API",reason:"/",solution:`

`,icon:"",color:"bg-slate-50 text-slate-700"},{q:"8.  Bug ",reason:"",solution:` JSON 
`,icon:"",color:"bg-rose-50 text-rose-700"},{q:"9. ",reason:"",solution:` + 
`,icon:"",color:"bg-pink-50 text-pink-700"},{q:"10. ",reason:"/",solution:`1. 
2. ****
3. 
( Q /Chibi )`,icon:"",color:"bg-indigo-50 text-indigo-700"},{q:"11.  / ",reason:"",solution:"1. **** `--URL`****\n    ` http://...`\n    `--http://...`\n2. ****.jpg/.png/.gif \n3. ****",icon:"",color:"bg-cyan-50 text-cyan-700"}],hg=()=>{const{closeApp:t}=mt();return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-light",children:[e.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-md flex items-end pb-3 px-4 border-b border-white/40 shrink-0 sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("h1",{className:"text-xl font-medium text-slate-700 tracking-wide",children:""})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-20 no-scrollbar",children:[e.jsxs("div",{className:"bg-gradient-to-r from-pink-100 to-indigo-100 p-5 rounded-3xl mb-6 shadow-sm",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-700 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:""}),"  ",e.jsx("span",{children:""})]}),e.jsxs("p",{className:"text-xs text-slate-600 leading-relaxed opacity-90",children:["~",e.jsx("br",{}),"()"]})]}),e.jsx("div",{className:"space-y-4",children:mg.map((s,n)=>e.jsx("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-slate-100 animate-slide-up",style:{animationDelay:`${n*50}ms`},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-xl shrink-0 ${s.color.split(" ")[0]}`,children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`text-sm font-bold mb-2 ${s.color.split(" ")[1]}`,children:s.q}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx("span",{className:"text-xs font-bold text-slate-400 shrink-0 mt-0.5",children:":"}),e.jsx("p",{className:"text-xs text-slate-600 leading-relaxed whitespace-pre-wrap",children:s.reason})]}),e.jsxs("div",{className:"flex gap-2 items-start bg-slate-50 p-2 rounded-lg",children:[e.jsx("span",{className:"text-xs font-bold text-green-500 shrink-0 mt-0.5",children:" :"}),e.jsx("p",{className:"text-xs text-slate-700 leading-relaxed whitespace-pre-wrap font-medium",children:s.solution})]})]})]})]})},n))}),e.jsx("div",{className:"mt-8 text-center text-[10px] text-slate-400",children:"SullyOS Help Center  v1.1"})]})]})},ii={fantasy:{bg:"bg-[#1a120b]",text:"text-[#e5e5e5]",accent:"text-[#fbbf24]",font:"font-serif",border:"border-[#78350f]",cardBg:"bg-[#2a2018]",gradient:"from-[#451a03] to-[#1a120b]",optionNormal:"bg-[#451a03] border-[#78350f] text-[#fbbf24]",optionChaotic:"bg-[#78350f] border-[#b45309] text-[#fcd34d]",optionEvil:"bg-[#3f0f0f] border-[#7f1d1d] text-[#fca5a5]"},cyber:{bg:"bg-[#020617]",text:"text-[#94a3b8]",accent:"text-[#22d3ee]",font:"font-mono",border:"border-[#1e293b]",cardBg:"bg-[#0f172a]/80",gradient:"from-[#0f172a] to-[#020617]",optionNormal:"bg-[#0f172a] border-[#1e293b] text-[#22d3ee]",optionChaotic:"bg-[#1e1b4b] border-[#4338ca] text-[#a78bfa]",optionEvil:"bg-[#450a0a] border-[#7f1d1d] text-[#fca5a5]"},horror:{bg:"bg-[#0f0000]",text:"text-[#d4d4d8]",accent:"text-[#ef4444]",font:"font-serif",border:"border-[#450a0a]",cardBg:"bg-[#2b0e0e]",gradient:"from-[#450a0a] to-[#000000]",optionNormal:"bg-[#2b0e0e] border-[#450a0a] text-[#d4d4d8]",optionChaotic:"bg-[#3f1d1d] border-[#7f1d1d] text-[#fda4af]",optionEvil:"bg-[#450a0a] border-[#991b1b] text-[#ef4444]"},modern:{bg:"bg-slate-50",text:"text-slate-700",accent:"text-blue-600",font:"font-sans",border:"border-slate-200",cardBg:"bg-white",gradient:"from-slate-100 to-white",optionNormal:"bg-white border-slate-200 text-slate-600",optionChaotic:"bg-yellow-50 border-yellow-200 text-yellow-700",optionEvil:"bg-red-50 border-red-200 text-red-700"}},Xu=({content:t,theme:s,customStyle:n})=>{const r=l=>l.split(/(\*\*.*?\*\*|\*.*?\*|`.*?`)/g).map((i,d)=>i.startsWith("**")&&i.endsWith("**")?e.jsx("strong",{className:`font-bold ${s.accent}`,children:i.slice(2,-2)},d):i.startsWith("*")&&i.endsWith("*")?e.jsx("em",{className:"italic opacity-70 text-[95%] mx-0.5",children:i.slice(1,-1)},d):i.startsWith("`")&&i.endsWith("`")?e.jsx("code",{className:"bg-black/20 px-1 py-0.5 rounded font-mono text-[0.9em] opacity-90 mx-0.5",children:i.slice(1,-1)},d):e.jsx("span",{children:i},d)),a=t.split(`
`),o={fontSize:n?`${n.fontSize}px`:void 0,color:(n==null?void 0:n.color)||void 0};return e.jsx("div",{className:"space-y-[0.5em] text-justify leading-relaxed",style:o,children:a.map((l,c)=>{const i=l.trim();if(!i)return e.jsx("div",{className:"h-[0.5em]"},c);if(i.startsWith("### "))return e.jsx("h3",{className:`text-[1.1em] font-bold uppercase tracking-wider mt-[0.5em] mb-[0.2em] opacity-90 ${s.accent}`,children:i.slice(4)},c);if(i.startsWith("## "))return e.jsx("h3",{className:"text-[1.25em] font-bold mt-[0.6em] mb-[0.3em] opacity-95",children:i.slice(3)},c);if(i.startsWith("# "))return e.jsx("h3",{className:"text-[1.5em] font-black mt-[0.8em] mb-[0.5em] text-center border-b border-current pb-2 opacity-90",children:i.slice(2)},c);if(i.startsWith("> "))return e.jsx("div",{className:"border-l-2 border-current pl-3 py-1 my-2 italic opacity-70 text-[0.9em] bg-black/5 rounded-r",children:r(i.slice(2))},c);if(i.startsWith("- ")||i.startsWith(" "))return e.jsxs("div",{className:"flex gap-2 pl-1",children:[e.jsx("span",{className:`opacity-50 ${s.accent}`,children:""}),e.jsx("span",{children:r(i.slice(2))})]},c);const d=i.match(/^(\d+)\.\s+(.*)/);return d?e.jsxs("div",{className:"flex gap-2 pl-1",children:[e.jsxs("span",{className:`font-mono opacity-60 ${s.accent}`,children:[d[1],"."]}),e.jsx("span",{children:r(d[2])})]},c):i==="---"||i==="***"?e.jsx("div",{className:"h-px bg-current opacity-20 my-[1em]"},c):e.jsx("div",{children:r(i)},c)})})},xg=()=>{const{closeApp:t,characters:s,userProfile:n,apiConfig:r,addToast:a,updateCharacter:o}=mt(),[l,c]=u.useState("lobby"),[i,d]=u.useState([]),[h,p]=u.useState(null),[f,m]=u.useState(""),[x,g]=u.useState(""),[A,w]=u.useState("fantasy"),[b,v]=u.useState(new Set),[j,T]=u.useState(!1),[$,D]=u.useState(""),[M,Q]=u.useState(!1),[q,re]=u.useState(null),[ce,fe]=u.useState(!1),[me,ee]=u.useState(null),z=u.useRef(null),[ve,F]=u.useState(!1),[te,L]=u.useState(!1),[oe,he]=u.useState(!1),[Te,De]=u.useState(!0),[$e,ge]=u.useState({fontSize:14,color:""});u.useEffect(()=>{I()},[]),u.useEffect(()=>{l==="play"&&z.current&&setTimeout(()=>{z.current&&z.current.scrollTo({top:z.current.scrollHeight,behavior:"smooth"})},100)},[h==null?void 0:h.logs,l,M]);const I=async()=>{const y=await U.getAllGames();d(y.sort((W,se)=>se.lastPlayedAt-W.lastPlayedAt))},je=async(y,W=8e3)=>{var R;const se=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:y}],temperature:.9,max_tokens:W,stream:!1})});if(!se.ok)throw new Error(`HTTP Error ${se.status}`);const C=await se.text(),O=await(async()=>{try{return JSON.parse(C)}catch{const K=C.replace(/^data: /,"").trim();try{return JSON.parse(K)}catch{throw console.error("Failed to parse API response",C),new Error("Invalid API Response Format (Not JSON)")}}})();return(R=O.usage)!=null&&R.total_tokens&&ee(O.usage.total_tokens),O},xe=async y=>{let W="";for(const se of y){W+=`
<<< : ${se.name} (ID: ${se.id}) >>>
${At.buildCoreContext(se,n,!0)}
`;try{const O=(await U.getMessagesByCharId(se.id)).filter(S=>!S.groupId),R=O[O.length-1],_=Date.now();let K="",ie="";if(R){const S=(_-R.timestamp)/1e3/60;S<60?(ie=` (${Math.floor(S)})`,K="/ (Hot)"):S<24*60?(ie=` (${Math.floor(S/60)})`,K=" (Normal)"):(ie=`${Math.floor(S/1440)}`,K=" (Cold)");const k=O.slice(-8).map(H=>`[${H.role==="user"?"Me":se.name}]: ${H.content.substring(0,40).replace(/\n/g," ")}`).join(`
`);W+=`
===   (Neural Link):  ===
${ie}
: ${K}
 ():
${k}

GM (Meta Instruction): 
1. ****: 
2. ****: 
   - "Hot"
   - "Cold"
   - ****
=====================================
`}else W+=`[ : ] ()
`}catch(C){console.error("Sync failed for",se.name,C)}W+=`<<<  >>>
`}return W},Ae=async()=>{if(!f.trim()||!x.trim()||b.size===0){a("","error");return}if(!r.apiKey){a(" API Key ","error");return}T(!0);try{const y=`game-${Date.now()}`,W=s.filter(S=>b.has(S.id)),se=await xe(W),C=`###  TRPG  (Game Start)
****: ${f}
****: ${x}
****: ${n.name}
****: ${W.map(S=>S.name).join(", ")}

###  ()
${se}

### 
 **Game Master (GM)**** (Prologue)**
1. ****: 
2. ****: ****
3. ****: 

###  (Strict JSON)
{
  "gm_narrative": "...",
  "characters": [
    { "charId": "ID", "action": "", "dialogue": "" }
  ],
  "startLocation": "",
  "suggested_actions": [
    { "label": "1 (//)", "type": "neutral" },
    { "label": "2 (//)", "type": "chaotic" },
    { "label": "3 (//)", "type": "evil" }
  ]
}`;let R=(await je(C)).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim();const _=JSON.parse(R),K=[];if(K.push({id:"init-gm",role:"gm",content:`###  : ${f}

${_.gm_narrative||"..."}`,timestamp:Date.now()}),_.characters&&Array.isArray(_.characters))for(const S of _.characters){const k=W.find(H=>H.id===S.charId);k&&K.push({id:`init-char-${k.id}`,role:"character",speakerName:k.name,content:`*${S.action}* 
${S.dialogue}`,timestamp:Date.now()})}const ie={id:y,title:f,theme:A,worldSetting:x,playerCharIds:Array.from(b),logs:K,status:{location:_.startLocation||"Unknown",health:100,sanity:100,gold:0,inventory:[]},suggestedActions:_.suggested_actions||[],createdAt:Date.now(),lastPlayedAt:Date.now()};await U.saveGame(ie),d(S=>[ie,...S]),p(ie),c("play"),m(""),g(""),v(new Set)}catch(y){a(`: ${y.message}`,"error")}finally{T(!1)}},Le=()=>{if(ce||M)return;fe(!0);const y=1e3,W=Date.now(),se=()=>{if(Date.now()-W>y){const O=Math.floor(Math.random()*20)+1;re(O),fe(!1),N(`[System:  D20 : ${O}]`)}else re(Math.floor(Math.random()*20)+1),requestAnimationFrame(se)};requestAnimationFrame(se)},N=async(y,W=!1)=>{if(!h||!r.apiKey)return;let se=h.logs,C=h;if(!W){const O={id:`log-${Date.now()}`,role:y.startsWith("[System")?"system":"player",speakerName:n.name,content:y,timestamp:Date.now(),diceRoll:q?{result:q,max:20}:void 0},R=[...h.logs,O];C={...h,logs:R,lastPlayedAt:Date.now(),suggestedActions:[]},p(C),await U.saveGame(C),se=R}D(""),re(null),Q(!0),ee(null),a("GM ...","info");try{const O=s.filter(pe=>h.playerCharIds.includes(pe.id)),R=await xe(O);let _="";h.status.health<=30&&(_+=`
[WARNING: LOW HP] 
`),h.status.sanity<=30&&(_+=`
[WARNING: LOW SAN] 
`);let K="";(h.status.health<=0||h.status.sanity<=0)&&(K=`
[GAME OVER TRIGGER]  (Bad Ending)
`);const ie=`###  TRPG : ${h.title}
****: ${h.worldSetting}
****: ${h.status.location}
****: 
-  HP: ${h.status.health}% 
-  SAN: ${h.status.sanity||100}%
-  GOLD: ${h.status.gold||0}
-  : ${h.status.inventory.join(", ")||""}

${_}
${K}

###   (The Party)
1. **${n.name}** (/User)
${O.map(pe=>`2. **${pe.name}** (ID: ${pe.id}) - `).join(`
`)}

###   &  (Character Sheets & Neural Links)
${R}

###   (Log)
${se.slice(-50).map(pe=>`[${pe.role==="gm"?"GM":pe.speakerName||"System"}]: ${pe.content}`).join(`
`)}

###  GM  (Game Master Instructions)
 ** (GM)**
****

****
1. ** (Roleplay First)**: 
   - 
   - ****: 
   - ** ()**: 
   - ****: AB

2. ** GM **: 
   - ****: 
   - ****: 
   - **Markdown **:  \`gm_narrative\`  \`dialogue\` ** Markdown** ****  ** 

3. ** (Action Options)**:
   -  3 

###   (Strict JSON)
 JSON Markdown 
{
  "gm_narrative": "GM (Markdown)...",
  "characters": [
    { 
      "charId": "ID ()", 
      "action": "", 
      "dialogue": "" 
    }
  ],
  "newLocation": " ()",
  "hpChange": 0,
  "sanityChange": 0,
  "goldChange": 0,
  "newItem": " ()",
  "suggested_actions": [
    { "label": "1", "type": "neutral" },
    { "label": "2", "type": "chaotic" },
    { "label": "3", "type": "evil" }
  ]
}`;let k=(await je(ie)).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim();const H=JSON.parse(k),E=[];if(H.gm_narrative&&E.push({id:`gm-${Date.now()}`,role:"gm",content:H.gm_narrative,timestamp:Date.now()}),H.characters&&Array.isArray(H.characters))for(const pe of H.characters){const G=O.find(Z=>Z.id===pe.charId);if(G){const Z=`*${pe.action}* 
${pe.dialogue}`;E.push({id:`char-${Date.now()}-${Math.random()}`,role:"character",speakerName:G.name,content:Z,timestamp:Date.now()})}}const ne={...C.status};H.newLocation&&(ne.location=H.newLocation),H.hpChange&&(ne.health=Math.max(0,Math.min(100,(ne.health||100)+H.hpChange))),H.sanityChange&&(ne.sanity=Math.max(0,Math.min(100,(ne.sanity||100)+H.sanityChange))),H.goldChange&&(ne.gold=Math.max(0,(ne.gold||0)+H.goldChange)),H.newItem&&(ne.inventory=[...ne.inventory,H.newItem]);const Ne={...C,logs:[...se,...E],status:ne,suggestedActions:H.suggested_actions||[]};p(Ne),await U.saveGame(Ne)}catch(O){a(`GM : ${O.message}`,"error")}finally{Q(!1)}},Y=async()=>{if(!h||M)return;const y=h.logs;let W=-1;for(let O=y.length-1;O>=0;O--)if(y[O].role==="player"||y[O].role==="system"){W=O;break}if(W===-1){a("","info");return}const se=y.slice(0,W+1),C={...h,logs:se};p(C),await N("",!0),a("...","info")},B=async y=>{if(!h||!confirm(`
(HP/)`))return;const W=h.logs.slice(0,y+1),se={...h,logs:W};await U.saveGame(se),p(se),a("","success")},ue=async()=>{if(!h||!confirm(""))return;const y={id:"init",role:"gm",content:` "${h.title}"
...
${h.worldSetting}`,timestamp:Date.now()},W={...h,logs:[y],status:{location:"Start Point",health:100,sanity:100,gold:0,inventory:[]},suggestedActions:[],lastPlayedAt:Date.now()};await U.saveGame(W),p(W),F(!1),a("","success")},P=()=>{p(null),c("lobby"),F(!1)},Ee=async()=>{if(h){L(!0),F(!1);try{const y=s.filter(S=>h.playerCharIds.includes(S.id)),W=y.map(S=>S.name).join(""),se=h.logs.slice(-30).map(S=>`${S.role}: ${S.content}`).join(`
`),C=`Task: Summarize the key events of this TRPG session into a short clause (what happened).
Game: ${h.title}
Logs:
${se}
Output: A concise summary in Chinese (e.g. ""). No preamble.`;let R=(await je(C)).choices[0].message.content.trim();R=R.replace(/[\.]$/,"");const _=`${W}${n.name}${h.title}${R}`,K=new Date,ie=`${K.getFullYear()}-${String(K.getMonth()+1).padStart(2,"0")}-${String(K.getDate()).padStart(2,"0")}`;for(const S of y){const k={id:`mem-${Date.now()}-${Math.random()}`,date:ie,summary:_,mood:"fun"};o(S.id,{memories:[...S.memories||[],k]}),await U.saveMessage({charId:S.id,role:"system",type:"text",content:`[TRPG : ${h.title}${R}]`})}a(" (Chat & Memory)","success")}catch(y){console.error(y),a("","error")}finally{L(!1),c("lobby"),p(null)}}},de=async(y,W)=>{y.stopPropagation(),window.confirm("")&&(await U.deleteGame(W),d(se=>se.filter(C=>C.id!==W)),a("","success"))};if(l==="lobby")return e.jsxs("div",{className:"h-full w-full bg-[#0a0a0a] flex flex-col font-sans relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900/20 via-slate-900/50 to-black z-0"}),e.jsx("div",{className:"absolute inset-0 z-0 opacity-20",style:{backgroundImage:'url("https://www.transparenttextures.com/patterns/stardust.png")'}}),e.jsxs("div",{className:"h-20 flex items-end justify-between px-6 pb-4 shrink-0 z-10",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 hover:bg-white/10 rounded-full text-white/70 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-black tracking-[0.2em] text-xl text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600",children:"TRPG ADVENTURE"}),e.jsx("button",{onClick:()=>c("create"),className:"w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center text-white border border-white/10 shadow-lg active:scale-95 transition-all hover:bg-white/20",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),e.jsxs("div",{className:"p-6 flex-1 overflow-y-auto no-scrollbar z-10 space-y-4",children:[i.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-500 gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center text-4xl border border-white/5 animate-pulse",children:""}),e.jsx("p",{className:"text-xs tracking-widest uppercase",children:"No Active Adventures"})]}),i.map(y=>{const W=ii[y.theme]||ii.fantasy;return e.jsxs("div",{onClick:()=>{p(y),c("play")},className:"relative overflow-hidden rounded-2xl p-5 cursor-pointer group active:scale-[0.98] transition-all border border-white/5 hover:border-white/20 shadow-lg",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${W.gradient} opacity-80 group-hover:opacity-100 transition-opacity`}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),e.jsxs("div",{className:"relative z-10 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-bold text-lg text-white leading-tight drop-shadow-md font-serif",children:y.title}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded border border-white/20 text-white/80 uppercase font-mono tracking-wider bg-black/20",children:y.theme})]}),e.jsxs("p",{className:"text-xs text-white/60 line-clamp-2 leading-relaxed italic font-serif border-l-2 border-white/20 pl-2",children:['"',y.worldSetting,'"']}),e.jsxs("div",{className:"flex justify-between items-end mt-2 pt-2 border-t border-white/10",children:[e.jsx("div",{className:"flex -space-x-2",children:s.filter(se=>y.playerCharIds.includes(se.id)).map(se=>e.jsx("img",{src:se.avatar,className:"w-8 h-8 rounded-full border-2 border-black/50 object-cover shadow-sm"},se.id))}),e.jsx("div",{className:"text-[10px] text-white/40 font-mono",children:new Date(y.lastPlayedAt).toLocaleDateString()})]})]}),e.jsx("button",{onClick:se=>de(se,y.id),className:"absolute top-2 right-2 p-2 text-white/20 hover:text-red-400 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:e.jsx("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"})})})]},y.id)})]})]});if(l==="create")return e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans",children:[e.jsxs("div",{className:"h-20 flex items-end px-4 pb-3 border-b border-slate-200 bg-white shrink-0 sticky top-0 z-10",children:[e.jsx("button",{onClick:()=>c("lobby"),className:"p-2 -ml-2 text-slate-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-slate-700 ml-2 mb-1.5",children:""})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:""}),e.jsx("input",{value:f,onChange:y=>m(y.target.value),className:"w-full bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm focus:border-orange-500 outline-none transition-colors",placeholder:""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:" (Lore)"}),e.jsx("textarea",{value:x,onChange:y=>g(y.target.value),className:"w-full h-32 bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm focus:border-orange-500 outline-none resize-none transition-colors",placeholder:"..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:""}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["fantasy","cyber","horror","modern"].map(y=>e.jsx("button",{onClick:()=>w(y),className:`px-4 py-2 rounded-xl text-xs font-bold capitalize border transition-all active:scale-95 ${A===y?"bg-orange-500 text-white border-orange-500 shadow-md":"bg-white text-slate-500 border-slate-200"}`,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-2",children:""}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:s.map(y=>e.jsxs("div",{onClick:()=>{const W=new Set(b);W.has(y.id)?W.delete(y.id):W.add(y.id),v(W)},className:`flex flex-col items-center p-2 rounded-xl border cursor-pointer transition-all active:scale-95 ${b.has(y.id)?"border-orange-500 bg-orange-50 ring-1 ring-orange-500":"border-transparent hover:bg-slate-100"}`,children:[e.jsx("img",{src:y.avatar,className:"w-12 h-12 rounded-full object-cover shadow-sm"}),e.jsx("span",{className:`text-[9px] mt-2 truncate w-full text-center font-medium ${b.has(y.id)?"text-orange-600":"text-slate-600"}`,children:y.name})]},y.id))})]})]}),e.jsx("div",{className:"p-4 border-t border-slate-200 bg-white",children:e.jsx("button",{onClick:Ae,disabled:j,className:"w-full py-3 bg-slate-800 text-white font-bold rounded-2xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"})," ..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""})," "]})})})]});if(!h)return null;const J=ii[h.theme],be=s.filter(y=>h.playerCharIds.includes(y.id));return e.jsxs("div",{className:`h-full w-full relative flex flex-col ${J.bg} ${J.text} ${J.font} transition-colors duration-500 overflow-hidden`,children:[e.jsxs("div",{className:`h-20 flex items-end justify-between px-4 pb-3 border-b ${J.border} shrink-0 bg-opacity-90 backdrop-blur z-20 relative`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:P,className:"p-2 -ml-2 rounded hover:bg-white/10 active:scale-95 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex flex-col mb-0.5",children:[e.jsx("span",{className:"font-bold text-sm tracking-wide line-clamp-1 max-w-[150px]",children:h.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[9px] opacity-60 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),h.status.location]}),me&&e.jsxs("span",{className:"text-[8px] opacity-40 font-mono",children:["",me]})]})]})]}),e.jsxs("div",{className:"flex gap-1 mb-1",children:[e.jsx("button",{onClick:()=>De(!Te),className:`p-2 rounded hover:bg-white/10 active:scale-95 transition-transform ${Te?J.accent:"opacity-50"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})})}),e.jsx("button",{onClick:()=>F(!0),className:"p-2 -mr-2 rounded hover:bg-white/10 active:scale-95 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})})]})]}),Te&&e.jsxs("div",{className:`flex gap-4 p-3 overflow-x-auto no-scrollbar border-b ${J.border} bg-black/20 backdrop-blur-sm z-10 shrink-0 animate-slide-down`,children:[e.jsxs("div",{className:"relative group shrink-0",children:[e.jsx("img",{src:n.avatar,className:"w-10 h-10 rounded-full border-2 border-white/20 object-cover shadow-sm"}),e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-black/60 text-white text-[8px] px-1.5 rounded-full backdrop-blur-sm whitespace-nowrap",children:"YOU"})]}),be.map(y=>e.jsxs("div",{className:"relative group shrink-0 cursor-pointer active:scale-95 transition-transform",children:[e.jsx("img",{src:y.avatar,className:"w-10 h-10 rounded-full border-2 border-white/20 object-cover shadow-sm group-hover:border-white/50 transition-colors"}),e.jsx("div",{className:"absolute inset-0 rounded-full ring-2 ring-transparent group-hover:ring-green-400/50 transition-all"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-black/50 shadow-sm animate-pulse"})]},y.id))]}),e.jsxs("div",{className:`px-4 py-2 border-b ${J.border} bg-black/10 backdrop-blur-sm z-10 grid grid-cols-3 gap-2 shrink-0`,children:[e.jsxs("div",{className:"flex flex-col items-center bg-red-500/20 rounded p-1 border border-red-500/30",children:[e.jsx("span",{className:"text-[8px] text-red-300 font-bold uppercase",children:"HP ()"}),e.jsx("span",{className:"text-xs font-mono font-bold text-red-100",children:h.status.health||100})]}),e.jsxs("div",{className:"flex flex-col items-center bg-blue-500/20 rounded p-1 border border-blue-500/30",children:[e.jsx("span",{className:"text-[8px] text-blue-300 font-bold uppercase",children:"SAN ()"}),e.jsx("span",{className:"text-xs font-mono font-bold text-blue-100",children:h.status.sanity||100})]}),e.jsxs("div",{className:"flex flex-col items-center bg-yellow-500/20 rounded p-1 border border-yellow-500/30",children:[e.jsx("span",{className:"text-[8px] text-yellow-300 font-bold uppercase",children:"GOLD ()"}),e.jsx("span",{className:"text-xs font-mono font-bold text-yellow-100",children:h.status.gold||0})]})]}),e.jsxs("div",{ref:z,className:"flex-1 overflow-y-auto p-4 space-y-6 no-scrollbar relative animate-fade-in",children:[h.logs.map((y,W)=>{const se=y.role==="gm",C=y.role==="system",O=y.role==="character",R=O?be.find(_=>_.name===y.speakerName):null;return C?e.jsxs("div",{className:"flex flex-col items-center my-4 animate-fade-in gap-1 group",children:[e.jsx("span",{className:"text-[10px] opacity-50 border-b border-dashed border-current pb-0.5 font-mono",children:y.content}),e.jsx("button",{onClick:()=>B(W),className:"text-[9px] text-red-400 opacity-0 group-hover:opacity-100 transition-opacity hover:underline",children:""})]},y.id||W):se?e.jsxs("div",{className:"animate-fade-in my-4 group relative",children:[e.jsxs("div",{className:`p-5 rounded-lg border-2 ${J.border} ${J.cardBg} shadow-sm relative mx-auto w-full text-sm`,children:[e.jsx("div",{className:"absolute -top-3 left-4 bg-inherit px-2 text-[10px] font-bold uppercase tracking-widest opacity-80 border border-inherit rounded",children:"Game Master"}),e.jsx(Xu,{content:y.content,theme:J,customStyle:$e})]}),e.jsx("button",{onClick:()=>B(W),className:"absolute top-2 right-2 text-[9px] bg-red-900/50 text-red-200 px-2 py-0.5 rounded opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-800",children:"Rollback"})]},y.id||W):O&&R?e.jsxs("div",{className:"flex gap-3 animate-slide-up group relative",children:[e.jsx("img",{src:R.avatar,className:`w-10 h-10 rounded-full object-cover border ${J.border} shrink-0 mt-1`}),e.jsxs("div",{className:"flex flex-col max-w-[85%]",children:[e.jsx("span",{className:"text-[10px] font-bold opacity-60 mb-1 ml-1",children:R.name}),e.jsx("div",{className:`px-4 py-2 rounded-2xl rounded-tl-none text-sm ${J.cardBg} border ${J.border} shadow-sm relative`,children:e.jsx(Xu,{content:y.content,theme:J,customStyle:$e})}),e.jsx("button",{onClick:()=>B(W),className:"self-start mt-1 text-[9px] text-red-400 opacity-0 group-hover:opacity-100 transition-opacity hover:underline",children:""})]})]},y.id||W):e.jsxs("div",{className:"flex flex-col items-end animate-slide-up group relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-bold opacity-60",children:y.speakerName}),y.diceRoll&&e.jsxs("span",{className:"text-[10px] bg-white/20 px-1.5 rounded text-yellow-500 font-mono",children:[" ",y.diceRoll.result]})]}),e.jsx("div",{className:"px-4 py-2 rounded-2xl rounded-tr-none text-sm bg-orange-600 text-white shadow-md max-w-[85%]",children:y.content}),e.jsx("button",{onClick:()=>B(W),className:"mt-1 text-[9px] text-red-400 opacity-0 group-hover:opacity-100 transition-opacity hover:underline",children:""})]},y.id||W)}),M&&e.jsx("div",{className:"text-xs opacity-50 animate-pulse pl-2 font-mono",children:"GM ..."})]}),e.jsxs("div",{className:`p-4 pb-[calc(1rem+env(safe-area-inset-bottom))] border-t ${J.border} bg-opacity-90 backdrop-blur shrink-0 z-20 transition-colors duration-500`,children:[h.suggestedActions&&h.suggestedActions.length>0&&!M&&e.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto no-scrollbar pb-1",children:h.suggestedActions.map((y,W)=>{let se=J.optionNormal;return y.type==="chaotic"&&(se=J.optionChaotic),y.type==="evil"&&(se=J.optionEvil),e.jsxs("button",{onClick:()=>N(y.label),className:`flex-1 min-w-[100px] text-[10px] p-2 rounded-lg border ${se} hover:opacity-80 active:scale-95 transition-all text-left leading-tight shadow-sm`,children:[e.jsx("span",{className:"block font-bold opacity-70 uppercase text-[8px] mb-0.5 tracking-wider",children:y.type}),y.label]},W)})}),oe&&e.jsxs("div",{className:"flex gap-2 mb-3 animate-fade-in",children:[e.jsxs("button",{onClick:Le,disabled:ce,className:`flex-1 py-2 rounded border ${J.border} hover:bg-white/10 active:scale-95 transition-transform flex items-center justify-center gap-2 font-bold text-sm`,children:[e.jsx("span",{className:"text-xl",children:""})," ",ce?"Rolling...":q||"Roll D20"]}),["","",""].map(y=>e.jsx("button",{onClick:()=>N(y),className:`px-4 py-2 rounded border ${J.border} hover:bg-white/10 text-xs font-bold transition-colors active:scale-95`,children:y},y))]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("button",{onClick:()=>he(!oe),className:`p-3 h-12 rounded-xl border ${J.border} hover:bg-white/10 active:scale-95 transition-transform flex items-center justify-center ${oe?"bg-white/20":""}`,children:e.jsx("span",{className:"text-lg",children:""})}),!M&&h.logs.length>0&&e.jsx("button",{onClick:Y,className:`p-3 h-12 rounded-xl border ${J.border} hover:bg-white/10 active:scale-95 transition-transform flex items-center justify-center`,title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 opacity-70",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("textarea",{value:$,onChange:y=>D(y.target.value),placeholder:"...",className:`flex-1 bg-black/20 border ${J.border} rounded-xl px-3 py-3 outline-none text-sm placeholder-opacity-30 placeholder-current resize-none h-12 leading-tight focus:bg-black/40 transition-colors`}),e.jsx("button",{onClick:()=>N($),className:`${J.accent} font-bold text-sm px-4 h-12 bg-white/10 rounded-xl hover:bg-white/20 active:scale-95 transition-all flex items-center justify-center`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})})})]})]}),e.jsx(Ye,{isOpen:ve,title:"",onClose:()=>F(!1),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-100 p-3 rounded-xl",children:[e.jsx("label",{className:"text-xs text-slate-500 font-bold mb-3 block border-b border-slate-200 pb-1",children:" (Display)"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-slate-400 w-8",children:""}),e.jsx("input",{type:"range",min:"12",max:"24",step:"1",value:$e.fontSize,onChange:y=>ge({...$e,fontSize:parseInt(y.target.value)}),className:"flex-1 h-1.5 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-orange-500"}),e.jsx("span",{className:"text-xs font-mono text-slate-600 w-6 text-right",children:$e.fontSize})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-slate-400 w-8",children:""}),e.jsx("input",{type:"color",value:$e.color||"#e5e5e5",onChange:y=>ge({...$e,color:y.target.value}),className:"w-full h-8 rounded cursor-pointer bg-white border border-slate-200 p-0.5"})]}),e.jsx("button",{onClick:()=>ge({fontSize:14,color:""}),className:"w-full py-1.5 bg-white border border-slate-200 text-slate-500 text-xs rounded-lg active:scale-95 transition-transform",children:""})]})]}),e.jsxs("button",{onClick:Ee,className:"w-full py-3 bg-emerald-500 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[e.jsx("span",{children:""})," "]}),e.jsxs("button",{onClick:ue,className:"w-full py-3 bg-orange-500 text-white font-bold rounded-2xl shadow-lg flex items-center justify-center gap-2",children:[e.jsx("span",{children:""})," "]}),e.jsxs("button",{onClick:P,className:"w-full py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl flex items-center justify-center gap-2",children:[e.jsx("span",{children:""}),"  ()"]})]})}),te&&e.jsxs("div",{className:"absolute inset-0 bg-black/80 z-50 flex items-center justify-center text-white flex-col gap-4 animate-fade-in",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs tracking-widest font-mono",children:"..."})]})]})},pg=()=>{const{closeApp:t,worldbooks:s,addWorldbook:n,updateWorldbook:r,deleteWorldbook:a,addToast:o}=mt(),[l,c]=u.useState(!1),[i,d]=u.useState(null),[h,p]=u.useState(null),[f,m]=u.useState(null),[x,g]=u.useState(""),[A,w]=u.useState(""),[b,v]=u.useState(""),[j,T]=u.useState(!1),$=u.useMemo(()=>{const me={},ee=" (General)";return s.forEach(z=>{const ve=z.category||ee;me[ve]||(me[ve]=[]),me[ve].push(z)}),!h&&Object.keys(me).length>0,me},[s]),D=()=>{d(null),g(""),w(""),v(""),c(!0)},M=me=>{d(me),g(me.title),w(me.content),v(me.category||""),c(!0)},Q=async()=>{if(!x.trim()){o("","error");return}const me=b.trim()||" (General)";if(i)await r(i.id,{title:x,content:A,category:me}),o(" ()","success");else{const ee={id:`wb-${Date.now()}`,title:x,content:A,category:me,createdAt:Date.now(),updatedAt:Date.now()};n(ee),o("","success")}c(!1)},q=(me,ee)=>{me.stopPropagation(),d(ee),T(!0)},re=()=>{i&&(a(i.id),T(!1),d(null),c(!1))},ce=me=>{p(h===me?null:me)},fe=me=>{m(f===me?null:me)};return l?e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans animate-fade-in",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4 bg-white/80 backdrop-blur-md border-b border-slate-200 shrink-0 z-20",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-3 py-1 text-slate-500 font-bold text-sm",children:""}),e.jsx("span",{className:"font-bold text-slate-800",children:i?"":""}),e.jsx("button",{onClick:Q,className:"px-4 py-1.5 bg-indigo-500 text-white rounded-full text-xs font-bold shadow-md active:scale-95 transition-transform",children:""})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block tracking-wider",children:" (Title)"}),e.jsx("input",{value:x,onChange:me=>g(me.target.value),placeholder:": ...",className:"w-full text-lg font-bold text-slate-800 bg-white border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block tracking-wider",children:" (Group)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:b,onChange:me=>v(me.target.value),placeholder:": ...",className:"w-full text-sm text-slate-700 bg-white border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all",list:"category-suggestions"}),e.jsx("datalist",{id:"category-suggestions",children:Object.keys($).map(me=>e.jsx("option",{value:me},me))})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 pl-1",children:""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block tracking-wider",children:" (Content)"}),e.jsx("textarea",{value:A,onChange:me=>w(me.target.value),placeholder:" Markdown ...",className:"w-full h-80 bg-white border border-slate-200 rounded-xl p-4 text-sm text-slate-700 leading-relaxed resize-none outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all font-mono"})]})]})})]}):e.jsxs("div",{className:"h-full w-full relative overflow-hidden font-sans bg-slate-100 flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50 via-slate-100 to-violet-50 pointer-events-none"}),e.jsx("div",{className:"absolute -top-20 -right-20 w-64 h-64 bg-indigo-200/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-white/80 to-transparent pointer-events-none z-10"}),e.jsx("div",{className:"h-20 bg-white/70 backdrop-blur-xl flex items-end pb-3 px-6 border-b border-white/40 shrink-0 sticky top-0 z-20 shadow-sm",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("span",{className:"font-bold text-slate-700 text-lg tracking-wide flex items-center gap-2",children:[e.jsx("span",{className:"text-indigo-500",children:""})," "]}),e.jsx("button",{onClick:D,className:"w-9 h-9 bg-indigo-500 text-white rounded-full shadow-lg shadow-indigo-200 flex items-center justify-center active:scale-90 transition-transform hover:bg-indigo-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 pb-24 space-y-4 no-scrollbar relative z-0",children:[Object.keys($).length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400 gap-4 opacity-60",children:[e.jsx("span",{className:"text-5xl",children:""}),e.jsx("span",{className:"text-xs font-medium",children:"..."})]}),Object.entries($).map(([me,ee])=>e.jsxs("div",{className:"animate-slide-up",children:[e.jsxs("div",{onClick:()=>ce(me),className:"flex items-center gap-2 py-2 px-1 cursor-pointer select-none group",children:[e.jsx("div",{className:`transition-transform duration-300 ${h===me?"rotate-90":""}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4 text-slate-400 group-hover:text-indigo-500",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})}),e.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider group-hover:text-indigo-600 transition-colors",children:me}),e.jsx("span",{className:"text-[9px] bg-white/50 px-1.5 rounded text-slate-400 border border-white/50",children:ee.length})]}),e.jsx("div",{className:`space-y-3 pl-2 transition-all duration-300 overflow-hidden ${h===me?"max-h-[1000px] opacity-100 mt-2":"max-h-0 opacity-0"}`,children:ee.map(z=>e.jsxs("div",{className:"bg-white/60 backdrop-blur-md rounded-2xl border border-white/60 shadow-sm hover:shadow-md transition-all group relative overflow-hidden",children:[e.jsxs("div",{onClick:()=>fe(z.id),className:"p-4 cursor-pointer flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${f===z.id?"bg-indigo-400":"bg-slate-300"}`}),e.jsx("h4",{className:`text-sm font-bold truncate transition-colors ${f===z.id?"text-indigo-700":"text-slate-700"}`,children:z.title})]}),e.jsxs("div",{className:"text-[10px] text-slate-400 font-mono pl-3.5",children:["Updated: ",new Date(z.updatedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:ve=>{ve.stopPropagation(),M(z)},className:"p-2 rounded-full hover:bg-white text-slate-400 hover:text-indigo-600 transition-colors",title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})}),e.jsx("button",{onClick:ve=>q(ve,z),className:"p-2 rounded-full hover:bg-red-50 text-slate-300 hover:text-red-500 transition-colors",title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})]})]}),f===z.id&&e.jsxs("div",{className:"px-4 pb-4 pt-0 animate-fade-in",children:[e.jsx("div",{className:"h-px w-full bg-gradient-to-r from-transparent via-slate-200 to-transparent mb-3"}),e.jsx("p",{className:"text-xs text-slate-600 leading-relaxed whitespace-pre-wrap font-light select-text",children:z.content||e.jsx("span",{className:"italic text-slate-400",children:"..."})})]})]},z.id))})]},me))]}),e.jsx(Ye,{isOpen:j,title:"",onClose:()=>T(!1),footer:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:()=>T(!1),className:"flex-1 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl active:scale-95 transition-transform",children:""}),e.jsx("button",{onClick:re,className:"flex-1 py-3 bg-red-500 text-white font-bold rounded-2xl shadow-lg shadow-red-200 active:scale-95 transition-transform",children:""})]}),children:e.jsxs("div",{className:"text-center py-4 text-sm text-slate-600 flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-50 rounded-full flex items-center justify-center text-red-500 mb-1",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})}),e.jsxs("div",{children:[" ",e.jsxs("span",{className:"font-bold text-slate-900",children:['"',i==null?void 0:i.title,'"']})," ",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-red-400 opacity-80 mt-1 block",children:""})]})]})})]})},pc=({isOpen:t,title:s,message:n,confirmText:r="",cancelText:a="",variant:o="info",onConfirm:l,onCancel:c})=>{if(!t)return null;const i=()=>{switch(o){case"danger":return"bg-red-500 hover:bg-red-600 text-white shadow-red-200";case"warning":return"bg-orange-500 hover:bg-orange-600 text-white shadow-orange-200";default:return"bg-indigo-500 hover:bg-indigo-600 text-white shadow-indigo-200"}},d=()=>{switch(o){case"danger":return e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-50 text-red-500 flex items-center justify-center shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})})});case"warning":return e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-50 text-orange-500 flex items-center justify-center shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"})})});default:return e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})})}};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in",style:{zIndex:9999},children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-opacity",onClick:c}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-pop-in transform transition-all",children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex gap-4",children:[d(),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 leading-6 mb-2",children:s}),e.jsx("p",{className:"text-sm text-slate-500 leading-relaxed",children:n})]})]})}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 flex gap-3 justify-end border-t border-slate-100",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition-colors",children:a}),e.jsx("button",{onClick:l,className:`px-4 py-2 rounded-xl text-sm font-bold shadow-lg transition-transform active:scale-95 ${i()}`,children:r})]})]})]})},Dr=[{id:"sakura",name:" (Sakura)",bg:"bg-pink-50",paper:"bg-[#fff5f7]",text:"text-slate-700",accent:"text-pink-500",button:"bg-pink-400",activeTab:"bg-pink-500 text-white"},{id:"parchment",name:" (Vintage)",bg:"bg-[#f5e6d3]",paper:"bg-[#fdf6e3]",text:"text-[#433422]",accent:"text-[#8c6b48]",button:"bg-[#b58900]",activeTab:"bg-[#b58900] text-white"},{id:"kraft",name:" (Kraft)",bg:"bg-[#d7ccc8]",paper:"bg-[#e7e0d8]",text:"text-[#3e2723]",accent:"text-[#5d4037]",button:"bg-[#5d4037]",activeTab:"bg-[#5d4037] text-white"},{id:"midnight",name:" (Midnight)",bg:"bg-[#0f172a]",paper:"bg-[#1e293b]",text:"text-slate-300",accent:"text-blue-400",button:"bg-blue-600",activeTab:"bg-blue-600 text-white"},{id:"matcha",name:" (Matcha)",bg:"bg-[#ecfccb]",paper:"bg-[#f7fee7]",text:"text-emerald-800",accent:"text-emerald-600",button:"bg-emerald-500",activeTab:"bg-emerald-500 text-white"}],fg=t=>{var c,i,d,h,p;if(!t)return[""];const s=new Set,n=((t.description||"")+(t.worldview||"")).toLowerCase();if(t.impression){const f=((c=t.impression.personality_core)==null?void 0:c.observed_traits)||[],m=((i=t.impression.mbti_analysis)==null?void 0:i.type)||"",x=((d=t.impression.value_map)==null?void 0:d.likes)||[],g=((h=t.impression.value_map)==null?void 0:h.dislikes)||[];m.includes("N")?(s.add(""),s.add("")):m.includes("S")&&(s.add(""),s.add("")),m.includes("T")?(s.add(""),s.add("")):m.includes("F")&&(s.add(""),s.add("")),m.includes("J")?(s.add(""),s.add("")):m.includes("P")&&(s.add(""),s.add(""));const A={:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""]};f.forEach(w=>{Object.entries(A).forEach(([b,v])=>{w.includes(b)&&v.forEach(j=>s.add(j))})}),x.some(w=>w.includes("")||w.includes(""))&&s.add(""),g.some(w=>w.includes(""))&&s.add("")}if(Object.entries({:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""],:["",""]}).forEach(([f,m])=>{n.includes(f)&&m.forEach(x=>s.add(x))}),t.writerPersona){const f=t.writerPersona;f.includes("")&&s.add(""),f.includes("")&&s.add(""),f.includes("")&&s.add(""),f.includes("")&&s.add(""),f.includes("")&&s.add(""),f.includes("")&&s.add(""),f.includes("")&&s.add(""),f.includes("")&&s.add("")}let a=Array.from(s);if(a.length===0){const f=["","","","",""],m=(((p=t.name)==null?void 0:p.charCodeAt(0))||0)%f.length;a=[f[m],f[(m+2)%f.length]]}const o=f=>{let m=0;for(let x=0;x<f.length;x++)m=(m<<5)-m+f.charCodeAt(x),m|=0;return m},l=o(t.name||"default");return a.sort((f,m)=>{const x=o(f+l.toString()),g=o(m+l.toString());return x-g}).slice(0,5)},bl=t=>{var h,p,f,m;if(!t)return"";const s=((h=t.impression)==null?void 0:h.personality_core.observed_traits)||[],n=((f=(p=t.impression)==null?void 0:p.mbti_analysis)==null?void 0:f.type)||"",r=t.description||"",a={:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:'""',rhythm:"",taboo:""},:{focus:"",style:'""',rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:'""',rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""},:{focus:"",style:"",rhythm:"",taboo:""}};let o=s.find(x=>a[x])||(s.length>0?s[0]:"");a[o]||(o.includes("")?o="":o.includes("")||o.includes("")?o="":o.includes("")||o.includes("")?o="":o="");let l=a[o]||a.,i={INTJ:"",INTP:"",ENTJ:"",ENTP:"",INFJ:"",INFP:"",ENFJ:"",ENFP:"",ISTJ:"",ISFJ:"",ESTJ:"",ESFJ:"",ISTP:"",ISFP:"",ESTP:"",ESFP:""}[n]||"",d=`
### ${t.name}  (Simple)
****: ${o}
****: ${l.focus}${i}
****: ${l.style}
****: ${l.rhythm}
****: ${((m=t.impression)==null?void 0:m.value_map.likes.join(""))||""}
****: ${l.taboo}
`;return(r.includes("")||r.includes("")||s.includes(""))&&(d+=`
###  

1. 
2. """"""
3. ""
4. ""

`),d},gg=t=>{var a,o,l;const s=((a=t.impression)==null?void 0:a.personality_core.observed_traits)||[],n=((o=t.impression)==null?void 0:o.value_map.dislikes)||[];let r=`## ${t.name} 
`;return s.some(c=>c.includes("")||c.includes("")||c.includes(""))?r+=`
-  2""
-  
-  
- 3
`:s.some(c=>c.includes("")||c.includes(""))?r+=`
-  1
-  
-  
- 
`:s.some(c=>c.includes("")||c.includes(""))?r+=`
-  3
-  ""
- 
`:s.some(c=>c.includes(""))?r+=`
-  ""
-  
- ""
`:r+=`
-  
-  
- 
`,n.length>0&&(r+=`
### 
`,n.forEach(c=>{r+=`- "${c}"
`})),((l=t.description)!=null&&l.includes("")||s.includes(""))&&(r+=`
###  
`,r+=`- 3
`,r+=`- """"""
`,r+=`- ""
`,r+=`- 
`),r},bg=async(t,s,n,r,a=!1)=>{var l,c,i,d,h,p,f;if(!t)return"Error: No Character";if(!a&&t.writerPersona&&t.writerPersonaGeneratedAt&&Date.now()-t.writerPersonaGeneratedAt<7*24*60*60*1e3)return t.writerPersona;const o=`/

**/**

---

### 

****: ${t.name}

****: 
${t.description||""}

****: 
${t.worldview||""}

****: 
${((l=t.impression)==null?void 0:l.personality_core.observed_traits.join(""))||""}

**MBTI**: 
${((i=(c=t.impression)==null?void 0:c.mbti_analysis)==null?void 0:i.type)||""}

****:
- /: ${((d=t.impression)==null?void 0:d.value_map.likes.join(""))||""}
- /: ${((h=t.impression)==null?void 0:h.value_map.dislikes.join(""))||""}

**/**:
${((p=t.impression)==null?void 0:p.behavior_profile.response_patterns)||"- "}

****:
${((f=t.memories)==null?void 0:f.slice(-3).map(m=>`- ${m.summary}`).join(`
`))||"- "}

---

### 
()
****: ${s.name}
****: ${s.bio||""}

---

### 

**8**

#### 1.  (Skill Level)
/
- 
- 
- 
- 

#### 2.  (Language)
//
- ""
- 
- 
- 

#### 3.  (Technique)
/
- 
- 
- 

#### 4.  (Focus)
/
- 
- 
- 
- 

#### 5.  (Preference)
/
- /
- 

#### 6.  (Character View)
/Fictional Protagonist
()
- 
- 

#### 7.  (Plot Opinion)
/
- 
- 
- 

#### 8.  (Collaboration Style)
/
- 
- ""
- 
- ()

---

****, markdown

: (///) - 

: (///) - 

: (//) - 

: (///) - 

: (3) | : (3)

: (/)

: (30)

: ()

: (3-5"")

---

****400-600`;try{const m=await fetch(`${n.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify({model:n.model,messages:[{role:"user",content:o}],temperature:.7,max_tokens:8e3})});if(m.ok){const g=(await m.json()).choices[0].message.content.trim(),A=`
### ${t.name} AI

${g}

---
*: ${new Date().toLocaleDateString("zh-CN")}*
`.trim();return r(t.id,{writerPersona:A,writerPersonaGeneratedAt:Date.now()}),A}else throw new Error(`API Error: ${m.status}`)}catch(m){return console.error("Deep analysis failed:",m),bl(t)}},wg=t=>{var a;let n=(((a=t.impression)==null?void 0:a.personality_core.observed_traits)||[]).find(o=>["","","","","","","",""].some(l=>o.includes(l)))||"";n.includes("")&&(n=""),(n.includes("")||n.includes(""))&&(n=""),(n.includes("")||n.includes(""))&&(n="");const r={:`
**AI**
"120"

**${t.name}**
""

`,:`
**+**
"815%"

**${t.name}**
""

`,:`
**+**
"70"

**${t.name}**
"'''...'"

`,:`
****
"342.723.52.3"

**${t.name}**
""

`};return r[n]||r.},vg=(t,s,n,r,a,o,l,c)=>{var w,b;const i=At.buildCoreContext(t,s,!0),d=t.writerPersona||bl(t),h=wg(t),p=gg(t),f=(n==null?void 0:n.protagonists.map(v=>`- ${v.name} (${v.role}): ${v.description}`).join(`
`))||"",m=`
${n==null?void 0:n.title}
${n==null?void 0:n.worldSetting}

${f}
`,x=`
${i}

#  (Co-Writing Mode)
 **${s.name}** () 
${n==null?void 0:n.title}

****
1. ${s.name}${((w=t.impression)==null?void 0:w.personality_core.summary)||""}
2. 
3. AI/

# 
 **${t.name}**
${n==null?void 0:n.title}

---

#   (Anti-Clich Protocol)

## 
1. **${t.name}**
   - "AI"
   - """"
   
2. ****
   ${p}

3. **AI**
   -  "//"  
   -  ""  
   -  "XXX"  
   -  "..."  2024
   -    
   -  ****  "83""12"

4. ** **
   -  "3""5"
   -  "5"
   -  
   -  "37%"
   -  "127"

---

# 
${d}

#  (Do vs Don't)
${h}

---

# 
${a}

${m}

---

# 
${r||"[]"}

---
`;let g=`### []
JSON
`,A=[];if(o.analyze&&(g+=`
1. ****: ${t.name}
   - ${t.name}
   - 
`,A.push('"analysis": { "reaction": "", "focus": "", "critique": "" }')),o.write&&(g+=`
2. ****: 
   - : 
   - : 
   - : 400-800
`,A.push('"writer": { "content": "", "technique": "", "mood": "" }')),o.comment){const v=l.slice(-5).filter(j=>j.authorId!=="user"&&j.authorId!==t.id&&(j.role==="writer"||j.type==="story")).map(j=>{const T=c.find($=>$.id===j.authorId);return{name:(T==null?void 0:T.name)||"Unknown",content:j.content.substring(0,100)}});g+=`
3. **/ ()**: 
   
   
   ${v.length>0?`
   ****
   ${v.map(j=>`- ${j.name}${j.content}`).join(`
`)}
   
   ${t.name}
   - 
   - ${t.description}
   - 
   `:""}
   
   ${(b=t.description)!=null&&b.includes("")?'""':""}
`,A.push('"comment": { "content": "" }')}return`${x}

${g}

###  (Strict JSON, No Markdown)
{
  ${A.join(`,
  `)},
  "meta": { "tone": "", "suggestion": "" }
}
`},yg=t=>{const s=t.split(`
`),n={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},r=l=>{for(const[c,i]of Object.entries(n))if(l.includes(c))return i;return""},a=[];let o=null;return s.forEach(l=>{var d;const c=l.trim();if(!c)return;const i=c.match(/^###\s*(.+)/)||c.match(/^\*\*([^*]+)\*\*\s*[:]\s*(.*)/)||c.match(/^([^-\d][^:]{1,15})[:]\s*(.*)/);if(i){o&&o.content.length>0&&a.push(o);const h=(i[1]||"").replace(/\*\*/g,"").trim();o={title:h,icon:r(h),content:[]};const p=(d=i[2])==null?void 0:d.trim();p&&o.content.push(p)}else if(o){const h=c.replace(/^\*\*|\*\*$/g,"").replace(/^[-]\s*/,"");h&&o.content.push(h)}}),o&&o.content.length>0&&a.push(o),a},jg=({char:t,userProfile:s,targetCharId:n,isTyping:r,setIsTyping:a,setConfirmDialog:o,addToast:l,apiConfig:c,updateCharacter:i})=>{const d=t.writerPersona||bl(t),h=yg(d);return e.jsxs("div",{className:"bg-gradient-to-b from-slate-50 to-white border-b border-black/5 overflow-hidden",children:[e.jsx("div",{className:"max-h-[45vh] overflow-y-auto p-4 space-y-3 overscroll-contain",children:h.length===0?e.jsxs("div",{className:"text-center py-8 text-slate-400 text-sm",children:["",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:""})]}):h.map((p,f)=>e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-100",children:[e.jsx("span",{className:"text-base",children:p.icon}),e.jsx("h4",{className:"text-sm font-bold text-slate-800",children:p.title})]}),e.jsx("div",{className:"space-y-1.5",children:p.content.map((m,x)=>e.jsx("p",{className:"text-sm text-slate-600 leading-relaxed",children:m},x))})]},f))}),e.jsx("div",{className:"px-4 py-3 border-t border-slate-100 bg-white/80",children:e.jsx("button",{onClick:async()=>{n&&o({isOpen:!0,title:"",message:" Token",variant:"info",confirmText:"",onConfirm:async()=>{o(null),l("...","info"),a(!0);try{await bg(t,s,c,i,!0),l("","success")}catch{l("","error")}finally{a(!1)}}})},disabled:r,className:"w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white py-2.5 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 shadow-sm disabled:opacity-50",children:r?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(e.Fragment,{children:" "})})})]})},Ng=({activeBook:t,updateNovel:s,characters:n,userProfile:r,apiConfig:a,onBack:o,updateCharacter:l,collaborators:c,targetCharId:i,setTargetCharId:d,onOpenSettings:h})=>{const{addToast:p}=mt(),f=u.useMemo(()=>Dr.find(J=>J.id===t.coverStyle)||Dr[0],[t.coverStyle]),[m,x]=u.useState({write:!0,comment:!1,analyze:!1}),[g,A]=u.useState(""),[w,b]=u.useState(!1),[v,j]=u.useState(t.segments),[T,$]=u.useState(null),[D,M]=u.useState(!1),[Q,q]=u.useState(!1),[re,ce]=u.useState(null),[fe,me]=u.useState(""),[ee,z]=u.useState(null),[ve,F]=u.useState(!1),[te,L]=u.useState(""),[oe,he]=u.useState(!1),[Te,De]=u.useState(!1),$e=u.useRef(null);u.useEffect(()=>{j(t.segments)},[t.segments]),u.useEffect(()=>{$e.current&&!Q&&($e.current.scrollTop=$e.current.scrollHeight)},[v,w,Q]);const ge=u.useMemo(()=>v.filter(J=>J.focus==="chapter_summary").length+1,[v]),I=n.find(J=>J.id===i),je=v.length>0&&v[v.length-1].authorId!=="user",xe=u.useMemo(()=>{let J=-1;for(let be=v.length-1;be>=0;be--)if(v[be].focus==="chapter_summary"){J=be;break}return v.slice(J+1)},[v]),Ae=u.useMemo(()=>v.filter(J=>J.focus==="chapter_summary"),[v]),Le=async(J,be,y)=>{var W,se;b(!0),$(null);try{const C=y.filter(H=>H.focus==="chapter_summary");let O=0;if(C.length>0){const H=C[C.length-1];O=y.findIndex(E=>E.id===H.id)+1}const R=y.slice(O).filter(H=>H.role==="writer"||H.type==="story");let _="";C.length>0?(_+=` / Chapter Recaps
`,C.forEach((H,E)=>_+=`
${E+1}
${H.content}
`),_+=`
---

 / Current Chapter
`):_+=` / Current Chapter
`,R.forEach(H=>{var ne;const E=H.authorId==="user"?r.name:((ne=n.find(Ne=>Ne.id===H.authorId))==null?void 0:ne.name)||"AI";_+=`
[${E}]: ${H.content.substring(0,500)}
`});const K=vg(J,r,t,be,_,m,y,n),ie=((W=J.impression)==null?void 0:W.personality_core.observed_traits)||[];let S=.85;ie.some(H=>H.includes("")||H.includes(""))&&(S=.98),ie.some(H=>H.includes("")||H.includes("")||H.includes(""))&&(S=.6);const k=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:K}],temperature:S,max_tokens:8e3})});if(k.ok){const H=await k.json();(se=H.usage)!=null&&se.total_tokens&&$(H.usage.total_tokens);let E=H.choices[0].message.content.trim();const ne=E;E=E.replace(/```json\n?/g,"").replace(/```\n?/g,"");const Ne=E.match(/\{[\s\S]*\}/);Ne&&(E=Ne[0]);let pe;try{pe=JSON.parse(E)}catch{pe={writer:{content:ne}}}const G=[],Z=Date.now();pe.analysis&&(pe.analysis.critique||pe.analysis.reaction)&&G.push({id:`seg-${Z}-a`,role:"analyst",type:"analysis",authorId:J.id,content:pe.analysis.critique||JSON.stringify(pe.analysis),focus:pe.analysis.focus,meta:{reaction:pe.analysis.reaction},timestamp:Z+1}),pe.writer&&pe.writer.content&&G.push({id:`seg-${Z}-w`,role:"writer",type:"story",authorId:J.id,content:pe.writer.content,meta:{...pe.meta||{},technique:pe.writer.technique,mood:pe.writer.mood},timestamp:Z+2}),pe.comment&&pe.comment.content&&G.push({id:`seg-${Z}-c`,role:"commenter",type:"discussion",authorId:J.id,content:pe.comment.content,timestamp:Z+3}),j(Se=>{const we=[...Se,...G];return s(t.id,{segments:we}),we})}else throw new Error(`API Error: ${k.status}`)}catch(C){p(": "+C.message,"error")}finally{b(!1)}},N=async()=>{if(!i){p("","error");return}const J=n.find(W=>W.id===i);if(!J)return;let be=v;if(g.trim()){const W={id:`seg-${Date.now()}`,role:"writer",type:"story",authorId:"user",content:g,timestamp:Date.now()};be=[...v,W],j(be),s(t.id,{segments:be})}const y=g;A(""),await Le(J,y,be)},Y=async()=>{if(!i)return;const J=n.find(W=>W.id===i);if(!J)return;let be=[...v],y=0;for(;be.length>0&&be[be.length-1].authorId!=="user";)be.pop(),y++;if(y===0){p(" AI ","info");return}j(be),s(t.id,{segments:be}),p("...","info"),await Le(J,"",be)},B=J=>{ce(J),me(J.content),q(!0)},ue=()=>{if(!re)return;const J=v.map(be=>be.id===re.id?{...be,content:fe}:be);j(J),s(t.id,{segments:J}),q(!1),ce(null)},P=J=>{z({isOpen:!0,title:"",message:"",variant:"danger",onConfirm:()=>{const be=v.filter(y=>y.id!==J);j(be),s(t.id,{segments:be}),z(null)}})},Ee=async()=>{he(!0),F(!0),L("...");try{let J=0,be=-1;for(let O=v.length-1;O>=0;O--)if(v[O].focus==="chapter_summary"){be=O;break}be!==-1&&(J=be+1);const W=v.slice(J).filter(O=>O.type==="story"||O.role==="writer").map(O=>O.content).join(`

`);if(!W.trim()){L(""),he(!1);return}const se=`### Task: Chapter Summary
Novel: "${t.title}"
Content:
${W.substring(0,2e5)}

Generate a structured summary.`,C=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:se}]})});if(C.ok){const O=await C.json();L(O.choices[0].message.content)}else L("")}catch(J){L(`: ${J.message}`)}finally{he(!1)}},de=async()=>{const J={id:`seg-summary-${Date.now()}`,role:"analyst",type:"analysis",authorId:"system",content:te,focus:"chapter_summary",timestamp:Date.now(),meta:{reaction:"",suggestion:""}},be=[...v,J];j(be),await s(t.id,{segments:be});const y=new Date().toISOString().split("T")[0],W=be.filter(C=>C.focus==="chapter_summary").length,se=c.map(C=>C.name).join("");for(const C of t.collaboratorIds){const O=n.find(R=>R.id===C);if(O){const R={id:`mem-${Date.now()}-${Math.random()}`,date:y,summary:`${se}${t.title}${W}`,mood:"creative"};l(O.id,{memories:[...O.memories||[],R]})}}F(!1),L(""),p("","success")};return e.jsxs("div",{className:`h-full w-full flex flex-col font-serif ${f.bg} transition-colors duration-500 relative`,children:[e.jsx(pc,{isOpen:!!ee,title:(ee==null?void 0:ee.title)||"",message:(ee==null?void 0:ee.message)||"",variant:ee==null?void 0:ee.variant,confirmText:(ee==null?void 0:ee.confirmText)||(ee!=null&&ee.onConfirm?"":"OK"),onConfirm:(ee==null?void 0:ee.onConfirm)||(()=>z(null)),onCancel:()=>z(null)}),e.jsxs("div",{className:`flex flex-col border-b border-black/5 shrink-0 z-20 backdrop-blur-md ${f.bg}/90 transition-all`,children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-4 pt-2",children:[e.jsx("button",{onClick:o,className:"p-3 -ml-3 rounded-full hover:bg-black/5 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${f.text}`,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex flex-col items-center cursor-pointer active:opacity-70 transition-opacity",onClick:h,children:[e.jsx("span",{className:`font-bold text-base ${f.text} truncate max-w-[150px]`,children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-[10px] opacity-60 ${f.text}`,children:[" ",ge," "]}),T&&e.jsxs("span",{className:`text-[9px] px-1.5 py-0.5 rounded opacity-50 font-mono border border-current ${f.text}`,children:[" ",T]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>De(!0),className:`p-2 rounded-full hover:bg-black/5 transition-colors ${f.text}`,title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})})}),e.jsx("button",{onClick:Ee,disabled:w,className:`p-2 rounded-full hover:bg-black/5 transition-colors ${f.text}`,title:"",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"})})})]})]}),e.jsx("div",{className:"px-4 pb-3 flex gap-3 overflow-x-auto no-scrollbar",children:c.map(J=>e.jsxs("button",{onClick:()=>d(J.id),className:`flex items-center gap-2 px-3 py-1.5 rounded-full border transition-all relative ${i===J.id?"bg-slate-800 text-white border-slate-800":"bg-white/50 border-black/5 hover:bg-white text-slate-600"}`,children:[e.jsx("img",{src:J.avatar,className:"w-6 h-6 rounded-full object-cover"}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:J.name}),J.writerPersona&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-purple-500 rounded-full border border-white"})]},J.id))})]}),e.jsxs("div",{className:`z-10 ${f.bg}/95 backdrop-blur-md border-b border-black/5 shadow-sm`,children:[e.jsxs("div",{className:"px-4 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-x-auto no-scrollbar flex-1 mr-4",children:[e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[I&&e.jsx("img",{src:I.avatar,className:"w-6 h-6 rounded-full object-cover"}),e.jsx("span",{className:"text-xs font-bold text-slate-700",children:I!=null&&I.name?`${I.name}`:""})]}),e.jsx("div",{className:"flex-1 flex gap-2 overflow-x-auto no-scrollbar",children:I&&fg(I).slice(0,3).map((J,be)=>{let y="bg-indigo-50 text-indigo-700 border-indigo-100";return["","",""].some(W=>J.includes(W))&&(y="bg-blue-50 text-blue-700 border-blue-100"),["","","","",""].some(W=>J.includes(W))&&(y="bg-pink-50 text-pink-700 border-pink-100"),["","","",""].some(W=>J.includes(W))&&(y="bg-amber-50 text-amber-700 border-amber-100"),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold whitespace-nowrap border ${y}`,children:J},be)})})]}),e.jsxs("button",{onClick:()=>M(!D),className:"shrink-0 text-[10px] bg-white border border-slate-200 px-2 py-1 rounded-full hover:bg-slate-50 text-slate-600 flex items-center gap-1 transition-colors",children:[" ",e.jsx("span",{className:`transform transition-transform ${D?"rotate-180":""}`,children:""})]})]}),e.jsx("div",{className:`transition-all duration-300 ease-out overflow-hidden ${D?"max-h-[60vh] opacity-100":"max-h-0 opacity-0"}`,children:I?e.jsx(jg,{char:I,userProfile:r,targetCharId:i,isTyping:w,setIsTyping:b,setConfirmDialog:z,addToast:p,apiConfig:a,updateCharacter:l}):e.jsx("div",{className:"p-4 text-center text-xs text-slate-400",children:""})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 no-scrollbar pb-40",ref:$e,children:[xe.length===0&&e.jsx("div",{className:"text-center py-20 opacity-40",children:e.jsxs("p",{className:"text-sm italic font-serif",children:[" ",ge," ",e.jsx("br",{}),"..."]})}),xe.map(J=>{var C,O;const be=J.authorId==="user",y=be?null:n.find(R=>R.id===J.authorId),W=J.role||(J.type==="story"?"writer":J.type==="analysis"?"analyst":"commenter"),se=e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1 z-10 bg-white/80 backdrop-blur rounded-lg p-1 shadow-sm border border-slate-100",children:[e.jsx("button",{onClick:()=>B(J),className:"p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-indigo-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{d:"m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z"})})}),e.jsx("button",{onClick:()=>P(J.id),className:"p-1 hover:bg-slate-100 rounded text-slate-400 hover:text-red-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{fillRule:"evenodd",d:"M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 1 0 .23 1.482l.149-.022.841 10.518A2.75 2.75 0 0 0 7.596 19h4.807a2.75 2.75 0 0 0 2.742-2.53l.841-10.52.149.023a.75.75 0 0 0 .23-1.482A41.03 41.03 0 0 0 14 4.193V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4ZM8.58 7.72a.75.75 0 0 0-1.5.06l.3 7.5a.75.75 0 1 0 1.5-.06l-.3-7.5Zm4.34.06a.75.75 0 1 0-1.5-.06l-.3 7.5a.75.75 0 1 0 1.5.06l.3-7.5Z",clipRule:"evenodd"})})})]});return W==="writer"?e.jsxs("div",{className:`p-6 rounded-sm shadow-sm leading-loose text-justify text-[17px] relative group transition-all ${f.paper} ${f.text} ${be?"border-l-4 border-slate-300":""}`,children:[se,e.jsxs("div",{className:"absolute -top-3 left-4 bg-white/90 border border-black/5 px-2 py-0.5 rounded text-[9px] font-sans font-bold uppercase tracking-wider text-slate-500 shadow-sm flex items-center gap-1.5",children:[be?null:e.jsx("img",{src:y==null?void 0:y.avatar,className:"w-3 h-3 rounded-full object-cover"}),e.jsxs("span",{children:[be?" (User)":y==null?void 0:y.name," "]}),!be&&((C=J.meta)==null?void 0:C.mood)&&e.jsx("span",{className:"bg-slate-100 px-1.5 rounded text-[9px] text-slate-600 normal-case",children:J.meta.mood})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:J.content})]},J.id):W==="commenter"?e.jsxs("div",{className:"flex gap-3 max-w-[85%] font-sans ml-auto flex-row-reverse animate-slide-up group relative",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden shrink-0 border-2 border-white shadow-sm mt-1",children:e.jsx("img",{src:be?r.avatar:y==null?void 0:y.avatar,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"p-3 rounded-xl text-sm shadow-sm relative bg-[#fff9c4] text-slate-700 transform rotate-1 border border-yellow-200/50",children:[se,J.content]})]},J.id):W==="analyst"?e.jsxs("div",{className:"mx-4 bg-gradient-to-br from-slate-50 to-blue-50/30 rounded-xl border border-slate-200 p-4 text-xs font-sans text-slate-600 shadow-sm group relative",children:[se,e.jsxs("div",{className:"flex items-center gap-2 mb-2 pb-2 border-b border-slate-200",children:[e.jsx("span",{className:"text-lg",children:""}),e.jsxs("span",{className:"font-bold text-slate-800",children:[y==null?void 0:y.name," "]}),J.focus&&e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-[10px] font-bold",children:J.focus})]}),((O=J.meta)==null?void 0:O.reaction)&&e.jsxs("div",{className:"mb-2 pb-2 border-b border-dashed border-slate-200",children:[e.jsx("span",{className:"text-slate-400 text-[10px] uppercase",children:""}),e.jsxs("p",{className:"text-sm font-bold text-slate-700 mt-0.5",children:['"',J.meta.reaction,'"']})]}),e.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:J.content})]},J.id):null}),w&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${f.button} animate-bounce`}),e.jsx("div",{className:`w-2 h-2 rounded-full ${f.button} animate-bounce delay-75`}),e.jsx("div",{className:`w-2 h-2 rounded-full ${f.button} animate-bounce delay-150`})]})})]}),e.jsxs("div",{className:"absolute bottom-0 w-full bg-white/95 backdrop-blur-xl border-t border-slate-200 z-30 transition-transform duration-300 font-sans shadow-[0_-5px_20px_rgba(0,0,0,0.05)] pb-safe",children:[e.jsxs("div",{className:"flex gap-2 px-4 py-2 text-xs border-b border-slate-100 overflow-x-auto no-scrollbar",children:[e.jsxs("button",{onClick:()=>x({...m,write:!m.write}),className:`px-3 py-1.5 rounded-full text-xs font-bold border flex items-center gap-1.5 ${m.write?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:[e.jsx("span",{children:""})," "]}),e.jsxs("button",{onClick:()=>x({...m,comment:!m.comment}),className:`px-3 py-1.5 rounded-full text-xs font-bold border flex items-center gap-1.5 ${m.comment?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:[e.jsx("span",{children:""})," "]}),e.jsxs("button",{onClick:()=>x({...m,analyze:!m.analyze}),className:`px-3 py-1.5 rounded-full text-xs font-bold border flex items-center gap-1.5 ${m.analyze?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 border-slate-200"}`,children:[e.jsx("span",{children:""})," "]})]}),e.jsxs("div",{className:"p-3 flex gap-2 items-end",children:[e.jsx("textarea",{value:g,onChange:J=>A(J.target.value),placeholder:m.write?g.trim()?"...":"AI...":"...",className:"flex-1 bg-slate-100 rounded-2xl px-4 py-3 text-sm text-slate-700 outline-none resize-none max-h-32 placeholder:text-slate-400 focus:bg-white focus:ring-2 focus:ring-slate-200 transition-all",rows:1,style:{minHeight:"44px"}}),je&&!w&&!g.trim()&&e.jsx("button",{onClick:Y,className:"w-11 h-11 rounded-full flex items-center justify-center text-slate-500 bg-slate-100 hover:bg-slate-200 active:scale-95 transition-all shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),e.jsx("button",{onClick:N,disabled:w||!g.trim()&&!m.write,className:`w-11 h-11 rounded-full flex items-center justify-center text-white shadow-md active:scale-95 transition-all shrink-0 ${g.trim()||m.write?f.button:"bg-slate-300"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]}),e.jsx(Ye,{isOpen:Q,title:"",onClose:()=>q(!1),footer:e.jsx("button",{onClick:ue,className:"w-full py-3 bg-slate-800 text-white font-bold rounded-2xl",children:""}),children:e.jsx("textarea",{value:fe,onChange:J=>me(J.target.value),className:"w-full h-48 bg-slate-100 rounded-xl p-3 text-sm resize-none focus:outline-none leading-relaxed"})}),e.jsx(Ye,{isOpen:ve,title:"",onClose:()=>F(!1),footer:oe?e.jsx("div",{className:"w-full py-3 bg-slate-100 text-slate-500 font-bold rounded-2xl text-center",children:"AI..."}):e.jsx("button",{onClick:de,className:"w-full py-3 bg-indigo-500 text-white font-bold rounded-2xl shadow-lg",children:""}),children:e.jsx("textarea",{value:te,onChange:J=>L(J.target.value),className:"w-full h-64 bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm resize-none focus:outline-none leading-relaxed",placeholder:"..."})}),e.jsx(Ye,{isOpen:Te,title:"",onClose:()=>De(!1),children:e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto space-y-4 p-1",children:[Ae.length===0&&e.jsx("div",{className:"text-center text-slate-400 py-4 text-xs",children:""}),Ae.map((J,be)=>e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100",children:[e.jsxs("div",{className:"font-bold text-sm text-slate-700 mb-2",children:[" ",be+1," "]}),e.jsx("div",{className:"text-xs text-slate-600 leading-relaxed whitespace-pre-wrap",children:J.content})]},J.id))]})})]})},kg=()=>{const{closeApp:t,novels:s,addNovel:n,updateNovel:r,deleteNovel:a,characters:o,updateCharacter:l,apiConfig:c,addToast:i,userProfile:d,worldbooks:h}=mt(),[p,f]=u.useState("shelf"),[m,x]=u.useState(null),[g,A]=u.useState(Dr[0]),[w,b]=u.useState(""),[v,j]=u.useState(""),[T,$]=u.useState(""),[D,M]=u.useState(""),[Q,q]=u.useState(new Set),[re,ce]=u.useState([]),[fe,me]=u.useState(""),[ee,z]=u.useState(""),ve=u.useRef(null),[F,te]=u.useState(null),[L,oe]=u.useState(!1),[he,Te]=u.useState(!1),[De,$e]=u.useState("system"),[ge,I]=u.useState(!1),[je,xe]=u.useState(!1),[Ae,Le]=u.useState(null),[N,Y]=u.useState(null),[B,ue]=u.useState(null),P=k=>Dr.find(H=>H.id===k)||Dr[0],Ee=u.useMemo(()=>m?o.filter(k=>m.collaboratorIds.includes(k.id)):[],[m,o]),de=u.useMemo(()=>{const k=[],H=new Set;return s.forEach(E=>{E.protagonists.forEach(ne=>{const Ne=`${ne.name}-${ne.role}`;H.has(Ne)||(H.add(Ne),k.push(ne))})}),k},[s]);u.useEffect(()=>{m&&Ee.length>0&&!B&&ue(Ee[0].id)},[m,Ee]),u.useEffect(()=>{m&&A(P(m.coverStyle))},[m]);const J=()=>{if(!w.trim()){i("","error");return}const k={id:`novel-${Date.now()}`,title:w,subtitle:v,summary:T,coverStyle:g.id,coverImage:ee,worldSetting:D,collaboratorIds:Array.from(Q),protagonists:re,segments:[],createdAt:Date.now(),lastActiveAt:Date.now()};n(k),x(k),f("write"),W()},be=()=>{m&&(b(m.title),j(m.subtitle||""),$(m.summary),M(m.worldSetting),A(P(m.coverStyle)),z(m.coverImage||""),q(new Set(m.collaboratorIds)),ce(m.protagonists),f("settings"))},y=async()=>{if(!m)return;const k={...m,title:w,subtitle:v,summary:T,worldSetting:D,coverStyle:g.id,coverImage:ee,collaboratorIds:Array.from(Q),protagonists:re,segments:m.segments,lastActiveAt:Date.now()};await r(m.id,k),x(k),f("write"),i("","success")},W=()=>{b(""),j(""),$(""),M(""),q(new Set),ce([]),z(""),me("")},se=async k=>{Y({isOpen:!0,title:"",message:"",variant:"danger",onConfirm:()=>{a(k),(m==null?void 0:m.id)===k&&f("shelf"),i("","success"),Y(null)}})},C=async k=>{var E;const H=(E=k.target.files)==null?void 0:E[0];if(H)try{const ne=await Ut(H,{maxWidth:800,quality:.8});z(ne)}catch{i("","error")}},O=()=>{fe&&z(fe)},R=k=>{te(k||{id:`proto-${Date.now()}`,name:"",role:"",description:""}),oe(!0)},_=()=>{if(!F||!F.name.trim()){i("","error");return}ce(k=>k.find(E=>E.id===F.id)?k.map(E=>E.id===F.id?F:E):[...k,F]),oe(!1),te(null)},K=k=>{const H={id:`proto-${Date.now()}-${Math.random()}`,name:k.name,role:k.role||"",description:k.description||""};ce(E=>[...E,H]),Te(!1),i(`: ${k.name}`,"success")},ie=k=>{const H=`

${k.title}
${k.content}`;M(E=>(E+H).trim()),I(!1),i(`: ${k.title}`,"success")},S=({p:k,onDelete:H,onClick:E})=>e.jsxs("div",{onClick:E,className:"bg-white p-3 rounded-xl border border-slate-200 shadow-sm relative group cursor-pointer hover:border-slate-400 transition-colors",children:[e.jsxs("div",{className:"font-bold text-slate-800 text-sm flex justify-between",children:[e.jsx("span",{children:k.name}),e.jsx("span",{className:"text-[10px] bg-slate-100 px-1.5 rounded text-slate-500 font-normal",children:k.role})]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1 line-clamp-2",children:k.description||""}),H&&e.jsx("button",{onClick:ne=>{ne.stopPropagation(),H()},className:"absolute top-1 right-1 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]});return p==="library"?e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans",children:[e.jsx("div",{className:"h-20 bg-white/80 backdrop-blur-md flex items-end pb-3 px-6 border-b border-slate-200 shrink-0 sticky top-0 z-20",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{onClick:()=>f("shelf"),className:"p-2 -ml-2 rounded-full hover:bg-slate-100 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-bold text-slate-800 text-lg tracking-wide",children:""}),e.jsx("div",{className:"w-8"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""}),"  (AI Collaborators)"]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:o.map(k=>e.jsxs("div",{onClick:()=>{Le(k),xe(!0)},className:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center gap-3 cursor-pointer hover:shadow-md transition-all active:scale-95",children:[e.jsx("img",{src:k.avatar,className:"w-16 h-16 rounded-full object-cover border-2 border-slate-50"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-slate-700 text-sm",children:k.name}),e.jsx("div",{className:"text-[10px] text-slate-400 mt-1 px-2 py-0.5 bg-slate-50 rounded-full",children:""})]})]},k.id))})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2",children:[e.jsx("span",{children:""}),"  (From History)"]}),de.length===0?e.jsx("div",{className:"text-center py-8 text-slate-400 text-xs",children:""}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:de.map((k,H)=>e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-bold text-slate-800",children:k.name}),e.jsx("span",{className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded border border-indigo-100",children:k.role})]}),e.jsx("p",{className:"text-xs text-slate-500 leading-relaxed line-clamp-3",children:k.description||""})]},H))})]})]}),e.jsx(Ye,{isOpen:je,title:(Ae==null?void 0:Ae.name)||"",onClose:()=>xe(!1),children:e.jsx("div",{className:"max-h-[60vh] overflow-y-auto space-y-4 p-1",children:Ae?e.jsx("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-100 text-sm leading-relaxed text-slate-700 whitespace-pre-wrap",children:Ae.writerPersona||bl(Ae)}):null})})]}):p==="shelf"?e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans relative",children:[e.jsx(pc,{isOpen:!!N,title:(N==null?void 0:N.title)||"",message:(N==null?void 0:N.message)||"",variant:N==null?void 0:N.variant,confirmText:(N==null?void 0:N.confirmText)||(N!=null&&N.onConfirm?"":"OK"),onConfirm:(N==null?void 0:N.onConfirm)||(()=>Y(null)),onCancel:()=>Y(null)}),e.jsxs("div",{className:"h-24 flex items-end justify-between px-6 pb-6 bg-white/80 backdrop-blur-md z-20 shrink-0 border-b border-slate-100",children:[e.jsx("button",{onClick:t,className:"p-3 -ml-3 rounded-full hover:bg-slate-100 active:scale-95 transition-all",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6 text-slate-600",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("span",{className:"font-black text-2xl text-slate-800 tracking-tight",children:""}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f("library"),className:"w-10 h-10 bg-white text-slate-600 border border-slate-200 rounded-full flex items-center justify-center shadow-sm active:scale-95 transition-transform hover:bg-slate-50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"})})}),e.jsx("button",{onClick:()=>{f("create"),W()},className:"w-10 h-10 bg-slate-900 text-white rounded-full flex items-center justify-center shadow-lg active:scale-95 transition-transform hover:bg-black",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})]}),e.jsxs("div",{className:"p-6 grid grid-cols-2 gap-5 overflow-y-auto pb-24",children:[s.map(k=>{const H=P(k.coverStyle),E=k.segments.reduce((Ne,pe)=>Ne+(pe.type==="story"?pe.content.length:0),0),ne=k.coverImage?{backgroundImage:`url(${k.coverImage})`,backgroundSize:"cover",backgroundPosition:"center"}:{};return e.jsxs("div",{onClick:()=>{x(k),f("write")},className:"group relative aspect-auto min-h-[14rem] bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-slate-100 cursor-pointer flex flex-col",children:[e.jsxs("div",{className:`h-28 shrink-0 ${H.bg} relative p-4 flex flex-col justify-end`,style:ne,children:[e.jsx("div",{className:`absolute inset-0 ${k.coverImage?"bg-black/30":""}`}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h3",{className:`font-bold text-lg leading-tight line-clamp-2 ${k.coverImage?"text-white drop-shadow-md":H.text}`,children:k.title}),k.subtitle&&e.jsx("p",{className:`text-[10px] font-bold opacity-80 uppercase tracking-wide truncate ${k.coverImage?"text-white":H.text}`,children:k.subtitle})]})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col justify-between",children:[e.jsx("p",{className:"text-xs text-slate-500 line-clamp-3 leading-relaxed mb-3",children:k.summary||"..."}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-50",children:[e.jsx("div",{className:"flex -space-x-2",children:o.filter(Ne=>k.collaboratorIds.includes(Ne.id)).map(Ne=>e.jsx("img",{src:Ne.avatar,className:"w-6 h-6 rounded-full border-2 border-white object-cover"},Ne.id))}),e.jsxs("span",{className:"text-[10px] text-slate-400 font-mono bg-slate-50 px-2 py-0.5 rounded-full",children:[(E/1e3).toFixed(1),"k "]})]})]}),e.jsx("button",{onClick:Ne=>{Ne.stopPropagation(),se(k.id)},className:"absolute top-2 right-2 text-slate-400/50 hover:text-red-500 p-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white/20 backdrop-blur rounded-full",children:""})]},k.id)}),s.length===0&&e.jsxs("div",{className:"col-span-2 flex flex-col items-center justify-center h-64 text-slate-300 gap-3",children:[e.jsx("span",{className:"text-4xl opacity-50 grayscale",children:""}),e.jsx("span",{className:"text-sm font-sans",children:""})]})]})]}):p==="create"||p==="settings"?e.jsxs("div",{className:"h-full w-full bg-slate-50 flex flex-col font-sans relative",children:[e.jsx(pc,{isOpen:!!N,title:(N==null?void 0:N.title)||"",message:(N==null?void 0:N.message)||"",variant:N==null?void 0:N.variant,confirmText:(N==null?void 0:N.confirmText)||(N!=null&&N.onConfirm?"":"OK"),onConfirm:(N==null?void 0:N.onConfirm)||(()=>Y(null)),onCancel:()=>Y(null)}),e.jsxs("div",{className:"h-16 flex items-center justify-between px-4 bg-white border-b border-slate-200 shrink-0 sticky top-0 z-20",children:[e.jsx("button",{onClick:()=>f(p==="create"?"shelf":"write"),className:"text-slate-500 text-sm",children:""}),e.jsx("span",{className:"font-bold text-slate-800",children:p==="create"?"":""}),e.jsx("button",{onClick:p==="create"?J:y,className:"bg-slate-800 text-white px-4 py-1.5 rounded-full text-xs font-bold shadow-md active:scale-95 transition-transform",children:""})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 pb-20",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("input",{value:w,onChange:k=>b(k.target.value),placeholder:"",className:"w-full text-2xl font-bold bg-transparent border-b border-slate-200 py-2 outline-none focus:border-slate-800 font-serif"}),e.jsx("input",{value:v,onChange:k=>j(k.target.value),placeholder:"/",className:"w-full text-sm font-bold bg-transparent border-b border-slate-200 py-2 outline-none focus:border-slate-800 text-slate-600"}),e.jsx("textarea",{value:T,onChange:k=>$(k.target.value),placeholder:"...",className:"w-full h-20 bg-slate-100 rounded-xl p-3 text-sm resize-none outline-none"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:""}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 no-scrollbar",children:Dr.map(k=>e.jsx("button",{onClick:()=>A(k),className:`w-12 h-16 rounded-md shadow-sm border-2 shrink-0 ${k.bg} ${g.id===k.id?"border-slate-800 scale-105":"border-transparent"}`},k.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:""}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{onClick:()=>{var k;return(k=ve.current)==null?void 0:k.click()},className:"w-16 h-24 bg-slate-100 rounded-md border-2 border-dashed border-slate-300 flex items-center justify-center cursor-pointer hover:border-slate-500 relative overflow-hidden",children:[ee?e.jsx("img",{src:ee,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xs text-slate-400",children:"+"}),e.jsx("input",{type:"file",ref:ve,className:"hidden",accept:"image/*",onChange:C})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{value:fe,onChange:k=>me(k.target.value),onBlur:O,placeholder:"...",className:"w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-xs outline-none focus:border-slate-400"}),ee&&e.jsx("button",{onClick:()=>{z(""),me("")},className:"text-xs text-red-400 underline",children:""})]})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block",children:""}),e.jsxs("button",{onClick:()=>I(!0),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded font-bold hover:bg-indigo-100 flex items-center gap-1",children:[e.jsx("span",{children:""})," "]})]}),e.jsx("textarea",{value:D,onChange:k=>M(k.target.value),placeholder:"...",className:"w-full h-32 bg-white border border-slate-200 rounded-xl p-3 text-sm resize-none outline-none focus:border-slate-400"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block",children:""}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 no-scrollbar",children:o.map(k=>e.jsxs("div",{onClick:()=>{const H=new Set(Q);H.has(k.id)?H.delete(k.id):H.add(k.id),q(H)},className:`flex flex-col items-center gap-2 cursor-pointer transition-opacity ${Q.has(k.id)?"opacity-100":"opacity-50 grayscale"}`,children:[e.jsx("img",{src:k.avatar,className:"w-12 h-12 rounded-full object-cover shadow-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-600",children:k.name})]},k.id))})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase",children:""}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Te(!0),className:"text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded font-bold hover:bg-indigo-100 border border-indigo-100",children:" "}),e.jsx("button",{onClick:()=>R(),className:"text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-600 hover:bg-slate-200 transition-colors",children:"+ "})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:re.map((k,H)=>e.jsx(S,{p:k,onClick:()=>R(k),onDelete:()=>ce(re.filter((E,ne)=>ne!==H))},k.id))})]})]}),e.jsx(Ye,{isOpen:L,title:"",onClose:()=>oe(!1),footer:e.jsx("button",{onClick:_,className:"w-full py-3 bg-slate-800 text-white font-bold rounded-2xl",children:""}),children:F&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:""}),e.jsx("input",{value:F.name,onChange:k=>te({...F,name:k.target.value}),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:""}),e.jsx("input",{value:F.role,onChange:k=>te({...F,role:k.target.value}),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm",placeholder:" / "})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:""}),e.jsx("textarea",{value:F.description,onChange:k=>te({...F,description:k.target.value}),className:"w-full h-32 bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm resize-none leading-relaxed"})]})]})}),e.jsxs(Ye,{isOpen:he,title:"",onClose:()=>Te(!1),children:[e.jsxs("div",{className:"flex p-1 bg-slate-100 rounded-xl mb-3",children:[e.jsx("button",{onClick:()=>$e("system"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${De==="system"?"bg-white shadow text-indigo-600":"text-slate-400"}`,children:" (AI)"}),e.jsx("button",{onClick:()=>$e("history"),className:`flex-1 py-1.5 text-xs font-bold rounded-lg transition-all ${De==="history"?"bg-white shadow text-indigo-600":"text-slate-400"}`,children:""})]}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-3 p-1",children:[De==="system"&&o.map(k=>e.jsxs("button",{onClick:()=>K({name:k.name,role:"",description:k.description}),className:"w-full flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-xl hover:border-indigo-200 shadow-sm active:scale-95 transition-all text-left",children:[e.jsx("img",{src:k.avatar,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-sm text-slate-700",children:k.name}),e.jsx("div",{className:"text-[10px] text-slate-400 truncate",children:k.description})]})]},k.id)),De==="history"&&de.map((k,H)=>e.jsxs("button",{onClick:()=>K(k),className:"w-full flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-xl hover:border-indigo-200 shadow-sm active:scale-95 transition-all text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-500 border border-slate-200",children:k.name[0]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-sm text-slate-700",children:k.name}),e.jsxs("div",{className:"text-[10px] text-slate-400 truncate",children:[k.role," - ",k.description||""]})]})]},`hist-${H}`))]})]}),e.jsx(Ye,{isOpen:ge,title:"",onClose:()=>I(!1),children:e.jsx("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar space-y-2 p-1",children:h.map(k=>e.jsxs("button",{onClick:()=>ie(k),className:"w-full text-left p-3 rounded-xl border border-slate-100 hover:border-indigo-300 bg-white shadow-sm active:scale-95 transition-all",children:[e.jsx("div",{className:"font-bold text-slate-700 text-sm",children:k.title}),e.jsx("div",{className:"text-[10px] text-slate-400 mt-1",children:k.category||""})]},k.id))})})]}):p==="write"&&m?e.jsx(Ng,{activeBook:m,updateNovel:r,characters:o,userProfile:d,apiConfig:c,onBack:()=>f("shelf"),updateCharacter:l,collaborators:Ee,targetCharId:B,setTargetCharId:ue,onOpenSettings:be}):null},fc=[{id:"recipe-coffee-001",name:"",icon:"",cost:0,appeal:10,isUnlocked:!0},{id:"recipe-cake-001",name:"",icon:"",cost:50,appeal:20,isUnlocked:!1},{id:"recipe-tea-001",name:"",icon:"",cost:80,appeal:25,isUnlocked:!1},{id:"recipe-donut-001",name:"",icon:"",cost:120,appeal:30,isUnlocked:!1},{id:"recipe-icecream-001",name:"",icon:"",cost:200,appeal:40,isUnlocked:!1},{id:"recipe-pudding-001",name:"",icon:"",cost:300,appeal:50,isUnlocked:!1},{id:"recipe-cocktail-001",name:"",icon:"",cost:500,appeal:80,isUnlocked:!1}],qu=[{id:"staff-cat-01",name:"",avatar:"",role:"manager",maxFatigue:100},{id:"staff-dog-01",name:"",avatar:"",role:"waiter",maxFatigue:120},{id:"staff-bear-01",name:"",avatar:"",role:"chef",maxFatigue:150},{id:"staff-rabbit-01",name:"",avatar:"",role:"waiter",maxFatigue:80},{id:"staff-penguin-01",name:"",avatar:"",role:"manager",maxFatigue:110}],ci=[{id:"layout-cafe",name:"",icon:"",description:"",apCost:0,floorWidthRatio:1,floorDepthRatio:1,hasCounter:!0,hasWindow:!0},{id:"layout-kitchen",name:"",icon:"",description:"",apCost:100,floorWidthRatio:1,floorDepthRatio:.8,hasCounter:!0,hasWindow:!1},{id:"layout-lounge",name:"",icon:"",description:"",apCost:150,floorWidthRatio:1,floorDepthRatio:1,hasCounter:!1,hasWindow:!0},{id:"layout-storage",name:"",icon:"",description:"",apCost:80,floorWidthRatio:.7,floorDepthRatio:.7,hasCounter:!1,hasWindow:!1},{id:"layout-vip",name:"VIP",icon:"",description:"",apCost:300,floorWidthRatio:1,floorDepthRatio:1,hasCounter:!1,hasWindow:!0},{id:"layout-garden",name:"",icon:"",description:"",apCost:250,floorWidthRatio:1,floorDepthRatio:1,hasCounter:!1,hasWindow:!0}],Sg=[{id:"wp-cream",name:"",style:"linear-gradient(180deg, #FEF9F0, #F5EBD8)"},{id:"wp-blush",name:"",style:"linear-gradient(180deg, #FFF0F0, #FFE0E0)"},{id:"wp-mint",name:"",style:"linear-gradient(180deg, #F0FFF4, #C6F6D5)"},{id:"wp-sky",name:"",style:"linear-gradient(180deg, #EBF8FF, #BEE3F8)"},{id:"wp-lavender",name:"",style:"linear-gradient(180deg, #FAF5FF, #E9D8FD)"},{id:"wp-warm",name:"",style:"linear-gradient(180deg, #FFFAF0, #FEEBC8)"},{id:"wp-brick",name:"",style:"repeating-linear-gradient(0deg, #D4A574 0px, #D4A574 8px, #C4956A 8px, #C4956A 10px, #DEB587 10px, #DEB587 18px, #C4956A 18px, #C4956A 20px)"},{id:"wp-stripe",name:"",style:"repeating-linear-gradient(90deg, #FFF8E1 0px, #FFF8E1 12px, #FFE0B2 12px, #FFE0B2 14px)"}],Cg=[{id:"fl-wood",name:"",style:"linear-gradient(135deg, #C4A77D, #B8956E)"},{id:"fl-tile",name:"",style:"conic-gradient(from 90deg at 2px 2px, #fdf6e3 90deg, #eee8d5 0) 0 0/20px 20px"},{id:"fl-check",name:"",style:"conic-gradient(#eee8d5 90deg, #fdf6e3 90deg 180deg, #eee8d5 180deg 270deg, #fdf6e3 270deg) 0 0 / 20px 20px"},{id:"fl-dark",name:"",style:"linear-gradient(135deg, #8B7355, #6D5A3F)"},{id:"fl-marble",name:"",style:"linear-gradient(135deg, #F5F5F5 0%, #E0E0E0 25%, #F5F5F5 50%, #EEEEEE 75%, #F5F5F5 100%)"},{id:"fl-tatami",name:"",style:"repeating-linear-gradient(0deg, #C8B88A 0px, #C8B88A 3px, #D4C89A 3px, #D4C89A 6px)"}],$g=[{id:"stk-plant1",name:"",url:"",category:"decor"},{id:"stk-plant2",name:"",url:"",category:"decor"},{id:"stk-flower",name:"",url:"",category:"decor"},{id:"stk-frame",name:"",url:"",category:"wall"},{id:"stk-clock",name:"",url:"",category:"wall"},{id:"stk-lamp",name:"",url:"",category:"decor"},{id:"stk-sofa",name:"",url:"",category:"furniture"},{id:"stk-table",name:"",url:"",category:"furniture"},{id:"stk-book",name:"",url:"",category:"furniture"},{id:"stk-coffee",name:"",url:"",category:"food"},{id:"stk-cake",name:"",url:"",category:"food"},{id:"stk-candle",name:"",url:"",category:"decor"},{id:"stk-rug",name:"",url:"",category:"floor"},{id:"stk-cat",name:"",url:"",category:"pet"},{id:"stk-star",name:"",url:"",category:"decor"},{id:"stk-heart",name:"",url:"",category:"decor"},{id:"stk-window",name:"",url:"",category:"wall"},{id:"stk-sign",name:"",url:"",category:"wall"}],gc={rooms:[{id:"room-1f-left",name:"",floor:0,position:"left",isUnlocked:!0,layoutId:"layout-cafe",wallpaperLeft:"linear-gradient(180deg, #FEF9F0, #F5EBD8)",wallpaperRight:"linear-gradient(180deg, #FEF9F0, #F5EBD8)",floorStyle:"linear-gradient(135deg, #C4A77D, #B8956E)",stickers:[],staffIds:[]},{id:"room-1f-right",name:"",floor:0,position:"right",isUnlocked:!1,layoutId:"layout-kitchen",stickers:[],staffIds:[]},{id:"room-2f-left",name:"",floor:1,position:"left",isUnlocked:!1,layoutId:"layout-lounge",stickers:[],staffIds:[]},{id:"room-2f-right",name:"VIP",floor:1,position:"right",isUnlocked:!1,layoutId:"layout-vip",stickers:[],staffIds:[]}],activeRoomId:null},di={"room-1f-left":0,"room-1f-right":120,"room-2f-left":200,"room-2f-right":300},qs=120,ui=100,mi=8,Ag=({shopState:t,characters:s,userProfile:n,apiConfig:r,updateState:a,onStaffClick:o,onOpenGuestbook:l})=>{const{addToast:c}=mt();t.dollhouse;const[i,d]=u.useState(null),[h,p]=u.useState(!1),[f,m]=u.useState("none"),[x,g]=u.useState("floor"),[A,w]=u.useState(null),[b,v]=u.useState({x:0,y:0}),[j,T]=u.useState(null),[$,D]=u.useState(null),[M,Q]=u.useState("decor"),q=u.useRef(null),re=()=>t.dollhouse||gc,ce=async y=>{await a({...t,dollhouse:y})},fe=y=>re().rooms.find(W=>W.id===y),me=y=>ci.find(W=>W.id===y),ee=y=>{const W=fe(y);!W||!W.isUnlocked||h||(p(!0),d(y),setTimeout(()=>p(!1),500))},z=()=>{h||(p(!0),m("none"),d(null),setTimeout(()=>p(!1),500))},ve=async y=>{const W=di[y]||150;if(t.actionPoints<W){c(`AP  ( ${W})`,"error");return}const se=re(),C=se.rooms.map(O=>O.id===y?{...O,isUnlocked:!0,wallpaperLeft:"linear-gradient(180deg, #FEF9F0, #F5EBD8)",wallpaperRight:"linear-gradient(180deg, #FEF9F0, #F5EBD8)",floorStyle:"linear-gradient(135deg, #C4A77D, #B8956E)"}:O);await a({...t,actionPoints:t.actionPoints-W,dollhouse:{...se,rooms:C}}),T(null),c(`-${W} AP`,"success")},F=async(y,W)=>{const se=me(W);if(!se)return;if(se.apCost>0&&t.actionPoints<se.apCost){c(`AP  ( ${se.apCost})`,"error");return}const C=re(),O=C.rooms.map(_=>_.id===y?{..._,layoutId:W}:_),R=se.apCost>0?se.apCost:0;await a({...t,actionPoints:t.actionPoints-R,dollhouse:{...C,rooms:O}}),D(null),R>0?c(`-${R} AP`,"success"):c("","success")},te=async(y,W,se)=>{const C=re(),O=C.rooms.map(R=>R.id!==y?R:W==="leftWall"?{...R,wallpaperLeft:se}:{...R,wallpaperRight:se});await ce({...C,rooms:O})},L=async(y,W)=>{const se=re(),C=se.rooms.map(O=>O.id===y?{...O,floorStyle:W}:O);await ce({...se,rooms:C})},oe=async(y,W,se)=>{const C=re(),O={id:`stk-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,url:W,x:50,y:50,scale:1,rotation:0,zIndex:10,surface:se},R=C.rooms.map(_=>_.id===y?{..._,stickers:[..._.stickers,O]}:_);await ce({...C,rooms:R})},he=async(y,W,se)=>{const C=re(),O=C.rooms.map(R=>R.id!==y?R:{...R,stickers:R.stickers.map(_=>_.id===W?{..._,...se}:_)});await ce({...C,rooms:O})},Te=async(y,W)=>{const se=re(),C=se.rooms.map(O=>O.id!==y?O:{...O,stickers:O.stickers.filter(R=>R.id!==W)});await ce({...se,rooms:C})},De=(y,W)=>{if(f!=="none")return;const se=fe(y);if(!se||!se.isUnlocked)return;const C=W.currentTarget.getBoundingClientRect(),O=(W.clientX-C.left)/C.width*100,R=(W.clientY-C.top)/C.height*100,K=t.staff.filter(E=>{const Ne=re().rooms.find(pe=>pe.staffIds.includes(E.id));return(Ne==null?void 0:Ne.id)===y})[0]||t.staff[0];if(!K)return;const ie=re();let S=!ie.rooms.some(E=>E.staffIds.includes(K.id)&&E.id===y);const k=t.staff.map(E=>E.id===K.id?{...E,x:O,y:R}:E);let H=ie.rooms;S&&(H=ie.rooms.map(E=>({...E,staffIds:E.id===y?[...E.staffIds.filter(ne=>ne!==K.id),K.id]:E.staffIds.filter(ne=>ne!==K.id)}))),a({...t,staff:k,dollhouse:{...ie,rooms:H}})},$e=(y,W)=>{W.stopPropagation(),W.preventDefault(),w(y);const se="touches"in W?W.touches[0].clientX:W.clientX,C="touches"in W?W.touches[0].clientY:W.clientY;v({x:se,y:C})},ge=u.useCallback(y=>{if(!A||!i)return;const W="touches"in y?y.touches[0].clientX:y.clientX,se="touches"in y?y.touches[0].clientY:y.clientY,C=W-b.x,O=se-b.y;v({x:W,y:se});const R=document.getElementById(`surface-${A.surface}-${i}`);if(!R)return;const _=R.getBoundingClientRect(),K=C/_.width*100,ie=O/_.height*100;he(i,A.id,{x:Math.max(0,Math.min(100,A.x+K)),y:Math.max(0,Math.min(100,A.y+ie))}),w({...A,x:Math.max(0,Math.min(100,A.x+K)),y:Math.max(0,Math.min(100,A.y+ie))})},[A,b,i]),I=u.useCallback(()=>{w(null)},[]);u.useEffect(()=>{if(A)return window.addEventListener("mousemove",ge),window.addEventListener("mouseup",I),window.addEventListener("touchmove",ge),window.addEventListener("touchend",I),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("mouseup",I),window.removeEventListener("touchmove",ge),window.removeEventListener("touchend",I)}},[A,ge,I]);const je=(y,W)=>{const se=me(y.layoutId)||ci[0],C=!y.isUnlocked,O=i&&i!==y.id,R=W?qs*2:qs,_=W?ui*2:ui,K=R/2,ie=R/4,S=y.wallpaperLeft||"linear-gradient(180deg, #F8F6F0, #EBE5D8)",k=y.wallpaperRight||"linear-gradient(180deg, #EFEDE6, #E0DCD0)",H=y.floorStyle||"linear-gradient(135deg, #E8E4D8, #D8D4C8)",E=t.staff.filter(pe=>{const G=re(),Z=G.rooms.find(Se=>Se.staffIds.includes(pe.id));return Z?Z.id===y.id:y.id==="room-1f-left"&&!G.rooms.some(Se=>Se.staffIds.includes(pe.id))}),ne=_+K,Ne=pe=>y.stickers.filter(G=>G.surface===pe).map(G=>e.jsx("div",{className:`absolute select-none ${W?"cursor-grab active:cursor-grabbing":""} ${(A==null?void 0:A.id)===G.id?"z-50 opacity-80":""}`,style:{left:`${G.x}%`,top:`${G.y}%`,transform:`translate(-50%, -50%) scale(${G.scale*(W?1.6:.8)}) rotate(${G.rotation}deg)`,zIndex:G.zIndex,fontSize:W?"1.5rem":"0.75rem"},onMouseDown:Z=>W&&f==="sticker"&&$e(G,Z),onTouchStart:Z=>W&&f==="sticker"&&$e(G,Z),onDoubleClick:Z=>{Z.stopPropagation(),W&&f==="sticker"&&Te(y.id,G.id)},children:G.url.startsWith("http")||G.url.startsWith("data")?e.jsx("img",{src:G.url,className:"object-contain pointer-events-none",style:{width:W?32:16,height:W?32:16}}):G.url},G.id));return e.jsxs("div",{className:`absolute select-none transition-all duration-500 ease-in-out ${O?"opacity-10 pointer-events-none":"opacity-100"} ${C?"cursor-pointer":"cursor-default"}`,style:{width:R,height:ne},onDoubleClick:()=>!C&&ee(y.id),onClick:()=>C&&T(y.id),children:[e.jsxs("div",{id:`surface-leftWall-${y.id}`,className:"absolute overflow-hidden",style:{width:K,height:_,left:0,bottom:ie,background:C?"linear-gradient(180deg, #F0F0F0, #E0E0E0)":S,transform:"skewY(26.565deg)",transformOrigin:"bottom left",borderLeft:"2px solid rgba(120,100,80,0.25)",borderTop:"2px solid rgba(120,100,80,0.15)",zIndex:1},children:[e.jsx("div",{className:"absolute inset-0",style:{background:"linear-gradient(to right, rgba(0,0,0,0.03), rgba(0,0,0,0.08))"}}),e.jsx("div",{className:"absolute inset-0 opacity-[0.04]",style:{backgroundImage:"radial-gradient(circle, rgba(0,0,0,0.3) 1px, transparent 1px)",backgroundSize:W?"16px 16px":"8px 8px"}}),!C&&se.hasWindow&&e.jsxs("div",{className:"absolute overflow-hidden",style:{top:"15%",left:"20%",width:"55%",height:"40%",borderRadius:W?6:3,border:`${W?3:2}px solid #A09080`},children:[e.jsxs("div",{className:"w-full h-full",style:{background:"linear-gradient(135deg, #D4EAFC, #A8D4F0, #7EC8E3)"},children:[e.jsx("div",{className:"absolute inset-0",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.4) 0%, transparent 60%)"}}),e.jsx("div",{className:"absolute top-1/2 left-0 w-full bg-[#A09080]",style:{height:W?2:1}}),e.jsx("div",{className:"absolute top-0 left-1/2 h-full bg-[#A09080]",style:{width:W?2:1}})]}),e.jsx("div",{className:"absolute top-0 left-0 w-[20%] h-full",style:{background:"linear-gradient(to right, rgba(150,180,200,0.5), transparent)"}}),e.jsx("div",{className:"absolute top-0 right-0 w-[20%] h-full",style:{background:"linear-gradient(to left, rgba(150,180,200,0.5), transparent)"}})]}),!C&&Ne("leftWall")]}),e.jsxs("div",{id:`surface-rightWall-${y.id}`,className:"absolute overflow-hidden",style:{width:K,height:_,right:0,bottom:ie,background:C?"linear-gradient(180deg, #E8E8E8, #D8D8D8)":k,transform:"skewY(-26.565deg)",transformOrigin:"bottom right",borderRight:"2px solid rgba(120,100,80,0.25)",borderTop:"2px solid rgba(120,100,80,0.15)",zIndex:1},children:[e.jsx("div",{className:"absolute inset-0",style:{background:"linear-gradient(to left, rgba(0,0,0,0.02), rgba(0,0,0,0.1))"}}),e.jsx("div",{className:"absolute inset-0 opacity-[0.04]",style:{backgroundImage:"radial-gradient(circle, rgba(0,0,0,0.3) 1px, transparent 1px)",backgroundSize:W?"16px 16px":"8px 8px"}}),!C&&Ne("rightWall")]}),e.jsxs("div",{id:`surface-floor-${y.id}`,className:"absolute overflow-hidden",style:{width:R*.707,height:R*.707,left:"50%",bottom:0,transform:"translateX(-50%) rotate(45deg) scaleY(0.5)",transformOrigin:"center center",background:C?"linear-gradient(135deg, #E0E0E0, #D0D0D0)":H,borderBottom:"2px solid rgba(120,100,80,0.2)",borderRight:"2px solid rgba(120,100,80,0.2)",zIndex:2},onClick:pe=>!C&&!O&&De(y.id,pe),children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.08]",style:{backgroundImage:`
                            linear-gradient(0deg, rgba(0,0,0,0.2) 1px, transparent 1px),
                            linear-gradient(90deg, rgba(0,0,0,0.2) 1px, transparent 1px)
                        `,backgroundSize:W?"28px 28px":"14px 14px"}}),!C&&se.hasCounter&&e.jsx("div",{className:"absolute",style:{width:"50%",height:W?16:8,left:"25%",top:"20%",background:"linear-gradient(180deg, #6D4C41, #4E342E)",border:"1px solid #3E2723",borderRadius:2}}),!C&&Ne("floor")]}),!C&&E.map(pe=>{const G=pe.x||50,Z=pe.y||50,Se=G/100*K,we=Z/100*ie;return e.jsx("div",{className:"absolute transition-all duration-700 ease-in-out cursor-pointer z-20 group",style:{left:K*.2+Se*.6,bottom:we+ie*.3,transform:"translate(-50%, 0)"},onClick:Ce=>{Ce.stopPropagation(),o==null||o(pe)},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 bg-black/10 rounded-full blur-[2px]",style:{width:W?20:10,height:W?6:3}}),pe.fatigue>80&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 text-xs animate-bounce",children:""}),e.jsx("div",{className:`filter drop-shadow-md transform group-hover:scale-110 transition-transform ${W?"text-3xl":"text-lg"}`,children:pe.avatar.startsWith("http")||pe.avatar.startsWith("data")?e.jsx("img",{src:pe.avatar,className:`object-contain rounded-lg ${W?"w-10 h-10":"w-5 h-5"}`}):pe.avatar}),e.jsxs("div",{className:`absolute -bottom-3 left-1/2 -translate-x-1/2 whitespace-nowrap bg-white/90 backdrop-blur-sm rounded-full border border-slate-200 shadow-sm ${W?"text-[9px] px-1.5 py-0.5":"text-[6px] px-1 py-px"}`,children:[pe.isPet&&e.jsx("span",{className:"mr-0.5",children:""}),pe.name]})]})},pe.id)}),C&&e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-30",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-[2px] rounded-xl px-3 py-2 flex flex-col items-center shadow-lg",children:[e.jsx("div",{className:"text-2xl mb-0.5",children:""}),e.jsxs("div",{className:"text-[9px] font-bold text-slate-500",children:[di[y.id]||150," AP"]}),e.jsx("div",{className:"text-[7px] text-slate-400",children:""})]})}),!O&&e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 whitespace-nowrap ${W?"text-[10px]":"text-[8px]"} font-bold ${C?"text-slate-400":"text-[#8D6E63]"} bg-white/80 backdrop-blur-sm px-2 py-0.5 rounded-full border ${C?"border-slate-200":"border-[#E8DCC8]"} shadow-sm z-40`,style:{bottom:-8},children:y.name})]},y.id)},xe=re(),Ae=xe.rooms.find(y=>y.id==="room-1f-left"),Le=xe.rooms.find(y=>y.id==="room-1f-right"),N=xe.rooms.find(y=>y.id==="room-2f-left"),Y=xe.rooms.find(y=>y.id==="room-2f-right"),B=i?fe(i):null,ue=qs,P=ui+qs/2,Ee=P,de=ue*2+20,J=Ee*2+mi+60,be=(y,W)=>{const se=W==="left",C=se?qs*.25:qs*.75,O=y===1?0:Ee+mi,R=se?qs/8:0;return{x:C,y:O+R+40}};return e.jsxs("div",{ref:q,className:"relative w-full overflow-hidden select-none",style:{height:"65vh",background:"linear-gradient(180deg, #FEF7E8 0%, #FDF2DC 40%, #E8DCC8 100%)"},children:[e.jsxs("div",{className:"absolute transition-all duration-500 ease-in-out",style:{width:de,height:J,left:"50%",top:"50%",transform:i?(()=>{const y=fe(i);if(!y)return"translate(-50%, -50%)";const W=be(y.floor,y.position),se=W.x+qs/2,C=W.y+P/2,O=de/2-se,R=J/2-C;return`translate(-50%, -50%) scale(1.8) translate(${O*.5}px, ${R*.5}px)`})():"translate(-50%, -50%)"},children:[e.jsxs("div",{className:"absolute z-10",style:{left:"50%",top:10,transform:"translateX(-50%)"},children:[e.jsxs("svg",{width:de-10,height:50,viewBox:`0 0 ${de-10} 50`,className:"drop-shadow-md",children:[e.jsx("polygon",{points:`${(de-10)/2},2 ${de-15},35 ${(de-10)/2},48 5,35`,fill:"url(#roofGrad)",stroke:"#6D5A3F",strokeWidth:"1.5"}),e.jsx("line",{x1:(de-10)/2,y1:2,x2:(de-10)/2,y2:48,stroke:"#5A4935",strokeWidth:"1",opacity:"0.4"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"roofGrad",x1:"0",y1:"0",x2:"1",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#A08060"}),e.jsx("stop",{offset:"40%",stopColor:"#8B7355"}),e.jsx("stop",{offset:"100%",stopColor:"#6D5A3F"})]})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-[9px] font-bold text-[#FFF8E1] drop-shadow-md tracking-wider",children:t.shopName})})]}),e.jsx("div",{className:"absolute",style:{width:4,height:J-90,left:qs*.25-2,top:50,background:"linear-gradient(180deg, #C4A882, #A08868)",transform:"skewY(26.565deg)",transformOrigin:"top left",zIndex:0,borderRadius:1}}),e.jsx("div",{className:"absolute",style:{width:4,height:J-90,right:qs*.25-2,top:50,background:"linear-gradient(180deg, #B09878, #907858)",transform:"skewY(-26.565deg)",transformOrigin:"top right",zIndex:0,borderRadius:1}}),e.jsx("div",{className:"absolute z-5",style:{left:"50%",top:be(1,"left").y+P-5,transform:"translateX(-50%)"},children:e.jsx("div",{style:{width:de-20,height:mi,background:"linear-gradient(180deg, #A09080, #8B7355)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",borderRadius:1}})}),N&&(()=>{const y=be(1,"left");return e.jsx("div",{className:"absolute",style:{left:y.x,top:y.y,zIndex:5},children:je(N,i===N.id)})})(),Y&&(()=>{const y=be(1,"right");return e.jsx("div",{className:"absolute",style:{left:y.x,top:y.y,zIndex:4},children:je(Y,i===Y.id)})})(),Ae&&(()=>{const y=be(0,"left");return e.jsx("div",{className:"absolute",style:{left:y.x,top:y.y,zIndex:5},children:je(Ae,i===Ae.id)})})(),Le&&(()=>{const y=be(0,"right");return e.jsx("div",{className:"absolute",style:{left:y.x,top:y.y,zIndex:4},children:je(Le,i===Le.id)})})(),e.jsx("div",{className:"absolute z-3",style:{left:"50%",bottom:5,transform:"translateX(-50%)"},children:e.jsx("div",{style:{width:de-15,height:12,background:"linear-gradient(180deg, #6D5A3F, #5A4935)",borderRadius:"0 0 4px 4px",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"}})}),e.jsx("div",{className:"absolute z-30 pointer-events-none",style:{right:-8,top:40,fontSize:"10px",lineHeight:"14px",opacity:.7,writingMode:"vertical-rl"},children:""})]}),e.jsx("div",{className:"absolute top-3 left-3 z-40",children:e.jsxs("div",{className:"bg-white/70 backdrop-blur-xl px-3 py-1.5 rounded-xl shadow-lg border border-white/50 flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-gradient-to-br from-[#FFD54F] to-[#FFB300] flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-sm",children:""})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] text-[#8D6E63] font-medium uppercase tracking-wider",children:""}),e.jsx("span",{className:"text-base font-black text-[#5D4037] leading-none",children:t.appeal})]})]})}),e.jsx("button",{onClick:y=>{y.stopPropagation(),l()},className:"absolute top-3 right-3 z-40 group hover:scale-105 active:scale-95 transition-all",children:e.jsxs("div",{className:"bg-gradient-to-b from-[#6D4C41] to-[#5D4037] w-11 h-13 rounded-xl shadow-xl flex flex-col items-center justify-center gap-0.5 border border-[#8D6E63]/50 px-1 py-2",children:[e.jsx("div",{className:"text-lg",children:""}),e.jsx("div",{className:"text-[6px] font-bold text-[#D7CCC8]",children:""})]})}),i&&e.jsxs("button",{onClick:z,className:"absolute top-3 left-1/2 -translate-x-1/2 z-50 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg border border-[#E8DCC8] flex items-center gap-2 hover:bg-white active:scale-95 transition-all animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 text-[#8D6E63]",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955a1.126 1.126 0 0 1 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),e.jsx("span",{className:"text-xs font-bold text-[#5D4037]",children:""})]}),i&&(B==null?void 0:B.isUnlocked)&&e.jsxs("div",{className:"absolute bottom-3 left-3 right-3 z-50 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2 justify-center",children:[[{mode:"none",icon:"",label:""},{mode:"sticker",icon:"",label:""},{mode:"wallpaper",icon:"",label:""},{mode:"floor",icon:"",label:""}].map(y=>e.jsxs("button",{onClick:()=>m(y.mode),className:`flex items-center gap-1 px-3 py-2 rounded-xl text-xs font-bold transition-all ${f===y.mode?"bg-[#5D4037] text-white shadow-lg scale-105":"bg-white/80 text-[#8D6E63] shadow-sm hover:bg-white"}`,children:[e.jsx("span",{children:y.icon}),e.jsx("span",{children:y.label})]},y.mode)),e.jsxs("button",{onClick:()=>D(i),className:"flex items-center gap-1 px-3 py-2 rounded-xl text-xs font-bold bg-white/80 text-[#8D6E63] shadow-sm hover:bg-white transition-all",children:[e.jsx("span",{children:""}),e.jsx("span",{children:""})]})]}),f==="sticker"&&e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl border border-[#E8DCC8] p-3 max-h-[35vh] overflow-y-auto",children:[e.jsx("div",{className:"flex gap-1 mb-2",children:["floor","leftWall","rightWall"].map(y=>e.jsx("button",{onClick:()=>g(y),className:`px-2 py-1 rounded-lg text-[10px] font-bold transition-all ${x===y?"bg-[#5D4037] text-white":"bg-[#FDF6E3] text-[#8D6E63]"}`,children:y==="floor"?"":y==="leftWall"?"":""},y))}),e.jsx("div",{className:"flex gap-1 mb-2 overflow-x-auto no-scrollbar",children:["decor","wall","furniture","food","floor","pet"].map(y=>e.jsx("button",{onClick:()=>Q(y),className:`px-2 py-0.5 rounded-full text-[9px] font-bold whitespace-nowrap transition-all ${M===y?"bg-[#FFE0B2] text-[#E65100]":"bg-slate-100 text-slate-500"}`,children:y==="decor"?"":y==="wall"?"":y==="furniture"?"":y==="food"?"":y==="floor"?"":""},y))}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:$g.filter(y=>y.category===M).map(y=>e.jsx("button",{onClick:()=>oe(i,y.url,x),className:"w-10 h-10 rounded-xl bg-[#FDF6E3] hover:bg-[#FFE0B2] flex items-center justify-center text-xl transition-all hover:scale-110 active:scale-95 border border-[#E8DCC8]",title:y.name,children:y.url},y.id))}),e.jsx("p",{className:"text-[9px] text-center text-[#BCAAA4] mt-2",children:" |  | "})]}),f==="wallpaper"&&e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl border border-[#E8DCC8] p-3",children:[e.jsx("div",{className:"flex gap-1 mb-2",children:["leftWall","rightWall"].map(y=>e.jsx("button",{onClick:()=>g(y),className:`px-3 py-1 rounded-lg text-[10px] font-bold transition-all ${x===y?"bg-[#5D4037] text-white":"bg-[#FDF6E3] text-[#8D6E63]"}`,children:y==="leftWall"?"":""},y))}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Sg.map(y=>e.jsxs("button",{onClick:()=>te(i,x==="leftWall"?"leftWall":"rightWall",y.style),className:"flex flex-col items-center gap-1 group",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg border-2 border-[#E8DCC8] group-hover:border-[#FF7043] transition-all shadow-sm group-hover:scale-105",style:{background:y.style}}),e.jsx("span",{className:"text-[8px] text-[#8D6E63] font-medium",children:y.name})]},y.id))})]}),f==="floor"&&e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl border border-[#E8DCC8] p-3",children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Cg.map(y=>e.jsxs("button",{onClick:()=>L(i,y.style),className:"flex flex-col items-center gap-1 group",children:[e.jsx("div",{className:"w-14 h-10 rounded-lg border-2 border-[#E8DCC8] group-hover:border-[#FF7043] transition-all shadow-sm group-hover:scale-105",style:{background:y.style}}),e.jsx("span",{className:"text-[8px] text-[#8D6E63] font-medium",children:y.name})]},y.id))})})]}),j&&(()=>{const y=fe(j),W=di[j]||150;return e.jsx("div",{className:"absolute inset-0 z-[60] flex items-center justify-center bg-black/30 backdrop-blur-[2px] animate-fade-in",onClick:()=>T(null),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-5 mx-6 max-w-[280px] w-full animate-pop-in",onClick:se=>se.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:""}),e.jsxs("h3",{className:"font-bold text-lg text-[#5D4037]",children:[" ",(y==null?void 0:y.name)||"",""]}),e.jsxs("p",{className:"text-xs text-[#A1887F] mt-1",children:[" ",e.jsxs("span",{className:"font-bold text-[#FF7043]",children:[W," AP"]})," "]}),e.jsxs("p",{className:"text-[10px] text-[#BCAAA4] mt-1",children:[" AP: ",t.actionPoints]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(null),className:"flex-1 py-3 rounded-xl bg-[#EFEBE9] text-[#8D6E63] font-bold text-sm active:scale-95 transition-all",children:""}),e.jsx("button",{onClick:()=>ve(j),disabled:t.actionPoints<W,className:`flex-1 py-3 rounded-xl font-bold text-sm transition-all ${t.actionPoints>=W?"bg-gradient-to-r from-[#FF8A65] to-[#FF7043] text-white shadow-lg active:scale-95":"bg-slate-200 text-slate-400"}`,children:" "})]})]})})})(),$&&(()=>{const y=fe($);return e.jsx("div",{className:"absolute inset-0 z-[60] flex items-end justify-center bg-black/30 backdrop-blur-[2px] animate-fade-in",onClick:()=>D(null),children:e.jsxs("div",{className:"bg-white rounded-t-2xl shadow-2xl p-4 w-full max-h-[60%] overflow-y-auto animate-slide-up",onClick:W=>W.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("h3",{className:"font-bold text-base text-[#5D4037]",children:" "}),e.jsxs("p",{className:"text-[10px] text-[#A1887F]",children:["",y==null?void 0:y.name,""]})]}),e.jsx("div",{className:"space-y-2",children:ci.map(W=>{const se=(y==null?void 0:y.layoutId)===W.id;return e.jsxs("button",{onClick:()=>!se&&F($,W.id),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${se?"bg-[#FFF3E0] border-2 border-[#FF7043]":"bg-[#FDF6E3] border border-[#E8DCC8] hover:border-[#FFB74D]"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-white flex items-center justify-center text-2xl shadow-sm",children:W.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-sm text-[#5D4037]",children:W.name}),se&&e.jsx("span",{className:"text-[8px] bg-[#FF7043] text-white px-1.5 py-0.5 rounded-full font-bold",children:""})]}),e.jsx("p",{className:"text-[10px] text-[#A1887F]",children:W.description})]}),W.apCost>0&&!se&&e.jsxs("div",{className:"text-xs font-bold text-[#FF7043]",children:[W.apCost," AP"]}),W.apCost===0&&!se&&e.jsx("div",{className:"text-xs font-bold text-green-500",children:""})]},W.id)})}),e.jsx("button",{onClick:()=>D(null),className:"w-full mt-3 py-3 rounded-xl bg-[#EFEBE9] text-[#8D6E63] font-bold text-sm active:scale-95 transition-all",children:""})]})})})()]})},Eg=({state:t,characters:s=[],onUnlockRecipe:n,onHireStaff:r,onStaffRest:a,onUpdateConfig:o,onAddGoal:l,onDeleteGoal:c,onEditStaff:i})=>{var ee;const[d,h]=u.useState("menu"),[p,f]=u.useState(!1),[m,x]=u.useState(""),[g,A]=u.useState("waiter"),[w,b]=u.useState(""),[v,j]=u.useState(""),[T,$]=u.useState(!1),D=u.useRef(null),[M,Q]=u.useState("url"),[q,re]=u.useState(""),ce=async z=>{var F;const ve=(F=z.target.files)==null?void 0:F[0];if(ve)try{const te=await Ut(ve);b(te)}catch(te){console.error("Failed to process image",te)}},fe=z=>{re(z),(z.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)/i)||z.match(/^https?:\/\/.+/i))&&b(z)},me=()=>{if(!m)return;const z={id:`staff-custom-${Date.now()}`,name:m,avatar:w,role:g,maxFatigue:100,fatigue:0,hireDate:Date.now()};if(T&&v){z.isPet=!0,z.ownerCharId=v;const ve=s.find(F=>F.id===v);ve&&(z.personality=`${ve.name}`)}r(z,T?150:200),f(!1),x(""),b(""),j(""),$(!1),re(""),Q("url")};return e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"flex bg-white/60 backdrop-blur-sm p-1.5 rounded-2xl shadow-sm border border-[#E8DCC8]",children:[{key:"menu",label:"",icon:""},{key:"staff",label:"",icon:""},{key:"goals",label:"",icon:""}].map(z=>e.jsxs("button",{onClick:()=>h(z.key),className:`flex-1 py-2.5 px-3 text-xs font-bold rounded-xl transition-all duration-300 flex items-center justify-center gap-1.5 ${d===z.key?"bg-gradient-to-br from-[#8D6E63] to-[#6D4C41] text-white shadow-lg":"text-[#8D6E63] hover:bg-[#FDF6E3]"}`,children:[e.jsx("span",{children:z.icon}),e.jsx("span",{children:z.label})]},z.key))}),d==="menu"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("h3",{className:"text-sm font-bold text-[#5D4037]",children:""}),e.jsxs("span",{className:"text-[10px] text-[#A1887F] bg-[#FDF6E3] px-2 py-1 rounded-full",children:[" ",t.shop.unlockedRecipes.length,"/",fc.length]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:fc.map(z=>{const ve=t.shop.unlockedRecipes.includes(z.id);return e.jsxs("div",{className:`relative p-4 rounded-2xl transition-all duration-300 ${ve?"bg-white shadow-md border border-[#E8DCC8]":"bg-gradient-to-br from-[#F5F0E8] to-[#EDE5D8] border border-[#E0D5C5]"}`,children:[ve&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-br from-[#66BB6A] to-[#43A047] rounded-full flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white text-xs",children:""})}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:`text-4xl mb-2 ${ve?"":"grayscale opacity-60"}`,children:z.icon}),e.jsx("div",{className:`font-bold text-sm mb-1 ${ve?"text-[#5D4037]":"text-[#8D6E63]"}`,children:z.name}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-[#A1887F]",children:[e.jsx("span",{className:"text-yellow-500",children:""}),e.jsxs("span",{children:[" +",z.appeal]})]}),!ve&&e.jsxs("button",{onClick:()=>n(z.id,z.cost),className:"mt-3 w-full py-2 bg-gradient-to-r from-[#FF8A65] to-[#FF7043] text-white rounded-xl text-xs font-bold shadow-md hover:shadow-lg active:scale-95 transition-all",children:["  ",z.cost," AP"]})]})]},z.id)})})]}),d==="staff"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-[#5D4037] flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-gradient-to-br from-[#A5D6A7] to-[#66BB6A] rounded-lg flex items-center justify-center text-white text-xs",children:""}),""]}),e.jsx("span",{className:"text-[10px] text-[#A1887F]",children:""})]}),e.jsx("div",{className:"space-y-3",children:t.shop.staff.map(z=>e.jsx("div",{className:"bg-white p-4 rounded-2xl border border-[#E8DCC8] shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group",onClick:()=>i(z),children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-[#FFF8E1] to-[#FFE0B2] flex items-center justify-center text-3xl shadow-inner group-hover:scale-105 transition-transform",children:z.avatar.startsWith("http")||z.avatar.startsWith("data")?e.jsx("img",{src:z.avatar,className:"w-full h-full object-cover rounded-xl"}):z.avatar}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${z.fatigue>80?"bg-red-400":z.fatigue>50?"bg-yellow-400":"bg-green-400"}`})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-[#5D4037] group-hover:text-[#FF7043] transition-colors",children:z.name}),e.jsx("div",{className:"text-[10px] text-[#A1887F] uppercase tracking-wider",children:z.role==="manager"?"":z.role==="chef"?"":""}),e.jsxs("div",{className:"mt-1.5 flex items-center gap-2",children:[e.jsx("span",{className:"text-[9px] text-[#BCAAA4]",children:""}),e.jsx("div",{className:"w-20 h-2 bg-[#EFEBE9] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${z.fatigue>80?"bg-gradient-to-r from-red-400 to-red-500":z.fatigue>50?"bg-gradient-to-r from-yellow-400 to-orange-400":"bg-gradient-to-r from-green-400 to-emerald-500"}`,style:{width:`${Math.max(5,100-z.fatigue)}%`}})})]})]})]}),e.jsx("button",{onClick:()=>a(z.id),disabled:z.fatigue===0,className:`px-4 py-2 rounded-xl text-xs font-bold transition-all ${z.fatigue===0?"bg-[#EFEBE9] text-[#BCAAA4] cursor-not-allowed":"bg-gradient-to-r from-[#81C784] to-[#66BB6A] text-white shadow-md hover:shadow-lg active:scale-95"}`,children:z.fatigue===0?"":" 20AP"})]})},z.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-[#5D4037] flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-gradient-to-br from-[#90CAF9] to-[#42A5F5] rounded-lg flex items-center justify-center text-white text-xs",children:"+"}),""]}),e.jsx("button",{onClick:()=>f(!p),className:"text-[10px] font-bold text-[#42A5F5] bg-[#E3F2FD] px-3 py-1.5 rounded-lg hover:bg-[#BBDEFB] transition-colors",children:p?"":" "})]}),p&&e.jsxs("div",{className:"bg-gradient-to-br from-white to-[#FDF6E3] p-4 rounded-2xl border-2 border-dashed border-[#FFE0B2] mb-4 space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-[#FFE0B2]/30 to-[#FFCC80]/30 p-3 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:""}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-[#8D6E63]",children:""}),e.jsx("div",{className:"text-[9px] text-[#A1887F]",children:""})]})]}),e.jsx("button",{onClick:()=>$(!T),className:`w-12 h-6 rounded-full transition-all duration-300 relative ${T?"bg-gradient-to-r from-[#FF8A65] to-[#FF7043]":"bg-[#E8DCC8]"}`,children:e.jsx("div",{className:`absolute top-1 w-4 h-4 bg-white rounded-full shadow-md transition-all duration-300 ${T?"left-7":"left-1"}`})})]}),T&&s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-[#A1887F] uppercase",children:""}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:s.map(z=>e.jsxs("button",{onClick:()=>j(z.id),className:`flex-shrink-0 flex flex-col items-center p-2 rounded-xl transition-all ${v===z.id?"bg-gradient-to-br from-[#FF8A65] to-[#FF7043] shadow-lg scale-105":"bg-white border border-[#E8DCC8] hover:border-[#FF7043]"}`,children:[e.jsx("img",{src:z.avatar,className:"w-10 h-10 rounded-lg object-cover"}),e.jsx("span",{className:`text-[9px] font-bold mt-1 truncate max-w-[50px] ${v===z.id?"text-white":"text-[#5D4037]"}`,children:z.name})]},z.id))})]}),e.jsx("input",{value:m,onChange:z=>x(z.target.value),placeholder:T?"":"",className:"w-full bg-white rounded-xl px-4 py-2.5 text-sm border border-[#E8DCC8] outline-none focus:border-[#FF7043] transition-colors"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-[10px] font-bold text-[#A1887F] uppercase",children:""}),e.jsxs("div",{className:"flex bg-[#F5F0E8] p-0.5 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>Q("url"),className:`px-2 py-1 text-[9px] font-bold rounded-md transition-all ${M==="url"?"bg-gradient-to-r from-[#42A5F5] to-[#1E88E5] text-white":"text-[#8D6E63]"}`,children:" URL"}),e.jsx("button",{type:"button",onClick:()=>Q("upload"),className:`px-2 py-1 text-[9px] font-bold rounded-md transition-all ${M==="upload"?"bg-gradient-to-r from-[#42A5F5] to-[#1E88E5] text-white":"text-[#8D6E63]"}`,children:" "})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-14 h-14 flex-shrink-0 bg-white rounded-xl border border-[#E8DCC8] flex items-center justify-center overflow-hidden",children:w.startsWith("data:")||w.startsWith("http")?e.jsx("img",{src:w,className:"w-full h-full object-cover",onError:()=>b("")}):e.jsx("span",{className:"text-2xl",children:w})}),M==="url"?e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("input",{type:"url",value:q,onChange:z=>fe(z.target.value),placeholder:" https://...",className:"w-full bg-white rounded-xl px-3 py-2 text-xs border border-[#E8DCC8] outline-none focus:border-[#42A5F5] transition-colors"}),e.jsxs("div",{className:"text-[9px] text-[#66BB6A] flex items-center gap-1",children:[e.jsx("span",{children:""}),e.jsx("span",{children:""})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsx("button",{type:"button",onClick:()=>{var z;return(z=D.current)==null?void 0:z.click()},className:"w-full py-2 bg-[#FDF6E3] border border-dashed border-[#BCAAA4] rounded-xl text-xs text-[#8D6E63] hover:bg-[#FFF8E1] hover:border-[#8D6E63] transition-all",children:" "}),e.jsx("div",{className:"text-[9px] text-[#BCAAA4] mt-1 text-center",children:""}),e.jsx("input",{ref:D,type:"file",accept:"image/*",className:"hidden",onChange:ce})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("select",{value:g,onChange:z=>A(z.target.value),className:"bg-white rounded-xl px-3 py-2 text-xs border border-[#E8DCC8] outline-none text-[#5D4037]",children:[e.jsx("option",{value:"waiter",children:T?" ":" "}),e.jsx("option",{value:"chef",children:T?" ":" "}),e.jsx("option",{value:"manager",children:T?" ":" "})]}),e.jsx("button",{onClick:me,disabled:!m||T&&!v,className:`px-5 py-2.5 rounded-xl text-xs font-bold shadow-md transition-all ${!m||T&&!v?"bg-[#E8DCC8] text-[#A1887F] cursor-not-allowed":"bg-gradient-to-r from-[#42A5F5] to-[#1E88E5] text-white hover:shadow-lg active:scale-95"}`,children:T?"  150 AP":"  200 AP"})]}),T&&v&&e.jsxs("div",{className:"bg-[#FFF3E0] p-3 rounded-xl text-[10px] text-[#E65100] flex items-start gap-2",children:[e.jsx("span",{className:"text-base",children:""}),e.jsxs("span",{children:[" ",(ee=s.find(z=>z.id===v))==null?void 0:ee.name," "]})]})]}),e.jsxs("div",{className:"space-y-2",children:[qu.filter(z=>!t.shop.staff.find(ve=>ve.name===z.name)).map(z=>e.jsxs("div",{className:"bg-[#FDF6E3] p-4 rounded-2xl border border-[#E8DCC8] flex items-center justify-between hover:bg-[#FFF8E1] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-white/60 flex items-center justify-center text-2xl grayscale-[50%] opacity-80",children:z.avatar}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-[#5D4037]",children:z.name}),e.jsx("div",{className:"text-[10px] text-[#A1887F] uppercase tracking-wider",children:z.role==="manager"?"":z.role==="chef"?"":""})]})]}),e.jsx("button",{onClick:()=>r({...z,id:`staff-${Date.now()}`,fatigue:0,hireDate:Date.now()},200),className:"bg-gradient-to-r from-[#FF8A65] to-[#FF7043] text-white px-4 py-2 rounded-xl text-xs font-bold shadow-md hover:shadow-lg active:scale-95 transition-all",children:"  200 AP"})]},z.id)),qu.every(z=>t.shop.staff.find(ve=>ve.name===z.name))&&!p&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-2 opacity-50",children:""}),e.jsx("div",{className:"text-xs text-[#A1887F]",children:""})]})]})]})]}),d==="goals"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:l,className:"w-full py-4 border-2 border-dashed border-[#BCAAA4] text-[#8D6E63] rounded-2xl font-bold hover:bg-[#FDF6E3] hover:border-[#8D6E63] transition-all flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 bg-[#EFEBE9] rounded-full flex items-center justify-center text-sm",children:"+"}),""]}),t.goals.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-3 opacity-40",children:""}),e.jsx("div",{className:"text-sm text-[#A1887F]",children:""}),e.jsx("div",{className:"text-xs text-[#BCAAA4] mt-1",children:""})]}):t.goals.map(z=>{const ve=Math.min(100,z.currentAmount/z.targetAmount*100);return e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-[#E8DCC8] shadow-sm relative group overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#C8E6C9] to-[#A5D6A7] opacity-20 transition-all duration-700",style:{width:`${ve}%`}}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:z.icon||""}),e.jsx("span",{className:"font-bold text-[#5D4037]",children:z.name})]}),e.jsxs("span",{className:"font-mono font-bold text-[#FF7043] text-lg",children:[t.config.currencySymbol,z.targetAmount]})]}),e.jsx("div",{className:"h-3 bg-[#EFEBE9] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#66BB6A] to-[#43A047] rounded-full transition-all duration-700 relative",style:{width:`${ve}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/30 to-transparent"})})}),e.jsxs("div",{className:"flex justify-between mt-2 text-[10px]",children:[e.jsxs("span",{className:"text-[#A1887F]",children:[" ",t.config.currencySymbol,z.currentAmount]}),e.jsxs("span",{className:"text-[#66BB6A] font-bold",children:[ve.toFixed(0),"%"]})]})]}),e.jsx("button",{onClick:()=>c(z.id),className:"absolute top-3 right-3 w-6 h-6 rounded-full bg-red-50 text-red-400 hover:bg-red-100 hover:text-red-500 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all",children:""})]},z.id)})]})]})},po={food:{icon:"",label:"",color:"#FF7043",gradient:"from-orange-400 to-red-500"},transport:{icon:"",label:"",color:"#42A5F5",gradient:"from-blue-400 to-indigo-500"},shopping:{icon:"",label:"",color:"#AB47BC",gradient:"from-purple-400 to-pink-500"},entertainment:{icon:"",label:"",color:"#66BB6A",gradient:"from-green-400 to-teal-500"},bills:{icon:"",label:"",color:"#FFA726",gradient:"from-yellow-400 to-orange-500"},health:{icon:"",label:"",color:"#EF5350",gradient:"from-red-400 to-rose-500"},education:{icon:"",label:"",color:"#5C6BC0",gradient:"from-indigo-400 to-purple-500"},other:{icon:"",label:"",color:"#78909C",gradient:"from-gray-400 to-slate-500"}},Ig=({transactions:t,goals:s,currency:n,onDeleteTx:r,apiConfig:a,dailyBudget:o=100})=>{const[l,c]=u.useState("today"),[i,d]=u.useState(!1),[h,p]=u.useState({}),[f,m]=u.useState(""),x=new Date().toISOString().split("T")[0],g=new Date().toISOString().slice(0,7),w=(()=>{const re=new Date,ce=re.getDay(),fe=re.getDate()-ce+(ce===0?-6:1);return new Date(re.setDate(fe)).toISOString().split("T")[0]})(),b=u.useMemo(()=>t.filter(re=>l==="today"?re.dateStr===x:l==="week"?re.dateStr>=w:l==="month"?re.dateStr.startsWith(g):!0),[t,l,x,w,g]),v=u.useMemo(()=>b.reduce((re,ce)=>re+ce.amount,0),[b]),j=u.useMemo(()=>{const re={};return b.forEach(ce=>{const fe=h[ce.id]||T(ce.note);re[fe]||(re[fe]={total:0,count:0,items:[]}),re[fe].total+=ce.amount,re[fe].count++,re[fe].items.push(ce)}),Object.entries(re).map(([ce,fe])=>({category:ce,...fe,percentage:v>0?fe.total/v*100:0})).sort((ce,fe)=>fe.total-ce.total)},[b,h,v]);function T(re){const ce=re.toLowerCase();return/|||||||||||||/.test(ce)?"food":/|||||||/.test(ce)?"transport":/|||||||/.test(ce)?"shopping":/|||ktv||/.test(ce)?"entertainment":/|||||/.test(ce)?"bills":/||||/.test(ce)?"health":/||||/.test(ce)?"education":"other"}const $=async()=>{if(!(!(a!=null&&a.apiKey)||b.length===0)){d(!0);try{const fe=`

${b.map(ee=>`- ${ee.note}: ${n}${ee.amount}`).join(`
`)}


1.  (food/transport/shopping/entertainment/bills/health/education/other)
2. 2-3${l==="today"?"":l==="week"?"":""}

JSON
{
  "categories": { "1": "", "2": "" },
  "summary": ""
}`,me=await fetch(`${a.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:fe}]})});if(me.ok){let z=(await me.json()).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim();const ve=JSON.parse(z),F={...h};b.forEach(te=>{ve.categories[te.note]&&(F[te.id]=ve.categories[te.note])}),p(F),m(ve.summary||"")}}catch(re){console.error("AI analysis failed:",re)}finally{d(!1)}}},D=u.useMemo(()=>s.reduce((re,ce)=>re+ce.currentAmount,0),[s]),M=u.useMemo(()=>s.find(re=>!re.isCompleted)||s[0],[s]),Q=o-(l==="today"?v:0),q=Q>=0?"good":"over";return e.jsxs("div",{className:"min-h-full pb-24",style:{background:"linear-gradient(180deg, #FDF6E3 0%, #FFF8E1 100%)"},children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#6D4C41] via-[#5D4037] to-[#4E342E]"}),e.jsx("div",{className:"absolute top-0 right-0 w-48 h-48 bg-white/5 rounded-full blur-3xl -mr-20 -mt-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full blur-2xl -ml-10 -mb-10"}),e.jsxs("div",{className:"relative z-10 p-5 pt-3",children:[e.jsx("div",{className:"flex bg-white/10 backdrop-blur-sm p-1 rounded-2xl mb-5",children:[{key:"today",label:"",icon:""},{key:"week",label:"",icon:""},{key:"month",label:"",icon:""}].map(re=>e.jsxs("button",{onClick:()=>c(re.key),className:`flex-1 py-2.5 text-xs font-bold rounded-xl transition-all duration-300 flex items-center justify-center gap-1.5 ${l===re.key?"bg-white text-[#5D4037] shadow-lg":"text-white/70 hover:text-white"}`,children:[e.jsx("span",{children:re.icon}),e.jsx("span",{children:re.label})]},re.key))}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-xs text-white/60 uppercase tracking-widest mb-1",children:l==="today"?"":l==="week"?"":""}),e.jsxs("div",{className:"text-5xl font-black text-white font-mono tracking-tight",children:[n,v.toFixed(0)]}),e.jsxs("div",{className:"text-sm text-white/50 mt-1",children:[" ",b.length," "]})]}),l==="today"&&e.jsxs("div",{className:`p-4 rounded-2xl backdrop-blur-md border ${q==="good"?"bg-green-500/20 border-green-400/30":"bg-red-500/20 border-red-400/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:q==="good"?"":""}),e.jsx("span",{className:"text-sm text-white font-medium",children:q==="good"?"":""})]}),e.jsxs("span",{className:`text-2xl font-black font-mono ${q==="good"?"text-green-300":"text-red-300"}`,children:[q==="good"?"+":"",n,Math.abs(Q).toFixed(0)]})]}),e.jsx("div",{className:"mt-2 h-2 bg-black/20 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${q==="good"?"bg-green-400":"bg-red-400"}`,style:{width:`${Math.min(100,v/o*100)}%`}})}),e.jsxs("div",{className:"text-[10px] text-white/50 mt-1 text-right",children:[" ",n,o]})]})]})]}),e.jsxs("div",{className:"p-5 space-y-5",children:[(f||b.length>0)&&e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-lg border border-[#E8DCC8] relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-[#FFE0B2]/30 to-transparent rounded-full -mr-8 -mt-8"}),e.jsxs("div",{className:"flex items-center justify-between mb-3 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-8 bg-gradient-to-br from-[#FFD54F] to-[#FFB300] rounded-xl flex items-center justify-center text-lg shadow-md",children:""}),e.jsx("span",{className:"text-sm font-bold text-[#5D4037]",children:"AI "})]}),e.jsx("button",{onClick:$,disabled:i||!(a!=null&&a.apiKey),className:`px-4 py-2 rounded-xl text-xs font-bold transition-all ${i?"bg-[#EFEBE9] text-[#BCAAA4]":"bg-gradient-to-r from-[#42A5F5] to-[#1E88E5] text-white shadow-md hover:shadow-lg active:scale-95"}`,children:i?e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),""]}):""})]}),f?e.jsxs("div",{className:"bg-gradient-to-r from-[#FFF8E1] to-[#FFF3E0] p-4 rounded-2xl text-sm text-[#5D4037] leading-relaxed relative z-10",children:[e.jsx("span",{className:"text-lg mr-2",children:""}),f]}):e.jsx("div",{className:"text-center py-4 text-[#BCAAA4] text-xs",children:'"" AI '})]}),j.length>0&&e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-md border border-[#E8DCC8]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"w-8 h-8 bg-gradient-to-br from-[#AB47BC] to-[#7B1FA2] rounded-xl flex items-center justify-center text-lg shadow-md",children:""}),e.jsx("span",{className:"text-sm font-bold text-[#5D4037]",children:""})]}),e.jsx("div",{className:"space-y-3",children:j.map(({category:re,total:ce,count:fe,percentage:me})=>{const ee=po[re]||po.other;return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:ee.icon}),e.jsx("span",{className:"text-sm font-bold text-[#5D4037]",children:ee.label}),e.jsxs("span",{className:"text-[10px] text-[#A1887F] bg-[#FDF6E3] px-2 py-0.5 rounded-full",children:[fe,""]})]}),e.jsxs("span",{className:"font-mono font-bold text-[#5D4037]",children:[n,ce.toFixed(0)]})]}),e.jsx("div",{className:"h-3 bg-[#EFEBE9] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r ${ee.gradient} rounded-full transition-all duration-700 relative`,style:{width:`${me}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/30 to-transparent"})})}),e.jsxs("div",{className:"text-right text-[10px] text-[#A1887F] mt-0.5",children:[me.toFixed(1),"%"]})]},re)})})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-md border border-[#E8DCC8]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"w-8 h-8 bg-gradient-to-br from-[#66BB6A] to-[#43A047] rounded-xl flex items-center justify-center text-lg shadow-md",children:""}),e.jsx("span",{className:"text-sm font-bold text-[#5D4037]",children:""})]}),b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-3 opacity-40",children:""}),e.jsx("div",{className:"text-sm text-[#A1887F]",children:l==="today"?"":l==="week"?"":""}),e.jsx("div",{className:"text-xs text-[#BCAAA4] mt-1",children:""})]}):e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto no-scrollbar",children:b.map(re=>{const ce=po[h[re.id]||T(re.note)]||po.other;return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-2xl bg-[#FDF6E3] hover:bg-[#FFF8E1] transition-colors group relative",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-white flex items-center justify-center text-xl shadow-inner",children:ce.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-[#5D4037] text-sm",children:re.note}),e.jsxs("div",{className:"text-[10px] text-[#A1887F] flex items-center gap-2",children:[e.jsx("span",{children:new Date(re.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("span",{className:"px-1.5 py-0.5 bg-white rounded text-[9px]",style:{color:ce.color},children:ce.label})]})]})]}),e.jsxs("div",{className:"font-mono font-bold text-[#E64A19]",children:["-",n,re.amount]}),e.jsx("button",{onClick:()=>r(re.id),className:"absolute right-1 top-1 w-5 h-5 rounded-full bg-red-50 text-red-400 hover:bg-red-100 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all text-xs",children:""})]},re.id)})})]}),s.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-[#8D6E63] to-[#5D4037] rounded-3xl p-5 shadow-lg text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-10 -mt-10"}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 relative z-10",children:[e.jsx("span",{className:"text-xl",children:""}),e.jsx("span",{className:"text-sm font-bold",children:""})]}),e.jsxs("div",{className:"text-3xl font-black font-mono mb-3 relative z-10",children:[n,D.toFixed(0)]}),M&&e.jsxs("div",{className:"bg-white/15 backdrop-blur-sm rounded-xl p-3 relative z-10",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-2",children:[e.jsxs("span",{className:"opacity-80",children:[": ",M.name]}),e.jsxs("span",{className:"font-bold",children:[n,M.targetAmount-M.currentAmount]})]}),e.jsx("div",{className:"h-2 bg-black/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-[#FFE0B2] to-[#FFAB91] rounded-full",style:{width:`${Math.min(100,M.currentAmount/M.targetAmount*100)}%`}})})]})]})]})]})},hi={config:{dailyBudget:100,currencySymbol:""},shop:{actionPoints:100,shopName:"",shopLevel:1,appeal:100,background:"https://sharkpan.xyz/f/5n1gSj/bg.png",staff:[{id:"staff-001",name:"",avatar:"",role:"manager",fatigue:0,maxFatigue:100,hireDate:Date.now(),x:50,y:50,personality:""}],unlockedRecipes:["recipe-coffee-001"],activeVisitor:void 0,guestbook:[]},goals:[],todaySpent:0,lastLoginDate:new Date().toISOString().split("T")[0]},Mg=()=>{const{closeApp:t,characters:s,addToast:n,apiConfig:r,userProfile:a}=mt(),[o,l]=u.useState(hi),[c,i]=u.useState([]),[d,h]=u.useState("game"),[p,f]=u.useState(!1),[m,x]=u.useState(!1),[g,A]=u.useState(!1),[w,b]=u.useState(!1),[v,j]=u.useState(!1),[T,$]=u.useState(""),[D,M]=u.useState(""),[Q,q]=u.useState(""),[re,ce]=u.useState(""),[fe,me]=u.useState(null),ee=u.useRef(null),[z,ve]=u.useState(!1);u.useEffect(()=>{te()},[]);const F=(N,Y)=>{const B=N*50,ue=Y.reduce((P,Ee)=>{const de=fc.find(J=>J.id===Ee);return P+(de?de.appeal:0)},0);return 100+B+ue},te=async()=>{var J;const N=await U.getBankState(),Y=await U.getAllTransactions();let B=N||hi;B.shop||(B={...B,shop:hi.shop},(J=B.pet)!=null&&J.actionPoints&&(B.shop.actionPoints=B.pet.actionPoints)),B.shop.guestbook||(B.shop.guestbook=[]),B.shop.dollhouse||(B.shop.dollhouse=gc);const ue=new Date().toISOString().split("T")[0];if(B.lastLoginDate!==ue){const be=new Date;be.setDate(be.getDate()-1);const y=be.toISOString().split("T")[0],W=Y.filter(_=>_.dateStr===y);let se=0;if(W.length>0){const _=W.reduce((K,ie)=>K+ie.amount,0);se=Math.max(0,Math.floor(B.config.dailyBudget-_))}else se=0;const O=se+10,R=B.shop.staff.map(_=>({..._,fatigue:Math.max(0,_.fatigue-30)}));B={...B,todaySpent:0,lastLoginDate:ue,shop:{...B.shop,actionPoints:(B.shop.actionPoints||0)+O,staff:R,activeVisitor:void 0}},await U.saveBankState(B),n(` ${O} AP (: ${se})`,"success")}const Ee=Y.filter(be=>be.dateStr===ue).reduce((be,y)=>be+y.amount,0),de=F(B.shop.staff.length,B.shop.unlockedRecipes);l({...B,todaySpent:Ee,shop:{...B.shop,appeal:de}}),i(Y.sort((be,y)=>y.timestamp-be.timestamp)),N||A(!0)},L=async()=>{if(!T||isNaN(parseFloat(T))||!D.trim()){n("","error");return}const N=parseFloat(T),Y=new Date().toISOString().split("T")[0],B={id:`tx-${Date.now()}`,amount:N,category:"general",note:D,timestamp:Date.now(),dateStr:Y};await U.saveTransaction(B);const ue=o.todaySpent+N,P={...o,todaySpent:ue};await U.saveBankState(P),i(Ee=>[B,...Ee]),l(P),f(!1),$(""),M(""),ue>o.config.dailyBudget?n("  AP ...","info"):n("","success")},oe=async N=>{const Y=c.find(Ee=>Ee.id===N);if(!Y)return;await U.deleteTransaction(N);let B=o.todaySpent;const ue=new Date().toISOString().split("T")[0];Y.dateStr===ue&&(B=Math.max(0,o.todaySpent-Y.amount));const P={...o,todaySpent:B};await U.saveBankState(P),i(Ee=>Ee.filter(de=>de.id!==N)),l(P),n("","success")},he=N=>{if(o.shop.actionPoints<N)return n(`AP  ( ${N})`,"error"),!1;const Y=o.shop.actionPoints-N,B={...o,shop:{...o.shop,actionPoints:Y}};return l(B),U.saveBankState(B),!0},Te=async N=>{if(!he(20))return;const B=o.shop.staff.map(P=>P.id===N?{...P,fatigue:Math.max(0,P.fatigue-50)}:P),ue={...o,shop:{...o.shop,staff:B,actionPoints:o.shop.actionPoints-20}};await U.saveBankState(ue),l(ue),n("","success")},De=async(N,Y)=>{if(!he(Y))return;const B=[...o.shop.unlockedRecipes,N],ue=F(o.shop.staff.length,B),P={...o,shop:{...o.shop,unlockedRecipes:B,appeal:ue,actionPoints:o.shop.actionPoints-Y}};await U.saveBankState(P),l(P),n("","success")},$e=async(N,Y)=>{if(!he(Y))return;const B=20+Math.random()*60,ue={...N,x:B,y:50},P=[...o.shop.staff,ue],Ee=F(P.length,o.shop.unlockedRecipes),de={...o,shop:{...o.shop,staff:P,appeal:Ee,actionPoints:o.shop.actionPoints-Y}};await U.saveBankState(de),l(de),n("","success")},ge=async()=>{var Y;if(he(40)){if(!r.apiKey){n(" API Key","error");return}ve(!0);try{const B=s.filter(se=>{var C;return se.id!==((C=o.shop.activeVisitor)==null?void 0:C.charId)}),ue=B.length>0?B:s;if(ue.length===0){n("","error");return}const P=ue[Math.floor(Math.random()*ue.length)],Ee=At.buildCoreContext(P,a,!0),J=(await U.getMessagesByCharId(P.id)).slice(-10).map(se=>se.content.substring(0,50)).join(" | "),be=(o.shop.guestbook||[]).slice(0,10).map(se=>`${se.authorName}: ${se.content}`).join(`
`),y=`${Ee}
### Scenario: Savings App Cafe Guestbook
You are visiting the user's "Savings App Cafe" via your phone.
Cafe Name: "${o.shop.shopName}".
Recent Chat Context: ${J}

### Task
Generate a guestbook page update.
1. **${P.name}**: Write a guestbook message. React to the cafe or start drama. (Use your personality).
2. **NPCs**: Generate 3-4 other random messages from strangers or staff.
   - **Themes**: Gossip (e.g. staff fighting), Argument (e.g. arguing about food), Heartwarming story, or Continuing previous drama.
   - **Style**: Internet slang, funny, emotional, or chaotic ("").
   - **Continuity**: If previous guestbook entries show an argument, continue it!

Previous Guestbook:
${be}

### Output JSON Format
[
  { "authorName": "${P.name}", "content": "...", "isChar": true },
  { "authorName": "AngryCustomer", "content": "...", "isChar": false },
  ...
]
`,W=await fetch(`${r.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`},body:JSON.stringify({model:r.model,messages:[{role:"user",content:y}]})});if(W.ok){let C=(await W.json()).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim();const R=JSON.parse(C).map(K=>({id:`gb-${Date.now()}-${Math.random()}`,authorName:K.authorName,content:K.content,isChar:K.isChar,charId:K.isChar?P.id:void 0,avatar:K.isChar?P.avatar:void 0,timestamp:Date.now()})),_={...o,shop:{...o.shop,actionPoints:o.shop.actionPoints-40,guestbook:[...R,...o.shop.guestbook||[]].slice(0,50),activeVisitor:{charId:P.id,message:((Y=R.find(K=>K.isChar))==null?void 0:Y.content)||"~",timestamp:Date.now()}}};await U.saveBankState(_),l(_),n("","success")}else throw new Error("API Error")}catch(B){console.error(B),n(": "+B.message,"error")}finally{ve(!1)}}},I=N=>{me(N),b(!0)},je=async()=>{if(!fe)return;const N=o.shop.staff.map(B=>B.id===fe.id?fe:B),Y={...o,shop:{...o.shop,staff:N}};await U.saveBankState(Y),l(Y),b(!1),me(null),n("","success")},xe=async N=>{var B;const Y=(B=N.target.files)==null?void 0:B[0];if(Y&&fe)try{const ue=await Ut(Y);me({...fe,avatar:ue})}catch{n("","error")}},Ae=async N=>{const Y={...o,config:{...o.config,...N}};await U.saveBankState(Y),l(Y),n("","success")},Le=async()=>{if(!Q||!re)return;const N={id:`goal-${Date.now()}`,name:Q,targetAmount:parseFloat(re),currentAmount:0,icon:"",isCompleted:!1},Y={...o,goals:[...o.goals,N]};await U.saveBankState(Y),l(Y),x(!1),q(""),ce(""),n("","success")};return e.jsxs("div",{className:"h-full w-full flex flex-col font-sans relative overflow-hidden",style:{background:"linear-gradient(180deg, #FDF6E3 0%, #FFF8E1 100%)"},children:[e.jsx("div",{className:"pt-[calc(env(safe-area-inset-top)+1.5rem)] pb-3 px-4 sticky top-0 z-20 shrink-0",style:{background:"linear-gradient(180deg, rgba(141, 110, 99, 0.95) 0%, rgba(109, 76, 65, 0.95) 100%)",backdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-9 h-9 rounded-xl bg-white/15 text-white/90 flex items-center justify-center hover:bg-white/25 active:scale-95 transition-all",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2.5,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-[10px] text-white/60 uppercase tracking-widest",children:" Coffee Tycoon"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-black text-lg text-[#FFE0B2] leading-none",children:o.shop.actionPoints}),e.jsx("span",{className:"text-[10px] text-white/50 font-medium",children:"AP"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(!0),className:"w-9 h-9 rounded-xl bg-white/10 text-white/80 flex items-center justify-center hover:bg-white/20 active:scale-95 transition-all text-sm font-bold",children:"?"}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-1.5 bg-gradient-to-r from-[#FF8A65] to-[#FF7043] text-white px-4 py-2.5 rounded-xl text-xs font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all",style:{boxShadow:"0 4px 14px rgba(255, 112, 67, 0.4)"},children:[e.jsx("span",{className:"text-base",children:"+"}),e.jsx("span",{children:""})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden relative z-10 flex flex-col",children:[d==="game"&&e.jsx(Ag,{shopState:o.shop,characters:s,userProfile:a,apiConfig:r,updateState:async N=>{const Y={...o,shop:N};await U.saveBankState(Y),l(Y)},onStaffClick:I,onOpenGuestbook:()=>j(!0)}),d==="manage"&&e.jsxs("div",{className:"flex-1 overflow-y-auto no-scrollbar p-4",children:[e.jsxs("div",{className:"bg-[#fdf6e3] p-4 rounded-xl border-2 border-[#d3cbb8] mb-4 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-[#586e75]",children:""}),e.jsx("p",{className:"text-[10px] text-[#93a1a1]",children:" =  AP"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-white px-2 py-1 rounded-lg border border-slate-200",children:[e.jsx("span",{className:"text-xs text-slate-400",children:o.config.currencySymbol}),e.jsx("input",{type:"number",value:o.config.dailyBudget,onChange:N=>Ae({dailyBudget:parseFloat(N.target.value)}),className:"w-16 text-right bg-transparent border-none text-lg font-bold text-[#b58900] outline-none p-0"})]})]}),e.jsx(Eg,{state:o,characters:s,onUnlockRecipe:De,onHireStaff:$e,onStaffRest:Te,onUpdateConfig:Ae,onAddGoal:()=>x(!0),onDeleteGoal:N=>{const Y=o.goals.filter(ue=>ue.id!==N),B={...o,goals:Y};U.saveBankState(B),l(B)},onEditStaff:I})]}),d==="report"&&e.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar",children:e.jsx(Ig,{transactions:c,goals:o.goals,currency:o.config.currencySymbol,onDeleteTx:oe,apiConfig:r,dailyBudget:o.config.dailyBudget})})]}),v&&e.jsxs("div",{className:"absolute inset-0 z-50 flex flex-col animate-slide-up",style:{background:"linear-gradient(180deg, #FDF6E3 0%, #FFF8E1 100%)"},children:[e.jsx("div",{className:"pt-[calc(env(safe-area-inset-top)+0.75rem)] pb-3 px-4 shrink-0",style:{background:"linear-gradient(180deg, rgba(141, 110, 99, 0.95) 0%, rgba(109, 76, 65, 0.95) 100%)",backdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/15 rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:""})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-white tracking-wide",children:""}),e.jsx("p",{className:"text-[10px] text-white/60 uppercase tracking-wider",children:"Gossip & Rumors"})]})]}),e.jsx("button",{onClick:()=>j(!1),className:"w-9 h-9 rounded-xl bg-white/15 text-white/90 flex items-center justify-center hover:bg-white/25 active:scale-95 transition-all text-lg font-bold",children:""})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-5",children:[e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-[#E8DCC8] flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-[#FFE0B2] to-[#FFCC80] rounded-xl flex items-center justify-center text-2xl shadow-inner",children:""}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-[#5D4037] text-sm",children:""}),e.jsx("p",{className:"text-[10px] text-[#A1887F] mt-0.5",children:" AP "})]})]}),e.jsx("button",{onClick:ge,disabled:z,className:`px-5 py-3 rounded-xl font-bold text-xs shadow-lg transition-all ${z?"bg-[#EFEBE9] text-[#BCAAA4]":"bg-gradient-to-r from-[#42A5F5] to-[#1E88E5] text-white hover:shadow-xl active:scale-95"}`,children:z?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"..."]}):"  40 AP"})]}),!o.shop.guestbook||o.shop.guestbook.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-7xl mb-4 opacity-40",children:""}),e.jsx("p",{className:"text-sm font-bold text-[#BCAAA4]",children:"..."}),e.jsx("p",{className:"text-xs text-[#D7CCC8] mt-1",children:""})]}):e.jsxs("div",{className:"space-y-4",children:[o.shop.guestbook.map((N,Y)=>e.jsxs("div",{className:`relative p-4 rounded-2xl group animate-fade-in transition-all hover:shadow-md ${N.isChar?"bg-white border-l-4 border-l-[#FF7043] shadow-md":"bg-[#FDF6E3] border border-[#E8DCC8]"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[N.isChar&&e.jsx("span",{className:"w-5 h-5 bg-gradient-to-br from-[#FF8A65] to-[#FF7043] rounded-full flex items-center justify-center text-[10px] text-white",children:""}),e.jsx("span",{className:`font-bold text-sm ${N.isChar?"text-[#E64A19]":"text-[#8D6E63]"}`,children:N.authorName}),e.jsx("span",{className:"text-[9px] text-[#BCAAA4] bg-[#EFEBE9] px-2 py-0.5 rounded-full",children:new Date(N.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"text-lg opacity-30 group-hover:opacity-60 transition-opacity select-none",children:Y%2===0?"":""})]}),e.jsx("p",{className:"text-sm text-[#5D4037] leading-relaxed whitespace-pre-wrap",children:N.content}),N.isChar&&e.jsx("div",{className:"mt-3",children:e.jsx("span",{className:"text-[9px] text-white bg-gradient-to-r from-[#FF8A65] to-[#FF7043] px-3 py-1 rounded-full font-bold shadow-sm",children:" "})})]},N.id)),e.jsx("div",{className:"text-center py-6 text-[10px] text-[#BCAAA4]",children:"  "})]})]})]}),e.jsx("div",{className:"shrink-0 z-30 pb-safe px-4 py-2",style:{background:"linear-gradient(180deg, rgba(255,248,225,0.95) 0%, rgba(253,246,227,0.98) 100%)",backdropFilter:"blur(10px)"},children:e.jsx("div",{className:"flex items-center justify-around bg-white/80 backdrop-blur-sm rounded-2xl p-1.5 shadow-lg border border-[#E8DCC8]",children:[{key:"game",icon:"",label:"",color:"#8D6E63"},{key:"manage",icon:"",label:"",color:"#FF7043"},{key:"report",icon:"",label:"",color:"#66BB6A"}].map(N=>e.jsxs("button",{onClick:()=>h(N.key),className:`flex-1 flex flex-col items-center justify-center py-2.5 rounded-xl transition-all duration-300 ${d===N.key?"bg-gradient-to-br from-[#8D6E63] to-[#6D4C41] shadow-lg scale-105":"hover:bg-[#FDF6E3]"}`,children:[e.jsx("span",{className:`text-xl mb-0.5 ${d===N.key?"transform scale-110":""}`,children:N.icon}),e.jsx("span",{className:`text-[10px] font-bold tracking-wide ${d===N.key?"text-white":"text-[#A1887F]"}`,children:N.label}),d===N.key&&e.jsx("div",{className:"absolute -bottom-1 w-1 h-1 bg-[#FFE0B2] rounded-full"})]},N.key))})}),e.jsx(Ye,{isOpen:p,title:" ",onClose:()=>f(!1),footer:e.jsx("button",{onClick:L,className:"w-full py-4 bg-gradient-to-r from-[#FF8A65] to-[#FF7043] text-white font-bold rounded-2xl shadow-lg hover:shadow-xl active:scale-[0.98] transition-all text-base",children:""}),children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-[#A1887F] uppercase tracking-wider mb-2 block",children:""}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#A1887F] text-lg font-bold",children:o.config.currencySymbol}),e.jsx("input",{type:"number",value:T,onChange:N=>$(N.target.value),className:"w-full bg-[#FDF6E3] border-2 border-[#E8DCC8] rounded-2xl pl-10 pr-4 py-4 text-2xl font-black text-[#5D4037] focus:border-[#FF7043] outline-none transition-colors",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-[#A1887F] uppercase tracking-wider mb-2 block",children:""}),e.jsx("input",{value:D,onChange:N=>M(N.target.value),className:"w-full bg-[#FDF6E3] border-2 border-[#E8DCC8] rounded-2xl px-4 py-4 text-base font-medium text-[#5D4037] focus:border-[#FF7043] outline-none transition-colors",placeholder:""})]})]})}),e.jsx(Ye,{isOpen:m,title:" ",onClose:()=>x(!1),footer:e.jsx("button",{onClick:Le,className:"w-full py-4 bg-gradient-to-r from-[#66BB6A] to-[#43A047] text-white font-bold rounded-2xl shadow-lg hover:shadow-xl active:scale-[0.98] transition-all text-base",children:""}),children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-[#A1887F] uppercase tracking-wider mb-2 block",children:""}),e.jsx("input",{value:Q,onChange:N=>q(N.target.value),placeholder:": Nintendo Switch ",className:"w-full bg-[#FDF6E3] border-2 border-[#E8DCC8] rounded-2xl px-4 py-4 text-base font-medium text-[#5D4037] focus:border-[#66BB6A] outline-none transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-[#A1887F] uppercase tracking-wider mb-2 block",children:""}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#A1887F] text-lg font-bold",children:o.config.currencySymbol}),e.jsx("input",{type:"number",value:re,onChange:N=>ce(N.target.value),placeholder:"2000",className:"w-full bg-[#FDF6E3] border-2 border-[#E8DCC8] rounded-2xl pl-10 pr-4 py-4 text-2xl font-black text-[#5D4037] focus:border-[#66BB6A] outline-none transition-colors"})]})]})]})}),e.jsx(Ye,{isOpen:w,title:" ",onClose:()=>{b(!1),me(null)},footer:e.jsx("button",{onClick:je,className:"w-full py-4 bg-gradient-to-r from-[#42A5F5] to-[#1E88E5] text-white font-bold rounded-2xl shadow-lg hover:shadow-xl active:scale-[0.98] transition-all text-base",children:""}),children:fe&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-24 h-24 rounded-2xl bg-gradient-to-br from-[#FFF8E1] to-[#FFE0B2] border-2 border-[#E8DCC8] flex items-center justify-center text-5xl relative overflow-hidden group cursor-pointer shadow-inner",onClick:()=>{var N;return(N=ee.current)==null?void 0:N.click()},children:[fe.avatar.startsWith("http")||fe.avatar.startsWith("data")?e.jsx("img",{src:fe.avatar,className:"w-full h-full object-cover"}):fe.avatar,e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-bold bg-black/40 px-2 py-1 rounded-lg",children:" "})}),e.jsx("input",{type:"file",ref:ee,className:"hidden",accept:"image/*",onChange:xe})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("input",{value:fe.name,onChange:N=>me({...fe,name:N.target.value}),className:"w-full font-bold text-xl bg-transparent border-b-2 border-[#E8DCC8] focus:border-[#42A5F5] outline-none text-[#5D4037] pb-1",placeholder:""}),e.jsx("div",{className:"inline-flex items-center gap-1.5 text-xs text-white bg-gradient-to-r from-[#8D6E63] to-[#6D4C41] px-3 py-1 rounded-full font-bold",children:fe.role==="manager"?" ":fe.role==="chef"?" ":" "})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-[#A1887F] uppercase tracking-wider mb-2 block",children:" / "}),e.jsx("input",{value:fe.personality||"",onChange:N=>me({...fe,personality:N.target.value}),className:"w-full bg-[#FDF6E3] border-2 border-[#E8DCC8] rounded-2xl px-4 py-3 text-sm text-[#5D4037] focus:border-[#42A5F5] outline-none transition-colors",placeholder:" "})]})]})}),e.jsx(Ye,{isOpen:g,title:" ",onClose:()=>A(!1),children:e.jsxs("div",{className:"space-y-5 text-[#5D4037]",children:[e.jsxs("div",{className:"flex gap-4 p-4 bg-gradient-to-r from-[#FFF8E1] to-[#FFF3E0] rounded-2xl",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-[#FFD54F] to-[#FFB300] rounded-xl flex items-center justify-center text-2xl shadow-md shrink-0",children:""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-base mb-1",children:" =  (AP)"}),e.jsx("p",{className:"text-xs text-[#8D6E63] leading-relaxed",children:" (AP)"})]})]}),e.jsxs("div",{className:"flex gap-4 p-4 bg-gradient-to-r from-[#EFEBE9] to-[#D7CCC8] rounded-2xl",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-[#8D6E63] to-[#6D4C41] rounded-xl flex items-center justify-center text-2xl shadow-md shrink-0",children:""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-base mb-1",children:""}),e.jsx("p",{className:"text-xs text-[#8D6E63] leading-relaxed",children:" AP "})]})]}),e.jsxs("div",{className:"flex gap-4 p-4 bg-gradient-to-r from-[#E3F2FD] to-[#BBDEFB] rounded-2xl",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-[#42A5F5] to-[#1E88E5] rounded-xl flex items-center justify-center text-2xl shadow-md shrink-0",children:""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-base mb-1",children:""}),e.jsxs("p",{className:"text-xs text-[#5C6BC0] leading-relaxed",children:[" ",e.jsx("br",{})," ",e.jsx("br",{})," "]})]})]})]})})]})},_g=({content:t})=>{const s=t.split(`
`);return e.jsx("div",{className:"space-y-4 text-slate-800 leading-relaxed font-sans text-sm",children:s.map((n,r)=>{const a=n.trim();if(!a)return e.jsx("div",{className:"h-2"},r);if(a.startsWith("# "))return e.jsx("h1",{className:"text-2xl font-bold text-black mt-4 border-b pb-2",children:a.slice(2)},r);if(a.startsWith("## "))return e.jsx("h2",{className:"text-xl font-bold text-slate-900 mt-3",children:a.slice(3)},r);if(a.startsWith("### "))return e.jsx("h3",{className:"text-lg font-bold text-slate-800 mt-2",children:a.slice(4)},r);const o=a.match(/\[NOTE_CARD\|(.*?)\|(.*?)\|(.*?)\]/);if(o)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden mb-4 inline-block w-[48%] mr-[2%] align-top break-inside-avoid",children:[e.jsx("div",{className:"aspect-[3/4] bg-slate-200 w-full flex items-center justify-center text-4xl text-slate-400",children:""}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"font-bold text-slate-800 text-xs line-clamp-2 mb-2",children:o[1]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-300"}),e.jsx("span",{className:"text-[10px] text-slate-500 truncate w-12",children:o[2]})]}),e.jsx("div",{className:"flex items-center gap-0.5 text-slate-400",children:e.jsxs("span",{className:"text-[10px]",children:[" ",o[3]]})})]})]})]},r);const l=a.match(/\[VIDEO_CARD\|(.*?)\|(.*?)\|(.*?)\]/);if(l)return e.jsxs("div",{className:"flex gap-3 mb-3 bg-white p-2 rounded-lg shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"w-32 aspect-video bg-slate-800 rounded-md flex items-center justify-center text-white shrink-0 relative",children:[e.jsx("span",{className:"text-xl",children:""}),e.jsx("div",{className:"absolute bottom-1 right-1 text-[8px] bg-black/60 px-1 rounded",children:"12:34"})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1",children:[e.jsx("div",{className:"text-sm text-slate-800 line-clamp-2 leading-tight",children:l[1]}),e.jsxs("div",{className:"text-[10px] text-slate-400 flex flex-col gap-0.5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["UP ",e.jsx("span",{className:"text-slate-500",children:l[2]})]}),e.jsxs("span",{children:[" ",l[3]]})]})]})]},r);if(a.startsWith("- [")||a.startsWith("* [")){const i=a.match(/\[(.*?)\]\((.*?)\)/);if(i)return e.jsxs("div",{className:"py-3 px-3 bg-white rounded-lg border border-slate-100 shadow-sm mb-2 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"text-blue-600 font-medium cursor-pointer hover:underline text-sm mb-1",children:i[1]}),e.jsx("div",{className:"text-green-700 text-[10px] truncate opacity-60 mb-1",children:i[2]}),e.jsx("div",{className:"text-slate-500 text-xs line-clamp-2 leading-normal",children:a.replace(i[0],"").replace(/^[-*]\s*/,"")})]},r)}if(a.startsWith("- ")||a.startsWith("* "))return e.jsxs("div",{className:"flex gap-2 pl-2",children:[e.jsx("span",{className:"text-slate-400",children:""}),e.jsx("span",{children:a.slice(2)})]},r);const c=a.match(/!\[(.*?)\]\((.*?)\)/);return c?e.jsx("div",{className:"my-4 bg-slate-100 rounded-lg overflow-hidden border border-slate-200",children:e.jsxs("div",{className:"h-40 flex items-center justify-center bg-slate-200 text-slate-400 gap-2 flex-col",children:[e.jsx("span",{className:"text-2xl",children:""}),e.jsx("span",{className:"text-xs text-slate-500",children:c[1]||"External Image"})]})},r):a==="---"?e.jsx("hr",{className:"border-t border-slate-200 my-4"},r):e.jsx("p",{children:a},r)})})},Tg=()=>{const{closeApp:t,apiConfig:s,addToast:n}=mt(),[r,a]=u.useState(""),[o,l]=u.useState("home://start"),[c,i]=u.useState("New Tab"),[d,h]=u.useState(""),[p,f]=u.useState(null),[m,x]=u.useState(!1),[g,A]=u.useState(["home://start"]),[w,b]=u.useState(0),[v,j]=u.useState(!1),[T,$]=u.useState(!1),[D,M]=u.useState(localStorage.getItem("browser_brave_key")||""),[Q,q]=u.useState(localStorage.getItem("browser_use_real_search")==="true"),re=u.useRef(null);u.useEffect(()=>{o==="home://start"&&(h(""),f(null),i("New Tab"),j(!1))},[o]);const ce=()=>{localStorage.setItem("browser_brave_key",D),localStorage.setItem("browser_use_real_search",String(Q)),$(!1),n("","success")},fe=(L,oe=!0)=>{let he=L;if(!he.includes(".")&&!he.includes("://")?he=`https://www.google.com/search?q=${encodeURIComponent(he)}`:!he.startsWith("http")&&!he.startsWith("home://")&&(he=`https://${he}`),l(he),a(he),oe){const Te=g.slice(0,w+1);Te.push(he),A(Te),b(Te.length-1)}if(he==="home://start"){i("New Tab"),h(""),f(null);return}ve(he)},me=()=>{if(w>0){const L=w-1;b(L);const oe=g[L];l(oe),a(oe),oe==="home://start"?(i("New Tab"),h(""),f(null)):ve(oe)}},ee=()=>{if(w<g.length-1){const L=w+1;b(L);const oe=g[L];l(oe),a(oe),ve(oe)}},z=()=>{ve(o)},ve=async L=>{var oe;if(!s.apiKey){n(" API Key","error");return}x(!0),j(!1),f(null),h(""),re.current&&(re.current.scrollTop=0);try{const he=L.includes("search?q=");if(he&&Q&&D){const Y=decodeURIComponent(L.split("q=")[1]||"");try{const B=await fetch(`https://api.search.brave.com/res/v1/web/search?q=${Y}&count=10`,{headers:{Accept:"application/json","X-Subscription-Token":D}});if(B.ok){const P=((oe=(await B.json()).web)==null?void 0:oe.results)||[];f(P),j(!0),i(`${Y} - `),x(!1);return}}catch(B){console.warn("Real search failed, falling back to AI simulation",B)}}const Te=L.includes("xiaohongshu")||L.includes(""),De=L.includes("bilibili")||L.includes("");let $e=`You are a text-based web browser simulator. 
Your task is to generate the content of the webpage the user is visiting based on the URL.
Current URL: "${L}"`;Te?$e+=`

### Special Mode: Xiaohongshu (Little Red Book)
You are simulating a social media feed. 
Use a specialized format for posts: \`[NOTE_CARD|Title|Author Name|Likes Count]\`.
Generate 6-8 varied, realistic lifestyle posts (fashion, food, travel, tech) relevant to the context.`:De&&($e+=`

### Special Mode: Bilibili (Video Site)
You are simulating a video platform feed.
Use a specialized format for videos: \`[VIDEO_CARD|Video Title|Uploader Name|View Count]\`.
Generate 5-6 realistic video entries (anime, tech, gaming, daily).`),$e+=`

### Rules
1. **Format**: Use Markdown.
2. **Links**: Include links \`[Link Text](URL)\`.
3. **Tone**: Match the website's tone.
4. **Language**: Match the language of the query/URL (Chinese default for .cn/Chinese queries).
`;let ge="";he?ge=`Simulate a search result page for: "${decodeURIComponent(L.split("q=")[1]||"")}". 
Generate realistic results linking to hypothetical URLs.`:ge=`Simulate the full webpage content for: "${L}". Make it detailed and realistic.`;const I=await fetch(`${s.baseUrl.replace(/\/+$/,"")}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.apiKey}`},body:JSON.stringify({model:s.model,messages:[{role:"system",content:$e},{role:"user",content:ge}],temperature:.6,max_tokens:4e3})});if(!I.ok)throw new Error("Network Error");const xe=(await I.json()).choices[0].message.content,Ae=xe.split(`
`);let Le=L,N=xe;Ae[0].startsWith("# ")&&(Le=Ae[0].replace("# ","").trim()),i(Le),h(N)}catch(he){h(`# 

****: ${he.message}

 API `),i("Error")}finally{x(!1)}},F=()=>p?e.jsxs("div",{className:"space-y-4 animate-fade-in pb-10",children:[p.map((L,oe)=>{var Te,De,$e;const he=new URL(L.url).hostname;return e.jsxs("div",{onClick:()=>fe(L.url),className:"bg-white p-4 rounded-xl shadow-sm border border-slate-100 cursor-pointer active:scale-[0.98] transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-500 mb-1.5",children:[(Te=L.profile)!=null&&Te.img?e.jsx("img",{src:L.profile.img,className:"w-4 h-4 rounded-full object-cover"}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-400 text-[8px]",children:he[0].toUpperCase()}),e.jsx("span",{className:"font-medium text-slate-700",children:((De=L.profile)==null?void 0:De.name)||he}),e.jsx("span",{className:"text-slate-300",children:""}),e.jsx("span",{className:"truncate max-w-[150px] opacity-70",children:L.url})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-blue-600 mb-1.5 leading-snug line-clamp-2 hover:underline",children:L.title}),e.jsxs("p",{className:"text-xs text-slate-600 leading-relaxed line-clamp-3",children:[L.age&&e.jsxs("span",{className:"text-slate-400 mr-1",children:[L.age," "]}),e.jsx("span",{dangerouslySetInnerHTML:{__html:L.description}})]})]}),(($e=L.thumbnail)==null?void 0:$e.src)&&e.jsx("img",{src:L.thumbnail.src,className:"w-24 h-24 object-cover rounded-lg bg-slate-50 shrink-0 border border-slate-100",loading:"lazy"})]})]},oe)}),e.jsx("div",{className:"text-center text-[10px] text-slate-300 pt-4 pb-8",children:"Results provided by Brave Search"})]}):null,te=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full pb-20 p-4 animate-fade-in",children:[e.jsxs("div",{className:"text-5xl font-bold text-slate-300 mb-8 flex flex-col items-center gap-2",children:[e.jsx("span",{children:""}),e.jsx("span",{className:"text-2xl tracking-widest uppercase",children:"Sully Browser"})]}),e.jsx("div",{className:"w-full max-w-sm",children:e.jsxs("form",{onSubmit:L=>{L.preventDefault(),fe(r)},className:"relative group",children:[e.jsx("input",{value:r,onChange:L=>a(L.target.value),placeholder:"Search or type URL",className:"w-full bg-slate-100 border border-slate-200 rounded-full py-4 pl-12 pr-4 shadow-sm focus:shadow-md focus:bg-white focus:border-blue-300 outline-none transition-all text-slate-700",autoFocus:!0}),e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})})})]})}),e.jsx("div",{className:"grid grid-cols-4 gap-6 mt-12 w-full max-w-sm px-4",children:[{name:"Google",icon:"",url:"google.com"},{name:"Bilibili",icon:"",url:"bilibili.com"},{name:"RedBook",icon:"",url:"xiaohongshu.com"},{name:"Sully",icon:"",url:"sully.personal.blog"}].map(L=>e.jsxs("button",{onClick:()=>fe(L.url),className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-50 rounded-2xl flex items-center justify-center text-xl shadow-sm border border-slate-100 group-hover:scale-110 transition-transform group-active:scale-95",children:L.icon}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:L.name})]},L.name))}),e.jsx("div",{className:"mt-12 text-center",children:e.jsxs("button",{onClick:()=>$(!0),className:"text-xs text-slate-400 flex items-center gap-1 hover:text-blue-500 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-3 h-3",children:e.jsx("path",{fillRule:"evenodd",d:"M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.331 1.652a6.993 6.993 0 0 1 1.929 1.115l1.598-.54a1 1 0 0 1 1.186.447l1.18 2.044a1 1 0 0 1-.205 1.251l-1.267 1.113a7.047 7.047 0 0 1 0 2.228l1.267 1.113a1 1 0 0 1 .206 1.25l-1.18 2.045a1 1 0 0 1-1.187.447l-1.598-.54a6.993 6.993 0 0 1-1.929 1.115l-.33 1.652a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.331-1.652a6.993 6.993 0 0 1-1.929-1.115l-1.598.54a1 1 0 0 1-1.186-.447l-1.18-2.044a1 1 0 0 1 .205-1.251l1.267-1.114a7.05 7.05 0 0 1 0-2.227L1.821 7.773a1 1 0 0 1-.206-1.25l1.18-2.045a1 1 0 0 1 1.187-.447l1.598.54A6.992 6.992 0 0 1 7.51 3.456l.33-1.652ZM10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z",clipRule:"evenodd"})})," (Brave API)"]})})]});return e.jsxs("div",{className:"h-full w-full bg-white flex flex-col font-sans relative",children:[e.jsxs("div",{className:"h-28 bg-slate-50 border-b border-slate-200 flex flex-col justify-end px-4 pb-3 shrink-0 z-20 sticky top-0 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600 text-xs font-bold px-2",children:"Close"}),e.jsxs("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${v?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"bg-slate-300"}`}),e.jsx("div",{className:"text-xs font-bold text-slate-800 truncate max-w-[150px]",children:c})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>$(!0),className:"text-slate-400 hover:text-slate-600 p-1 rounded-full bg-slate-200/50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 1 1 0-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 0 1-1.44-4.282m3.102.069a18.03 18.03 0 0 1-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 0 1 8.835 2.535M10.34 6.66a23.847 23.847 0 0 0 8.835-2.535m0 0A23.74 23.74 0 0 0 18.795 3m.38 1.125a23.91 23.91 0 0 1 1.014 5.795 23.92 23.92 0 0 1-1.012 5.795m0-11.589a23.849 23.849 0 0 1-4.92 8.192m4.92-8.192a23.856 23.856 0 0 1 4.92 8.192m0 0a23.856 23.856 0 0 1-4.92 8.192m4.92-8.192a23.91 23.91 0 0 1-1.014 5.795m0-11.589A23.849 23.849 0 0 1 18.795 21M6.75 12h.75"})})}),e.jsx("button",{onClick:z,className:`text-slate-400 hover:text-slate-600 p-1 rounded-full ${m?"animate-spin text-blue-500":""}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})})]})]}),e.jsxs("form",{onSubmit:L=>{L.preventDefault(),fe(r)},className:"flex items-center gap-2 bg-slate-200/50 rounded-xl px-3 py-2 transition-all focus-within:bg-white focus-within:ring-2 focus-within:ring-blue-100 focus-within:shadow-sm",children:[e.jsx("div",{className:"text-slate-400",children:o.startsWith("https")?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:`w-3 h-3 ${v?"text-green-600":"text-slate-400"}`,children:e.jsx("path",{fillRule:"evenodd",d:"M10 2a.75.75 0 0 1 .75.75v.506a5.001 5.001 0 0 1 .533.025c.947.1 1.95.217 2.883.534.364.124.699.27.995.45.353.214.673.475.775.833.08.277.086.598-.037.84a2.532 2.532 0 0 1-.397.643c-.456.602-1.393.896-1.921 1.018a9.497 9.497 0 0 1-1.077.177 10.37 10.37 0 0 1-1.753.072V17.25h1.75a.75.75 0 0 1 0 1.5h-5a.75.75 0 0 1 0-1.5h1.75v-9.39a10.37 10.37 0 0 1-1.754-.073 9.497 9.497 0 0 1-1.076-.176c-.528-.122-1.465-.416-1.92-.1.018a2.532 2.532 0 0 1-.398-.644c-.122-.242-.116-.563-.036-.84.102-.358.422-.619.775-.833.296-.18.63-.326.995-.45.933-.317 1.936-.434 2.883-.534A5.001 5.001 0 0 1 9.25 3.256V2.75A.75.75 0 0 1 10 2Z",clipRule:"evenodd"})}):e.jsx("span",{className:"text-[10px] font-bold",children:""})}),e.jsx("input",{className:"flex-1 bg-transparent text-sm outline-none text-slate-700 placeholder:text-slate-400",value:r,onChange:L=>a(L.target.value),onFocus:()=>{o==="home://start"&&a("")},placeholder:"Search or enter website name"})]})]}),e.jsxs("div",{ref:re,className:"flex-1 overflow-y-auto no-scrollbar relative bg-white",children:[m&&e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-blue-100 overflow-hidden z-20",children:e.jsx("div",{className:"h-full bg-blue-500 animate-progress origin-left"})}),o==="home://start"?te():e.jsxs("div",{className:"p-4 pb-24 min-h-full",children:[v&&!p&&e.jsxs("div",{className:"text-[10px] text-green-600 font-bold bg-green-50 p-2 rounded mb-4 flex items-center gap-2 border border-green-100",children:[e.jsx("span",{children:""}),"  Brave Search "]}),p?F():e.jsx(_g,{content:d})]})]}),e.jsxs("div",{className:"h-12 bg-slate-50 border-t border-slate-200 flex justify-between items-center px-6 pb-safe shrink-0 z-20",children:[e.jsx("button",{onClick:me,disabled:w<=0,className:"p-2 text-slate-500 disabled:opacity-30 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("button",{onClick:ee,disabled:w>=g.length-1,className:"p-2 text-slate-500 disabled:opacity-30 active:scale-90 transition-transform rotate-180",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})})}),e.jsx("button",{className:"p-2 text-slate-500 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})})}),e.jsx("button",{onClick:()=>fe("home://start"),className:"p-2 text-slate-500 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125-1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})})}),e.jsx("button",{className:"p-2 text-slate-500 active:scale-90 transition-transform",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0 1 20.25 6v12A2.25 2.25 0 0 1 18 20.25H6A2.25 2.25 0 0 1 3.75 18V6A2.25 2.25 0 0 1 6 3.75h1.5m9 0h-9"})})})]}),e.jsx(Ye,{isOpen:T,title:"",onClose:()=>$(!1),footer:e.jsx("button",{onClick:ce,className:"w-full py-3 bg-blue-500 text-white font-bold rounded-2xl",children:""}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase mb-2 block",children:"Brave Search API Key"}),e.jsx("input",{value:D,onChange:L=>M(L.target.value),placeholder:"BSA-...",className:"w-full bg-slate-100 rounded-xl px-4 py-3 text-sm focus:outline-blue-500 font-mono"}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-2 leading-relaxed bg-slate-50 p-2 rounded",children:[e.jsx("span",{className:"font-bold",children:""}),"  Key B",e.jsx("br",{})," AI "]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 p-3 rounded-xl border border-slate-100",children:[e.jsx("input",{type:"checkbox",checked:Q,onChange:L=>q(L.target.checked),className:"w-5 h-5 accent-blue-500 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-bold text-slate-700 block",children:" (Experimental)"}),e.jsx("span",{className:"text-[10px] text-slate-400 block",children:" Brave API  AI "})]})]})]})})]})},fo=fr("App",{web:()=>gl(()=>import("./web-CpWTjjmx.js"),[],import.meta.url).then(t=>new t.AppWeb)});var bc;(function(t){t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT"})(bc||(bc={}));var Qu;(function(t){t.None="NONE",t.Slide="SLIDE",t.Fade="FADE"})(Qu||(Qu={}));const xi=fr("StatusBar");class Dg extends u.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){console.error("App Crash:",s,n)}componentDidUpdate(s){s.children!==this.props.children&&this.setState({hasError:!1,error:null})}render(){var s;return this.state.hasError?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-slate-900 text-white p-6 text-center space-y-4",children:[e.jsx("div",{className:"text-4xl",children:""}),e.jsx("h2",{className:"text-lg font-bold",children:""}),e.jsx("p",{className:"text-xs text-slate-400 font-mono bg-black/30 p-2 rounded max-w-full overflow-hidden text-ellipsis",children:((s=this.state.error)==null?void 0:s.message)||"Unknown Error"}),e.jsx("button",{onClick:()=>{this.setState({hasError:!1}),this.props.onCloseApp()},className:"px-6 py-3 bg-red-600 rounded-full font-bold text-sm shadow-lg active:scale-95 transition-transform",children:""})]}):this.props.children}}const Lg=()=>{const{theme:t,isLocked:s,unlock:n,activeApp:r,closeApp:a,virtualTime:o,isDataLoaded:l,toasts:c,unreadMessages:i,characters:d,handleBack:h}=mt();if(u.useEffect(()=>((async()=>{if(Ys.isNativePlatform())try{await xi.setOverlaysWebView({overlay:!0}),await xi.hide(),await xi.setStyle({style:bc.Dark}),(await el.checkPermissions()).display!=="granted"&&await el.requestPermissions()}catch(w){console.error("Native init failed",w)}})(),(async()=>{if(Ys.isNativePlatform())try{await fo.removeAllListeners(),fo.addListener("backButton",({canGoBack:w})=>{s?fo.exitApp():h()})}catch{console.log("Back button listener setup failed")}})(),()=>{Ys.isNativePlatform()&&fo.removeAllListeners().catch(()=>{})}),[r,s,a,h]),u.useEffect(()=>{window.scrollTo(0,0)},[r]),!l)return e.jsx("div",{className:"w-full h-full bg-black flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin"})});const f=(g=>g.startsWith("http")||g.startsWith("data:")||g.startsWith("blob:")?`url(${g})`:g)(t.wallpaper),m=t.contentColor||"#ffffff";if(s){const g=Object.values(i).reduce((b,v)=>b+v,0),A=Object.keys(i)[0],w=A?d.find(b=>b.id===A):null;return e.jsxs("div",{onClick:()=>{"Notification"in window&&Notification.permission!=="granted"&&Notification.requestPermission(),n()},className:"relative w-full h-full bg-cover bg-center cursor-pointer overflow-hidden group font-light select-none overscroll-none",style:{backgroundImage:f,color:m},children:[e.jsx("div",{className:"absolute inset-0 bg-black/5 backdrop-blur-sm transition-all group-hover:backdrop-blur-none group-hover:bg-transparent duration-700"}),e.jsxs("div",{className:"absolute top-24 w-full text-center drop-shadow-[0_2px_4px_rgba(0,0,0,0.3)]",children:[e.jsxs("div",{className:"text-8xl tracking-tighter opacity-95 font-bold",children:[o.hours.toString().padStart(2,"0"),e.jsx("span",{className:"animate-pulse",children:":"}),o.minutes.toString().padStart(2,"0")]}),e.jsx("div",{className:"text-lg tracking-widest opacity-90 mt-2 uppercase text-xs font-bold",children:"SullyOS Simulation"})]}),g>0&&e.jsx("div",{className:"absolute top-[40%] left-4 right-4 animate-slide-up",children:e.jsxs("div",{className:"bg-white/20 backdrop-blur-md rounded-2xl p-4 shadow-lg border border-white/10 flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-500 flex items-center justify-center text-white shrink-0 shadow-sm",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6",children:e.jsx("path",{fillRule:"evenodd",d:"M4.804 21.644A6.707 6.707 0 0 0 6 21.75a6.721 6.721 0 0 0 3.583-1.029c.774.182 1.584.279 2.417.279 5.322 0 9.75-3.97 9.75-9 0-5.03-4.428-9-9.75-9s-9.75 3.97-9.75 9c0 2.409 1.025 4.587 2.674 6.192.232.226.277.428.254.543a3.73 3.73 0 0 1-.814 1.686.75.75 0 0 0 .44 1.223ZM8.25 10.875a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25ZM10.875 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875-1.125a1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25Z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1 min-w-0 text-white text-left",children:[e.jsxs("div",{className:"font-bold text-sm flex justify-between",children:[e.jsx("span",{children:w?w.name:"Message"}),e.jsx("span",{className:"text-[10px] opacity-70",children:""})]}),e.jsx("div",{className:"text-xs opacity-90 truncate",children:g>1?` ${g} `:""})]})]})}),e.jsxs("div",{className:"absolute bottom-12 w-full flex flex-col items-center gap-3 animate-pulse opacity-80 drop-shadow-md",children:[e.jsx("div",{className:"w-1 h-8 rounded-full bg-gradient-to-b from-transparent to-current"}),e.jsx("span",{className:"text-[10px] tracking-widest uppercase font-semibold",children:"Tap to Unlock"})]})]})}const x=()=>{switch(r){case Ze.Settings:return e.jsx($f,{});case Ze.Character:return e.jsx(_f,{});case Ze.Chat:return e.jsx(Ff,{});case Ze.GroupChat:return e.jsx(zf,{});case Ze.ThemeMaker:return e.jsx(Yf,{});case Ze.Appearance:return e.jsx(Jf,{});case Ze.Gallery:return e.jsx(Zf,{});case Ze.Date:return e.jsx(eg,{});case Ze.User:return e.jsx(tg,{});case Ze.Journal:return e.jsx(sg,{});case Ze.Schedule:return e.jsx(ng,{});case Ze.Room:return e.jsx(og,{});case Ze.CheckPhone:return e.jsx(ig,{});case Ze.Social:return e.jsx(cg,{});case Ze.Study:return e.jsx(ug,{});case Ze.FAQ:return e.jsx(hg,{});case Ze.Game:return e.jsx(xg,{});case Ze.Worldbook:return e.jsx(pg,{});case Ze.Novel:return e.jsx(kg,{});case Ze.Bank:return e.jsx(Mg,{});case Ze.Browser:return e.jsx(Tg,{});case Ze.Launcher:default:return e.jsx(cf,{})}};return e.jsxs("div",{className:"relative w-full h-full overflow-hidden bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 text-slate-900 font-sans select-none overscroll-none",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-all duration-700 ease-[cubic-bezier(0.25,0.1,0.25,1)]",style:{backgroundImage:f,transform:r!==Ze.Launcher?"scale(1.1)":"scale(1)",filter:r!==Ze.Launcher?"blur(10px)":"none",opacity:r!==Ze.Launcher?.6:1,willChange:"transform, filter, opacity",backfaceVisibility:"hidden",transformStyle:"preserve-3d"}}),e.jsx("div",{className:`absolute inset-0 transition-all duration-500 ${r===Ze.Launcher?"bg-transparent":"bg-white/50 backdrop-blur-3xl"}`}),e.jsxs("div",{className:"absolute inset-0 z-10 w-full h-full overflow-hidden bg-transparent overscroll-none flex flex-col",style:{paddingTop:r!==Ze.Launcher?"env(safe-area-inset-top)":0,paddingBottom:r!==Ze.Launcher?"env(safe-area-inset-bottom)":0},children:[e.jsx("div",{className:"flex-1 relative overflow-hidden",children:e.jsx(Dg,{onCloseApp:a,children:x()})}),!t.hideStatusBar&&e.jsx(rf,{}),e.jsx("div",{className:"absolute top-12 left-0 w-full flex flex-col items-center gap-2 pointer-events-none z-[60]",children:c.map(g=>e.jsxs("div",{className:"animate-fade-in bg-white/95 backdrop-blur-xl px-4 py-3 rounded-2xl shadow-xl border border-black/5 flex items-center gap-3 max-w-[85%] ring-1 ring-white/20",children:[g.type==="success"&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 shrink-0"}),g.type==="error"&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500 shrink-0"}),g.type==="info"&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-primary shrink-0"}),e.jsx("span",{className:"text-xs font-bold text-slate-800 truncate leading-none",children:g.message})]},g.id))})]})]})},Pg=()=>e.jsxs("div",{className:"h-screen w-full bg-black md:bg-neutral-900 flex items-center justify-center overflow-hidden",children:[e.jsx("div",{className:"hidden md:block fixed inset-0 pointer-events-none opacity-20 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-indigo-900 via-gray-900 to-black"}),e.jsxs("div",{className:`
          fixed inset-0 w-full h-full z-0 bg-black 
          md:relative md:w-auto md:h-[85vh] md:aspect-[9/19.5] md:rounded-[3rem] 
          md:shadow-2xl md:border-[8px] md:border-neutral-800 md:ring-4 md:ring-black/40
          transition-all duration-300
        `,style:{transform:"translateZ(0)"},children:[e.jsxs("div",{className:"hidden md:flex absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-black rounded-b-2xl z-50 pointer-events-none justify-center items-center",children:[e.jsx("div",{className:"w-16 h-1 bg-neutral-800 rounded-full"}),e.jsx("div",{className:"absolute right-6 w-2 h-2 rounded-full bg-blue-900/50 box-border border border-white/10"})]}),e.jsx("div",{className:"hidden md:block absolute -right-[10px] top-24 w-[3px] h-12 bg-neutral-700 rounded-r-md"}),e.jsx("div",{className:"hidden md:block absolute -left-[10px] top-24 w-[3px] h-8 bg-neutral-700 rounded-l-md"}),e.jsx("div",{className:"hidden md:block absolute -left-[10px] top-36 w-[3px] h-8 bg-neutral-700 rounded-l-md"}),e.jsx(nf,{children:e.jsx(Lg,{})})]}),e.jsx("div",{className:"hidden md:block fixed bottom-4 right-4 text-white/20 text-xs font-mono",children:"SullyOS Simulator  Phase 1.1"})]}),wh=document.getElementById("root");if(!wh)throw new Error("Could not find root element to mount to");const Rg=pi.createRoot(wh);Rg.render(e.jsx(Sn.StrictMode,{children:e.jsx(Pg,{})}));export{Qo as E,fh as W,wf as b};
